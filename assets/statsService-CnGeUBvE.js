import{r as p,d as P,g as K,p as N,s as q}from"./prerender-BIIx8aII.js";import"./vendor-BsMbSbDn.js";function C(n,u){return n==="solutionhunt"?"solutionhunt_standard":`${n==="daily"?"daily":"marathon"}_${u?"speedrun":"standard"}`}const U={1:0,2:0,3:0,4:0,5:0,6:0};async function J({uid:n,mode:u,speedrunEnabled:s,dateString:e,guesses:m,solveTimeMs:t=null,numBoards:l=1,solved:o=!0,marathonIndex:T=null,marathonTotalGuesses:i=null,marathonTotalTimeMs:G=null,isMarathonComplete:g=!1}){if(n)try{if(!(u==="daily"&&l===1||u==="marathon"))return;const d=C(u,s);if(u==="marathon"){if(o&&m>0&&m<=6){const f={dateString:e,guesses:m,solved:!0,timestamp:Date.now(),stageIndex:T,stageBoards:l};s&&t!==null&&t>0&&(f.solveTimeMs=t);const M=p(P,`users/${n}/stats/${d}/stages`);await N(M,f)}if(g&&i!==null&&i>0){const f={dateString:e,guesses:i,solved:!0,timestamp:Date.now(),isFullMarathon:!0};s&&G!==null&&G>0&&(f.solveTimeMs=G);const M=p(P,`users/${n}/stats/${d}/games`);await N(M,f),await _({uid:n,statsKey:d,gameData:f})}}else if(o&&m>0&&m<=6){const f={dateString:e,guesses:m,solved:!0,timestamp:Date.now()};s&&t!==null&&t>0&&(f.solveTimeMs=t);const M=p(P,`users/${n}/stats/${d}/games`);await N(M,f),await _({uid:n,statsKey:d,gameData:f})}}catch{}}async function _({uid:n,statsKey:u,gameData:s}){try{const e=p(P,`users/${n}/stats/${u}/aggregated`),m=await K(e),t=m.exists()?m.val():{totalGames:0,solvedGames:0,totalGuesses:0,guessDistribution:{...U},totalTimeMs:0,fastestTimeMs:null,slowestTimeMs:null,lastUpdated:Date.now()},l={...t};l.guessDistribution={...U};for(let o=1;o<=6;o++){const T=t.guessDistribution&&typeof t.guessDistribution[o]=="number"?t.guessDistribution[o]:0;l.guessDistribution[o]=T}l.totalGames=(typeof t.totalGames=="number"?t.totalGames:0)+1,s.solved&&s.guesses>0&&s.guesses<=6&&(l.solvedGames=(typeof t.solvedGames=="number"?t.solvedGames:0)+1,l.totalGuesses=(typeof t.totalGuesses=="number"?t.totalGuesses:0)+s.guesses,l.guessDistribution[s.guesses]=(l.guessDistribution[s.guesses]||0)+1,s.solveTimeMs!==void 0&&s.solveTimeMs!==null&&s.solveTimeMs>0&&(l.totalTimeMs=(l.totalTimeMs||0)+s.solveTimeMs,(l.fastestTimeMs===null||s.solveTimeMs<l.fastestTimeMs)&&(l.fastestTimeMs=s.solveTimeMs),(l.slowestTimeMs===null||s.solveTimeMs>l.slowestTimeMs)&&(l.slowestTimeMs=s.solveTimeMs))),l.lastUpdated=Date.now(),await q(e,l)}catch{}}async function Q({uid:n,mode:u,speedrunEnabled:s}){if(!n)return null;try{const e=C(u,s),m=p(P,`users/${n}/stats/${e}/aggregated`),t=await K(m);return t.exists()?t.val():null}catch{return null}}async function V({uid:n,mode:u,speedrunEnabled:s}){if(!n)return null;try{const e=C(u,s),m=p(P,`users/${n}/stats/${e}/games`),t=await K(m);if(t.exists()){const l=t.val(),o=Object.values(l||{});return u==="marathon"?o.filter(T=>T.isFullMarathon===!0):o}return[]}catch{return null}}async function W({uid:n,speedrunEnabled:u}){if(!n)return null;try{const s=C("marathon",u),e=p(P,`users/${n}/stats/${s}/stages`),m=await K(e);if(m.exists()){const t=m.val();return Object.values(t||{})}return[]}catch{return null}}function X(n){if(!n||n.length===0)return{totalGames:0,solvedGames:0,winRate:0,averageGuesses:0,medianGuesses:0,guessDistribution:{1:0,2:0,3:0,4:0,5:0,6:0},bestPerformance:null,worstPerformance:null,perfectGames:0,gamesSolvedIn3OrFewer:0,gamesSolvedIn4OrFewer:0,averageTimeMs:null,medianTimeMs:null,fastestTimeMs:null,slowestTimeMs:null,averageTimePerGuess:null,sub30Count:0,sub30Percentage:0,sub60Count:0,sub60Percentage:0,sub120Count:0,sub120Percentage:0,avgTimeMsByGuesses:{1:null,2:null,3:null,4:null,5:null,6:null}};const u=n.filter(a=>a.solved),s=n.length,e=u.length,m=s>0?e/s*100:0,t=u.map(a=>a.guesses).filter(a=>a>0),l=t.length>0?t.reduce((a,v)=>a+v,0)/t.length:0,o=[...t].sort((a,v)=>a-v),T=o.length>0?o.length%2===0?(o[o.length/2-1]+o[o.length/2])/2:o[Math.floor(o.length/2)]:0,i={1:0,2:0,3:0,4:0,5:0,6:0};t.forEach(a=>{a>=1&&a<=6&&(i[a]=(i[a]||0)+1)});const G=t.length>0?Math.min(...t):null,g=t.length>0?Math.max(...t):null,r=i[1]||0,d=(i[1]||0)+(i[2]||0)+(i[3]||0),f=d+(i[4]||0),M=u.map(a=>a.solveTimeMs).filter(a=>a!=null&&a>0),w=M.length>0?M.reduce((a,v)=>a+v,0)/M.length:null,b=[...M].sort((a,v)=>a-v),x=b.length>0?b.length%2===0?(b[b.length/2-1]+b[b.length/2])/2:b[Math.floor(b.length/2)]:null,F=M.length>0?Math.min(...M):null,S=M.length>0?Math.max(...M):null,c=w!==null&&l>0?w/l:null,h=30*1e3,y=60*1e3,$=120*1e3;let I=0,O=0,B=0;const E={1:null,2:null,3:null,4:null,5:null,6:null},R={1:0,2:0,3:0,4:0,5:0,6:0},A={1:0,2:0,3:0,4:0,5:0,6:0};u.forEach(a=>{const v=a.solveTimeMs;if(v!=null&&v>0){v<h&&(I+=1),v<y&&(O+=1),v<$&&(B+=1);const D=a.guesses;D>=1&&D<=6&&(R[D]+=v,A[D]+=1)}}),[1,2,3,4,5,6].forEach(a=>{A[a]>0&&(E[a]=Math.round(R[a]/A[a]))});const L=e>0?Math.round(I/e*1e4)/100:0,j=e>0?Math.round(O/e*1e4)/100:0,k=e>0?Math.round(B/e*1e4)/100:0;return{totalGames:s,solvedGames:e,winRate:Math.round(m*100)/100,averageGuesses:Math.round(l*100)/100,medianGuesses:T,guessDistribution:i,bestPerformance:G,worstPerformance:g,perfectGames:r,perfectGamesPercentage:e>0?Math.round(r/e*1e4)/100:0,gamesSolvedIn3OrFewer:d,gamesSolvedIn3OrFewerPercentage:e>0?Math.round(d/e*1e4)/100:0,gamesSolvedIn4OrFewer:f,gamesSolvedIn4OrFewerPercentage:e>0?Math.round(f/e*1e4)/100:0,averageTimeMs:w,medianTimeMs:x,fastestTimeMs:F,slowestTimeMs:S,averageTimePerGuess:c!==null?Math.round(c*100)/100:null,sub30Count:I,sub30Percentage:L,sub60Count:O,sub60Percentage:j,sub120Count:B,sub120Percentage:k,avgTimeMsByGuesses:E}}function Y(n,u=!1){const s={1:null,2:null,3:null,4:null};[1,2,3,4].forEach(l=>{const o=(n||[]).filter(c=>{const h=Number(c.stageBoards),y=Number(c.guesses);return h===l&&c.solved!==!1&&y>=1&&y<=6}),T=o.length,i=o.map(c=>Number(c.guesses)),G={1:0,2:0,3:0,4:0,5:0,6:0};i.forEach(c=>{G[c]=(G[c]||0)+1});const g=i.length>0?i.reduce((c,h)=>c+h,0)/i.length:0,r=[...i].sort((c,h)=>c-h),d=r.length>0?r.length%2===0?(r[r.length/2-1]+r[r.length/2])/2:r[Math.floor(r.length/2)]:0,f=i.length>0?Math.min(...i):null,M=i.length>0?Math.max(...i):null;let w=null,b=null,x=null,F=null,S=null;if(u){const c=o.map(h=>h.solveTimeMs).filter(h=>h!=null&&h>0);if(c.length>0){w=c.reduce((y,$)=>y+$,0)/c.length;const h=[...c].sort((y,$)=>y-$);b=h.length%2===0?(h[h.length/2-1]+h[h.length/2])/2:h[Math.floor(h.length/2)],x=Math.min(...c),F=Math.max(...c),g>0&&(S=w/g)}}s[l]={guessDistribution:G,solvedGames:T,averageGuesses:Math.round(g*100)/100,medianGuesses:d,bestPerformance:f,worstPerformance:M,averageTimeMs:w!=null?Math.round(w):null,medianTimeMs:b!=null?Math.round(b):null,fastestTimeMs:x??null,slowestTimeMs:F??null,averageTimePerGuess:S!=null?Math.round(S*100)/100:null}});const t={totalStages:(n||[]).filter(l=>{const o=Number(l.guesses);return l.solved!==!1&&o>=1&&o<=6}).length};return{byStage:s,totals:t}}function Z(n,u=!1){if(!n||n.length===0)return{totalMarathons:0,averageTotalGuesses:0,bestMarathonGuesses:null,worstMarathonGuesses:null,averageTimeMs:null,medianTimeMs:null,fastestTimeMs:null,slowestTimeMs:null};const s=n.length,e=n.map(g=>g.guesses).filter(g=>g>0),m=e.length>0?e.reduce((g,r)=>g+r,0)/e.length:0,t=e.length>0?Math.min(...e):null,l=e.length>0?Math.max(...e):null;let o=null,T=null,i=null,G=null;if(u){const g=n.map(r=>r.solveTimeMs).filter(r=>r!=null&&r>0);if(g.length>0){o=g.reduce((d,f)=>d+f,0)/g.length;const r=[...g].sort((d,f)=>d-f);T=r.length%2===0?(r[r.length/2-1]+r[r.length/2])/2:r[Math.floor(r.length/2)],i=Math.min(...g),G=Math.max(...g)}}return{totalMarathons:s,averageTotalGuesses:Math.round(m*100)/100,bestMarathonGuesses:t,worstMarathonGuesses:l,averageTimeMs:o!=null?Math.round(o):null,medianTimeMs:T!=null?Math.round(T):null,fastestTimeMs:i??null,slowestTimeMs:G??null}}function ee(n){if(n==null)return"N/A";const u=Math.floor(n/1e3),s=Math.floor(u/60),e=u%60;return s>0?`${s}m ${e}s`:`${u}s`}export{X as calculateAdvancedStats,Y as calculateMarathonStageStats,Z as calculateMarathonSummaryFromGames,ee as formatTime,Q as loadAggregatedStats,V as loadGameRecords,W as loadMarathonStageRecords,J as saveGameStats};