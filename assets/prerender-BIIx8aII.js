const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FriendsModal-D7MusmLV.js","assets/vendor-BsMbSbDn.js","FriendsModal.css","assets/OpenRoomsModal-6fe7ClJM.js","OpenRoomsModal.css","assets/FeedbackModal-DtP9FLlv.js","assets/MultiplayerModal-BdC_u0Tz.js","assets/statsService-CnGeUBvE.js","assets/Game-DEMzHZeP.js","assets/Profile-DSjTNZfS.js","Profile.css","assets/AdvancedStats-D3mXytR_.js","AdvancedStats.css","assets/Leaderboard-Dv7wMxhS.js","Leaderboard.css","assets/Faq-Dt1kWDNi.js","Faq.css","assets/HowToPlay-DnaiNBXS.js","HowToPlay.css","assets/MultiplayerWordleLanding-CiHRZnAa.js","assets/SeoLandingLayout-CSD0rF3D.js","SeoLandingLayout.css","assets/MultiBoardWordleLanding-Bqz_eYpP.js","assets/WordleSpeedrunLanding-UsHpQYly.js","assets/WordleMarathonLanding-B_gwpM5Y.js"])))=>i.map(i=>d[i]);
var uT=Object.defineProperty;var hT=(t,e,n)=>e in t?uT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var os=(t,e,n)=>hT(t,typeof e!="symbol"?e+"":e,n);import{r as p,p as dT,A as fT,e as pT,f as M_,g as Op,R as rt,u as br,c as O_,L as Ti,h as mT,a as j_,b as gT,i as yT,j as Ht,N as vT}from"./vendor-BsMbSbDn.js";var F_={exports:{}},Wu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wT=p,_T=Symbol.for("react.element"),ST=Symbol.for("react.fragment"),xT=Object.prototype.hasOwnProperty,bT=wT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CT={key:!0,ref:!0,__self:!0,__source:!0};function L_(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)xT.call(e,s)&&!CT.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:_T,type:t,key:i,ref:o,props:r,_owner:bT.current}}Wu.Fragment=ST;Wu.jsx=L_;Wu.jsxs=L_;F_.exports=Wu;var u=F_.exports,fo={};/**
 * @license React
 * react-dom-server-legacy.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $_=p;function Pe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yn=Object.prototype.hasOwnProperty,ET=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,iy={},oy={};function B_(t){return yn.call(oy,t)?!0:yn.call(iy,t)?!1:ET.test(t)?oy[t]=!0:(iy[t]=!0,!1)}function fn(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Xt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Xt[t]=new fn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Xt[e]=new fn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Xt[t]=new fn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Xt[t]=new fn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Xt[t]=new fn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Xt[t]=new fn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Xt[t]=new fn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Xt[t]=new fn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Xt[t]=new fn(t,5,!1,t.toLowerCase(),null,!1,!1)});var jp=/[\-:]([a-z])/g;function Fp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(jp,Fp);Xt[e]=new fn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(jp,Fp);Xt[e]=new fn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(jp,Fp);Xt[e]=new fn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Xt[t]=new fn(t,1,!1,t.toLowerCase(),null,!1,!1)});Xt.xlinkHref=new fn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Xt[t]=new fn(t,1,!1,t.toLowerCase(),null,!0,!0)});var gc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},TT=["Webkit","ms","Moz","O"];Object.keys(gc).forEach(function(t){TT.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),gc[e]=gc[t]})});var IT=/["'&<>]/;function un(t){if(typeof t=="boolean"||typeof t=="number")return""+t;t=""+t;var e=IT.exec(t);if(e){var n="",s,r=0;for(s=e.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#x27;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}r!==s&&(n+=t.substring(r,s)),r=s+1,n+=e}t=r!==s?n+t.substring(r,s):n}return t}var kT=/([A-Z])/g,AT=/^ms-/,_f=Array.isArray;function Is(t,e){return{insertionMode:t,selectedValue:e}}function RT(t,e,n){switch(e){case"select":return Is(1,n.value!=null?n.value:n.defaultValue);case"svg":return Is(2,null);case"math":return Is(3,null);case"foreignObject":return Is(1,null);case"table":return Is(4,null);case"thead":case"tbody":case"tfoot":return Is(5,null);case"colgroup":return Is(7,null);case"tr":return Is(6,null)}return 4<=t.insertionMode||t.insertionMode===0?Is(1,null):t}var ay=new Map;function U_(t,e,n){if(typeof n!="object")throw Error(Pe(62));e=!0;for(var s in n)if(yn.call(n,s)){var r=n[s];if(r!=null&&typeof r!="boolean"&&r!==""){if(s.indexOf("--")===0){var i=un(s);r=un((""+r).trim())}else{i=s;var o=ay.get(i);o!==void 0||(o=un(i.replace(kT,"-$1").toLowerCase().replace(AT,"-ms-")),ay.set(i,o)),i=o,r=typeof r=="number"?r===0||yn.call(gc,s)?""+r:r+"px":un((""+r).trim())}e?(e=!1,t.push(' style="',i,":",r)):t.push(";",i,":",r)}}e||t.push('"')}function En(t,e,n,s){switch(n){case"style":U_(t,e,s);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N"){if(e=Xt.hasOwnProperty(n)?Xt[n]:null,e!==null){switch(typeof s){case"function":case"symbol":return;case"boolean":if(!e.acceptsBooleans)return}switch(n=e.attributeName,e.type){case 3:s&&t.push(" ",n,'=""');break;case 4:s===!0?t.push(" ",n,'=""'):s!==!1&&t.push(" ",n,'="',un(s),'"');break;case 5:isNaN(s)||t.push(" ",n,'="',un(s),'"');break;case 6:!isNaN(s)&&1<=s&&t.push(" ",n,'="',un(s),'"');break;default:e.sanitizeURL&&(s=""+s),t.push(" ",n,'="',un(s),'"')}}else if(B_(n)){switch(typeof s){case"function":case"symbol":return;case"boolean":if(e=n.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-")return}t.push(" ",n,'="',un(s),'"')}}}function yc(t,e,n){if(e!=null){if(n!=null)throw Error(Pe(60));if(typeof e!="object"||!("__html"in e))throw Error(Pe(61));e=e.__html,e!=null&&t.push(""+e)}}function NT(t){var e="";return $_.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function Td(t,e,n,s){t.push(as(n));var r=n=null,i;for(i in e)if(yn.call(e,i)){var o=e[i];if(o!=null)switch(i){case"children":n=o;break;case"dangerouslySetInnerHTML":r=o;break;default:En(t,s,i,o)}}return t.push(">"),yc(t,r,n),typeof n=="string"?(t.push(un(n)),null):n}var PT=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ly=new Map;function as(t){var e=ly.get(t);if(e===void 0){if(!PT.test(t))throw Error(Pe(65,t));e="<"+t,ly.set(t,e)}return e}function DT(t,e,n,s,r){switch(e){case"select":t.push(as("select"));var i=null,o=null;for(h in n)if(yn.call(n,h)){var a=n[h];if(a!=null)switch(h){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;case"defaultValue":case"value":break;default:En(t,s,h,a)}}return t.push(">"),yc(t,o,i),i;case"option":o=r.selectedValue,t.push(as("option"));var l=a=null,c=null,h=null;for(i in n)if(yn.call(n,i)){var d=n[i];if(d!=null)switch(i){case"children":a=d;break;case"selected":c=d;break;case"dangerouslySetInnerHTML":h=d;break;case"value":l=d;default:En(t,s,i,d)}}if(o!=null)if(n=l!==null?""+l:NT(a),_f(o)){for(s=0;s<o.length;s++)if(""+o[s]===n){t.push(' selected=""');break}}else""+o===n&&t.push(' selected=""');else c&&t.push(' selected=""');return t.push(">"),yc(t,h,a),a;case"textarea":t.push(as("textarea")),h=o=i=null;for(a in n)if(yn.call(n,a)&&(l=n[a],l!=null))switch(a){case"children":h=l;break;case"value":i=l;break;case"defaultValue":o=l;break;case"dangerouslySetInnerHTML":throw Error(Pe(91));default:En(t,s,a,l)}if(i===null&&o!==null&&(i=o),t.push(">"),h!=null){if(i!=null)throw Error(Pe(92));if(_f(h)&&1<h.length)throw Error(Pe(93));i=""+h}return typeof i=="string"&&i[0]===`
`&&t.push(`
`),i!==null&&t.push(un(""+i)),null;case"input":t.push(as("input")),l=h=a=i=null;for(o in n)if(yn.call(n,o)&&(c=n[o],c!=null))switch(o){case"children":case"dangerouslySetInnerHTML":throw Error(Pe(399,"input"));case"defaultChecked":l=c;break;case"defaultValue":a=c;break;case"checked":h=c;break;case"value":i=c;break;default:En(t,s,o,c)}return h!==null?En(t,s,"checked",h):l!==null&&En(t,s,"checked",l),i!==null?En(t,s,"value",i):a!==null&&En(t,s,"value",a),t.push("/>"),null;case"menuitem":t.push(as("menuitem"));for(var f in n)if(yn.call(n,f)&&(i=n[f],i!=null))switch(f){case"children":case"dangerouslySetInnerHTML":throw Error(Pe(400));default:En(t,s,f,i)}return t.push(">"),null;case"title":t.push(as("title")),i=null;for(d in n)if(yn.call(n,d)&&(o=n[d],o!=null))switch(d){case"children":i=o;break;case"dangerouslySetInnerHTML":throw Error(Pe(434));default:En(t,s,d,o)}return t.push(">"),i;case"listing":case"pre":t.push(as(e)),o=i=null;for(l in n)if(yn.call(n,l)&&(a=n[l],a!=null))switch(l){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;default:En(t,s,l,a)}if(t.push(">"),o!=null){if(i!=null)throw Error(Pe(60));if(typeof o!="object"||!("__html"in o))throw Error(Pe(61));n=o.__html,n!=null&&(typeof n=="string"&&0<n.length&&n[0]===`
`?t.push(`
`,n):t.push(""+n))}return typeof i=="string"&&i[0]===`
`&&t.push(`
`),i;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":t.push(as(e));for(var m in n)if(yn.call(n,m)&&(i=n[m],i!=null))switch(m){case"children":case"dangerouslySetInnerHTML":throw Error(Pe(399,e));default:En(t,s,m,i)}return t.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Td(t,n,e,s);case"html":return r.insertionMode===0&&t.push("<!DOCTYPE html>"),Td(t,n,e,s);default:if(e.indexOf("-")===-1&&typeof n.is!="string")return Td(t,n,e,s);t.push(as(e)),o=i=null;for(c in n)if(yn.call(n,c)&&(a=n[c],a!=null))switch(c){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;case"style":U_(t,s,a);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:B_(c)&&typeof a!="function"&&typeof a!="symbol"&&t.push(" ",c,'="',un(a),'"')}return t.push(">"),yc(t,o,i),i}}function cy(t,e,n){if(t.push('<!--$?--><template id="'),n===null)throw Error(Pe(395));return t.push(n),t.push('"></template>')}function MT(t,e,n,s){switch(n.insertionMode){case 0:case 1:return t.push('<div hidden id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 2:return t.push('<svg aria-hidden="true" style="display:none" id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 3:return t.push('<math aria-hidden="true" style="display:none" id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 4:return t.push('<table hidden id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 5:return t.push('<table hidden><tbody id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 6:return t.push('<table hidden><tr id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');case 7:return t.push('<table hidden><colgroup id="'),t.push(e.segmentPrefix),e=s.toString(16),t.push(e),t.push('">');default:throw Error(Pe(397))}}function OT(t,e){switch(e.insertionMode){case 0:case 1:return t.push("</div>");case 2:return t.push("</svg>");case 3:return t.push("</math>");case 4:return t.push("</table>");case 5:return t.push("</tbody></table>");case 6:return t.push("</tr></table>");case 7:return t.push("</colgroup></table>");default:throw Error(Pe(397))}}var jT=/[<\u2028\u2029]/g;function Id(t){return JSON.stringify(t).replace(jT,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}function FT(t,e){return e=e===void 0?"":e,{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:e+"P:",segmentPrefix:e+"S:",boundaryPrefix:e+"B:",idPrefix:e,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:t}}function uy(t,e,n,s){return n.generateStaticMarkup?(t.push(un(e)),!1):(e===""?t=s:(s&&t.push("<!-- -->"),t.push(un(e)),t=!0),t)}var ra=Object.assign,LT=Symbol.for("react.element"),z_=Symbol.for("react.portal"),V_=Symbol.for("react.fragment"),W_=Symbol.for("react.strict_mode"),H_=Symbol.for("react.profiler"),G_=Symbol.for("react.provider"),q_=Symbol.for("react.context"),K_=Symbol.for("react.forward_ref"),Y_=Symbol.for("react.suspense"),Q_=Symbol.for("react.suspense_list"),X_=Symbol.for("react.memo"),Lp=Symbol.for("react.lazy"),$T=Symbol.for("react.scope"),BT=Symbol.for("react.debug_trace_mode"),UT=Symbol.for("react.legacy_hidden"),zT=Symbol.for("react.default_value"),hy=Symbol.iterator;function Sf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case V_:return"Fragment";case z_:return"Portal";case H_:return"Profiler";case W_:return"StrictMode";case Y_:return"Suspense";case Q_:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case q_:return(t.displayName||"Context")+".Consumer";case G_:return(t._context.displayName||"Context")+".Provider";case K_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case X_:return e=t.displayName||null,e!==null?e:Sf(t.type)||"Memo";case Lp:e=t._payload,t=t._init;try{return Sf(t(e))}catch{}}return null}var J_={};function dy(t,e){if(t=t.contextTypes,!t)return J_;var n={},s;for(s in t)n[s]=e[s];return n}var Ur=null;function Hu(t,e){if(t!==e){t.context._currentValue2=t.parentValue,t=t.parent;var n=e.parent;if(t===null){if(n!==null)throw Error(Pe(401))}else{if(n===null)throw Error(Pe(401));Hu(t,n)}e.context._currentValue2=e.value}}function Z_(t){t.context._currentValue2=t.parentValue,t=t.parent,t!==null&&Z_(t)}function e0(t){var e=t.parent;e!==null&&e0(e),t.context._currentValue2=t.value}function t0(t,e){if(t.context._currentValue2=t.parentValue,t=t.parent,t===null)throw Error(Pe(402));t.depth===e.depth?Hu(t,e):t0(t,e)}function n0(t,e){var n=e.parent;if(n===null)throw Error(Pe(402));t.depth===n.depth?Hu(t,n):n0(t,n),e.context._currentValue2=e.value}function Bc(t){var e=Ur;e!==t&&(e===null?e0(t):t===null?Z_(e):e.depth===t.depth?Hu(e,t):e.depth>t.depth?t0(e,t):n0(e,t),Ur=t)}var fy={isMounted:function(){return!1},enqueueSetState:function(t,e){t=t._reactInternals,t.queue!==null&&t.queue.push(e)},enqueueReplaceState:function(t,e){t=t._reactInternals,t.replace=!0,t.queue=[e]},enqueueForceUpdate:function(){}};function py(t,e,n,s){var r=t.state!==void 0?t.state:null;t.updater=fy,t.props=n,t.state=r;var i={queue:[],replace:!1};t._reactInternals=i;var o=e.contextType;if(t.context=typeof o=="object"&&o!==null?o._currentValue2:s,o=e.getDerivedStateFromProps,typeof o=="function"&&(o=o(n,r),r=o==null?r:ra({},r,o),t.state=r),typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function"&&(typeof t.UNSAFE_componentWillMount=="function"||typeof t.componentWillMount=="function"))if(e=t.state,typeof t.componentWillMount=="function"&&t.componentWillMount(),typeof t.UNSAFE_componentWillMount=="function"&&t.UNSAFE_componentWillMount(),e!==t.state&&fy.enqueueReplaceState(t,t.state,null),i.queue!==null&&0<i.queue.length)if(e=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&e.length===1)t.state=e[0];else{for(i=o?e[0]:t.state,r=!0,o=o?1:0;o<e.length;o++){var a=e[o];a=typeof a=="function"?a.call(t,i,n,s):a,a!=null&&(r?(r=!1,i=ra({},i,a)):ra(i,a))}t.state=i}else i.queue=null}var VT={id:1,overflow:""};function xf(t,e,n){var s=t.id;t=t.overflow;var r=32-vc(s)-1;s&=~(1<<r),n+=1;var i=32-vc(e)+r;if(30<i){var o=r-r%5;return i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,{id:1<<32-vc(e)+r|n<<r|s,overflow:i+t}}return{id:1<<i|n<<r|s,overflow:t}}var vc=Math.clz32?Math.clz32:GT,WT=Math.log,HT=Math.LN2;function GT(t){return t>>>=0,t===0?32:31-(WT(t)/HT|0)|0}function qT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var KT=typeof Object.is=="function"?Object.is:qT,Ms=null,$p=null,wc=null,ct=null,qo=!1,Uc=!1,ba=0,tr=null,Gu=0;function jr(){if(Ms===null)throw Error(Pe(321));return Ms}function my(){if(0<Gu)throw Error(Pe(312));return{memoizedState:null,queue:null,next:null}}function Bp(){return ct===null?wc===null?(qo=!1,wc=ct=my()):(qo=!0,ct=wc):ct.next===null?(qo=!1,ct=ct.next=my()):(qo=!0,ct=ct.next),ct}function Up(){$p=Ms=null,Uc=!1,wc=null,Gu=0,ct=tr=null}function s0(t,e){return typeof e=="function"?e(t):e}function gy(t,e,n){if(Ms=jr(),ct=Bp(),qo){var s=ct.queue;if(e=s.dispatch,tr!==null&&(n=tr.get(s),n!==void 0)){tr.delete(s),s=ct.memoizedState;do s=t(s,n.action),n=n.next;while(n!==null);return ct.memoizedState=s,[s,e]}return[ct.memoizedState,e]}return t=t===s0?typeof e=="function"?e():e:n!==void 0?n(e):e,ct.memoizedState=t,t=ct.queue={last:null,dispatch:null},t=t.dispatch=YT.bind(null,Ms,t),[ct.memoizedState,t]}function yy(t,e){if(Ms=jr(),ct=Bp(),e=e===void 0?null:e,ct!==null){var n=ct.memoizedState;if(n!==null&&e!==null){var s=n[1];e:if(s===null)s=!1;else{for(var r=0;r<s.length&&r<e.length;r++)if(!KT(e[r],s[r])){s=!1;break e}s=!0}if(s)return n[0]}}return t=t(),ct.memoizedState=[t,e],t}function YT(t,e,n){if(25<=Gu)throw Error(Pe(301));if(t===Ms)if(Uc=!0,t={action:n,next:null},tr===null&&(tr=new Map),n=tr.get(e),n===void 0)tr.set(e,t);else{for(e=n;e.next!==null;)e=e.next;e.next=t}}function QT(){throw Error(Pe(394))}function Kl(){}var vy={readContext:function(t){return t._currentValue2},useContext:function(t){return jr(),t._currentValue2},useMemo:yy,useReducer:gy,useRef:function(t){Ms=jr(),ct=Bp();var e=ct.memoizedState;return e===null?(t={current:t},ct.memoizedState=t):e},useState:function(t){return gy(s0,t)},useInsertionEffect:Kl,useLayoutEffect:function(){},useCallback:function(t,e){return yy(function(){return t},e)},useImperativeHandle:Kl,useEffect:Kl,useDebugValue:Kl,useDeferredValue:function(t){return jr(),t},useTransition:function(){return jr(),[!1,QT]},useId:function(){var t=$p.treeContext,e=t.overflow;t=t.id,t=(t&~(1<<32-vc(t)-1)).toString(32)+e;var n=_c;if(n===null)throw Error(Pe(404));return e=ba++,t=":"+n.idPrefix+"R"+t,0<e&&(t+="H"+e.toString(32)),t+":"},useMutableSource:function(t,e){return jr(),e(t._source)},useSyncExternalStore:function(t,e,n){if(n===void 0)throw Error(Pe(407));return n()}},_c=null,kd=$_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function XT(t){return console.error(t),null}function Ko(){}function JT(t,e,n,s,r,i,o,a,l){var c=[],h=new Set;return e={destination:null,responseState:e,progressiveChunkSize:s===void 0?12800:s,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:h,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:r===void 0?XT:r,onAllReady:Ko,onShellReady:o===void 0?Ko:o,onShellError:Ko,onFatalError:Ko},n=zc(e,0,null,n,!1,!1),n.parentFlushed=!0,t=zp(e,t,null,n,h,J_,null,VT),c.push(t),e}function zp(t,e,n,s,r,i,o,a){t.allPendingTasks++,n===null?t.pendingRootTasks++:n.pendingTasks++;var l={node:e,ping:function(){var c=t.pingedTasks;c.push(l),c.length===1&&o0(t)},blockedBoundary:n,blockedSegment:s,abortSet:r,legacyContext:i,context:o,treeContext:a};return r.add(l),l}function zc(t,e,n,s,r,i){return{status:0,id:-1,index:e,parentFlushed:!1,chunks:[],children:[],formatContext:s,boundary:n,lastPushedText:r,textEmbedded:i}}function Ca(t,e){if(t=t.onError(e),t!=null&&typeof t!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof t+'" instead');return t}function Vc(t,e){var n=t.onShellError;n(e),n=t.onFatalError,n(e),t.destination!==null?(t.status=2,t.destination.destroy(e)):(t.status=1,t.fatalError=e)}function wy(t,e,n,s,r){for(Ms={},$p=e,ba=0,t=n(s,r);Uc;)Uc=!1,ba=0,Gu+=1,ct=null,t=n(s,r);return Up(),t}function _y(t,e,n,s){var r=n.render(),i=s.childContextTypes;if(i!=null){var o=e.legacyContext;if(typeof n.getChildContext!="function")s=o;else{n=n.getChildContext();for(var a in n)if(!(a in i))throw Error(Pe(108,Sf(s)||"Unknown",a));s=ra({},o,n)}e.legacyContext=s,In(t,e,r),e.legacyContext=o}else In(t,e,r)}function Sy(t,e){if(t&&t.defaultProps){e=ra({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function bf(t,e,n,s,r){if(typeof n=="function")if(n.prototype&&n.prototype.isReactComponent){r=dy(n,e.legacyContext);var i=n.contextType;i=new n(s,typeof i=="object"&&i!==null?i._currentValue2:r),py(i,n,s,r),_y(t,e,i,n)}else{i=dy(n,e.legacyContext),r=wy(t,e,n,s,i);var o=ba!==0;if(typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0)py(r,n,s,i),_y(t,e,r,n);else if(o){s=e.treeContext,e.treeContext=xf(s,1,0);try{In(t,e,r)}finally{e.treeContext=s}}else In(t,e,r)}else if(typeof n=="string"){switch(r=e.blockedSegment,i=DT(r.chunks,n,s,t.responseState,r.formatContext),r.lastPushedText=!1,o=r.formatContext,r.formatContext=RT(o,n,s),Cf(t,e,i),r.formatContext=o,n){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:r.chunks.push("</",n,">")}r.lastPushedText=!1}else{switch(n){case UT:case BT:case W_:case H_:case V_:In(t,e,s.children);return;case Q_:In(t,e,s.children);return;case $T:throw Error(Pe(343));case Y_:e:{n=e.blockedBoundary,r=e.blockedSegment,i=s.fallback,s=s.children,o=new Set;var a={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:o,errorDigest:null},l=zc(t,r.chunks.length,a,r.formatContext,!1,!1);r.children.push(l),r.lastPushedText=!1;var c=zc(t,0,null,r.formatContext,!1,!1);c.parentFlushed=!0,e.blockedBoundary=a,e.blockedSegment=c;try{if(Cf(t,e,s),t.responseState.generateStaticMarkup||c.lastPushedText&&c.textEmbedded&&c.chunks.push("<!-- -->"),c.status=1,Wc(a,c),a.pendingTasks===0)break e}catch(h){c.status=4,a.forceClientRender=!0,a.errorDigest=Ca(t,h)}finally{e.blockedBoundary=n,e.blockedSegment=r}e=zp(t,i,n,l,o,e.legacyContext,e.context,e.treeContext),t.pingedTasks.push(e)}return}if(typeof n=="object"&&n!==null)switch(n.$$typeof){case K_:if(s=wy(t,e,n.render,s,r),ba!==0){n=e.treeContext,e.treeContext=xf(n,1,0);try{In(t,e,s)}finally{e.treeContext=n}}else In(t,e,s);return;case X_:n=n.type,s=Sy(n,s),bf(t,e,n,s,r);return;case G_:if(r=s.children,n=n._context,s=s.value,i=n._currentValue2,n._currentValue2=s,o=Ur,Ur=s={parent:o,depth:o===null?0:o.depth+1,context:n,parentValue:i,value:s},e.context=s,In(t,e,r),t=Ur,t===null)throw Error(Pe(403));s=t.parentValue,t.context._currentValue2=s===zT?t.context._defaultValue:s,t=Ur=t.parent,e.context=t;return;case q_:s=s.children,s=s(n._currentValue2),In(t,e,s);return;case Lp:r=n._init,n=r(n._payload),s=Sy(n,s),bf(t,e,n,s,void 0);return}throw Error(Pe(130,n==null?n:typeof n,""))}}function In(t,e,n){if(e.node=n,typeof n=="object"&&n!==null){switch(n.$$typeof){case LT:bf(t,e,n.type,n.props,n.ref);return;case z_:throw Error(Pe(257));case Lp:var s=n._init;n=s(n._payload),In(t,e,n);return}if(_f(n)){xy(t,e,n);return}if(n===null||typeof n!="object"?s=null:(s=hy&&n[hy]||n["@@iterator"],s=typeof s=="function"?s:null),s&&(s=s.call(n))){if(n=s.next(),!n.done){var r=[];do r.push(n.value),n=s.next();while(!n.done);xy(t,e,r)}return}throw t=Object.prototype.toString.call(n),Error(Pe(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t))}typeof n=="string"?(s=e.blockedSegment,s.lastPushedText=uy(e.blockedSegment.chunks,n,t.responseState,s.lastPushedText)):typeof n=="number"&&(s=e.blockedSegment,s.lastPushedText=uy(e.blockedSegment.chunks,""+n,t.responseState,s.lastPushedText))}function xy(t,e,n){for(var s=n.length,r=0;r<s;r++){var i=e.treeContext;e.treeContext=xf(i,s,r);try{Cf(t,e,n[r])}finally{e.treeContext=i}}}function Cf(t,e,n){var s=e.blockedSegment.formatContext,r=e.legacyContext,i=e.context;try{return In(t,e,n)}catch(l){if(Up(),typeof l=="object"&&l!==null&&typeof l.then=="function"){n=l;var o=e.blockedSegment,a=zc(t,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,t=zp(t,e.node,e.blockedBoundary,a,e.abortSet,e.legacyContext,e.context,e.treeContext).ping,n.then(t,t),e.blockedSegment.formatContext=s,e.legacyContext=r,e.context=i,Bc(i)}else throw e.blockedSegment.formatContext=s,e.legacyContext=r,e.context=i,Bc(i),l}}function ZT(t){var e=t.blockedBoundary;t=t.blockedSegment,t.status=3,i0(this,e,t)}function r0(t,e,n){var s=t.blockedBoundary;t.blockedSegment.status=3,s===null?(e.allPendingTasks--,e.status!==2&&(e.status=2,e.destination!==null&&e.destination.push(null))):(s.pendingTasks--,s.forceClientRender||(s.forceClientRender=!0,t=n===void 0?Error(Pe(432)):n,s.errorDigest=e.onError(t),s.parentFlushed&&e.clientRenderedBoundaries.push(s)),s.fallbackAbortableTasks.forEach(function(r){return r0(r,e,n)}),s.fallbackAbortableTasks.clear(),e.allPendingTasks--,e.allPendingTasks===0&&(s=e.onAllReady,s()))}function Wc(t,e){if(e.chunks.length===0&&e.children.length===1&&e.children[0].boundary===null){var n=e.children[0];n.id=e.id,n.parentFlushed=!0,n.status===1&&Wc(t,n)}else t.completedSegments.push(e)}function i0(t,e,n){if(e===null){if(n.parentFlushed){if(t.completedRootSegment!==null)throw Error(Pe(389));t.completedRootSegment=n}t.pendingRootTasks--,t.pendingRootTasks===0&&(t.onShellError=Ko,e=t.onShellReady,e())}else e.pendingTasks--,e.forceClientRender||(e.pendingTasks===0?(n.parentFlushed&&n.status===1&&Wc(e,n),e.parentFlushed&&t.completedBoundaries.push(e),e.fallbackAbortableTasks.forEach(ZT,t),e.fallbackAbortableTasks.clear()):n.parentFlushed&&n.status===1&&(Wc(e,n),e.completedSegments.length===1&&e.parentFlushed&&t.partialBoundaries.push(e)));t.allPendingTasks--,t.allPendingTasks===0&&(t=t.onAllReady,t())}function o0(t){if(t.status!==2){var e=Ur,n=kd.current;kd.current=vy;var s=_c;_c=t.responseState;try{var r=t.pingedTasks,i;for(i=0;i<r.length;i++){var o=r[i],a=t,l=o.blockedSegment;if(l.status===0){Bc(o.context);try{In(a,o,o.node),a.responseState.generateStaticMarkup||l.lastPushedText&&l.textEmbedded&&l.chunks.push("<!-- -->"),o.abortSet.delete(o),l.status=1,i0(a,o.blockedBoundary,l)}catch(g){if(Up(),typeof g=="object"&&g!==null&&typeof g.then=="function"){var c=o.ping;g.then(c,c)}else{o.abortSet.delete(o),l.status=4;var h=o.blockedBoundary,d=g,f=Ca(a,d);if(h===null?Vc(a,d):(h.pendingTasks--,h.forceClientRender||(h.forceClientRender=!0,h.errorDigest=f,h.parentFlushed&&a.clientRenderedBoundaries.push(h))),a.allPendingTasks--,a.allPendingTasks===0){var m=a.onAllReady;m()}}}finally{}}}r.splice(0,i),t.destination!==null&&Vp(t,t.destination)}catch(g){Ca(t,g),Vc(t,g)}finally{_c=s,kd.current=n,n===vy&&Bc(e)}}}function Yl(t,e,n){switch(n.parentFlushed=!0,n.status){case 0:var s=n.id=t.nextSegmentId++;return n.lastPushedText=!1,n.textEmbedded=!1,t=t.responseState,e.push('<template id="'),e.push(t.placeholderPrefix),t=s.toString(16),e.push(t),e.push('"></template>');case 1:n.status=2;var r=!0;s=n.chunks;var i=0;n=n.children;for(var o=0;o<n.length;o++){for(r=n[o];i<r.index;i++)e.push(s[i]);r=qu(t,e,r)}for(;i<s.length-1;i++)e.push(s[i]);return i<s.length&&(r=e.push(s[i])),r;default:throw Error(Pe(390))}}function qu(t,e,n){var s=n.boundary;if(s===null)return Yl(t,e,n);if(s.parentFlushed=!0,s.forceClientRender)return t.responseState.generateStaticMarkup||(s=s.errorDigest,e.push("<!--$!-->"),e.push("<template"),s&&(e.push(' data-dgst="'),s=un(s),e.push(s),e.push('"')),e.push("></template>")),Yl(t,e,n),t=t.responseState.generateStaticMarkup?!0:e.push("<!--/$-->"),t;if(0<s.pendingTasks){s.rootSegmentID=t.nextSegmentId++,0<s.completedSegments.length&&t.partialBoundaries.push(s);var r=t.responseState,i=r.nextSuspenseID++;return r=r.boundaryPrefix+i.toString(16),s=s.id=r,cy(e,t.responseState,s),Yl(t,e,n),e.push("<!--/$-->")}if(s.byteSize>t.progressiveChunkSize)return s.rootSegmentID=t.nextSegmentId++,t.completedBoundaries.push(s),cy(e,t.responseState,s.id),Yl(t,e,n),e.push("<!--/$-->");if(t.responseState.generateStaticMarkup||e.push("<!--$-->"),n=s.completedSegments,n.length!==1)throw Error(Pe(391));return qu(t,e,n[0]),t=t.responseState.generateStaticMarkup?!0:e.push("<!--/$-->"),t}function by(t,e,n){return MT(e,t.responseState,n.formatContext,n.id),qu(t,e,n),OT(e,n.formatContext)}function Cy(t,e,n){for(var s=n.completedSegments,r=0;r<s.length;r++)a0(t,e,n,s[r]);if(s.length=0,t=t.responseState,s=n.id,n=n.rootSegmentID,e.push(t.startInlineScript),t.sentCompleteBoundaryFunction?e.push('$RC("'):(t.sentCompleteBoundaryFunction=!0,e.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),s===null)throw Error(Pe(395));return n=n.toString(16),e.push(s),e.push('","'),e.push(t.segmentPrefix),e.push(n),e.push('")<\/script>')}function a0(t,e,n,s){if(s.status===2)return!0;var r=s.id;if(r===-1){if((s.id=n.rootSegmentID)===-1)throw Error(Pe(392));return by(t,e,s)}return by(t,e,s),t=t.responseState,e.push(t.startInlineScript),t.sentCompleteSegmentFunction?e.push('$RS("'):(t.sentCompleteSegmentFunction=!0,e.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),e.push(t.segmentPrefix),r=r.toString(16),e.push(r),e.push('","'),e.push(t.placeholderPrefix),e.push(r),e.push('")<\/script>')}function Vp(t,e){try{var n=t.completedRootSegment;if(n!==null&&t.pendingRootTasks===0){qu(t,e,n),t.completedRootSegment=null;var s=t.responseState.bootstrapChunks;for(n=0;n<s.length-1;n++)e.push(s[n]);n<s.length&&e.push(s[n])}var r=t.clientRenderedBoundaries,i;for(i=0;i<r.length;i++){var o=r[i];s=e;var a=t.responseState,l=o.id,c=o.errorDigest,h=o.errorMessage,d=o.errorComponentStack;if(s.push(a.startInlineScript),a.sentClientRenderFunction?s.push('$RX("'):(a.sentClientRenderFunction=!0,s.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),l===null)throw Error(Pe(395));if(s.push(l),s.push('"'),c||h||d){s.push(",");var f=Id(c||"");s.push(f)}if(h||d){s.push(",");var m=Id(h||"");s.push(m)}if(d){s.push(",");var g=Id(d);s.push(g)}if(!s.push(")<\/script>")){t.destination=null,i++,r.splice(0,i);return}}r.splice(0,i);var y=t.completedBoundaries;for(i=0;i<y.length;i++)if(!Cy(t,e,y[i])){t.destination=null,i++,y.splice(0,i);return}y.splice(0,i);var S=t.partialBoundaries;for(i=0;i<S.length;i++){var T=S[i];e:{r=t,o=e;var w=T.completedSegments;for(a=0;a<w.length;a++)if(!a0(r,o,T,w[a])){a++,w.splice(0,a);var b=!1;break e}w.splice(0,a),b=!0}if(!b){t.destination=null,i++,S.splice(0,i);return}}S.splice(0,i);var _=t.completedBoundaries;for(i=0;i<_.length;i++)if(!Cy(t,e,_[i])){t.destination=null,i++,_.splice(0,i);return}_.splice(0,i)}finally{t.allPendingTasks===0&&t.pingedTasks.length===0&&t.clientRenderedBoundaries.length===0&&t.completedBoundaries.length===0&&e.push(null)}}function eI(t,e){try{var n=t.abortableTasks;n.forEach(function(s){return r0(s,t,e)}),n.clear(),t.destination!==null&&Vp(t,t.destination)}catch(s){Ca(t,s),Vc(t,s)}}function tI(){}function l0(t,e,n,s){var r=!1,i=null,o="",a={push:function(c){return c!==null&&(o+=c),!0},destroy:function(c){r=!0,i=c}},l=!1;if(t=JT(t,FT(n,e?e.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,tI,void 0,function(){l=!0}),o0(t),eI(t,s),t.status===1)t.status=2,a.destroy(t.fatalError);else if(t.status!==2&&t.destination===null){t.destination=a;try{Vp(t,a)}catch(c){Ca(t,c),Vc(t,c)}}if(r)throw i;if(!l)throw Error(Pe(426));return o}fo.renderToNodeStream=function(){throw Error(Pe(207))};fo.renderToStaticMarkup=function(t,e){return l0(t,e,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')};fo.renderToStaticNodeStream=function(){throw Error(Pe(208))};fo.renderToString=function(t,e){return l0(t,e,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')};fo.version="18.3.1";var Wp={};/**
 * @license React
 * react-dom-server.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c0=p;function je(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kn=null,An=0;function me(t,e){if(e.length!==0)if(512<e.length)0<An&&(t.enqueue(new Uint8Array(kn.buffer,0,An)),kn=new Uint8Array(512),An=0),t.enqueue(e);else{var n=kn.length-An;n<e.length&&(n===0?t.enqueue(kn):(kn.set(e.subarray(0,n),An),t.enqueue(kn),e=e.subarray(n)),kn=new Uint8Array(512),An=0),kn.set(e,An),An+=e.length}}function ft(t,e){return me(t,e),!0}function Ey(t){kn&&0<An&&(t.enqueue(new Uint8Array(kn.buffer,0,An)),kn=null,An=0)}var u0=new TextEncoder;function $e(t){return u0.encode(t)}function te(t){return u0.encode(t)}function h0(t,e){typeof t.error=="function"?t.error(e):t.close()}var vn=Object.prototype.hasOwnProperty,nI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ty={},Iy={};function d0(t){return vn.call(Iy,t)?!0:vn.call(Ty,t)?!1:nI.test(t)?Iy[t]=!0:(Ty[t]=!0,!1)}function pn(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Jt[t]=new pn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Jt[e]=new pn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Jt[t]=new pn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Jt[t]=new pn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Jt[t]=new pn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Jt[t]=new pn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Jt[t]=new pn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Jt[t]=new pn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Jt[t]=new pn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hp=/[\-:]([a-z])/g;function Gp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hp,Gp);Jt[e]=new pn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hp,Gp);Jt[e]=new pn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hp,Gp);Jt[e]=new pn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Jt[t]=new pn(t,1,!1,t.toLowerCase(),null,!1,!1)});Jt.xlinkHref=new pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Jt[t]=new pn(t,1,!1,t.toLowerCase(),null,!0,!0)});var Sc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sI=["Webkit","ms","Moz","O"];Object.keys(Sc).forEach(function(t){sI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Sc[e]=Sc[t]})});var rI=/["'&<>]/;function Kt(t){if(typeof t=="boolean"||typeof t=="number")return""+t;t=""+t;var e=rI.exec(t);if(e){var n="",s,r=0;for(s=e.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#x27;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}r!==s&&(n+=t.substring(r,s)),r=s+1,n+=e}t=r!==s?n+t.substring(r,s):n}return t}var iI=/([A-Z])/g,oI=/^ms-/,Ef=Array.isArray,aI=te("<script>"),lI=te("<\/script>"),cI=te('<script src="'),uI=te('<script type="module" src="'),ky=te('" async=""><\/script>'),hI=/(<\/|<)(s)(cript)/gi;function dI(t,e,n,s){return""+e+(n==="s"?"\\u0073":"\\u0053")+s}function fI(t,e,n,s,r){t=t===void 0?"":t,e=e===void 0?aI:te('<script nonce="'+Kt(e)+'">');var i=[];if(n!==void 0&&i.push(e,$e((""+n).replace(hI,dI)),lI),s!==void 0)for(n=0;n<s.length;n++)i.push(cI,$e(Kt(s[n])),ky);if(r!==void 0)for(s=0;s<r.length;s++)i.push(uI,$e(Kt(r[s])),ky);return{bootstrapChunks:i,startInlineScript:e,placeholderPrefix:te(t+"P:"),segmentPrefix:te(t+"S:"),boundaryPrefix:t+"B:",idPrefix:t,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}function ls(t,e){return{insertionMode:t,selectedValue:e}}function pI(t){return ls(t==="http://www.w3.org/2000/svg"?2:t==="http://www.w3.org/1998/Math/MathML"?3:0,null)}function mI(t,e,n){switch(e){case"select":return ls(1,n.value!=null?n.value:n.defaultValue);case"svg":return ls(2,null);case"math":return ls(3,null);case"foreignObject":return ls(1,null);case"table":return ls(4,null);case"thead":case"tbody":case"tfoot":return ls(5,null);case"colgroup":return ls(7,null);case"tr":return ls(6,null)}return 4<=t.insertionMode||t.insertionMode===0?ls(1,null):t}var qp=te("<!-- -->");function Ay(t,e,n,s){return e===""?s:(s&&t.push(qp),t.push($e(Kt(e))),!0)}var Ry=new Map,gI=te(' style="'),Ny=te(":"),yI=te(";");function f0(t,e,n){if(typeof n!="object")throw Error(je(62));e=!0;for(var s in n)if(vn.call(n,s)){var r=n[s];if(r!=null&&typeof r!="boolean"&&r!==""){if(s.indexOf("--")===0){var i=$e(Kt(s));r=$e(Kt((""+r).trim()))}else{i=s;var o=Ry.get(i);o!==void 0||(o=te(Kt(i.replace(iI,"-$1").toLowerCase().replace(oI,"-ms-"))),Ry.set(i,o)),i=o,r=typeof r=="number"?r===0||vn.call(Sc,s)?$e(""+r):$e(r+"px"):$e(Kt((""+r).trim()))}e?(e=!1,t.push(gI,i,Ny,r)):t.push(yI,i,Ny,r)}}e||t.push(Fr)}var Ks=te(" "),Pi=te('="'),Fr=te('"'),Py=te('=""');function Tn(t,e,n,s){switch(n){case"style":f0(t,e,s);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N"){if(e=Jt.hasOwnProperty(n)?Jt[n]:null,e!==null){switch(typeof s){case"function":case"symbol":return;case"boolean":if(!e.acceptsBooleans)return}switch(n=$e(e.attributeName),e.type){case 3:s&&t.push(Ks,n,Py);break;case 4:s===!0?t.push(Ks,n,Py):s!==!1&&t.push(Ks,n,Pi,$e(Kt(s)),Fr);break;case 5:isNaN(s)||t.push(Ks,n,Pi,$e(Kt(s)),Fr);break;case 6:!isNaN(s)&&1<=s&&t.push(Ks,n,Pi,$e(Kt(s)),Fr);break;default:e.sanitizeURL&&(s=""+s),t.push(Ks,n,Pi,$e(Kt(s)),Fr)}}else if(d0(n)){switch(typeof s){case"function":case"symbol":return;case"boolean":if(e=n.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-")return}t.push(Ks,$e(n),Pi,$e(Kt(s)),Fr)}}}var Ys=te(">"),Dy=te("/>");function xc(t,e,n){if(e!=null){if(n!=null)throw Error(je(60));if(typeof e!="object"||!("__html"in e))throw Error(je(61));e=e.__html,e!=null&&t.push($e(""+e))}}function vI(t){var e="";return c0.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}var Ad=te(' selected=""');function Rd(t,e,n,s){t.push(cs(n));var r=n=null,i;for(i in e)if(vn.call(e,i)){var o=e[i];if(o!=null)switch(i){case"children":n=o;break;case"dangerouslySetInnerHTML":r=o;break;default:Tn(t,s,i,o)}}return t.push(Ys),xc(t,r,n),typeof n=="string"?(t.push($e(Kt(n))),null):n}var Nd=te(`
`),wI=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,My=new Map;function cs(t){var e=My.get(t);if(e===void 0){if(!wI.test(t))throw Error(je(65,t));e=te("<"+t),My.set(t,e)}return e}var _I=te("<!DOCTYPE html>");function SI(t,e,n,s,r){switch(e){case"select":t.push(cs("select"));var i=null,o=null;for(h in n)if(vn.call(n,h)){var a=n[h];if(a!=null)switch(h){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;case"defaultValue":case"value":break;default:Tn(t,s,h,a)}}return t.push(Ys),xc(t,o,i),i;case"option":o=r.selectedValue,t.push(cs("option"));var l=a=null,c=null,h=null;for(i in n)if(vn.call(n,i)){var d=n[i];if(d!=null)switch(i){case"children":a=d;break;case"selected":c=d;break;case"dangerouslySetInnerHTML":h=d;break;case"value":l=d;default:Tn(t,s,i,d)}}if(o!=null)if(n=l!==null?""+l:vI(a),Ef(o)){for(s=0;s<o.length;s++)if(""+o[s]===n){t.push(Ad);break}}else""+o===n&&t.push(Ad);else c&&t.push(Ad);return t.push(Ys),xc(t,h,a),a;case"textarea":t.push(cs("textarea")),h=o=i=null;for(a in n)if(vn.call(n,a)&&(l=n[a],l!=null))switch(a){case"children":h=l;break;case"value":i=l;break;case"defaultValue":o=l;break;case"dangerouslySetInnerHTML":throw Error(je(91));default:Tn(t,s,a,l)}if(i===null&&o!==null&&(i=o),t.push(Ys),h!=null){if(i!=null)throw Error(je(92));if(Ef(h)&&1<h.length)throw Error(je(93));i=""+h}return typeof i=="string"&&i[0]===`
`&&t.push(Nd),i!==null&&t.push($e(Kt(""+i))),null;case"input":t.push(cs("input")),l=h=a=i=null;for(o in n)if(vn.call(n,o)&&(c=n[o],c!=null))switch(o){case"children":case"dangerouslySetInnerHTML":throw Error(je(399,"input"));case"defaultChecked":l=c;break;case"defaultValue":a=c;break;case"checked":h=c;break;case"value":i=c;break;default:Tn(t,s,o,c)}return h!==null?Tn(t,s,"checked",h):l!==null&&Tn(t,s,"checked",l),i!==null?Tn(t,s,"value",i):a!==null&&Tn(t,s,"value",a),t.push(Dy),null;case"menuitem":t.push(cs("menuitem"));for(var f in n)if(vn.call(n,f)&&(i=n[f],i!=null))switch(f){case"children":case"dangerouslySetInnerHTML":throw Error(je(400));default:Tn(t,s,f,i)}return t.push(Ys),null;case"title":t.push(cs("title")),i=null;for(d in n)if(vn.call(n,d)&&(o=n[d],o!=null))switch(d){case"children":i=o;break;case"dangerouslySetInnerHTML":throw Error(je(434));default:Tn(t,s,d,o)}return t.push(Ys),i;case"listing":case"pre":t.push(cs(e)),o=i=null;for(l in n)if(vn.call(n,l)&&(a=n[l],a!=null))switch(l){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;default:Tn(t,s,l,a)}if(t.push(Ys),o!=null){if(i!=null)throw Error(je(60));if(typeof o!="object"||!("__html"in o))throw Error(je(61));n=o.__html,n!=null&&(typeof n=="string"&&0<n.length&&n[0]===`
`?t.push(Nd,$e(n)):t.push($e(""+n)))}return typeof i=="string"&&i[0]===`
`&&t.push(Nd),i;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":t.push(cs(e));for(var m in n)if(vn.call(n,m)&&(i=n[m],i!=null))switch(m){case"children":case"dangerouslySetInnerHTML":throw Error(je(399,e));default:Tn(t,s,m,i)}return t.push(Dy),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Rd(t,n,e,s);case"html":return r.insertionMode===0&&t.push(_I),Rd(t,n,e,s);default:if(e.indexOf("-")===-1&&typeof n.is!="string")return Rd(t,n,e,s);t.push(cs(e)),o=i=null;for(c in n)if(vn.call(n,c)&&(a=n[c],a!=null))switch(c){case"children":i=a;break;case"dangerouslySetInnerHTML":o=a;break;case"style":f0(t,s,a);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:d0(c)&&typeof a!="function"&&typeof a!="symbol"&&t.push(Ks,$e(c),Pi,$e(Kt(a)),Fr)}return t.push(Ys),xc(t,o,i),i}}var xI=te("</"),bI=te(">"),CI=te('<template id="'),EI=te('"></template>'),TI=te("<!--$-->"),II=te('<!--$?--><template id="'),kI=te('"></template>'),AI=te("<!--$!-->"),RI=te("<!--/$-->"),NI=te("<template"),PI=te('"'),DI=te(' data-dgst="');te(' data-msg="');te(' data-stck="');var MI=te("></template>");function Oy(t,e,n){if(me(t,II),n===null)throw Error(je(395));return me(t,n),ft(t,kI)}var OI=te('<div hidden id="'),jI=te('">'),FI=te("</div>"),LI=te('<svg aria-hidden="true" style="display:none" id="'),$I=te('">'),BI=te("</svg>"),UI=te('<math aria-hidden="true" style="display:none" id="'),zI=te('">'),VI=te("</math>"),WI=te('<table hidden id="'),HI=te('">'),GI=te("</table>"),qI=te('<table hidden><tbody id="'),KI=te('">'),YI=te("</tbody></table>"),QI=te('<table hidden><tr id="'),XI=te('">'),JI=te("</tr></table>"),ZI=te('<table hidden><colgroup id="'),ek=te('">'),tk=te("</colgroup></table>");function nk(t,e,n,s){switch(n.insertionMode){case 0:case 1:return me(t,OI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,jI);case 2:return me(t,LI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,$I);case 3:return me(t,UI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,zI);case 4:return me(t,WI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,HI);case 5:return me(t,qI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,KI);case 6:return me(t,QI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,XI);case 7:return me(t,ZI),me(t,e.segmentPrefix),me(t,$e(s.toString(16))),ft(t,ek);default:throw Error(je(397))}}function sk(t,e){switch(e.insertionMode){case 0:case 1:return ft(t,FI);case 2:return ft(t,BI);case 3:return ft(t,VI);case 4:return ft(t,GI);case 5:return ft(t,YI);case 6:return ft(t,JI);case 7:return ft(t,tk);default:throw Error(je(397))}}var rk=te('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),ik=te('$RS("'),ok=te('","'),ak=te('")<\/script>'),lk=te('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),ck=te('$RC("'),uk=te('","'),hk=te('")<\/script>'),dk=te('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),fk=te('$RX("'),pk=te('"'),mk=te(")<\/script>"),Pd=te(","),gk=/[<\u2028\u2029]/g;function Dd(t){return JSON.stringify(t).replace(gk,function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var ia=Object.assign,yk=Symbol.for("react.element"),p0=Symbol.for("react.portal"),m0=Symbol.for("react.fragment"),g0=Symbol.for("react.strict_mode"),y0=Symbol.for("react.profiler"),v0=Symbol.for("react.provider"),w0=Symbol.for("react.context"),_0=Symbol.for("react.forward_ref"),S0=Symbol.for("react.suspense"),x0=Symbol.for("react.suspense_list"),b0=Symbol.for("react.memo"),Kp=Symbol.for("react.lazy"),vk=Symbol.for("react.scope"),wk=Symbol.for("react.debug_trace_mode"),_k=Symbol.for("react.legacy_hidden"),Sk=Symbol.for("react.default_value"),jy=Symbol.iterator;function Tf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case m0:return"Fragment";case p0:return"Portal";case y0:return"Profiler";case g0:return"StrictMode";case S0:return"Suspense";case x0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case w0:return(t.displayName||"Context")+".Consumer";case v0:return(t._context.displayName||"Context")+".Provider";case _0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case b0:return e=t.displayName||null,e!==null?e:Tf(t.type)||"Memo";case Kp:e=t._payload,t=t._init;try{return Tf(t(e))}catch{}}return null}var C0={};function Fy(t,e){if(t=t.contextTypes,!t)return C0;var n={},s;for(s in t)n[s]=e[s];return n}var zr=null;function Ku(t,e){if(t!==e){t.context._currentValue=t.parentValue,t=t.parent;var n=e.parent;if(t===null){if(n!==null)throw Error(je(401))}else{if(n===null)throw Error(je(401));Ku(t,n)}e.context._currentValue=e.value}}function E0(t){t.context._currentValue=t.parentValue,t=t.parent,t!==null&&E0(t)}function T0(t){var e=t.parent;e!==null&&T0(e),t.context._currentValue=t.value}function I0(t,e){if(t.context._currentValue=t.parentValue,t=t.parent,t===null)throw Error(je(402));t.depth===e.depth?Ku(t,e):I0(t,e)}function k0(t,e){var n=e.parent;if(n===null)throw Error(je(402));t.depth===n.depth?Ku(t,n):k0(t,n),e.context._currentValue=e.value}function Hc(t){var e=zr;e!==t&&(e===null?T0(t):t===null?E0(e):e.depth===t.depth?Ku(e,t):e.depth>t.depth?I0(e,t):k0(e,t),zr=t)}var Ly={isMounted:function(){return!1},enqueueSetState:function(t,e){t=t._reactInternals,t.queue!==null&&t.queue.push(e)},enqueueReplaceState:function(t,e){t=t._reactInternals,t.replace=!0,t.queue=[e]},enqueueForceUpdate:function(){}};function $y(t,e,n,s){var r=t.state!==void 0?t.state:null;t.updater=Ly,t.props=n,t.state=r;var i={queue:[],replace:!1};t._reactInternals=i;var o=e.contextType;if(t.context=typeof o=="object"&&o!==null?o._currentValue:s,o=e.getDerivedStateFromProps,typeof o=="function"&&(o=o(n,r),r=o==null?r:ia({},r,o),t.state=r),typeof e.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function"&&(typeof t.UNSAFE_componentWillMount=="function"||typeof t.componentWillMount=="function"))if(e=t.state,typeof t.componentWillMount=="function"&&t.componentWillMount(),typeof t.UNSAFE_componentWillMount=="function"&&t.UNSAFE_componentWillMount(),e!==t.state&&Ly.enqueueReplaceState(t,t.state,null),i.queue!==null&&0<i.queue.length)if(e=i.queue,o=i.replace,i.queue=null,i.replace=!1,o&&e.length===1)t.state=e[0];else{for(i=o?e[0]:t.state,r=!0,o=o?1:0;o<e.length;o++){var a=e[o];a=typeof a=="function"?a.call(t,i,n,s):a,a!=null&&(r?(r=!1,i=ia({},i,a)):ia(i,a))}t.state=i}else i.queue=null}var xk={id:1,overflow:""};function If(t,e,n){var s=t.id;t=t.overflow;var r=32-bc(s)-1;s&=~(1<<r),n+=1;var i=32-bc(e)+r;if(30<i){var o=r-r%5;return i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,{id:1<<32-bc(e)+r|n<<r|s,overflow:i+t}}return{id:1<<i|n<<r|s,overflow:t}}var bc=Math.clz32?Math.clz32:Ek,bk=Math.log,Ck=Math.LN2;function Ek(t){return t>>>=0,t===0?32:31-(bk(t)/Ck|0)|0}function Tk(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ik=typeof Object.is=="function"?Object.is:Tk,Os=null,Yp=null,Cc=null,ut=null,Yo=!1,Gc=!1,Ea=0,nr=null,Yu=0;function Lr(){if(Os===null)throw Error(je(321));return Os}function By(){if(0<Yu)throw Error(je(312));return{memoizedState:null,queue:null,next:null}}function Qp(){return ut===null?Cc===null?(Yo=!1,Cc=ut=By()):(Yo=!0,ut=Cc):ut.next===null?(Yo=!1,ut=ut.next=By()):(Yo=!0,ut=ut.next),ut}function Xp(){Yp=Os=null,Gc=!1,Cc=null,Yu=0,ut=nr=null}function A0(t,e){return typeof e=="function"?e(t):e}function Uy(t,e,n){if(Os=Lr(),ut=Qp(),Yo){var s=ut.queue;if(e=s.dispatch,nr!==null&&(n=nr.get(s),n!==void 0)){nr.delete(s),s=ut.memoizedState;do s=t(s,n.action),n=n.next;while(n!==null);return ut.memoizedState=s,[s,e]}return[ut.memoizedState,e]}return t=t===A0?typeof e=="function"?e():e:n!==void 0?n(e):e,ut.memoizedState=t,t=ut.queue={last:null,dispatch:null},t=t.dispatch=kk.bind(null,Os,t),[ut.memoizedState,t]}function zy(t,e){if(Os=Lr(),ut=Qp(),e=e===void 0?null:e,ut!==null){var n=ut.memoizedState;if(n!==null&&e!==null){var s=n[1];e:if(s===null)s=!1;else{for(var r=0;r<s.length&&r<e.length;r++)if(!Ik(e[r],s[r])){s=!1;break e}s=!0}if(s)return n[0]}}return t=t(),ut.memoizedState=[t,e],t}function kk(t,e,n){if(25<=Yu)throw Error(je(301));if(t===Os)if(Gc=!0,t={action:n,next:null},nr===null&&(nr=new Map),n=nr.get(e),n===void 0)nr.set(e,t);else{for(e=n;e.next!==null;)e=e.next;e.next=t}}function Ak(){throw Error(je(394))}function Ql(){}var Vy={readContext:function(t){return t._currentValue},useContext:function(t){return Lr(),t._currentValue},useMemo:zy,useReducer:Uy,useRef:function(t){Os=Lr(),ut=Qp();var e=ut.memoizedState;return e===null?(t={current:t},ut.memoizedState=t):e},useState:function(t){return Uy(A0,t)},useInsertionEffect:Ql,useLayoutEffect:function(){},useCallback:function(t,e){return zy(function(){return t},e)},useImperativeHandle:Ql,useEffect:Ql,useDebugValue:Ql,useDeferredValue:function(t){return Lr(),t},useTransition:function(){return Lr(),[!1,Ak]},useId:function(){var t=Yp.treeContext,e=t.overflow;t=t.id,t=(t&~(1<<32-bc(t)-1)).toString(32)+e;var n=Ec;if(n===null)throw Error(je(404));return e=Ea++,t=":"+n.idPrefix+"R"+t,0<e&&(t+="H"+e.toString(32)),t+":"},useMutableSource:function(t,e){return Lr(),e(t._source)},useSyncExternalStore:function(t,e,n){if(n===void 0)throw Error(je(407));return n()}},Ec=null,Md=c0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Rk(t){return console.error(t),null}function Qo(){}function Nk(t,e,n,s,r,i,o,a,l){var c=[],h=new Set;return e={destination:null,responseState:e,progressiveChunkSize:s===void 0?12800:s,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:h,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:r===void 0?Rk:r,onAllReady:i===void 0?Qo:i,onShellReady:o===void 0?Qo:o,onShellError:a===void 0?Qo:a,onFatalError:l===void 0?Qo:l},n=qc(e,0,null,n,!1,!1),n.parentFlushed=!0,t=Jp(e,t,null,n,h,C0,null,xk),c.push(t),e}function Jp(t,e,n,s,r,i,o,a){t.allPendingTasks++,n===null?t.pendingRootTasks++:n.pendingTasks++;var l={node:e,ping:function(){var c=t.pingedTasks;c.push(l),c.length===1&&P0(t)},blockedBoundary:n,blockedSegment:s,abortSet:r,legacyContext:i,context:o,treeContext:a};return r.add(l),l}function qc(t,e,n,s,r,i){return{status:0,id:-1,index:e,parentFlushed:!1,chunks:[],children:[],formatContext:s,boundary:n,lastPushedText:r,textEmbedded:i}}function Ta(t,e){if(t=t.onError(e),t!=null&&typeof t!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof t+'" instead');return t}function Kc(t,e){var n=t.onShellError;n(e),n=t.onFatalError,n(e),t.destination!==null?(t.status=2,h0(t.destination,e)):(t.status=1,t.fatalError=e)}function Wy(t,e,n,s,r){for(Os={},Yp=e,Ea=0,t=n(s,r);Gc;)Gc=!1,Ea=0,Yu+=1,ut=null,t=n(s,r);return Xp(),t}function Hy(t,e,n,s){var r=n.render(),i=s.childContextTypes;if(i!=null){var o=e.legacyContext;if(typeof n.getChildContext!="function")s=o;else{n=n.getChildContext();for(var a in n)if(!(a in i))throw Error(je(108,Tf(s)||"Unknown",a));s=ia({},o,n)}e.legacyContext=s,Rn(t,e,r),e.legacyContext=o}else Rn(t,e,r)}function Gy(t,e){if(t&&t.defaultProps){e=ia({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function kf(t,e,n,s,r){if(typeof n=="function")if(n.prototype&&n.prototype.isReactComponent){r=Fy(n,e.legacyContext);var i=n.contextType;i=new n(s,typeof i=="object"&&i!==null?i._currentValue:r),$y(i,n,s,r),Hy(t,e,i,n)}else{i=Fy(n,e.legacyContext),r=Wy(t,e,n,s,i);var o=Ea!==0;if(typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0)$y(r,n,s,i),Hy(t,e,r,n);else if(o){s=e.treeContext,e.treeContext=If(s,1,0);try{Rn(t,e,r)}finally{e.treeContext=s}}else Rn(t,e,r)}else if(typeof n=="string"){switch(r=e.blockedSegment,i=SI(r.chunks,n,s,t.responseState,r.formatContext),r.lastPushedText=!1,o=r.formatContext,r.formatContext=mI(o,n,s),Af(t,e,i),r.formatContext=o,n){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:r.chunks.push(xI,$e(n),bI)}r.lastPushedText=!1}else{switch(n){case _k:case wk:case g0:case y0:case m0:Rn(t,e,s.children);return;case x0:Rn(t,e,s.children);return;case vk:throw Error(je(343));case S0:e:{n=e.blockedBoundary,r=e.blockedSegment,i=s.fallback,s=s.children,o=new Set;var a={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:o,errorDigest:null},l=qc(t,r.chunks.length,a,r.formatContext,!1,!1);r.children.push(l),r.lastPushedText=!1;var c=qc(t,0,null,r.formatContext,!1,!1);c.parentFlushed=!0,e.blockedBoundary=a,e.blockedSegment=c;try{if(Af(t,e,s),c.lastPushedText&&c.textEmbedded&&c.chunks.push(qp),c.status=1,Yc(a,c),a.pendingTasks===0)break e}catch(h){c.status=4,a.forceClientRender=!0,a.errorDigest=Ta(t,h)}finally{e.blockedBoundary=n,e.blockedSegment=r}e=Jp(t,i,n,l,o,e.legacyContext,e.context,e.treeContext),t.pingedTasks.push(e)}return}if(typeof n=="object"&&n!==null)switch(n.$$typeof){case _0:if(s=Wy(t,e,n.render,s,r),Ea!==0){n=e.treeContext,e.treeContext=If(n,1,0);try{Rn(t,e,s)}finally{e.treeContext=n}}else Rn(t,e,s);return;case b0:n=n.type,s=Gy(n,s),kf(t,e,n,s,r);return;case v0:if(r=s.children,n=n._context,s=s.value,i=n._currentValue,n._currentValue=s,o=zr,zr=s={parent:o,depth:o===null?0:o.depth+1,context:n,parentValue:i,value:s},e.context=s,Rn(t,e,r),t=zr,t===null)throw Error(je(403));s=t.parentValue,t.context._currentValue=s===Sk?t.context._defaultValue:s,t=zr=t.parent,e.context=t;return;case w0:s=s.children,s=s(n._currentValue),Rn(t,e,s);return;case Kp:r=n._init,n=r(n._payload),s=Gy(n,s),kf(t,e,n,s,void 0);return}throw Error(je(130,n==null?n:typeof n,""))}}function Rn(t,e,n){if(e.node=n,typeof n=="object"&&n!==null){switch(n.$$typeof){case yk:kf(t,e,n.type,n.props,n.ref);return;case p0:throw Error(je(257));case Kp:var s=n._init;n=s(n._payload),Rn(t,e,n);return}if(Ef(n)){qy(t,e,n);return}if(n===null||typeof n!="object"?s=null:(s=jy&&n[jy]||n["@@iterator"],s=typeof s=="function"?s:null),s&&(s=s.call(n))){if(n=s.next(),!n.done){var r=[];do r.push(n.value),n=s.next();while(!n.done);qy(t,e,r)}return}throw t=Object.prototype.toString.call(n),Error(je(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t))}typeof n=="string"?(s=e.blockedSegment,s.lastPushedText=Ay(e.blockedSegment.chunks,n,t.responseState,s.lastPushedText)):typeof n=="number"&&(s=e.blockedSegment,s.lastPushedText=Ay(e.blockedSegment.chunks,""+n,t.responseState,s.lastPushedText))}function qy(t,e,n){for(var s=n.length,r=0;r<s;r++){var i=e.treeContext;e.treeContext=If(i,s,r);try{Af(t,e,n[r])}finally{e.treeContext=i}}}function Af(t,e,n){var s=e.blockedSegment.formatContext,r=e.legacyContext,i=e.context;try{return Rn(t,e,n)}catch(l){if(Xp(),typeof l=="object"&&l!==null&&typeof l.then=="function"){n=l;var o=e.blockedSegment,a=qc(t,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(a),o.lastPushedText=!1,t=Jp(t,e.node,e.blockedBoundary,a,e.abortSet,e.legacyContext,e.context,e.treeContext).ping,n.then(t,t),e.blockedSegment.formatContext=s,e.legacyContext=r,e.context=i,Hc(i)}else throw e.blockedSegment.formatContext=s,e.legacyContext=r,e.context=i,Hc(i),l}}function Pk(t){var e=t.blockedBoundary;t=t.blockedSegment,t.status=3,N0(this,e,t)}function R0(t,e,n){var s=t.blockedBoundary;t.blockedSegment.status=3,s===null?(e.allPendingTasks--,e.status!==2&&(e.status=2,e.destination!==null&&e.destination.close())):(s.pendingTasks--,s.forceClientRender||(s.forceClientRender=!0,t=n===void 0?Error(je(432)):n,s.errorDigest=e.onError(t),s.parentFlushed&&e.clientRenderedBoundaries.push(s)),s.fallbackAbortableTasks.forEach(function(r){return R0(r,e,n)}),s.fallbackAbortableTasks.clear(),e.allPendingTasks--,e.allPendingTasks===0&&(s=e.onAllReady,s()))}function Yc(t,e){if(e.chunks.length===0&&e.children.length===1&&e.children[0].boundary===null){var n=e.children[0];n.id=e.id,n.parentFlushed=!0,n.status===1&&Yc(t,n)}else t.completedSegments.push(e)}function N0(t,e,n){if(e===null){if(n.parentFlushed){if(t.completedRootSegment!==null)throw Error(je(389));t.completedRootSegment=n}t.pendingRootTasks--,t.pendingRootTasks===0&&(t.onShellError=Qo,e=t.onShellReady,e())}else e.pendingTasks--,e.forceClientRender||(e.pendingTasks===0?(n.parentFlushed&&n.status===1&&Yc(e,n),e.parentFlushed&&t.completedBoundaries.push(e),e.fallbackAbortableTasks.forEach(Pk,t),e.fallbackAbortableTasks.clear()):n.parentFlushed&&n.status===1&&(Yc(e,n),e.completedSegments.length===1&&e.parentFlushed&&t.partialBoundaries.push(e)));t.allPendingTasks--,t.allPendingTasks===0&&(t=t.onAllReady,t())}function P0(t){if(t.status!==2){var e=zr,n=Md.current;Md.current=Vy;var s=Ec;Ec=t.responseState;try{var r=t.pingedTasks,i;for(i=0;i<r.length;i++){var o=r[i],a=t,l=o.blockedSegment;if(l.status===0){Hc(o.context);try{Rn(a,o,o.node),l.lastPushedText&&l.textEmbedded&&l.chunks.push(qp),o.abortSet.delete(o),l.status=1,N0(a,o.blockedBoundary,l)}catch(g){if(Xp(),typeof g=="object"&&g!==null&&typeof g.then=="function"){var c=o.ping;g.then(c,c)}else{o.abortSet.delete(o),l.status=4;var h=o.blockedBoundary,d=g,f=Ta(a,d);if(h===null?Kc(a,d):(h.pendingTasks--,h.forceClientRender||(h.forceClientRender=!0,h.errorDigest=f,h.parentFlushed&&a.clientRenderedBoundaries.push(h))),a.allPendingTasks--,a.allPendingTasks===0){var m=a.onAllReady;m()}}}finally{}}}r.splice(0,i),t.destination!==null&&Zp(t,t.destination)}catch(g){Ta(t,g),Kc(t,g)}finally{Ec=s,Md.current=n,n===Vy&&Hc(e)}}}function Xl(t,e,n){switch(n.parentFlushed=!0,n.status){case 0:var s=n.id=t.nextSegmentId++;return n.lastPushedText=!1,n.textEmbedded=!1,t=t.responseState,me(e,CI),me(e,t.placeholderPrefix),t=$e(s.toString(16)),me(e,t),ft(e,EI);case 1:n.status=2;var r=!0;s=n.chunks;var i=0;n=n.children;for(var o=0;o<n.length;o++){for(r=n[o];i<r.index;i++)me(e,s[i]);r=Qu(t,e,r)}for(;i<s.length-1;i++)me(e,s[i]);return i<s.length&&(r=ft(e,s[i])),r;default:throw Error(je(390))}}function Qu(t,e,n){var s=n.boundary;if(s===null)return Xl(t,e,n);if(s.parentFlushed=!0,s.forceClientRender)s=s.errorDigest,ft(e,AI),me(e,NI),s&&(me(e,DI),me(e,$e(Kt(s))),me(e,PI)),ft(e,MI),Xl(t,e,n);else if(0<s.pendingTasks){s.rootSegmentID=t.nextSegmentId++,0<s.completedSegments.length&&t.partialBoundaries.push(s);var r=t.responseState,i=r.nextSuspenseID++;r=te(r.boundaryPrefix+i.toString(16)),s=s.id=r,Oy(e,t.responseState,s),Xl(t,e,n)}else if(s.byteSize>t.progressiveChunkSize)s.rootSegmentID=t.nextSegmentId++,t.completedBoundaries.push(s),Oy(e,t.responseState,s.id),Xl(t,e,n);else{if(ft(e,TI),n=s.completedSegments,n.length!==1)throw Error(je(391));Qu(t,e,n[0])}return ft(e,RI)}function Ky(t,e,n){return nk(e,t.responseState,n.formatContext,n.id),Qu(t,e,n),sk(e,n.formatContext)}function Yy(t,e,n){for(var s=n.completedSegments,r=0;r<s.length;r++)D0(t,e,n,s[r]);if(s.length=0,t=t.responseState,s=n.id,n=n.rootSegmentID,me(e,t.startInlineScript),t.sentCompleteBoundaryFunction?me(e,ck):(t.sentCompleteBoundaryFunction=!0,me(e,lk)),s===null)throw Error(je(395));return n=$e(n.toString(16)),me(e,s),me(e,uk),me(e,t.segmentPrefix),me(e,n),ft(e,hk)}function D0(t,e,n,s){if(s.status===2)return!0;var r=s.id;if(r===-1){if((s.id=n.rootSegmentID)===-1)throw Error(je(392));return Ky(t,e,s)}return Ky(t,e,s),t=t.responseState,me(e,t.startInlineScript),t.sentCompleteSegmentFunction?me(e,ik):(t.sentCompleteSegmentFunction=!0,me(e,rk)),me(e,t.segmentPrefix),r=$e(r.toString(16)),me(e,r),me(e,ok),me(e,t.placeholderPrefix),me(e,r),ft(e,ak)}function Zp(t,e){kn=new Uint8Array(512),An=0;try{var n=t.completedRootSegment;if(n!==null&&t.pendingRootTasks===0){Qu(t,e,n),t.completedRootSegment=null;var s=t.responseState.bootstrapChunks;for(n=0;n<s.length-1;n++)me(e,s[n]);n<s.length&&ft(e,s[n])}var r=t.clientRenderedBoundaries,i;for(i=0;i<r.length;i++){var o=r[i];s=e;var a=t.responseState,l=o.id,c=o.errorDigest,h=o.errorMessage,d=o.errorComponentStack;if(me(s,a.startInlineScript),a.sentClientRenderFunction?me(s,fk):(a.sentClientRenderFunction=!0,me(s,dk)),l===null)throw Error(je(395));me(s,l),me(s,pk),(c||h||d)&&(me(s,Pd),me(s,$e(Dd(c||"")))),(h||d)&&(me(s,Pd),me(s,$e(Dd(h||"")))),d&&(me(s,Pd),me(s,$e(Dd(d)))),ft(s,mk)}r.splice(0,i);var f=t.completedBoundaries;for(i=0;i<f.length;i++)Yy(t,e,f[i]);f.splice(0,i),Ey(e),kn=new Uint8Array(512),An=0;var m=t.partialBoundaries;for(i=0;i<m.length;i++){var g=m[i];e:{r=t,o=e;var y=g.completedSegments;for(a=0;a<y.length;a++)if(!D0(r,o,g,y[a])){a++,y.splice(0,a);var S=!1;break e}y.splice(0,a),S=!0}if(!S){t.destination=null,i++,m.splice(0,i);return}}m.splice(0,i);var T=t.completedBoundaries;for(i=0;i<T.length;i++)Yy(t,e,T[i]);T.splice(0,i)}finally{Ey(e),t.allPendingTasks===0&&t.pingedTasks.length===0&&t.clientRenderedBoundaries.length===0&&t.completedBoundaries.length===0&&e.close()}}function Qy(t,e){try{var n=t.abortableTasks;n.forEach(function(s){return R0(s,t,e)}),n.clear(),t.destination!==null&&Zp(t,t.destination)}catch(s){Ta(t,s),Kc(t,s)}}Wp.renderToReadableStream=function(t,e){return new Promise(function(n,s){var r,i,o=new Promise(function(h,d){i=h,r=d}),a=Nk(t,fI(e?e.identifierPrefix:void 0,e?e.nonce:void 0,e?e.bootstrapScriptContent:void 0,e?e.bootstrapScripts:void 0,e?e.bootstrapModules:void 0),pI(e?e.namespaceURI:void 0),e?e.progressiveChunkSize:void 0,e?e.onError:void 0,i,function(){var h=new ReadableStream({type:"bytes",pull:function(d){if(a.status===1)a.status=2,h0(d,a.fatalError);else if(a.status!==2&&a.destination===null){a.destination=d;try{Zp(a,d)}catch(f){Ta(a,f),Kc(a,f)}}},cancel:function(){Qy(a)}},{highWaterMark:0});h.allReady=o,n(h)},function(h){o.catch(function(){}),s(h)},r);if(e&&e.signal){var l=e.signal,c=function(){Qy(a,l.reason),l.removeEventListener("abort",c)};l.addEventListener("abort",c)}P0(a)})};Wp.version="18.3.1";var po,M0;po=fo,M0=Wp;po.version;var Dk=po.renderToString;po.renderToStaticMarkup;po.renderToNodeStream;po.renderToStaticNodeStream;M0.renderToReadableStream;function Mk({basename:t,children:e,location:n="/",future:s}){typeof n=="string"&&(n=dT(n));let r=fT.Pop,i={pathname:n.pathname||"/",search:n.search||"",hash:n.hash||"",state:n.state!=null?n.state:null,key:n.key||"default"},o=Ok();return p.createElement(pT,{basename:t,children:e,location:i,navigationType:r,navigator:o,future:s,static:!0})}function Ok(){return{createHref:jk,encodeLocation:Fk,push(t){throw new Error(`You cannot use navigator.push() on the server because it is a stateless environment. This error was probably triggered when you did a \`navigate(${JSON.stringify(t)})\` somewhere in your app.`)},replace(t){throw new Error(`You cannot use navigator.replace() on the server because it is a stateless environment. This error was probably triggered when you did a \`navigate(${JSON.stringify(t)}, { replace: true })\` somewhere in your app.`)},go(t){throw new Error(`You cannot use navigator.go() on the server because it is a stateless environment. This error was probably triggered when you did a \`navigate(${t})\` somewhere in your app.`)},back(){throw new Error("You cannot use navigator.back() on the server because it is a stateless environment.")},forward(){throw new Error("You cannot use navigator.forward() on the server because it is a stateless environment.")}}}function jk(t){return typeof t=="string"?t:M_(t)}function Fk(t){let e=typeof t=="string"?t:M_(t);e=e.replace(/ $/,"%20");let n=Lk.test(e)?new URL(e):new URL(e,"http://localhost");return{pathname:n.pathname,search:n.search,hash:n.hash}}const Lk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;var $k=typeof Element<"u",Bk=typeof Map=="function",Uk=typeof Set=="function",zk=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Tc(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,s,r;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(s=n;s--!==0;)if(!Tc(t[s],e[s]))return!1;return!0}var i;if(Bk&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i=t.entries();!(s=i.next()).done;)if(!e.has(s.value[0]))return!1;for(i=t.entries();!(s=i.next()).done;)if(!Tc(s.value[1],e.get(s.value[0])))return!1;return!0}if(Uk&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i=t.entries();!(s=i.next()).done;)if(!e.has(s.value[0]))return!1;return!0}if(zk&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(s=n;s--!==0;)if(t[s]!==e[s])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[s]))return!1;if($k&&t instanceof Element)return!1;for(s=n;s--!==0;)if(!((r[s]==="_owner"||r[s]==="__v"||r[s]==="__o")&&t.$$typeof)&&!Tc(t[r[s]],e[r[s]]))return!1;return!0}return t!==t&&e!==e}var Vk=function(e,n){try{return Tc(e,n)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}};const Wk=Op(Vk);var Hk=function(t,e,n,s,r,i,o,a){if(!t){var l;if(e===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,s,r,i,o,a],h=0;l=new Error(e.replace(/%s/g,function(){return c[h++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}},Gk=Hk;const Xy=Op(Gk);var qk=function(e,n,s,r){var i=s?s.call(r,e,n):void 0;if(i!==void 0)return!!i;if(e===n)return!0;if(typeof e!="object"||!e||typeof n!="object"||!n)return!1;var o=Object.keys(e),a=Object.keys(n);if(o.length!==a.length)return!1;for(var l=Object.prototype.hasOwnProperty.bind(n),c=0;c<o.length;c++){var h=o[c];if(!l(h))return!1;var d=e[h],f=n[h];if(i=s?s.call(r,d,f,h):void 0,i===!1||i===void 0&&d!==f)return!1}return!0};const Kk=Op(qk);var O0=(t=>(t.BASE="base",t.BODY="body",t.HEAD="head",t.HTML="html",t.LINK="link",t.META="meta",t.NOSCRIPT="noscript",t.SCRIPT="script",t.STYLE="style",t.TITLE="title",t.FRAGMENT="Symbol(react.fragment)",t))(O0||{}),Od={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},Jy=Object.values(O0),em={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},Yk=Object.entries(em).reduce((t,[e,n])=>(t[n]=e,t),{}),Qn="data-rh",Li={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},$i=(t,e)=>{for(let n=t.length-1;n>=0;n-=1){const s=t[n];if(Object.prototype.hasOwnProperty.call(s,e))return s[e]}return null},Qk=t=>{let e=$i(t,"title");const n=$i(t,Li.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),n&&e)return n.replace(/%s/g,()=>e);const s=$i(t,Li.DEFAULT_TITLE);return e||s||void 0},Xk=t=>$i(t,Li.ON_CHANGE_CLIENT_STATE)||(()=>{}),jd=(t,e)=>e.filter(n=>typeof n[t]<"u").map(n=>n[t]).reduce((n,s)=>({...n,...s}),{}),Jk=(t,e)=>e.filter(n=>typeof n.base<"u").map(n=>n.base).reverse().reduce((n,s)=>{if(!n.length){const r=Object.keys(s);for(let i=0;i<r.length;i+=1){const a=r[i].toLowerCase();if(t.indexOf(a)!==-1&&s[a])return n.concat(s)}}return n},[]),Zk=t=>console&&typeof console.warn=="function"&&console.warn(t),$o=(t,e,n)=>{const s={};return n.filter(r=>Array.isArray(r[t])?!0:(typeof r[t]<"u"&&Zk(`Helmet: ${t} should be of type "Array". Instead found type "${typeof r[t]}"`),!1)).map(r=>r[t]).reverse().reduce((r,i)=>{const o={};i.filter(l=>{let c;const h=Object.keys(l);for(let f=0;f<h.length;f+=1){const m=h[f],g=m.toLowerCase();e.indexOf(g)!==-1&&!(c==="rel"&&l[c].toLowerCase()==="canonical")&&!(g==="rel"&&l[g].toLowerCase()==="stylesheet")&&(c=g),e.indexOf(m)!==-1&&(m==="innerHTML"||m==="cssText"||m==="itemprop")&&(c=m)}if(!c||!l[c])return!1;const d=l[c].toLowerCase();return s[c]||(s[c]={}),o[c]||(o[c]={}),s[c][d]?!1:(o[c][d]=!0,!0)}).reverse().forEach(l=>r.push(l));const a=Object.keys(o);for(let l=0;l<a.length;l+=1){const c=a[l],h={...s[c],...o[c]};s[c]=h}return r},[]).reverse()},e1=(t,e)=>{if(Array.isArray(t)&&t.length){for(let n=0;n<t.length;n+=1)if(t[n][e])return!0}return!1},t1=t=>({baseTag:Jk(["href"],t),bodyAttributes:jd("bodyAttributes",t),defer:$i(t,Li.DEFER),encode:$i(t,Li.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:jd("htmlAttributes",t),linkTags:$o("link",["rel","href"],t),metaTags:$o("meta",["name","charset","http-equiv","property","itemprop"],t),noscriptTags:$o("noscript",["innerHTML"],t),onChangeClientState:Xk(t),scriptTags:$o("script",["src","innerHTML"],t),styleTags:$o("style",["cssText"],t),title:Qk(t),titleAttributes:jd("titleAttributes",t),prioritizeSeoTags:e1(t,Li.PRIORITIZE_SEO_TAGS)}),j0=t=>Array.isArray(t)?t.join(""):t,n1=(t,e)=>{const n=Object.keys(t);for(let s=0;s<n.length;s+=1)if(e[n[s]]&&e[n[s]].includes(t[n[s]]))return!0;return!1},Fd=(t,e)=>Array.isArray(t)?t.reduce((n,s)=>(n1(s,e)?n.priority.push(s):n.default.push(s),n),{priority:[],default:[]}):{default:t,priority:[]},Zy=(t,e)=>({...t,[e]:void 0}),s1=["noscript","script","style"],Rf=(t,e=!0)=>e===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),F0=t=>Object.keys(t).reduce((e,n)=>{const s=typeof t[n]<"u"?`${n}="${t[n]}"`:`${n}`;return e?`${e} ${s}`:s},""),r1=(t,e,n,s)=>{const r=F0(n),i=j0(e);return r?`<${t} ${Qn}="true" ${r}>${Rf(i,s)}</${t}>`:`<${t} ${Qn}="true">${Rf(i,s)}</${t}>`},i1=(t,e,n=!0)=>e.reduce((s,r)=>{const i=r,o=Object.keys(i).filter(c=>!(c==="innerHTML"||c==="cssText")).reduce((c,h)=>{const d=typeof i[h]>"u"?h:`${h}="${Rf(i[h],n)}"`;return c?`${c} ${d}`:d},""),a=i.innerHTML||i.cssText||"",l=s1.indexOf(t)===-1;return`${s}<${t} ${Qn}="true" ${o}${l?"/>":`>${a}</${t}>`}`},""),L0=(t,e={})=>Object.keys(t).reduce((n,s)=>{const r=em[s];return n[r||s]=t[s],n},e),o1=(t,e,n)=>{const s={key:e,[Qn]:!0},r=L0(n,s);return[rt.createElement("title",r,e)]},Ic=(t,e)=>e.map((n,s)=>{const r={key:s,[Qn]:!0};return Object.keys(n).forEach(i=>{const a=em[i]||i;if(a==="innerHTML"||a==="cssText"){const l=n.innerHTML||n.cssText;r.dangerouslySetInnerHTML={__html:l}}else r[a]=n[i]}),rt.createElement(t,r)}),jn=(t,e,n=!0)=>{switch(t){case"title":return{toComponent:()=>o1(t,e.title,e.titleAttributes),toString:()=>r1(t,e.title,e.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>L0(e),toString:()=>F0(e)};default:return{toComponent:()=>Ic(t,e),toString:()=>i1(t,e,n)}}},a1=({metaTags:t,linkTags:e,scriptTags:n,encode:s})=>{const r=Fd(t,Od.meta),i=Fd(e,Od.link),o=Fd(n,Od.script);return{priorityMethods:{toComponent:()=>[...Ic("meta",r.priority),...Ic("link",i.priority),...Ic("script",o.priority)],toString:()=>`${jn("meta",r.priority,s)} ${jn("link",i.priority,s)} ${jn("script",o.priority,s)}`},metaTags:r.default,linkTags:i.default,scriptTags:o.default}},l1=t=>{const{baseTag:e,bodyAttributes:n,encode:s=!0,htmlAttributes:r,noscriptTags:i,styleTags:o,title:a="",titleAttributes:l,prioritizeSeoTags:c}=t;let{linkTags:h,metaTags:d,scriptTags:f}=t,m={toComponent:()=>{},toString:()=>""};return c&&({priorityMethods:m,linkTags:h,metaTags:d,scriptTags:f}=a1(t)),{priority:m,base:jn("base",e,s),bodyAttributes:jn("bodyAttributes",n,s),htmlAttributes:jn("htmlAttributes",r,s),link:jn("link",h,s),meta:jn("meta",d,s),noscript:jn("noscript",i,s),script:jn("script",f,s),style:jn("style",o,s),title:jn("title",{title:a,titleAttributes:l},s)}},Nf=l1,Jl=[],$0=!!(typeof window<"u"&&window.document&&window.document.createElement),Pf=class{constructor(t,e){os(this,"instances",[]);os(this,"canUseDOM",$0);os(this,"context");os(this,"value",{setHelmet:t=>{this.context.helmet=t},helmetInstances:{get:()=>this.canUseDOM?Jl:this.instances,add:t=>{(this.canUseDOM?Jl:this.instances).push(t)},remove:t=>{const e=(this.canUseDOM?Jl:this.instances).indexOf(t);(this.canUseDOM?Jl:this.instances).splice(e,1)}}});this.context=t,this.canUseDOM=e||!1,e||(t.helmet=Nf({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},c1={},B0=rt.createContext(c1),Kr,U0=(Kr=class extends p.Component{constructor(n){super(n);os(this,"helmetData");this.helmetData=new Pf(this.props.context||{},Kr.canUseDOM)}render(){return rt.createElement(B0.Provider,{value:this.helmetData.value},this.props.children)}},os(Kr,"canUseDOM",$0),Kr),Ii=(t,e)=>{const n=document.head||document.querySelector("head"),s=n.querySelectorAll(`${t}[${Qn}]`),r=[].slice.call(s),i=[];let o;return e&&e.length&&e.forEach(a=>{const l=document.createElement(t);for(const c in a)if(Object.prototype.hasOwnProperty.call(a,c))if(c==="innerHTML")l.innerHTML=a.innerHTML;else if(c==="cssText")l.styleSheet?l.styleSheet.cssText=a.cssText:l.appendChild(document.createTextNode(a.cssText));else{const h=c,d=typeof a[h]>"u"?"":a[h];l.setAttribute(c,d)}l.setAttribute(Qn,"true"),r.some((c,h)=>(o=h,l.isEqualNode(c)))?r.splice(o,1):i.push(l)}),r.forEach(a=>{var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),i.forEach(a=>n.appendChild(a)),{oldTags:r,newTags:i}},Df=(t,e)=>{const n=document.getElementsByTagName(t)[0];if(!n)return;const s=n.getAttribute(Qn),r=s?s.split(","):[],i=[...r],o=Object.keys(e);for(const a of o){const l=e[a]||"";n.getAttribute(a)!==l&&n.setAttribute(a,l),r.indexOf(a)===-1&&r.push(a);const c=i.indexOf(a);c!==-1&&i.splice(c,1)}for(let a=i.length-1;a>=0;a-=1)n.removeAttribute(i[a]);r.length===i.length?n.removeAttribute(Qn):n.getAttribute(Qn)!==o.join(",")&&n.setAttribute(Qn,o.join(","))},u1=(t,e)=>{typeof t<"u"&&document.title!==t&&(document.title=j0(t)),Df("title",e)},ev=(t,e)=>{const{baseTag:n,bodyAttributes:s,htmlAttributes:r,linkTags:i,metaTags:o,noscriptTags:a,onChangeClientState:l,scriptTags:c,styleTags:h,title:d,titleAttributes:f}=t;Df("body",s),Df("html",r),u1(d,f);const m={baseTag:Ii("base",n),linkTags:Ii("link",i),metaTags:Ii("meta",o),noscriptTags:Ii("noscript",a),scriptTags:Ii("script",c),styleTags:Ii("style",h)},g={},y={};Object.keys(m).forEach(S=>{const{newTags:T,oldTags:w}=m[S];T.length&&(g[S]=T),w.length&&(y[S]=m[S].oldTags)}),e&&e(),l(t,g,y)},Bo=null,h1=t=>{Bo&&cancelAnimationFrame(Bo),t.defer?Bo=requestAnimationFrame(()=>{ev(t,()=>{Bo=null})}):(ev(t),Bo=null)},d1=h1,tv=class extends p.Component{constructor(){super(...arguments);os(this,"rendered",!1)}shouldComponentUpdate(e){return!Kk(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:n}=this.props.context;let s=null;const r=t1(e.get().map(i=>{const o={...i.props};return delete o.context,o}));U0.canUseDOM?d1(r):Nf&&(s=Nf(r)),n(s)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},wf,Qc=(wf=class extends p.Component{shouldComponentUpdate(t){return!Wk(Zy(this.props,"helmetData"),Zy(t,"helmetData"))}mapNestedChildrenToProps(t,e){if(!e)return null;switch(t.type){case"script":case"noscript":return{innerHTML:e};case"style":return{cssText:e};default:throw new Error(`<${t.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(t,e,n,s){return{...e,[t.type]:[...e[t.type]||[],{...n,...this.mapNestedChildrenToProps(t,s)}]}}mapObjectTypeChildren(t,e,n,s){switch(t.type){case"title":return{...e,[t.type]:s,titleAttributes:{...n}};case"body":return{...e,bodyAttributes:{...n}};case"html":return{...e,htmlAttributes:{...n}};default:return{...e,[t.type]:{...n}}}}mapArrayTypeChildrenToProps(t,e){let n={...e};return Object.keys(t).forEach(s=>{n={...n,[s]:t[s]}}),n}warnOnInvalidChildren(t,e){return Xy(Jy.some(n=>t.type===n),typeof t.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${Jy.join(", ")} are allowed. Helmet does not support rendering <${t.type}> elements. Refer to our API for more information.`),Xy(!e||typeof e=="string"||Array.isArray(e)&&!e.some(n=>typeof n!="string"),`Helmet expects a string as a child of <${t.type}>. Did you forget to wrap your children in braces? ( <${t.type}>{\`\`}</${t.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(t,e){let n={};return rt.Children.forEach(t,s=>{if(!s||!s.props)return;const{children:r,...i}=s.props,o=Object.keys(i).reduce((l,c)=>(l[Yk[c]||c]=i[c],l),{});let{type:a}=s;switch(typeof a=="symbol"?a=a.toString():this.warnOnInvalidChildren(s,r),a){case"Symbol(react.fragment)":e=this.mapChildrenToProps(r,e);break;case"link":case"meta":case"noscript":case"script":case"style":n=this.flattenArrayTypeChildren(s,n,o,r);break;default:e=this.mapObjectTypeChildren(s,e,o,r);break}}),this.mapArrayTypeChildrenToProps(n,e)}render(){const{children:t,...e}=this.props;let n={...e},{helmetData:s}=e;if(t&&(n=this.mapChildrenToProps(t,n)),s&&!(s instanceof Pf)){const r=s;s=new Pf(r.context,!0),delete n.helmetData}return s?rt.createElement(tv,{...n,context:s.value}):rt.createElement(B0.Consumer,null,r=>rt.createElement(tv,{...n,context:r}))}},os(wf,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),wf);const f1="modulepreload",p1=function(t){return"/better-wordle/"+t},nv={},Je=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0&&typeof window<"u"){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(n.map(l=>{if(l=p1(l),l in nv)return;nv[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":f1,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((f,m)=>{d.addEventListener("load",f),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},bt=5,m1=["QWERTYUIOP".split(""),"ASDFGHJKL".split(""),["BACK",..."ZXCVBNM".split(""),"ENTER"]],Mf=190;function oa(t){const e=[{boards:1,turns:6},{boards:8,turns:12},{boards:16,turns:21},{boards:32,turns:37}];if(t<=1)return 6;for(let s=0;s<e.length-1;s++){const r=e[s],i=e[s+1];if(t===i.boards)return i.turns;if(t>r.boards&&t<i.boards){const o=r.turns+(t-r.boards);return Math.min(o,i.turns-1)}}const n=e[e.length-1];return n.turns+(t-n.boards)}function Xu(t,e){const n=Array(bt).fill("grey"),s=typeof t=="string"?t:"",i=(typeof e=="string"?e:"").split(""),o=s.split(""),a=Array(bt).fill(!1);for(let l=0;l<bt;l++)o[l]===i[l]&&(n[l]="green",a[l]=!0);for(let l=0;l<bt;l++){if(n[l]==="green")continue;const c=o[l];let h=-1;for(let d=0;d<bt;d++)if(!a[d]&&i[d]===c){h=d;break}h!==-1&&(n[l]="yellow",a[h]=!0)}return n}function g1(t){return{solution:t,guesses:[],isSolved:!1,isDead:!1,lastRevealId:null}}const sv={none:0,grey:1,yellow:2,green:3};function y1(t,e){const n=sv[t||"none"]??0;return(sv[e||"none"]??0)>n?e:t}function v1(t){return t==="green"?"#50a339":t==="yellow"?"#B1A04C":"#3A3A3C"}function w1(t){return t==="green"?"#50a339":t==="yellow"?"#B1A04C":t==="grey"?"#3A3A3C":"#212121"}function _1(t){const e={};if(!Array.isArray(t))return e;for(const n of t){if(!n||typeof n.word!="string"||!Array.isArray(n.colors))continue;const s=n.word.split("");for(let r=0;r<s.length&&r<n.colors.length;r++){const i=s[r],o=n.colors[r];e[i]=y1(e[i],o)}}return e}function S1(t){const e=Array(bt).fill("");if(!Array.isArray(t))return e;for(const n of t){if(!n||typeof n.word!="string"||!Array.isArray(n.colors))continue;const s=n.word.split("");for(let r=0;r<bt;r++)n.colors[r]==="green"&&(e[r]=s[r])}return e}function aa(t){if(!Array.isArray(t)||t.length===0)return 0;let e=0;for(const n of t){if(!n||!Array.isArray(n.guesses))continue;const s=n.guesses.length||0;s>e&&(e=s)}return e}function Xs(t){const e=typeof t=="number"&&Number.isFinite(t)?t:0,n=Math.max(0,Math.floor(e)),s=Math.floor(n/6e4),r=Math.floor(n%6e4/1e3),i=Math.floor(n%1e3/100),o=String(s).padStart(2,"0"),a=String(r).padStart(2,"0");return`${o}:${a}.${i}`}function x1(t){return!Array.isArray(t)||t.length===0?0:t.reduce((e,n)=>e+(typeof(n==null?void 0:n.ms)=="number"&&Number.isFinite(n.ms)?n.ms:0),0)}const Ia=32,z0=6,$r=2,kc=8,b1=100,ei=3e3,Qs=5e3,V0=1e4,rv=8e3,C1=3e3,E1=500,W0=300,la=E1+(bt-1)*W0;function iv(t){if(!t)return[];const e=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(",");return Array.from(t.querySelectorAll(e))}function vs({isOpen:t,titleId:e,onRequestClose:n,children:s,zIndex:r=2e3,disableAutoFocus:i=!1,panelClassName:o=""}){const a=p.useRef(null),l=p.useRef(null);return p.useEffect(()=>{if(!t)return;l.current=document.activeElement;const c=document.body.style.overflow;document.body.style.overflow="hidden";const h=()=>{var y;if(i)return;const m=document.activeElement;if(m&&a.current&&a.current.contains(m))return;const g=iv(a.current);g.length>0?g[0].focus():(y=a.current)==null||y.focus()},d=window.setTimeout(h,0),f=m=>{if(m.key==="Escape"){m.preventDefault(),n==null||n();return}if(m.key!=="Tab")return;const g=iv(a.current);if(g.length===0){m.preventDefault();return}const y=g[0],S=g[g.length-1],T=document.activeElement;m.shiftKey?(T===y||!a.current.contains(T))&&(m.preventDefault(),S.focus()):T===S&&(m.preventDefault(),y.focus())};return document.addEventListener("keydown",f,!0),()=>{window.clearTimeout(d),document.body.style.overflow=c,document.removeEventListener("keydown",f,!0),l.current&&typeof l.current.focus=="function"&&l.current.focus()}},[t]),t?u.jsx("div",{className:"modalOverlay",style:{zIndex:r},onMouseDown:n,children:u.jsx("div",{className:`modalPanel ${o}`.trim(),role:"dialog","aria-modal":"true","aria-labelledby":e,ref:a,tabIndex:-1,onMouseDown:c=>c.stopPropagation(),children:s})}):null}var ov={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H0={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H=function(t,e){if(!t)throw mo(e)},mo=function(t){return new Error("Firebase Database ("+H0.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},T1=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},tm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<t.length;r+=3){const i=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,c=l?t[r+2]:0,h=i>>2,d=(i&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),s.push(n[h],n[d],n[f],n[m])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(G0(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):T1(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<t.length;){const i=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const c=r<t.length?n[t.charAt(r)]:64;++r;const d=r<t.length?n[t.charAt(r)]:64;if(++r,i==null||a==null||c==null||d==null)throw new I1;const f=i<<2|a>>4;if(s.push(f),c!==64){const m=a<<4&240|c>>2;if(s.push(m),d!==64){const g=c<<6&192|d;s.push(g)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class I1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const q0=function(t){const e=G0(t);return tm.encodeByteArray(e,!0)},Xc=function(t){return q0(t).replace(/\./g,"")},Jc=function(t){try{return tm.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k1(t){return K0(void 0,t)}function K0(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!A1(n)||(t[n]=K0(t[n],e[n]));return t}function A1(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N1=()=>R1().__FIREBASE_DEFAULTS__,P1=()=>{if(typeof process>"u"||typeof ov>"u")return;const t=ov.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},D1=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Jc(t[1]);return e&&JSON.parse(e)},nm=()=>{try{return N1()||P1()||D1()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Y0=t=>{var e,n;return(n=(e=nm())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},sm=t=>{const e=Y0(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},Q0=()=>{var t;return(t=nm())===null||t===void 0?void 0:t.config},X0=t=>{var e;return(e=nm())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J0(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Xc(JSON.stringify(n)),Xc(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ln())}function M1(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Z0(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function O1(){const t=ln();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function j1(){return H0.NODE_ADMIN===!0}function F1(){try{return typeof indexedDB=="object"}catch{return!1}}function L1(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1="FirebaseError";class xs extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=$1,Object.setPrototypeOf(this,xs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,nl.prototype.create)}}class nl{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?B1(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new xs(r,a,s)}}function B1(t,e){return t.replace(U1,(n,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const U1=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(t){return JSON.parse(t)}function Dt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS=function(t){let e={},n={},s={},r="";try{const i=t.split(".");e=ka(Jc(i[0])||""),n=ka(Jc(i[1])||""),r=i[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:r}},z1=function(t){const e=eS(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},V1=function(t){const e=eS(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ti(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Zc(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function eu(t,e,n){const s={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=e.call(n,t[r],r,t));return s}function tu(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const i=t[r],o=e[r];if(av(i)&&av(o)){if(!tu(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function av(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function go(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Xo(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function Jo(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)s[d]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let d=0;d<16;d++)s[d]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let d=16;d<80;d++){const f=s[d-3]^s[d-8]^s[d-14]^s[d-16];s[d]=(f<<1|f>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let d=0;d<80;d++){d<40?d<20?(c=a^i&(o^a),h=1518500249):(c=i^o^a,h=1859775393):d<60?(c=i&o|a&(i|o),h=2400959708):(c=i^o^a,h=3395469782);const f=(r<<5|r>>>27)+c+l+h+s[d]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=r,r=f}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<n;){if(o===0)for(;r<=s;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<n;)if(i[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<n;)if(i[o]=e[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let r=0;r<5;r++)for(let i=24;i>=0;i-=8)e[s]=this.chain_[r]>>i&255,++s;return e}}function H1(t,e){const n=new G1(t,e);return n.subscribe.bind(n)}class G1{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let r;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");q1(e,["next","error","complete"])?r=e:r={next:e,error:n,complete:s},r.next===void 0&&(r.next=Ld),r.error===void 0&&(r.error=Ld),r.complete===void 0&&(r.complete=Ld);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function q1(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ld(){}function ni(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K1=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);if(r>=55296&&r<=56319){const i=r-55296;s++,H(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;r=65536+(i<<10)+o}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},Ju=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(t){return t&&t._delegate?t._delegate:t}class js{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new Nn;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(X1(e))try{this.getOrInitializeService({instanceIdentifier:Mr})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=Mr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mr){return this.instances.has(e)}getOptions(e=Mr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,n){var s;const r=this.normalizeInstanceIdentifier(n),i=(s=this.onInitCallbacks.get(r))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const r of s)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Q1(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Mr){return this.component?this.component.multipleInstances?e:Mr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Q1(t){return t===Mr?void 0:t}function X1(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Y1(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ke||(Ke={}));const Z1={debug:Ke.DEBUG,verbose:Ke.VERBOSE,info:Ke.INFO,warn:Ke.WARN,error:Ke.ERROR,silent:Ke.SILENT},eA=Ke.INFO,tA={[Ke.DEBUG]:"log",[Ke.VERBOSE]:"log",[Ke.INFO]:"info",[Ke.WARN]:"warn",[Ke.ERROR]:"error"},nA=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),r=tA[e];if(r)console[r](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zu{constructor(e){this.name=e,this._logLevel=eA,this._logHandler=nA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ke))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Z1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ke.DEBUG,...e),this._logHandler(this,Ke.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ke.VERBOSE,...e),this._logHandler(this,Ke.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ke.INFO,...e),this._logHandler(this,Ke.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ke.WARN,...e),this._logHandler(this,Ke.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ke.ERROR,...e),this._logHandler(this,Ke.ERROR,...e)}}const sA=(t,e)=>e.some(n=>t instanceof n);let lv,cv;function rA(){return lv||(lv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function iA(){return cv||(cv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tS=new WeakMap,Of=new WeakMap,nS=new WeakMap,$d=new WeakMap,im=new WeakMap;function oA(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(ar(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&tS.set(n,t)}).catch(()=>{}),im.set(e,t),e}function aA(t){if(Of.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Of.set(t,e)}let jf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Of.get(t);if(e==="objectStoreNames")return t.objectStoreNames||nS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ar(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function lA(t){jf=t(jf)}function cA(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(Bd(this),e,...n);return nS.set(s,e.sort?e.sort():[e]),ar(s)}:iA().includes(t)?function(...e){return t.apply(Bd(this),e),ar(tS.get(this))}:function(...e){return ar(t.apply(Bd(this),e))}}function uA(t){return typeof t=="function"?cA(t):(t instanceof IDBTransaction&&aA(t),sA(t,rA())?new Proxy(t,jf):t)}function ar(t){if(t instanceof IDBRequest)return oA(t);if($d.has(t))return $d.get(t);const e=uA(t);return e!==t&&($d.set(t,e),im.set(e,t)),e}const Bd=t=>im.get(t);function hA(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=ar(o);return s&&o.addEventListener("upgradeneeded",l=>{s(ar(o.result),l.oldVersion,l.newVersion,ar(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const dA=["get","getKey","getAll","getAllKeys","count"],fA=["put","add","delete","clear"],Ud=new Map;function uv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ud.get(e))return Ud.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=fA.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||dA.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return Ud.set(e,i),i}lA(t=>({...t,get:(e,n,s)=>uv(e,n)||t.get(e,n,s),has:(e,n)=>!!uv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(mA(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function mA(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ff="@firebase/app",hv="0.9.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si=new Zu("@firebase/app"),gA="@firebase/app-compat",yA="@firebase/analytics-compat",vA="@firebase/analytics",wA="@firebase/app-check-compat",_A="@firebase/app-check",SA="@firebase/auth",xA="@firebase/auth-compat",bA="@firebase/database",CA="@firebase/database-compat",EA="@firebase/functions",TA="@firebase/functions-compat",IA="@firebase/installations",kA="@firebase/installations-compat",AA="@firebase/messaging",RA="@firebase/messaging-compat",NA="@firebase/performance",PA="@firebase/performance-compat",DA="@firebase/remote-config",MA="@firebase/remote-config-compat",OA="@firebase/storage",jA="@firebase/storage-compat",FA="@firebase/firestore",LA="@firebase/firestore-compat",$A="firebase",BA="9.23.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="[DEFAULT]",UA={[Ff]:"fire-core",[gA]:"fire-core-compat",[vA]:"fire-analytics",[yA]:"fire-analytics-compat",[_A]:"fire-app-check",[wA]:"fire-app-check-compat",[SA]:"fire-auth",[xA]:"fire-auth-compat",[bA]:"fire-rtdb",[CA]:"fire-rtdb-compat",[EA]:"fire-fn",[TA]:"fire-fn-compat",[IA]:"fire-iid",[kA]:"fire-iid-compat",[AA]:"fire-fcm",[RA]:"fire-fcm-compat",[NA]:"fire-perf",[PA]:"fire-perf-compat",[DA]:"fire-rc",[MA]:"fire-rc-compat",[OA]:"fire-gcs",[jA]:"fire-gcs-compat",[FA]:"fire-fst",[LA]:"fire-fst-compat","fire-js":"fire-js",[$A]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nu=new Map,$f=new Map;function zA(t,e){try{t.container.addComponent(e)}catch(n){si.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function dr(t){const e=t.name;if($f.has(e))return si.debug(`There were multiple attempts to register component ${e}.`),!1;$f.set(e,t);for(const n of nu.values())zA(n,t);return!0}function sl(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},lr=new nl("app","Firebase",VA);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new js("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi=BA;function sS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Lf,automaticDataCollectionEnabled:!1},e),r=s.name;if(typeof r!="string"||!r)throw lr.create("bad-app-name",{appName:String(r)});if(n||(n=Q0()),!n)throw lr.create("no-options");const i=nu.get(r);if(i){if(tu(n,i.options)&&tu(s,i.config))return i;throw lr.create("duplicate-app",{appName:r})}const o=new J1(r);for(const l of $f.values())o.addComponent(l);const a=new WA(n,s,o);return nu.set(r,a),a}function rl(t=Lf){const e=nu.get(t);if(!e&&t===Lf&&Q0())return sS();if(!e)throw lr.create("no-app",{appName:t});return e}function Vn(t,e,n){var s;let r=(s=UA[t])!==null&&s!==void 0?s:t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),si.warn(a.join(" "));return}dr(new js(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HA="firebase-heartbeat-database",GA=1,Aa="firebase-heartbeat-store";let zd=null;function rS(){return zd||(zd=hA(HA,GA,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Aa)}}}).catch(t=>{throw lr.create("idb-open",{originalErrorMessage:t.message})})),zd}async function qA(t){try{return await(await rS()).transaction(Aa).objectStore(Aa).get(iS(t))}catch(e){if(e instanceof xs)si.warn(e.message);else{const n=lr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});si.warn(n.message)}}}async function dv(t,e){try{const s=(await rS()).transaction(Aa,"readwrite");await s.objectStore(Aa).put(e,iS(t)),await s.done}catch(n){if(n instanceof xs)si.warn(n.message);else{const s=lr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});si.warn(s.message)}}}function iS(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KA=1024,YA=30*24*60*60*1e3;class QA{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new JA(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=fv();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const i=new Date(r.date).valueOf();return Date.now()-i<=YA}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=fv(),{heartbeatsToSend:n,unsentEntries:s}=XA(this._heartbeatsCache.heartbeats),r=Xc(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function fv(){return new Date().toISOString().substring(0,10)}function XA(t,e=KA){const n=[];let s=t.slice();for(const r of t){const i=n.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),pv(n)>e){i.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),pv(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class JA{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return F1()?L1().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await qA(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return dv(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const r=await this.read();return dv(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function pv(t){return Xc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZA(t){dr(new js("platform-logger",e=>new pA(e),"PRIVATE")),dr(new js("heartbeat",e=>new QA(e),"PRIVATE")),Vn(Ff,hv,t),Vn(Ff,hv,"esm2017"),Vn("fire-js","")}ZA("");function om(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function oS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const eR=oS,aS=new nl("auth","Firebase",oS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=new Zu("@firebase/auth");function tR(t,...e){su.logLevel<=Ke.WARN&&su.warn(`Auth (${fi}): ${t}`,...e)}function Ac(t,...e){su.logLevel<=Ke.ERROR&&su.error(`Auth (${fi}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hn(t,...e){throw am(t,...e)}function fs(t,...e){return am(t,...e)}function lS(t,e,n){const s=Object.assign(Object.assign({},eR()),{[e]:n});return new nl("auth","Firebase",s).create(e,{appName:t.name})}function cS(t,e,n){const s=n;if(!(e instanceof s))throw s.name!==e.constructor.name&&Hn(t,"argument-error"),lS(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function am(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return aS.create(t,...e)}function Ie(t,e,...n){if(!t)throw am(e,...n)}function As(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Ac(e),new Error(e)}function Fs(t,e){t||As(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function uS(){return mv()==="http:"||mv()==="https:"}function mv(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uS()||M1()||"connection"in navigator)?navigator.onLine:!0}function sR(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(e,n){this.shortDelay=e,this.longDelay=n,Fs(n>e,"Short delay should be less than long delay!"),this.isMobile=rm()||Z0()}get(){return nR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lm(t,e){Fs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;As("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;As("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;As("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=new il(3e4,6e4);function Cr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Ws(t,e,n,s,r={}){return dS(t,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=go(Object.assign({key:t.config.apiKey},o)).slice(1),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode),hS.fetch()(fS(t,t.config.apiHost,n,a),Object.assign({method:e,headers:l,referrerPolicy:"no-referrer"},i))})}async function dS(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},rR),e);try{const r=new oR(t),i=await Promise.race([n(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Zl(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Zl(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Zl(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Zl(t,"user-disabled",o);const h=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw lS(t,h,c);Hn(t,h)}}catch(r){if(r instanceof xs)throw r;Hn(t,"network-request-failed",{message:String(r)})}}async function ol(t,e,n,s,r={}){const i=await Ws(t,e,n,s,r);return"mfaPendingCredential"in i&&Hn(t,"multi-factor-auth-required",{_serverResponse:i}),i}function fS(t,e,n,s){const r=`${e}${n}?${s}`;return t.config.emulator?lm(t.config,r):`${t.config.apiScheme}://${r}`}class oR{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(fs(this.auth,"network-request-failed")),iR.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Zl(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=fs(t,e,s);return r.customData._tokenResponse=n,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aR(t,e){return Ws(t,"POST","/v1/accounts:delete",e)}async function lR(t,e){return Ws(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cR(t,e=!1){const n=Ue(t),s=await n.getIdToken(e),r=cm(s);Ie(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:ca(Vd(r.auth_time)),issuedAtTime:ca(Vd(r.iat)),expirationTime:ca(Vd(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Vd(t){return Number(t)*1e3}function cm(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return Ac("JWT malformed, contained fewer than 3 sections"),null;try{const r=Jc(n);return r?JSON.parse(r):(Ac("Failed to decode base64 JWT payload"),null)}catch(r){return Ac("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function uR(t){const e=cm(t);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qi(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof xs&&hR(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function hR({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const r=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ca(this.lastLoginAt),this.creationTime=ca(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ra(t){var e;const n=t.auth,s=await t.getIdToken(),r=await Qi(t,lR(n,{idToken:s}));Ie(r==null?void 0:r.users.length,n,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?mR(i.providerUserInfo):[],a=pR(t.providerData,o),l=t.isAnonymous,c=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new pS(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(t,d)}async function fR(t){const e=Ue(t);await Ra(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function pR(t,e){return[...t.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function mR(t){return t.map(e=>{var{providerId:n}=e,s=om(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gR(t,e){const n=await dS(t,{},async()=>{const s=go({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=fS(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",hS.fetch()(o,{method:"POST",headers:a,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):uR(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,n=!1){return Ie(!this.accessToken||this.refreshToken,e,"user-token-expired"),!n&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:r,expiresIn:i}=await gR(e,n);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:r,expirationTime:i}=n,o=new Na;return s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(Ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Na,this.toJSON())}_performRefresh(){return As("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qs(t,e){Ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Yr{constructor(e){var{uid:n,auth:s,stsTokenManager:r}=e,i=om(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new dR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new pS(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Qi(this,this.stsTokenManager.getToken(this.auth,e));return Ie(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return cR(this,e)}reload(){return fR(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Yr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Ra(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Qi(this,aR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,r,i,o,a,l,c,h;const d=(s=n.displayName)!==null&&s!==void 0?s:void 0,f=(r=n.email)!==null&&r!==void 0?r:void 0,m=(i=n.phoneNumber)!==null&&i!==void 0?i:void 0,g=(o=n.photoURL)!==null&&o!==void 0?o:void 0,y=(a=n.tenantId)!==null&&a!==void 0?a:void 0,S=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,T=(c=n.createdAt)!==null&&c!==void 0?c:void 0,w=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:b,emailVerified:_,isAnonymous:k,providerData:O,stsTokenManager:q}=n;Ie(b&&q,e,"internal-error");const I=Na.fromJSON(this.name,q);Ie(typeof b=="string",e,"internal-error"),qs(d,e.name),qs(f,e.name),Ie(typeof _=="boolean",e,"internal-error"),Ie(typeof k=="boolean",e,"internal-error"),qs(m,e.name),qs(g,e.name),qs(y,e.name),qs(S,e.name),qs(T,e.name),qs(w,e.name);const N=new Yr({uid:b,auth:e,email:f,emailVerified:_,displayName:d,isAnonymous:k,photoURL:g,phoneNumber:m,tenantId:y,stsTokenManager:I,createdAt:T,lastLoginAt:w});return O&&Array.isArray(O)&&(N.providerData=O.map(M=>Object.assign({},M))),S&&(N._redirectEventId=S),N}static async _fromIdTokenResponse(e,n,s=!1){const r=new Na;r.updateFromServerResponse(n);const i=new Yr({uid:n.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await Ra(i),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=new Map;function Rs(t){Fs(t instanceof Function,"Expected a class definition");let e=gv.get(t);return e?(Fs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,gv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}mS.type="NONE";const yv=mS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(t,e,n){return`firebase:${t}:${e}:${n}`}class Bi{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=Rc(this.userKey,r.apiKey,i),this.fullPersistenceKey=Rc("persistence",r.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Bi(Rs(yv),e,s);const r=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=r[0]||Rs(yv);const o=Rc(s,e.config.apiKey,e.name);let a=null;for(const c of n)try{const h=await c._get(o);if(h){const d=Yr._fromJSON(e,h);c!==i&&(a=d),i=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Bi(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Bi(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(vS(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(gS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_S(e))return"Blackberry";if(SS(e))return"Webos";if(um(e))return"Safari";if((e.includes("chrome/")||yS(e))&&!e.includes("edge/"))return"Chrome";if(wS(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function gS(t=ln()){return/firefox\//i.test(t)}function um(t=ln()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function yS(t=ln()){return/crios\//i.test(t)}function vS(t=ln()){return/iemobile/i.test(t)}function wS(t=ln()){return/android/i.test(t)}function _S(t=ln()){return/blackberry/i.test(t)}function SS(t=ln()){return/webos/i.test(t)}function eh(t=ln()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function yR(t=ln()){var e;return eh(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function vR(){return O1()&&document.documentMode===10}function xS(t=ln()){return eh(t)||wS(t)||SS(t)||_S(t)||/windows phone/i.test(t)||vS(t)}function wR(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bS(t,e=[]){let n;switch(t){case"Browser":n=vv(ln());break;case"Worker":n=`${vv(ln())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${fi}/${s}`}async function CS(t,e){return Ws(t,"GET","/v2/recaptchaConfig",Cr(t,e))}function wv(t){return t!==void 0&&t.enterprise!==void 0}class ES{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(n=>n.provider==="EMAIL_PASSWORD_PROVIDER"&&n.enforcementState!=="OFF")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function TS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=r=>{const i=fs("internal-error");i.customData=r,n(i)},s.type="text/javascript",s.charset="UTF-8",_R().appendChild(s)})}function SR(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const xR="https://www.google.com/recaptcha/enterprise.js?render=",bR="recaptcha-enterprise",CR="NO_RECAPTCHA";class IS{constructor(e){this.type=bR,this.auth=Hs(e)}async verify(e="verify",n=!1){async function s(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{CS(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new ES(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;wv(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(CR)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{s(this.auth).then(a=>{if(!n&&wv(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}TS(xR+a).then(()=>{r(a,i,o)}).catch(l=>{o(l)})}}).catch(a=>{o(a)})})}}async function Xi(t,e,n,s=!1){const r=new IS(t);let i;try{i=await r.verify(n)}catch{i=await r.verify(n,!0)}const o=Object.assign({},e);return s?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=n,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const r of n)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e,n,s,r){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _v(this),this.idTokenSubscription=new _v(this),this.beforeStateQueue=new ER(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=aS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Rs(n)),this._initializationPromise=this.queue(async()=>{var s,r;if(!this._deleted&&(this.persistenceManager=await Bi.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var n;const s=await this.assertedPersistence.getCurrentUser();let r=s,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ra(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=sR()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const n=e?Ue(e):null;return n&&Ie(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Rs(e))})}async initializeRecaptchaConfig(){const e=await CS(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new ES(e);this.tenantId==null?this._agentRecaptchaConfig=n:this._tenantRecaptchaConfigs[this.tenantId]=n,n.emailPasswordEnabled&&new IS(this).verify()}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new nl("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Rs(e)||this._popupRedirectResolver;Ie(n,this,"argument-error"),this.redirectPersistenceManager=await Bi.create(this,[Rs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,r){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n),o=this._isInitialized?Promise.resolve():this._initializationPromise;return Ie(o,this,"internal-error"),o.then(()=>i(this.currentUser)),typeof n=="function"?e.addObserver(n,s,r):e.addObserver(n)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=bS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const r=await this._getAppCheckToken();return r&&(n["X-Firebase-AppCheck"]=r),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&tR(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Hs(t){return Ue(t)}class _v{constructor(e){this.auth=e,this.observer=null,this.addObserver=H1(n=>this.observer=n)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(t,e){const n=sl(t,"auth");if(n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(tu(i,e??{}))return r;Hn(r,"already-initialized")}return n.initialize({options:e})}function kR(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Rs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function AR(t,e,n){const s=Hs(t);Ie(s._canInitEmulator,s,"emulator-config-failed"),Ie(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!1,i=kS(e),{host:o,port:a}=RR(e),l=a===null?"":`:${a}`;s.config.emulator={url:`${i}//${o}${l}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})}),NR()}function kS(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function RR(t){const e=kS(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:Sv(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:Sv(o)}}}function Sv(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function NR(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return As("not implemented")}_getIdTokenResponse(e){return As("not implemented")}_linkToIdToken(e,n){return As("not implemented")}_getReauthenticationResolver(e){return As("not implemented")}}async function PR(t,e){return Ws(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wd(t,e){return ol(t,"POST","/v1/accounts:signInWithPassword",Cr(t,e))}async function AS(t,e){return Ws(t,"POST","/v1/accounts:sendOobCode",Cr(t,e))}async function DR(t,e){return AS(t,e)}async function Hd(t,e){return AS(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MR(t,e){return ol(t,"POST","/v1/accounts:signInWithEmailLink",Cr(t,e))}async function OR(t,e){return ol(t,"POST","/v1/accounts:signInWithEmailLink",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa extends hm{constructor(e,n,s,r=null){super("password",s),this._email=e,this._password=n,this._tenantId=r}static _fromEmailAndPassword(e,n){return new Pa(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Pa(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){var n;switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((n=e._getRecaptchaConfig())===null||n===void 0)&&n.emailPasswordEnabled){const r=await Xi(e,s,"signInWithPassword");return Wd(e,r)}else return Wd(e,s).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const i=await Xi(e,s,"signInWithPassword");return Wd(e,i)}else return Promise.reject(r)});case"emailLink":return MR(e,{email:this._email,oobCode:this._password});default:Hn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":return PR(e,{idToken:n,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return OR(e,{idToken:n,email:this._email,oobCode:this._password});default:Hn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ui(t,e){return ol(t,"POST","/v1/accounts:signInWithIdp",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR="http://localhost";class ri extends hm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ri(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Hn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r}=n,i=om(n,["providerId","signInMethod"]);if(!s||!r)return null;const o=new ri(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ui(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,Ui(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ui(e,n)}buildRequest(){const e={requestUri:jR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=go(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FR(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function LR(t){const e=Xo(Jo(t)).link,n=e?Xo(Jo(e)).deep_link_id:null,s=Xo(Jo(t)).deep_link_id;return(s?Xo(Jo(s)).link:null)||s||n||e||t}class dm{constructor(e){var n,s,r,i,o,a;const l=Xo(Jo(e)),c=(n=l.apiKey)!==null&&n!==void 0?n:null,h=(s=l.oobCode)!==null&&s!==void 0?s:null,d=FR((r=l.mode)!==null&&r!==void 0?r:null);Ie(c&&h&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const n=LR(e);try{return new dm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(){this.providerId=yo.PROVIDER_ID}static credential(e,n){return Pa._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=dm.parseLink(n);return Ie(s,"argument-error"),Pa._fromEmailAndCode(e,s.code,s.tenantId)}}yo.PROVIDER_ID="password";yo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";yo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al extends th{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js extends al{constructor(){super("facebook.com")}static credential(e){return ri._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Js.credentialFromTaggedObject(e)}static credentialFromError(e){return Js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Js.credential(e.oauthAccessToken)}catch{return null}}}Js.FACEBOOK_SIGN_IN_METHOD="facebook.com";Js.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends al{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ri._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return ks.credential(n,s)}catch{return null}}}ks.GOOGLE_SIGN_IN_METHOD="google.com";ks.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs extends al{constructor(){super("github.com")}static credential(e){return ri._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zs.credential(e.oauthAccessToken)}catch{return null}}}Zs.GITHUB_SIGN_IN_METHOD="github.com";Zs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er extends al{constructor(){super("twitter.com")}static credential(e,n){return ri._fromParams({providerId:er.PROVIDER_ID,signInMethod:er.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return er.credentialFromTaggedObject(e)}static credentialFromError(e){return er.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return er.credential(n,s)}catch{return null}}}er.TWITTER_SIGN_IN_METHOD="twitter.com";er.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gd(t,e){return ol(t,"POST","/v1/accounts:signUp",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,r=!1){const i=await Yr._fromIdTokenResponse(e,s,r),o=xv(s);return new ii({user:i,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const r=xv(s);return new ii({user:e,providerId:r,_tokenResponse:s,operationType:n})}}function xv(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu extends xs{constructor(e,n,s,r){var i;super(n.code,n.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,iu.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,r){return new iu(e,n,s,r)}}function RS(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?iu._fromErrorAndOperation(t,i,e,s):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $R(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function BR(t,e,n=!1){const s=await Qi(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ii._forOperation(t,"link",s)}async function UR(t,e,n){await Ra(e);const s=$R(e.providerData);Ie(s.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zR(t,e,n=!1){const{auth:s}=t,r="reauthenticate";try{const i=await Qi(t,RS(s,r,e,t),n);Ie(i.idToken,s,"internal-error");const o=cm(i.idToken);Ie(o,s,"internal-error");const{sub:a}=o;return Ie(t.uid===a,s,"user-mismatch"),ii._forOperation(t,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Hn(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NS(t,e,n=!1){const s="signIn",r=await RS(t,s,e),i=await ii._fromIdTokenResponse(t,s,r);return n||await t._updateCurrentUser(i.user),i}async function VR(t,e){return NS(Hs(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WR(t,e,n){var s;const r=Hs(t),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};if(!((s=r._getRecaptchaConfig())===null||s===void 0)&&s.emailPasswordEnabled){const o=await Xi(r,i,"getOobCode",!0);await Hd(r,o)}else await Hd(r,i).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const a=await Xi(r,i,"getOobCode",!0);await Hd(r,a)}else return Promise.reject(o)})}async function HR(t,e,n){var s;const r=Hs(t),i={returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(!((s=r._getRecaptchaConfig())===null||s===void 0)&&s.emailPasswordEnabled){const c=await Xi(r,i,"signUpPassword");o=Gd(r,c)}else o=Gd(r,i).catch(async c=>{if(c.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const h=await Xi(r,i,"signUpPassword");return Gd(r,h)}else return Promise.reject(c)});const a=await o.catch(c=>Promise.reject(c)),l=await ii._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function GR(t,e,n){return VR(Ue(t),yo.credential(e,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qR(t,e){return Ws(t,"POST","/v1/accounts:createAuthUri",Cr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KR(t,e){const n=uS()?ru():"http://localhost",s={identifier:e,continueUri:n},{signinMethods:r}=await qR(Ue(t),s);return r||[]}async function bv(t,e){const n=Ue(t),r={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()},{email:i}=await DR(n.auth,r);i!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YR(t,e){return Ws(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cv(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const s=Ue(t),i={idToken:await s.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Qi(s,YR(s.auth,i));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function QR(t,e,n,s){return Ue(t).onIdTokenChanged(e,n,s)}function XR(t,e,n){return Ue(t).beforeAuthStateChanged(e,n)}function JR(t,e,n,s){return Ue(t).onAuthStateChanged(e,n,s)}function ZR(t){return Ue(t).signOut()}async function eN(t){return Ue(t).delete()}const ou="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ou,"1"),this.storage.removeItem(ou),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tN(){const t=ln();return um(t)||eh(t)}const nN=1e3,sN=10;class DS extends PS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=tN()&&wR(),this.fallbackToPolling=xS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),r=this.localCache[n];s!==r&&e(n,r,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(s);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!n)return}const r=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);vR()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,sN):r()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},nN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}DS.type="LOCAL";const rN=DS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS extends PS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}MS.type="SESSION";const OS=MS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iN(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(r=>r.isListeningto(e));if(n)return n;const s=new nh(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:r,data:i}=n.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async c=>c(n.origin,i)),l=await iN(a);n.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sh(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=sh("",20);r.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(d){const f=d;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(){return window}function aN(t){ps().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(){return typeof ps().WorkerGlobalScope<"u"&&typeof ps().importScripts=="function"}async function lN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function cN(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function uN(){return jS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FS="firebaseLocalStorageDb",hN=1,au="firebaseLocalStorage",LS="fbase_key";class ll{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function rh(t,e){return t.transaction([au],e?"readwrite":"readonly").objectStore(au)}function dN(){const t=indexedDB.deleteDatabase(FS);return new ll(t).toPromise()}function Bf(){const t=indexedDB.open(FS,hN);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(au,{keyPath:LS})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(au)?e(s):(s.close(),await dN(),e(await Bf()))})})}async function Ev(t,e,n){const s=rh(t,!0).put({[LS]:e,value:n});return new ll(s).toPromise()}async function fN(t,e){const n=rh(t,!1).get(e),s=await new ll(n).toPromise();return s===void 0?null:s.value}function Tv(t,e){const n=rh(t,!0).delete(e);return new ll(n).toPromise()}const pN=800,mN=3;class $S{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Bf(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>mN)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nh._getInstance(uN()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await lN(),!this.activeServiceWorker)return;this.sender=new oN(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||cN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bf();return await Ev(e,ou,"1"),await Tv(e,ou),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>Ev(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>fN(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Tv(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=rh(r,!1).getAll();return new ll(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),n.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),n.push(r));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),pN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$S.type="LOCAL";const gN=$S;new il(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(t,e){return e?Rs(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm extends hm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ui(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ui(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ui(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function yN(t){return NS(t.auth,new pm(t),t.bypassAuthState)}function vN(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),zR(n,new pm(t),t.bypassAuthState)}async function wN(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),BR(n,new pm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,n,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return yN;case"linkViaPopup":case"linkViaRedirect":return wN;case"reauthViaPopup":case"reauthViaRedirect":return vN;default:Hn(this.auth,"internal-error")}}resolve(e){Fs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Fs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N=new il(2e3,1e4);async function SN(t,e,n){const s=Hs(t);cS(t,e,th);const r=fm(s,n);return new Vr(s,"signInViaPopup",e,r).executeNotNull()}class Vr extends BS{constructor(e,n,s,r,i){super(e,n,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Vr.currentPopupAction&&Vr.currentPopupAction.cancel(),Vr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Fs(this.filter.length===1,"Popup operations only handle one event");const e=sh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(fs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(fs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_N.get())};e()}}Vr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN="pendingRedirect",Nc=new Map;class bN extends BS{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=Nc.get(this.auth._key());if(!e){try{const s=await CN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}Nc.set(this.auth._key(),e)}return this.bypassAuthState||Nc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function CN(t,e){const n=zS(e),s=US(t);if(!await s._isAvailable())return!1;const r=await s._get(n)==="true";return await s._remove(n),r}async function EN(t,e){return US(t)._set(zS(e),"true")}function TN(t,e){Nc.set(t._key(),e)}function US(t){return Rs(t._redirectPersistence)}function zS(t){return Rc(xN,t.config.apiKey,t.name)}function IN(t,e,n){return kN(t,e,n)}async function kN(t,e,n){const s=Ue(t);cS(s.auth,e,th),await s.auth._initializationPromise;const r=fm(s.auth,n);await UR(!1,s,e.providerId),await EN(r,s.auth);const i=await RN(s);return r._openRedirect(s.auth,e,"linkViaRedirect",i)}async function AN(t,e){return await Hs(t)._initializationPromise,VS(t,e,!1)}async function VS(t,e,n=!1){const s=Hs(t),r=fm(s,e),o=await new bN(s,r,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}async function RN(t){const e=sh(`${t.uid}:::`);return t._redirectEventId=e,await t.auth._setRedirectUser(t),await t.auth._persistUserIfCurrent(t),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN=10*60*1e3;class PN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DN(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!WS(e)){const r=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(fs(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=NN&&this.cachedEventUids.clear(),this.cachedEventUids.has(Iv(e))}saveEventToCache(e){this.cachedEventUids.add(Iv(e)),this.lastProcessedEventTime=Date.now()}}function Iv(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function WS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function DN(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return WS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MN(t,e={}){return Ws(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jN=/^https?/;async function FN(t){if(t.config.emulator)return;const{authorizedDomains:e}=await MN(t);for(const n of e)try{if(LN(n))return}catch{}Hn(t,"unauthorized-domain")}function LN(t){const e=ru(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!jN.test(n))return!1;if(ON.test(t))return s===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N=new il(3e4,6e4);function kv(){const t=ps().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function BN(t){return new Promise((e,n)=>{var s,r,i;function o(){kv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{kv(),n(fs(t,"network-request-failed"))},timeout:$N.get()})}if(!((r=(s=ps().gapi)===null||s===void 0?void 0:s.iframes)===null||r===void 0)&&r.Iframe)e(gapi.iframes.getContext());else if(!((i=ps().gapi)===null||i===void 0)&&i.load)o();else{const a=SR("iframefcb");return ps()[a]=()=>{gapi.load?o():n(fs(t,"network-request-failed"))},TS(`https://apis.google.com/js/api.js?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw Pc=null,e})}let Pc=null;function UN(t){return Pc=Pc||BN(t),Pc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=new il(5e3,15e3),VN="__/auth/iframe",WN="emulator/auth/iframe",HN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},GN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function qN(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?lm(e,WN):`https://${t.config.authDomain}/${VN}`,s={apiKey:e.apiKey,appName:t.name,v:fi},r=GN.get(t.config.apiHost);r&&(s.eid=r);const i=t._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${go(s).slice(1)}`}async function KN(t){const e=await UN(t),n=ps().gapi;return Ie(n,t,"internal-error"),e.open({where:document.body,url:qN(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:HN,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=fs(t,"network-request-failed"),a=ps().setTimeout(()=>{i(o)},zN.get());function l(){ps().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},QN=500,XN=600,JN="_blank",ZN="http://localhost";class Av{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eP(t,e,n,s=QN,r=XN){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l=Object.assign(Object.assign({},YN),{width:s.toString(),height:r.toString(),top:i,left:o}),c=ln().toLowerCase();n&&(a=yS(c)?JN:n),gS(c)&&(e=e||ZN,l.scrollbars="yes");const h=Object.entries(l).reduce((f,[m,g])=>`${f}${m}=${g},`,"");if(yR(c)&&a!=="_self")return tP(e||"",a),new Av(null);const d=window.open(e||"",a,h);Ie(d,t,"popup-blocked");try{d.focus()}catch{}return new Av(d)}function tP(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP="__/auth/handler",sP="emulator/auth/handler",rP=encodeURIComponent("fac");async function Rv(t,e,n,s,r,i){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:fi,eventId:r};if(e instanceof th){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Zc(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(e instanceof al){const h=e.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await t._getAppCheckToken(),c=l?`#${rP}=${encodeURIComponent(l)}`:"";return`${iP(t)}?${go(a).slice(1)}${c}`}function iP({config:t}){return t.emulator?lm(t,sP):`https://${t.authDomain}/${nP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd="webStorageSupport";class oP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=OS,this._completeRedirectFn=VS,this._overrideRedirectResult=TN}async _openPopup(e,n,s,r){var i;Fs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await Rv(e,n,s,ru(),r);return eP(e,o,sh())}async _openRedirect(e,n,s,r){await this._originValidation(e);const i=await Rv(e,n,s,ru(),r);return aN(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:r,promise:i}=this.eventManagers[n];return r?Promise.resolve(r):(Fs(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await KN(e),s=new PN(e);return n.register("authEvent",r=>(Ie(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(qd,{type:qd},r=>{var i;const o=(i=r==null?void 0:r[0])===null||i===void 0?void 0:i[qd];o!==void 0&&n(!!o),Hn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=FN(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return xS()||um()||eh()}}const aP=oP;var Nv="@firebase/auth",Pv="0.23.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function uP(t){dr(new js("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:bS(t)},c=new TR(s,r,i,l);return kR(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),dr(new js("auth-internal",e=>{const n=Hs(e.getProvider("auth").getImmediate());return(s=>new lP(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Vn(Nv,Pv,cP(t)),Vn(Nv,Pv,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP=5*60,dP=X0("authIdTokenMaxAge")||hP;let Dv=null;const fP=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>dP)return;const r=n==null?void 0:n.token;Dv!==r&&(Dv=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function pP(t=rl()){const e=sl(t,"auth");if(e.isInitialized())return e.getImmediate();const n=IR(t,{popupRedirectResolver:aP,persistence:[gN,rN,OS]}),s=X0("authTokenSyncURL");if(s){const i=fP(s);XR(n,i,()=>i(n.currentUser)),QR(n,o=>i(o))}const r=Y0("auth");return r&&AR(n,`http://${r}`),n}uP("Browser");var mP="firebase",gP="9.23.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vn(mP,gP,"app");var Mv={};const Ov="@firebase/database",jv="0.14.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let HS="";function GS(t){HS=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Dt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:ka(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return rs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new yP(e)}}catch{}return new vP},Wr=qS("localStorage"),Uf=qS("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zi=new Zu("@firebase/database"),KS=function(){let t=1;return function(){return t++}}(),YS=function(t){const e=K1(t),n=new W1;n.update(e);const s=n.digest();return tm.encodeByteArray(s)},cl=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=cl.apply(null,s):typeof s=="object"?e+=Dt(s):e+=s,e+=" "}return e};let Qr=null,Fv=!0;const QS=function(t,e){H(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(zi.logLevel=Ke.VERBOSE,Qr=zi.log.bind(zi),e&&Uf.set("logging_enabled",!0)):typeof t=="function"?Qr=t:(Qr=null,Uf.remove("logging_enabled"))},Bt=function(...t){if(Fv===!0&&(Fv=!1,Qr===null&&Uf.get("logging_enabled")===!0&&QS(!0)),Qr){const e=cl.apply(null,t);Qr(e)}},ul=function(t){return function(...e){Bt(t,...e)}},zf=function(...t){const e="FIREBASE INTERNAL ERROR: "+cl(...t);zi.error(e)},ws=function(...t){const e=`FIREBASE FATAL ERROR: ${cl(...t)}`;throw zi.error(e),new Error(e)},sn=function(...t){const e="FIREBASE WARNING: "+cl(...t);zi.warn(e)},wP=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&sn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ih=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},_P=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},fr="[MIN_NAME]",Ls="[MAX_NAME]",pi=function(t,e){if(t===e)return 0;if(t===fr||e===Ls)return-1;if(e===fr||t===Ls)return 1;{const n=Lv(t),s=Lv(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},SP=function(t,e){return t===e?0:t<e?-1:1},Uo=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Dt(e))},mm=function(t){if(typeof t!="object"||t===null)return Dt(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=Dt(e[s]),n+=":",n+=mm(t[e[s]]);return n+="}",n},XS=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let r=0;r<n;r+=e)r+e>n?s.push(t.substring(r,n)):s.push(t.substring(r,r+e));return s};function Ut(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const JS=function(t){H(!ih(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let r,i,o,a,l;t===0?(i=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),i=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-s-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(i%2?1:0),i=Math.floor(i/2);c.push(r?1:0),c.reverse();const h=c.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(h.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},xP=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bP=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function CP(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const EP=new RegExp("^-?(0*)\\d{1,10}$"),TP=-2147483648,IP=2147483647,Lv=function(t){if(EP.test(t)){const e=Number(t);if(e>=TP&&e<=IP)return e}return null},vo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw sn("Exception was thrown by user callback.",n),e},Math.floor(0))}},kP=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ua=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){sn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Bt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',sn(e)}}class Vi{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Vi.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gm="5",ZS="v",ex="s",tx="r",nx="f",sx=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,rx="ls",ix="p",Vf="ac",ox="websocket",ax="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,n,s,r,i=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Wr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Wr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function NP(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function cx(t,e,n){H(typeof e=="string","typeof type must == string"),H(typeof n=="object","typeof params must == object");let s;if(e===ox)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ax)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);NP(t)&&(n.ns=t.namespace);const r=[];return Ut(n,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.counters_={}}incrementCounter(e,n=1){rs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return k1(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kd={},Yd={};function ym(t){const e=t.toString();return Kd[e]||(Kd[e]=new PP),Kd[e]}function DP(t,e){const n=t.toString();return Yd[n]||(Yd[n]=e()),Yd[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&vo(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $v="start",OP="close",jP="pLPCommand",FP="pRTLPCB",ux="id",hx="pw",dx="ser",LP="cb",$P="seg",BP="ts",UP="d",zP="dframe",fx=1870,px=30,VP=fx-px,WP=25e3,HP=3e4;class sr{constructor(e,n,s,r,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ul(e),this.stats_=ym(n),this.urlFn=l=>(this.appCheckToken&&(l[Vf]=this.appCheckToken),cx(n,ax,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new MP(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(HP)),_P(()=>{if(this.isClosed_)return;this.scriptTagHolder=new vm((...i)=>{const[o,a,l,c,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===$v)this.id=a,this.password=l;else if(o===OP)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[$v]="t",s[dx]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[LP]=this.scriptTagHolder.uniqueCallbackIdentifier),s[ZS]=gm,this.transportSessionId&&(s[ex]=this.transportSessionId),this.lastSessionId&&(s[rx]=this.lastSessionId),this.applicationId&&(s[ix]=this.applicationId),this.appCheckToken&&(s[Vf]=this.appCheckToken),typeof location<"u"&&location.hostname&&sx.test(location.hostname)&&(s[tx]=nx);const r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){sr.forceAllow_=!0}static forceDisallow(){sr.forceDisallow_=!0}static isAvailable(){return sr.forceAllow_?!0:!sr.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!xP()&&!bP()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Dt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=q0(n),r=XS(s,VP);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[zP]="t",s[ux]=e,s[hx]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Dt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class vm{constructor(e,n,s,r){this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=KS(),window[jP+this.uniqueCallbackIdentifier]=e,window[FP+this.uniqueCallbackIdentifier]=n,this.myIFrame=vm.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Bt("frame writing exception"),a.stack&&Bt(a.stack),Bt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Bt("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[ux]=this.myID,e[hx]=this.myPW,e[dx]=this.currentSerial;let n=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+px+s.length<=fx;){const o=this.pendingSegs.shift();s=s+"&"+$P+r+"="+o.seg+"&"+BP+r+"="+o.ts+"&"+UP+r+"="+o.d,r++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(s,Math.floor(WP)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{Bt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP=16384,qP=45e3;let lu=null;typeof MozWebSocket<"u"?lu=MozWebSocket:typeof WebSocket<"u"&&(lu=WebSocket);class Fn{constructor(e,n,s,r,i,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ul(this.connId),this.stats_=ym(n),this.connURL=Fn.connectionURL_(n,o,a,r,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,r,i){const o={};return o[ZS]=gm,typeof location<"u"&&location.hostname&&sx.test(location.hostname)&&(o[tx]=nx),n&&(o[ex]=n),s&&(o[rx]=s),r&&(o[Vf]=r),i&&(o[ix]=i),cx(e,ox,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Wr.set("previous_websocket_failure",!0);try{let s;j1(),this.mySock=new lu(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Fn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&lu!==null&&!Fn.forceDisallow_}static previouslyFailed(){return Wr.isInMemoryStorage||Wr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Wr.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=ka(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(H(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=Dt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=XS(n,GP);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(qP))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Fn.responsesRequiredToBeHealthy=2;Fn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[sr,Fn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const n=Fn&&Fn.isAvailable();let s=n&&!Fn.previouslyFailed();if(e.webSocketOnly&&(n||sn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Fn];else{const r=this.transports_=[];for(const i of Ji.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Ji.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ji.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP=6e4,YP=5e3,QP=10*1024,XP=100*1024,Qd="t",Bv="d",JP="s",Uv="r",ZP="e",zv="o",Vv="a",Wv="n",Hv="p",eD="h";class tD{constructor(e,n,s,r,i,o,a,l,c,h){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ul("c:"+this.id+":"),this.transportManager_=new Ji(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=ua(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>XP?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>QP?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Qd in e){const n=e[Qd];n===Vv?this.upgradeIfSecondaryHealthy_():n===Uv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===zv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Uo("t",e),s=Uo("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Hv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Vv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Wv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Uo("t",e),s=Uo("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Uo(Qd,e);if(Bv in e){const s=e[Bv];if(n===eD){const r=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===Wv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===JP?this.onConnectionShutdown_(s):n===Uv?this.onReset_(s):n===ZP?zf("Server Error: "+s):n===zv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):zf("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),gm!==s&&sn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),ua(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(KP))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ua(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(YP))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Hv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Wr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{put(e,n,s,r){}merge(e,n,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e){this.allowedEvents_=e,this.listeners_={},H(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const r=this.getInitialEvent(e);r&&n.apply(s,r)}off(e,n,s){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===n&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){H(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu extends gx{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!rm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new cu}getInitialEvent(e){return H(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv=32,qv=768;class tt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Qe(){return new tt("")}function Fe(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function pr(t){return t.pieces_.length-t.pieceNum_}function it(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new tt(t.pieces_,e)}function wm(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function nD(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Da(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function yx(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new tt(e,0)}function yt(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof tt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&n.push(s[r])}return new tt(n,0)}function Le(t){return t.pieceNum_>=t.pieces_.length}function hn(t,e){const n=Fe(t),s=Fe(e);if(n===null)return e;if(n===s)return hn(it(t),it(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function sD(t,e){const n=Da(t,0),s=Da(e,0);for(let r=0;r<n.length&&r<s.length;r++){const i=pi(n[r],s[r]);if(i!==0)return i}return n.length===s.length?0:n.length<s.length?-1:1}function _m(t,e){if(pr(t)!==pr(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function Bn(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(pr(t)>pr(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class rD{constructor(e,n){this.errorPrefix_=n,this.parts_=Da(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Ju(this.parts_[s]);vx(this)}}function iD(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ju(e),vx(t)}function oD(t){const e=t.parts_.pop();t.byteLength_-=Ju(e),t.parts_.length>0&&(t.byteLength_-=1)}function vx(t){if(t.byteLength_>qv)throw new Error(t.errorPrefix_+"has a key path longer than "+qv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Gv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Gv+") or object contains a cycle "+Or(t))}function Or(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm extends gx{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new Sm}getInitialEvent(e){return H(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zo=1e3,aD=60*5*1e3,Kv=30*1e3,lD=1.3,cD=3e4,uD="server_kill",Yv=3;class Wn extends mx{constructor(e,n,s,r,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Wn.nextPersistentConnectionId_++,this.log_=ul("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=zo,this.maxReconnectDelay_=aD,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Sm.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&cu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const r=++this.requestNumber_,i={r,a:e,b:n};this.log_(Dt(i)),H(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const n=new Nn,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,s,r){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),H(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:n,query:e,tag:s};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+s+" for "+r);const i={p:s},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,c=a.s;Wn.warnOnListenWarnings_(l,n),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&rs(e,"w")){const s=ti(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();sn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||V1(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Kv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=z1(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,r=>{const i=r.s,o=r.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,n)}sendUnlisten_(e,n,s,r){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";r&&(i.q=s,i.t=r),this.sendRequest(o,i)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,r){const i={p:n,d:s};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,n,s,r){this.putInternal("p",e,n,s,r)}merge(e,n,s,r){this.putInternal("m",e,n,s,r)}putInternal(e,n,s,r,i){this.initConnection_();const o={p:n,d:s};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const i=s.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Dt(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):zf("Unrecognized action received from server: "+Dt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){H(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zo,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=zo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>cD&&(this.reconnectDelay_=zo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*lD)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Wn.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(d){H(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Bt("getToken() completed but was canceled"):(Bt("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new tD(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,m=>{sn(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(uD)},i))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&sn(d),l())}}}interrupt(e){Bt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Bt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Zc(this.interruptReasons_)&&(this.reconnectDelay_=zo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(i=>mm(i)).join("$"):s="default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,n){const s=new tt(e).toString();let r;if(this.listens.has(s)){const i=this.listens.get(s);r=i.get(n),i.delete(n),i.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,n){Bt("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Yv&&(this.reconnectDelay_=Kv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Bt("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Yv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+HS.replace(/\./g,"-")]=1,rm()?e["framework.cordova"]=1:Z0()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=cu.getInstance().currentlyOnline();return Zc(this.interruptReasons_)&&e}}Wn.nextPersistentConnectionId_=0;Wn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Be(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new Be(fr,e),r=new Be(fr,n);return this.compare(s,r)!==0}minPost(){return Be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ec;class wx extends oh{static get __EMPTY_NODE(){return ec}static set __EMPTY_NODE(e){ec=e}compare(e,n){return pi(e.name,n.name)}isDefinedOn(e){throw mo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Be.MIN}maxPost(){return new Be(Ls,ec)}makePost(e,n){return H(typeof e=="string","KeyIndex indexValue must always be a string."),new Be(e,ec)}toString(){return".key"}}const ms=new wx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,n,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class $t{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??$t.RED,this.left=r??wn.EMPTY_NODE,this.right=i??wn.EMPTY_NODE}copy(e,n,s,r,i){return new $t(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this;const i=s(e,r.key);return i<0?r=r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return wn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,r;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return wn.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,$t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,$t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}$t.RED=!0;$t.BLACK=!1;class hD{copy(e,n,s,r,i){return this}insert(e,n,s){return new $t(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class wn{constructor(e,n=wn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new wn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,$t.BLACK,null,null))}remove(e){return new wn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,$t.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,r=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new tc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new tc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new tc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new tc(this.root_,null,this.comparator_,!0,e)}}wn.EMPTY_NODE=new hD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD(t,e){return pi(t.name,e.name)}function xm(t,e){return pi(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wf;function fD(t){Wf=t}const _x=function(t){return typeof t=="number"?"number:"+JS(t):"string:"+t},Sx=function(t){if(t.isLeafNode()){const e=t.val();H(typeof e=="string"||typeof e=="number"||typeof e=="object"&&rs(e,".sv"),"Priority must be a string or number.")}else H(t===Wf||t.isEmpty(),"priority of unexpected type.");H(t===Wf||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qv;class Ft{constructor(e,n=Ft.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,H(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Sx(this.priorityNode_)}static set __childrenNodeConstructor(e){Qv=e}static get __childrenNodeConstructor(){return Qv}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ft(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ft.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Le(e)?this:Fe(e)===".priority"?this.priorityNode_:Ft.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Ft.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=Fe(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(H(s!==".priority"||pr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,Ft.__childrenNodeConstructor.EMPTY_NODE.updateChild(it(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+_x(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=JS(this.value_):e+=this.value_,this.lazyHash_=YS(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ft.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ft.__childrenNodeConstructor?-1:(H(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,r=Ft.VALUE_TYPE_ORDER.indexOf(n),i=Ft.VALUE_TYPE_ORDER.indexOf(s);return H(r>=0,"Unknown leaf type: "+n),H(i>=0,"Unknown leaf type: "+s),r===i?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Ft.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xx,bx;function pD(t){xx=t}function mD(t){bx=t}class gD extends oh{compare(e,n){const s=e.node.getPriority(),r=n.node.getPriority(),i=s.compareTo(r);return i===0?pi(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Be.MIN}maxPost(){return new Be(Ls,new Ft("[PRIORITY-POST]",bx))}makePost(e,n){const s=xx(e);return new Be(n,new Ft("[PRIORITY-POST]",s))}toString(){return".priority"}}const ht=new gD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=Math.log(2);class vD{constructor(e){const n=i=>parseInt(Math.log(i)/yD,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const uu=function(t,e,n,s){t.sort(e);const r=function(l,c){const h=c-l;let d,f;if(h===0)return null;if(h===1)return d=t[l],f=n?n(d):d,new $t(f,d.node,$t.BLACK,null,null);{const m=parseInt(h/2,10)+l,g=r(l,m),y=r(m+1,c);return d=t[m],f=n?n(d):d,new $t(f,d.node,$t.BLACK,g,y)}},i=function(l){let c=null,h=null,d=t.length;const f=function(g,y){const S=d-g,T=d;d-=g;const w=r(S+1,T),b=t[S],_=n?n(b):b;m(new $t(_,b.node,y,null,w))},m=function(g){c?(c.left=g,c=g):(h=g,c=g)};for(let g=0;g<l.count;++g){const y=l.nextBitIsOne(),S=Math.pow(2,l.count-(g+1));y?f(S,$t.BLACK):(f(S,$t.BLACK),f(S,$t.RED))}return h},o=new vD(t.length),a=i(o);return new wn(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xd;const ki={};class Ns{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return H(ki&&ht,"ChildrenNode.ts has not been loaded"),Xd=Xd||new Ns({".priority":ki},{".priority":ht}),Xd}get(e){const n=ti(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof wn?n:null}hasIndex(e){return rs(this.indexSet_,e.toString())}addIndex(e,n){H(e!==ms,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let r=!1;const i=n.getIterator(Be.Wrap);let o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=uu(s,e.getCompare()):a=ki;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Ns(h,c)}addToIndexes(e,n){const s=eu(this.indexes_,(r,i)=>{const o=ti(this.indexSet_,i);if(H(o,"Missing index implementation for "+i),r===ki)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(Be.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),uu(a,o.getCompare())}else return ki;else{const a=n.get(e.name);let l=r;return a&&(l=l.remove(new Be(e.name,a))),l.insert(e,e.node)}});return new Ns(s,this.indexSet_)}removeFromIndexes(e,n){const s=eu(this.indexes_,r=>{if(r===ki)return r;{const i=n.get(e.name);return i?r.remove(new Be(e.name,i)):r}});return new Ns(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vo;class be{constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Sx(this.priorityNode_),this.children_.isEmpty()&&H(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Vo||(Vo=new be(new wn(xm),null,Ns.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Vo}updatePriority(e){return this.children_.isEmpty()?this:new be(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Vo:n}}getChild(e){const n=Fe(e);return n===null?this:this.getImmediateChild(n).getChild(it(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(H(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new Be(e,n);let r,i;n.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(s,this.children_));const o=r.isEmpty()?Vo:this.priorityNode_;return new be(r,o,i)}}updateChild(e,n){const s=Fe(e);if(s===null)return n;{H(Fe(e)!==".priority"||pr(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(it(e),n);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,r=0,i=!0;if(this.forEachChild(ht,(o,a)=>{n[o]=a.val(e),s++,i&&be.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1}),!e&&i&&r<2*s){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+_x(this.getPriority().val())+":"),this.forEachChild(ht,(n,s)=>{const r=s.hash();r!==""&&(e+=":"+n+":"+r)}),this.lazyHash_=e===""?"":YS(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const r=this.resolveIndex_(s);if(r){const i=r.getPredecessorKey(new Be(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Be(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Be(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Be.Wrap);let i=r.peek();for(;i!=null&&n.compare(i,e)<0;)r.getNext(),i=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Be.Wrap);let i=r.peek();for(;i!=null&&n.compare(i,e)>0;)r.getNext(),i=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===hl?-1:0}withIndex(e){if(e===ms||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new be(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===ms||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(ht),r=n.getIterator(ht);let i=s.getNext(),o=r.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=s.getNext(),o=r.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ms?null:this.indexMap_.get(e.toString())}}be.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class wD extends be{constructor(){super(new wn(xm),be.EMPTY_NODE,Ns.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return be.EMPTY_NODE}isEmpty(){return!1}}const hl=new wD;Object.defineProperties(Be,{MIN:{value:new Be(fr,be.EMPTY_NODE)},MAX:{value:new Be(Ls,hl)}});wx.__EMPTY_NODE=be.EMPTY_NODE;Ft.__childrenNodeConstructor=be;fD(hl);mD(hl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D=!0;function wt(t,e=null){if(t===null)return be.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),H(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Ft(n,wt(e))}if(!(t instanceof Array)&&_D){const n=[];let s=!1;if(Ut(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=wt(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new Be(o,l)))}}),n.length===0)return be.EMPTY_NODE;const i=uu(n,dD,o=>o.name,xm);if(s){const o=uu(n,ht.getCompare());return new be(i,wt(e),new Ns({".priority":o},{".priority":ht}))}else return new be(i,wt(e),Ns.Default)}else{let n=be.EMPTY_NODE;return Ut(t,(s,r)=>{if(rs(t,s)&&s.substring(0,1)!=="."){const i=wt(r);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(s,i))}}),n.updatePriority(wt(e))}}pD(wt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm extends oh{constructor(e){super(),this.indexPath_=e,H(!Le(e)&&Fe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),r=this.extractChild(n.node),i=s.compareTo(r);return i===0?pi(e.name,n.name):i}makePost(e,n){const s=wt(e),r=be.EMPTY_NODE.updateChild(this.indexPath_,s);return new Be(n,r)}maxPost(){const e=be.EMPTY_NODE.updateChild(this.indexPath_,hl);return new Be(Ls,e)}toString(){return Da(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD extends oh{compare(e,n){const s=e.node.compareTo(n.node);return s===0?pi(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Be.MIN}maxPost(){return Be.MAX}makePost(e,n){const s=wt(e);return new Be(n,s)}toString(){return".value"}}const Cm=new SD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cx(t){return{type:"value",snapshotNode:t}}function Zi(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ma(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Oa(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function xD(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e){this.index_=e}updateChild(e,n,s,r,i,o){H(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Ma(n,a)):H(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Zi(n,s)):o.trackChildChange(Oa(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(ht,(r,i)=>{n.hasChild(r)||s.trackChildChange(Ma(r,i))}),n.isLeafNode()||n.forEachChild(ht,(r,i)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(Oa(r,i,o))}else s.trackChildChange(Zi(r,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?be.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.indexedFilter_=new Em(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ja.getStartPost_(e),this.endPost_=ja.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,r,i,o){return this.matches(new Be(n,s))||(s=be.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,r,i,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=be.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(be.EMPTY_NODE);const i=this;return n.forEachChild(ht,(o,a)=>{i.matches(new Be(o,a))||(r=r.updateImmediateChild(o,be.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{const s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new ja(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,r,i,o){return this.rangedFilter_.matches(new Be(n,s))||(s=be.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,r,i,o):this.fullLimitUpdateChild_(e,n,s,i,o)}updateFullNode(e,n,s){let r;if(n.isLeafNode()||n.isEmpty())r=be.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=be.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(be.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,be.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,r,i){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,m)=>d(m,f)}else o=this.index_.getCompare();const a=e;H(a.numChildren()===this.limit_,"");const l=new Be(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(n)){const d=a.getImmediateChild(n);let f=r.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,l);if(h&&!s.isEmpty()&&m>=0)return i!=null&&i.trackChildChange(Oa(n,s,d)),a.updateImmediateChild(n,s);{i!=null&&i.trackChildChange(Ma(n,d));const y=a.updateImmediateChild(n,be.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Zi(f.name,f.node)),y.updateImmediateChild(f.name,f.node)):y}}else return s.isEmpty()?e:h&&o(c,l)>=0?(i!=null&&(i.trackChildChange(Ma(c.name,c.node)),i.trackChildChange(Zi(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,be.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ht}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return H(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return H(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fr}hasEnd(){return this.endSet_}getIndexEndValue(){return H(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return H(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ls}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return H(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ht}copy(){const e=new ah;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function CD(t){return t.loadsAllData()?new Em(t.getIndex()):t.hasLimit()?new bD(t):new ja(t)}function ED(t,e){const n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="l",n}function TD(t,e){const n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="r",n}function Hf(t,e,n){const s=t.copy();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,n!=null?(s.startNameSet_=!0,s.indexStartName_=n):(s.startNameSet_=!1,s.indexStartName_=""),s}function ID(t,e,n){let s;return t.index_===ms||n?s=Hf(t,e,n):s=Hf(t,e,Ls),s.startAfterSet_=!0,s}function Gf(t,e,n){const s=t.copy();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,n!==void 0?(s.endNameSet_=!0,s.indexEndName_=n):(s.endNameSet_=!1,s.indexEndName_=""),s}function kD(t,e,n){let s;return t.index_===ms||n?s=Gf(t,e,n):s=Gf(t,e,fr),s.endBeforeSet_=!0,s}function lh(t,e){const n=t.copy();return n.index_=e,n}function Xv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===ht?n="$priority":t.index_===Cm?n="$value":t.index_===ms?n="$key":(H(t.index_ instanceof bm,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Dt(n),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=Dt(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+Dt(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=Dt(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+Dt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Jv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==ht&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu extends mx{constructor(e,n,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=ul("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(H(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,s,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=hu.getListenId_(e,s),a={};this.listens_[o]=a;const l=Xv(e._queryParams);this.restRequest_(i+".json",l,(c,h)=>{let d=h;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(i,d,!1,s),ti(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",r(f,null)}})}unlisten(e,n){const s=hu.getListenId_(e,n);delete this.listens_[s]}get(e){const n=Xv(e._queryParams),s=e._path.toString(),r=new Nn;return this.restRequest_(s+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(n.auth=r.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+go(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=ka(a.responseText)}catch{sn("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&sn("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(){this.rootNode_=be.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(){return{value:null,children:new Map}}function wo(t,e,n){if(Le(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=Fe(e);t.children.has(s)||t.children.set(s,du());const r=t.children.get(s);e=it(e),wo(r,e,n)}}function qf(t,e){if(Le(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(ht,(s,r)=>{wo(t,new tt(s),r)}),qf(t,e)}}else if(t.children.size>0){const n=Fe(e);return e=it(e),t.children.has(n)&&qf(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Kf(t,e,n){t.value!==null?n(e,t.value):RD(t,(s,r)=>{const i=new tt(e.toString()+"/"+s);Kf(r,i,n)})}function RD(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Ut(this.last_,(s,r)=>{n[s]=n[s]-r}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv=10*1e3,PD=30*1e3,DD=5*60*1e3;class MD{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new ND(e);const s=Zv+(PD-Zv)*Math.random();ua(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Ut(e,(r,i)=>{i>0&&rs(this.statsToReport_,r)&&(n[r]=i,s=!0)}),s&&this.server_.reportStats(n),ua(this.reportStats_.bind(this),Math.floor(Math.random()*2*DD))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xn;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Xn||(Xn={}));function Tm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Im(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function km(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=Xn.ACK_USER_WRITE,this.source=Tm()}operationForChild(e){if(Le(this.path)){if(this.affectedTree.value!=null)return H(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new tt(e));return new fu(Qe(),n,this.revert)}}else return H(Fe(this.path)===e,"operationForChild called for unrelated child."),new fu(it(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e,n){this.source=e,this.path=n,this.type=Xn.LISTEN_COMPLETE}operationForChild(e){return Le(this.path)?new Fa(this.source,Qe()):new Fa(this.source,it(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=Xn.OVERWRITE}operationForChild(e){return Le(this.path)?new oi(this.source,Qe(),this.snap.getImmediateChild(e)):new oi(this.source,it(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=Xn.MERGE}operationForChild(e){if(Le(this.path)){const n=this.children.subtree(new tt(e));return n.isEmpty()?null:n.value?new oi(this.source,Qe(),n.value):new eo(this.source,Qe(),n)}else return H(Fe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new eo(this.source,it(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Le(e))return this.isFullyInitialized()&&!this.filtered_;const n=Fe(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function jD(t,e,n,s){const r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(xD(o.childName,o.snapshotNode))}),Wo(t,r,"child_removed",e,s,n),Wo(t,r,"child_added",e,s,n),Wo(t,r,"child_moved",i,s,n),Wo(t,r,"child_changed",e,s,n),Wo(t,r,"value",e,s,n),r}function Wo(t,e,n,s,r,i){const o=s.filter(a=>a.type===n);o.sort((a,l)=>LD(t,a,l)),o.forEach(a=>{const l=FD(t,a,i);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function FD(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function LD(t,e,n){if(e.childName==null||n.childName==null)throw mo("Should only compare child_ events.");const s=new Be(e.childName,e.snapshotNode),r=new Be(n.childName,n.snapshotNode);return t.index_.compare(s,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(t,e){return{eventCache:t,serverCache:e}}function ha(t,e,n,s){return ch(new mr(e,n,s),t.serverCache)}function Ex(t,e,n,s){return ch(t.eventCache,new mr(e,n,s))}function pu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function ai(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jd;const $D=()=>(Jd||(Jd=new wn(SP)),Jd);class lt{constructor(e,n=$D()){this.value=e,this.children=n}static fromObject(e){let n=new lt(null);return Ut(e,(s,r)=>{n=n.set(new tt(s),r)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Qe(),value:this.value};if(Le(e))return null;{const s=Fe(e),r=this.children.get(s);if(r!==null){const i=r.findRootMostMatchingPathAndValue(it(e),n);return i!=null?{path:yt(new tt(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Le(e))return this;{const n=Fe(e),s=this.children.get(n);return s!==null?s.subtree(it(e)):new lt(null)}}set(e,n){if(Le(e))return new lt(n,this.children);{const s=Fe(e),i=(this.children.get(s)||new lt(null)).set(it(e),n),o=this.children.insert(s,i);return new lt(this.value,o)}}remove(e){if(Le(e))return this.children.isEmpty()?new lt(null):new lt(null,this.children);{const n=Fe(e),s=this.children.get(n);if(s){const r=s.remove(it(e));let i;return r.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,r),this.value===null&&i.isEmpty()?new lt(null):new lt(this.value,i)}else return this}}get(e){if(Le(e))return this.value;{const n=Fe(e),s=this.children.get(n);return s?s.get(it(e)):null}}setTree(e,n){if(Le(e))return n;{const s=Fe(e),i=(this.children.get(s)||new lt(null)).setTree(it(e),n);let o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new lt(this.value,o)}}fold(e){return this.fold_(Qe(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(yt(e,r),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,Qe(),n)}findOnPath_(e,n,s){const r=this.value?s(n,this.value):!1;if(r)return r;if(Le(e))return null;{const i=Fe(e),o=this.children.get(i);return o?o.findOnPath_(it(e),yt(n,i),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Qe(),n)}foreachOnPath_(e,n,s){if(Le(e))return this;{this.value&&s(n,this.value);const r=Fe(e),i=this.children.get(r);return i?i.foreachOnPath_(it(e),yt(n,r),s):new lt(null)}}foreach(e){this.foreach_(Qe(),e)}foreach_(e,n){this.children.inorderTraversal((s,r)=>{r.foreach_(yt(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.writeTree_=e}static empty(){return new es(new lt(null))}}function da(t,e,n){if(Le(e))return new es(new lt(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const r=s.path;let i=s.value;const o=hn(r,e);return i=i.updateChild(o,n),new es(t.writeTree_.set(r,i))}else{const r=new lt(n),i=t.writeTree_.setTree(e,r);return new es(i)}}}function Yf(t,e,n){let s=t;return Ut(n,(r,i)=>{s=da(s,yt(e,r),i)}),s}function ew(t,e){if(Le(e))return es.empty();{const n=t.writeTree_.setTree(e,new lt(null));return new es(n)}}function Qf(t,e){return mi(t,e)!=null}function mi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(hn(n.path,e)):null}function tw(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(ht,(s,r)=>{e.push(new Be(s,r))}):t.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new Be(s,r.value))}),e}function cr(t,e){if(Le(e))return t;{const n=mi(t,e);return n!=null?new es(new lt(n)):new es(t.writeTree_.subtree(e))}}function Xf(t){return t.writeTree_.isEmpty()}function to(t,e){return Tx(Qe(),t.writeTree_,e)}function Tx(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(H(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):n=Tx(yt(t,r),i,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(yt(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(t,e){return Rx(e,t)}function BD(t,e,n,s,r){H(s>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:r}),r&&(t.visibleWrites=da(t.visibleWrites,e,n)),t.lastWriteId=s}function UD(t,e,n,s){H(s>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:s,visible:!0}),t.visibleWrites=Yf(t.visibleWrites,e,n),t.lastWriteId=s}function zD(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function VD(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);H(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let r=s.visible,i=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&WD(a,s.path)?r=!1:Bn(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return HD(t),!0;if(s.snap)t.visibleWrites=ew(t.visibleWrites,s.path);else{const a=s.children;Ut(a,l=>{t.visibleWrites=ew(t.visibleWrites,yt(s.path,l))})}return!0}else return!1}function WD(t,e){if(t.snap)return Bn(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Bn(yt(t.path,n),e))return!0;return!1}function HD(t){t.visibleWrites=Ix(t.allWrites,GD,Qe()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function GD(t){return t.visible}function Ix(t,e,n){let s=es.empty();for(let r=0;r<t.length;++r){const i=t[r];if(e(i)){const o=i.path;let a;if(i.snap)Bn(n,o)?(a=hn(n,o),s=da(s,a,i.snap)):Bn(o,n)&&(a=hn(o,n),s=da(s,Qe(),i.snap.getChild(a)));else if(i.children){if(Bn(n,o))a=hn(n,o),s=Yf(s,a,i.children);else if(Bn(o,n))if(a=hn(o,n),Le(a))s=Yf(s,Qe(),i.children);else{const l=ti(i.children,Fe(a));if(l){const c=l.getChild(it(a));s=da(s,Qe(),c)}}}else throw mo("WriteRecord should have .snap or .children")}}return s}function kx(t,e,n,s,r){if(!s&&!r){const i=mi(t.visibleWrites,e);if(i!=null)return i;{const o=cr(t.visibleWrites,e);if(Xf(o))return n;if(n==null&&!Qf(o,Qe()))return null;{const a=n||be.EMPTY_NODE;return to(o,a)}}}else{const i=cr(t.visibleWrites,e);if(!r&&Xf(i))return n;if(!r&&n==null&&!Qf(i,Qe()))return null;{const o=function(c){return(c.visible||r)&&(!s||!~s.indexOf(c.writeId))&&(Bn(c.path,e)||Bn(e,c.path))},a=Ix(t.allWrites,o,e),l=n||be.EMPTY_NODE;return to(a,l)}}}function qD(t,e,n){let s=be.EMPTY_NODE;const r=mi(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(ht,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(n){const i=cr(t.visibleWrites,e);return n.forEachChild(ht,(o,a)=>{const l=to(cr(i,new tt(o)),a);s=s.updateImmediateChild(o,l)}),tw(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const i=cr(t.visibleWrites,e);return tw(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function KD(t,e,n,s,r){H(s||r,"Either existingEventSnap or existingServerSnap must exist");const i=yt(e,n);if(Qf(t.visibleWrites,i))return null;{const o=cr(t.visibleWrites,i);return Xf(o)?r.getChild(n):to(o,r.getChild(n))}}function YD(t,e,n,s){const r=yt(e,n),i=mi(t.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(n)){const o=cr(t.visibleWrites,r);return to(o,s.getNode().getImmediateChild(n))}else return null}function QD(t,e){return mi(t.visibleWrites,e)}function XD(t,e,n,s,r,i,o){let a;const l=cr(t.visibleWrites,e),c=mi(l,Qe());if(c!=null)a=c;else if(n!=null)a=to(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],d=o.getCompare(),f=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let m=f.getNext();for(;m&&h.length<r;)d(m,s)!==0&&h.push(m),m=f.getNext();return h}else return[]}function JD(){return{visibleWrites:es.empty(),allWrites:[],lastWriteId:-1}}function mu(t,e,n,s){return kx(t.writeTree,t.treePath,e,n,s)}function Am(t,e){return qD(t.writeTree,t.treePath,e)}function nw(t,e,n,s){return KD(t.writeTree,t.treePath,e,n,s)}function gu(t,e){return QD(t.writeTree,yt(t.treePath,e))}function ZD(t,e,n,s,r,i){return XD(t.writeTree,t.treePath,e,n,s,r,i)}function Rm(t,e,n){return YD(t.writeTree,t.treePath,e,n)}function Ax(t,e){return Rx(yt(t.treePath,e),t.writeTree)}function Rx(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eM{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;H(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),H(s!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const i=r.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(s,Oa(s,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(s,Ma(s,r.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(s,Zi(s,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(s,Oa(s,e.snapshotNode,r.oldSnap));else throw mo("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const Nx=new tM;class Nm{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new mr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Rm(this.writes_,e,s)}}getChildAfterChild(e,n,s){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ai(this.viewCache_),i=ZD(this.writes_,r,n,1,s,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nM(t){return{filter:t}}function sM(t,e){H(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),H(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function rM(t,e,n,s,r){const i=new eM;let o,a;if(n.type===Xn.OVERWRITE){const c=n;c.source.fromUser?o=Jf(t,e,c.path,c.snap,s,r,i):(H(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!Le(c.path),o=yu(t,e,c.path,c.snap,s,r,a,i))}else if(n.type===Xn.MERGE){const c=n;c.source.fromUser?o=oM(t,e,c.path,c.children,s,r,i):(H(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Zf(t,e,c.path,c.children,s,r,a,i))}else if(n.type===Xn.ACK_USER_WRITE){const c=n;c.revert?o=cM(t,e,c.path,s,r,i):o=aM(t,e,c.path,c.affectedTree,s,r,i)}else if(n.type===Xn.LISTEN_COMPLETE)o=lM(t,e,n.path,s,i);else throw mo("Unknown operation type: "+n.type);const l=i.getChanges();return iM(e,o,l),{viewCache:o,changes:l}}function iM(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=pu(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&n.push(Cx(pu(e)))}}function Px(t,e,n,s,r,i){const o=e.eventCache;if(gu(s,n)!=null)return e;{let a,l;if(Le(n))if(H(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=ai(e),h=c instanceof be?c:be.EMPTY_NODE,d=Am(s,h);a=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const c=mu(s,ai(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,i)}else{const c=Fe(n);if(c===".priority"){H(pr(n)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const d=nw(s,n,h,l);d!=null?a=t.filter.updatePriority(h,d):a=o.getNode()}else{const h=it(n);let d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=nw(s,n,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(c).updateChild(h,f):d=o.getNode().getImmediateChild(c)}else d=Rm(s,c,e.serverCache);d!=null?a=t.filter.updateChild(o.getNode(),c,d,h,r,i):a=o.getNode()}}return ha(e,a,o.isFullyInitialized()||Le(n),t.filter.filtersNodes())}}function yu(t,e,n,s,r,i,o,a){const l=e.serverCache;let c;const h=o?t.filter:t.filter.getIndexedFilter();if(Le(n))c=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){const m=l.getNode().updateChild(n,s);c=h.updateFullNode(l.getNode(),m,null)}else{const m=Fe(n);if(!l.isCompleteForPath(n)&&pr(n)>1)return e;const g=it(n),S=l.getNode().getImmediateChild(m).updateChild(g,s);m===".priority"?c=h.updatePriority(l.getNode(),S):c=h.updateChild(l.getNode(),m,S,g,Nx,null)}const d=Ex(e,c,l.isFullyInitialized()||Le(n),h.filtersNodes()),f=new Nm(r,d,i);return Px(t,d,n,r,f,a)}function Jf(t,e,n,s,r,i,o){const a=e.eventCache;let l,c;const h=new Nm(r,e,i);if(Le(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=ha(e,c,!0,t.filter.filtersNodes());else{const d=Fe(n);if(d===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=ha(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=it(n),m=a.getNode().getImmediateChild(d);let g;if(Le(f))g=s;else{const y=h.getCompleteChild(d);y!=null?wm(f)===".priority"&&y.getChild(yx(f)).isEmpty()?g=y:g=y.updateChild(f,s):g=be.EMPTY_NODE}if(m.equals(g))l=e;else{const y=t.filter.updateChild(a.getNode(),d,g,f,h,o);l=ha(e,y,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function sw(t,e){return t.eventCache.isCompleteForChild(e)}function oM(t,e,n,s,r,i,o){let a=e;return s.foreach((l,c)=>{const h=yt(n,l);sw(e,Fe(h))&&(a=Jf(t,a,h,c,r,i,o))}),s.foreach((l,c)=>{const h=yt(n,l);sw(e,Fe(h))||(a=Jf(t,a,h,c,r,i,o))}),a}function rw(t,e,n){return n.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function Zf(t,e,n,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;Le(n)?c=s:c=new lt(null).setTree(n,s);const h=e.serverCache.getNode();return c.children.inorderTraversal((d,f)=>{if(h.hasChild(d)){const m=e.serverCache.getNode().getImmediateChild(d),g=rw(t,m,f);l=yu(t,l,new tt(d),g,r,i,o,a)}}),c.children.inorderTraversal((d,f)=>{const m=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!h.hasChild(d)&&!m){const g=e.serverCache.getNode().getImmediateChild(d),y=rw(t,g,f);l=yu(t,l,new tt(d),y,r,i,o,a)}}),l}function aM(t,e,n,s,r,i,o){if(gu(r,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(Le(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return yu(t,e,n,l.getNode().getChild(n),r,i,a,o);if(Le(n)){let c=new lt(null);return l.getNode().forEachChild(ms,(h,d)=>{c=c.set(new tt(h),d)}),Zf(t,e,n,c,r,i,a,o)}else return e}else{let c=new lt(null);return s.foreach((h,d)=>{const f=yt(n,h);l.isCompleteForPath(f)&&(c=c.set(h,l.getNode().getChild(f)))}),Zf(t,e,n,c,r,i,a,o)}}function lM(t,e,n,s,r){const i=e.serverCache,o=Ex(e,i.getNode(),i.isFullyInitialized()||Le(n),i.isFiltered());return Px(t,o,n,s,Nx,r)}function cM(t,e,n,s,r,i){let o;if(gu(s,n)!=null)return e;{const a=new Nm(s,e,r),l=e.eventCache.getNode();let c;if(Le(n)||Fe(n)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=mu(s,ai(e));else{const d=e.serverCache.getNode();H(d instanceof be,"serverChildren would be complete if leaf node"),h=Am(s,d)}h=h,c=t.filter.updateFullNode(l,h,i)}else{const h=Fe(n);let d=Rm(s,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?c=t.filter.updateChild(l,h,d,it(n),a,i):e.eventCache.getNode().hasChild(h)?c=t.filter.updateChild(l,h,be.EMPTY_NODE,it(n),a,i):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mu(s,ai(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,i)))}return o=e.serverCache.isFullyInitialized()||gu(s,Qe())!=null,ha(e,c,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uM{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,r=new Em(s.getIndex()),i=CD(s);this.processor_=nM(i);const o=n.serverCache,a=n.eventCache,l=r.updateFullNode(be.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(be.EMPTY_NODE,a.getNode(),null),h=new mr(l,o.isFullyInitialized(),r.filtersNodes()),d=new mr(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=ch(d,h),this.eventGenerator_=new OD(this.query_)}get query(){return this.query_}}function hM(t){return t.viewCache_.serverCache.getNode()}function dM(t){return pu(t.viewCache_)}function fM(t,e){const n=ai(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Le(e)&&!n.getImmediateChild(Fe(e)).isEmpty())?n.getChild(e):null}function iw(t){return t.eventRegistrations_.length===0}function pM(t,e){t.eventRegistrations_.push(e)}function ow(t,e,n){const s=[];if(n){H(e==null,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return s}function aw(t,e,n,s){e.type===Xn.MERGE&&e.source.queryId!==null&&(H(ai(t.viewCache_),"We should always have a full cache before handling merges"),H(pu(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,i=rM(t.processor_,r,e,n,s);return sM(t.processor_,i.viewCache),H(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Dx(t,i.changes,i.viewCache.eventCache.getNode(),null)}function mM(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(ht,(i,o)=>{s.push(Zi(i,o))}),n.isFullyInitialized()&&s.push(Cx(n.getNode())),Dx(t,s,n.getNode(),e)}function Dx(t,e,n,s){const r=s?[s]:t.eventRegistrations_;return jD(t.eventGenerator_,e,n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vu;class Mx{constructor(){this.views=new Map}}function gM(t){H(!vu,"__referenceConstructor has already been defined"),vu=t}function yM(){return H(vu,"Reference.ts has not been loaded"),vu}function vM(t){return t.views.size===0}function Pm(t,e,n,s){const r=e.source.queryId;if(r!==null){const i=t.views.get(r);return H(i!=null,"SyncTree gave us an op for an invalid query."),aw(i,e,n,s)}else{let i=[];for(const o of t.views.values())i=i.concat(aw(o,e,n,s));return i}}function Ox(t,e,n,s,r){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=mu(n,r?s:null),l=!1;a?l=!0:s instanceof be?(a=Am(n,s),l=!1):(a=be.EMPTY_NODE,l=!1);const c=ch(new mr(a,l,!1),new mr(s,r,!1));return new uM(e,c)}return o}function wM(t,e,n,s,r,i){const o=Ox(t,e,s,r,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),pM(o,n),mM(o,n)}function _M(t,e,n,s){const r=e._queryIdentifier,i=[];let o=[];const a=gr(t);if(r==="default")for(const[l,c]of t.views.entries())o=o.concat(ow(c,n,s)),iw(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||i.push(c.query));else{const l=t.views.get(r);l&&(o=o.concat(ow(l,n,s)),iw(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!gr(t)&&i.push(new(yM())(e._repo,e._path)),{removed:i,events:o}}function jx(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ur(t,e){let n=null;for(const s of t.views.values())n=n||fM(s,e);return n}function Fx(t,e){if(e._queryParams.loadsAllData())return hh(t);{const s=e._queryIdentifier;return t.views.get(s)}}function Lx(t,e){return Fx(t,e)!=null}function gr(t){return hh(t)!=null}function hh(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wu;function SM(t){H(!wu,"__referenceConstructor has already been defined"),wu=t}function xM(){return H(wu,"Reference.ts has not been loaded"),wu}let bM=1;class lw{constructor(e){this.listenProvider_=e,this.syncPointTree_=new lt(null),this.pendingWriteTree_=JD(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Dm(t,e,n,s,r){return BD(t.pendingWriteTree_,e,n,s,r),r?_o(t,new oi(Tm(),e,n)):[]}function CM(t,e,n,s){UD(t.pendingWriteTree_,e,n,s);const r=lt.fromObject(n);return _o(t,new eo(Tm(),e,r))}function rr(t,e,n=!1){const s=zD(t.pendingWriteTree_,e);if(VD(t.pendingWriteTree_,e)){let i=new lt(null);return s.snap!=null?i=i.set(Qe(),!0):Ut(s.children,o=>{i=i.set(new tt(o),!0)}),_o(t,new fu(s.path,i,n))}else return[]}function dl(t,e,n){return _o(t,new oi(Im(),e,n))}function EM(t,e,n){const s=lt.fromObject(n);return _o(t,new eo(Im(),e,s))}function TM(t,e){return _o(t,new Fa(Im(),e))}function IM(t,e,n){const s=Mm(t,n);if(s){const r=Om(s),i=r.path,o=r.queryId,a=hn(i,e),l=new Fa(km(o),a);return jm(t,i,l)}else return[]}function _u(t,e,n,s,r=!1){const i=e._path,o=t.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||Lx(o,e))){const l=_M(o,e,n,s);vM(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const c=l.removed;if(a=l.events,!r){const h=c.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(i,(f,m)=>gr(m));if(h&&!d){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const m=RM(f);for(let g=0;g<m.length;++g){const y=m[g],S=y.query,T=zx(t,y);t.listenProvider_.startListening(fa(S),La(t,S),T.hashFn,T.onComplete)}}}!d&&c.length>0&&!s&&(h?t.listenProvider_.stopListening(fa(e),null):c.forEach(f=>{const m=t.queryToTagMap.get(fh(f));t.listenProvider_.stopListening(fa(f),m)}))}NM(t,c)}return a}function $x(t,e,n,s){const r=Mm(t,s);if(r!=null){const i=Om(r),o=i.path,a=i.queryId,l=hn(o,e),c=new oi(km(a),l,n);return jm(t,o,c)}else return[]}function kM(t,e,n,s){const r=Mm(t,s);if(r){const i=Om(r),o=i.path,a=i.queryId,l=hn(o,e),c=lt.fromObject(n),h=new eo(km(a),l,c);return jm(t,o,h)}else return[]}function ep(t,e,n,s=!1){const r=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(r,(f,m)=>{const g=hn(f,r);i=i||ur(m,g),o=o||gr(m)});let a=t.syncPointTree_.get(r);a?(o=o||gr(a),i=i||ur(a,Qe())):(a=new Mx,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=be.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((m,g)=>{const y=ur(g,Qe());y&&(i=i.updateImmediateChild(m,y))}));const c=Lx(a,e);if(!c&&!e._queryParams.loadsAllData()){const f=fh(e);H(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=PM();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const h=uh(t.pendingWriteTree_,r);let d=wM(a,e,n,h,i,l);if(!c&&!o&&!s){const f=Fx(a,e);d=d.concat(DM(t,e,f))}return d}function dh(t,e,n){const r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=hn(o,e),c=ur(a,l);if(c)return c});return kx(r,e,i,n,!0)}function AM(t,e){const n=e._path;let s=null;t.syncPointTree_.foreachOnPath(n,(c,h)=>{const d=hn(c,n);s=s||ur(h,d)});let r=t.syncPointTree_.get(n);r?s=s||ur(r,Qe()):(r=new Mx,t.syncPointTree_=t.syncPointTree_.set(n,r));const i=s!=null,o=i?new mr(s,!0,!1):null,a=uh(t.pendingWriteTree_,e._path),l=Ox(r,e,a,i?o.getNode():be.EMPTY_NODE,i);return dM(l)}function _o(t,e){return Bx(e,t.syncPointTree_,null,uh(t.pendingWriteTree_,Qe()))}function Bx(t,e,n,s){if(Le(t.path))return Ux(t,e,n,s);{const r=e.get(Qe());n==null&&r!=null&&(n=ur(r,Qe()));let i=[];const o=Fe(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,h=Ax(s,o);i=i.concat(Bx(a,l,c,h))}return r&&(i=i.concat(Pm(r,t,s,n))),i}}function Ux(t,e,n,s){const r=e.get(Qe());n==null&&r!=null&&(n=ur(r,Qe()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=Ax(s,o),h=t.operationForChild(o);h&&(i=i.concat(Ux(h,a,l,c)))}),r&&(i=i.concat(Pm(r,t,s,n))),i}function zx(t,e){const n=e.query,s=La(t,n);return{hashFn:()=>(hM(e)||be.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?IM(t,n._path,s):TM(t,n._path);{const i=CP(r,n);return _u(t,n,null,i)}}}}function La(t,e){const n=fh(e);return t.queryToTagMap.get(n)}function fh(t){return t._path.toString()+"$"+t._queryIdentifier}function Mm(t,e){return t.tagToQueryMap.get(e)}function Om(t){const e=t.indexOf("$");return H(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new tt(t.substr(0,e))}}function jm(t,e,n){const s=t.syncPointTree_.get(e);H(s,"Missing sync point for query tag that we're tracking");const r=uh(t.pendingWriteTree_,e);return Pm(s,n,r,null)}function RM(t){return t.fold((e,n,s)=>{if(n&&gr(n))return[hh(n)];{let r=[];return n&&(r=jx(n)),Ut(s,(i,o)=>{r=r.concat(o)}),r}})}function fa(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(xM())(t._repo,t._path):t}function NM(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const r=fh(s),i=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i)}}}function PM(){return bM++}function DM(t,e,n){const s=e._path,r=La(t,e),i=zx(t,n),o=t.listenProvider_.startListening(fa(e),r,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(s);if(r)H(!gr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,d)=>{if(!Le(c)&&h&&gr(h))return[hh(h).query];{let f=[];return h&&(f=f.concat(jx(h).map(m=>m.query))),Ut(d,(m,g)=>{f=f.concat(g)}),f}});for(let c=0;c<l.length;++c){const h=l[c];t.listenProvider_.stopListening(fa(h),La(t,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Fm(n)}node(){return this.node_}}class Lm{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=yt(this.path_,e);return new Lm(this.syncTree_,n)}node(){return dh(this.syncTree_,this.path_)}}const MM=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},cw=function(t,e,n){if(!t||typeof t!="object")return t;if(H(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return OM(t[".sv"],e,n);if(typeof t[".sv"]=="object")return jM(t[".sv"],e);H(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},OM=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:H(!1,"Unexpected server value: "+t)}},jM=function(t,e,n){t.hasOwnProperty("increment")||H(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&H(!1,"Unexpected increment value: "+s);const r=e.node();if(H(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return typeof o!="number"?s:o+s},Vx=function(t,e,n,s){return Bm(e,new Lm(n,t),s)},$m=function(t,e,n){return Bm(t,new Fm(e),n)};function Bm(t,e,n){const s=t.getPriority().val(),r=cw(s,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,a=cw(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new Ft(a,wt(r)):t}else{const o=t;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Ft(r))),o.forEachChild(ht,(a,l)=>{const c=Bm(l,e.getImmediateChild(a),n);c!==l&&(i=i.updateImmediateChild(a,c))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function ph(t,e){let n=e instanceof tt?e:new tt(e),s=t,r=Fe(n);for(;r!==null;){const i=ti(s.node.children,r)||{children:{},childCount:0};s=new Um(r,s,i),n=it(n),r=Fe(n)}return s}function gi(t){return t.node.value}function zm(t,e){t.node.value=e,tp(t)}function Wx(t){return t.node.childCount>0}function FM(t){return gi(t)===void 0&&!Wx(t)}function mh(t,e){Ut(t.node.children,(n,s)=>{e(new Um(n,t,s))})}function Hx(t,e,n,s){n&&e(t),mh(t,r=>{Hx(r,e,!0)})}function LM(t,e,n){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function fl(t){return new tt(t.parent===null?t.name:fl(t.parent)+"/"+t.name)}function tp(t){t.parent!==null&&$M(t.parent,t.name,t)}function $M(t,e,n){const s=FM(n),r=rs(t.node.children,e);s&&r?(delete t.node.children[e],t.node.childCount--,tp(t)):!s&&!r&&(t.node.children[e]=n.node,t.node.childCount++,tp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM=/[\[\].#$\/\u0000-\u001F\u007F]/,UM=/[\[\].#$\u0000-\u001F\u007F]/,Zd=10*1024*1024,gh=function(t){return typeof t=="string"&&t.length!==0&&!BM.test(t)},Gx=function(t){return typeof t=="string"&&t.length!==0&&!UM.test(t)},zM=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gx(t)},$a=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!ih(t)||t&&typeof t=="object"&&rs(t,".sv")},_s=function(t,e,n,s){s&&e===void 0||pl(ni(t,"value"),e,n)},pl=function(t,e,n){const s=n instanceof tt?new rD(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Or(s));if(typeof e=="function")throw new Error(t+"contains a function "+Or(s)+" with contents = "+e.toString());if(ih(e))throw new Error(t+"contains "+e.toString()+" "+Or(s));if(typeof e=="string"&&e.length>Zd/3&&Ju(e)>Zd)throw new Error(t+"contains a string greater than "+Zd+" utf8 bytes "+Or(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Ut(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!gh(o)))throw new Error(t+" contains an invalid key ("+o+") "+Or(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iD(s,o),pl(t,a,s),oD(s)}),r&&i)throw new Error(t+' contains ".value" child '+Or(s)+" in addition to actual children.")}},VM=function(t,e){let n,s;for(n=0;n<e.length;n++){s=e[n];const i=Da(s);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!gh(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(sD);let r=null;for(n=0;n<e.length;n++){if(s=e[n],r!==null&&Bn(r,s))throw new Error(t+"contains a path "+r.toString()+" that is ancestor of another path "+s.toString());r=s}},qx=function(t,e,n,s){const r=ni(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const i=[];Ut(e,(o,a)=>{const l=new tt(o);if(pl(r,a,yt(n,l)),wm(l)===".priority"&&!$a(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),VM(r,i)},Vm=function(t,e,n){if(ih(e))throw new Error(ni(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!$a(e))throw new Error(ni(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},ml=function(t,e,n,s){if(n!==void 0&&!gh(n))throw new Error(ni(t,e)+'was an invalid key = "'+n+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},yh=function(t,e,n,s){if(!(s&&n===void 0)&&!Gx(n))throw new Error(ni(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},WM=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),yh(t,e,n,s)},Jn=function(t,e){if(Fe(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},Kx=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!gh(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!zM(n))throw new Error(ni(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function vh(t,e){let n=null;for(let s=0;s<e.length;s++){const r=e[s],i=r.getPath();n!==null&&!_m(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(r)}n&&t.eventLists_.push(n)}function Yx(t,e,n){vh(t,n),Qx(t,s=>_m(s,e))}function Dn(t,e,n){vh(t,n),Qx(t,s=>Bn(s,e)||Bn(e,s))}function Qx(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const r=t.eventLists_[s];if(r){const i=r.path;e(i)?(GM(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function GM(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();Qr&&Bt("event: "+n.toString()),vo(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx="repo_interrupt",qM=25;class KM{constructor(e,n,s,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new HM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=du(),this.transactionQueueTree_=new Um,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function YM(t,e,n){if(t.stats_=ym(t.repoInfo_),t.forceRestClient_||kP())t.server_=new hu(t.repoInfo_,(s,r,i,o)=>{uw(t,s,r,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>hw(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Dt(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Wn(t.repoInfo_,e,(s,r,i,o)=>{uw(t,s,r,i,o)},s=>{hw(t,s)},s=>{QM(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=DP(t.repoInfo_,()=>new MD(t.stats_,t.server_)),t.infoData_=new AD,t.infoSyncTree_=new lw({startListening:(s,r,i,o)=>{let a=[];const l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=dl(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Wm(t,"connected",!1),t.serverSyncTree_=new lw({startListening:(s,r,i,o)=>(t.server_.listen(s,i,r,(a,l)=>{const c=o(a,l);Dn(t.eventQueue_,s._path,c)}),[]),stopListening:(s,r)=>{t.server_.unlisten(s,r)}})}function Jx(t){const n=t.infoData_.getNode(new tt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function gl(t){return MM({timestamp:Jx(t)})}function uw(t,e,n,s,r){t.dataUpdateCount++;const i=new tt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(s){const l=eu(n,c=>wt(c));o=kM(t.serverSyncTree_,i,l,r)}else{const l=wt(n);o=$x(t.serverSyncTree_,i,l,r)}else if(s){const l=eu(n,c=>wt(c));o=EM(t.serverSyncTree_,i,l)}else{const l=wt(n);o=dl(t.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=no(t,i)),Dn(t.eventQueue_,a,o)}function hw(t,e){Wm(t,"connected",e),e===!1&&ZM(t)}function QM(t,e){Ut(e,(n,s)=>{Wm(t,n,s)})}function Wm(t,e,n){const s=new tt("/.info/"+e),r=wt(n);t.infoData_.updateSnapshot(s,r);const i=dl(t.infoSyncTree_,s,r);Dn(t.eventQueue_,s,i)}function wh(t){return t.nextWriteId_++}function XM(t,e,n){const s=AM(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(r=>{const i=wt(r).withIndex(e._queryParams.getIndex());ep(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=dl(t.serverSyncTree_,e._path,i);else{const a=La(t.serverSyncTree_,e);o=$x(t.serverSyncTree_,e._path,i,a)}return Dn(t.eventQueue_,e._path,o),_u(t.serverSyncTree_,e,n,null,!0),i},r=>(So(t,"get for query "+Dt(e)+" failed: "+r),Promise.reject(new Error(r))))}function Hm(t,e,n,s,r){So(t,"set",{path:e.toString(),value:n,priority:s});const i=gl(t),o=wt(n,s),a=dh(t.serverSyncTree_,e),l=$m(o,a,i),c=wh(t),h=Dm(t.serverSyncTree_,e,l,c,!0);vh(t.eventQueue_,h),t.server_.put(e.toString(),o.val(!0),(f,m)=>{const g=f==="ok";g||sn("set at "+e+" failed: "+f);const y=rr(t.serverSyncTree_,c,!g);Dn(t.eventQueue_,e,y),yr(t,r,f,m)});const d=qm(t,e);no(t,d),Dn(t.eventQueue_,d,[])}function JM(t,e,n,s){So(t,"update",{path:e.toString(),value:n});let r=!0;const i=gl(t),o={};if(Ut(n,(a,l)=>{r=!1,o[a]=Vx(yt(e,a),wt(l),t.serverSyncTree_,i)}),r)Bt("update() called with empty data.  Don't do anything."),yr(t,s,"ok",void 0);else{const a=wh(t),l=CM(t.serverSyncTree_,e,o,a);vh(t.eventQueue_,l),t.server_.merge(e.toString(),n,(c,h)=>{const d=c==="ok";d||sn("update at "+e+" failed: "+c);const f=rr(t.serverSyncTree_,a,!d),m=f.length>0?no(t,e):e;Dn(t.eventQueue_,m,f),yr(t,s,c,h)}),Ut(n,c=>{const h=qm(t,yt(e,c));no(t,h)}),Dn(t.eventQueue_,e,[])}}function ZM(t){So(t,"onDisconnectEvents");const e=gl(t),n=du();Kf(t.onDisconnect_,Qe(),(r,i)=>{const o=Vx(r,i,t.serverSyncTree_,e);wo(n,r,o)});let s=[];Kf(n,Qe(),(r,i)=>{s=s.concat(dl(t.serverSyncTree_,r,i));const o=qm(t,r);no(t,o)}),t.onDisconnect_=du(),Dn(t.eventQueue_,Qe(),s)}function eO(t,e,n){t.server_.onDisconnectCancel(e.toString(),(s,r)=>{s==="ok"&&qf(t.onDisconnect_,e),yr(t,n,s,r)})}function dw(t,e,n,s){const r=wt(n);t.server_.onDisconnectPut(e.toString(),r.val(!0),(i,o)=>{i==="ok"&&wo(t.onDisconnect_,e,r),yr(t,s,i,o)})}function tO(t,e,n,s,r){const i=wt(n,s);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&wo(t.onDisconnect_,e,i),yr(t,r,o,a)})}function nO(t,e,n,s){if(Zc(n)){Bt("onDisconnect().update() called with empty data.  Don't do anything."),yr(t,s,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(r,i)=>{r==="ok"&&Ut(n,(o,a)=>{const l=wt(a);wo(t.onDisconnect_,yt(e,o),l)}),yr(t,s,r,i)})}function sO(t,e,n){let s;Fe(e._path)===".info"?s=ep(t.infoSyncTree_,e,n):s=ep(t.serverSyncTree_,e,n),Yx(t.eventQueue_,e._path,s)}function np(t,e,n){let s;Fe(e._path)===".info"?s=_u(t.infoSyncTree_,e,n):s=_u(t.serverSyncTree_,e,n),Yx(t.eventQueue_,e._path,s)}function Zx(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Xx)}function rO(t){t.persistentConnection_&&t.persistentConnection_.resume(Xx)}function So(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Bt(n,...e)}function yr(t,e,n,s){e&&vo(()=>{if(n==="ok")e(null);else{const r=(n||"error").toUpperCase();let i=r;s&&(i+=": "+s);const o=new Error(i);o.code=r,e(o)}})}function iO(t,e,n,s,r,i){So(t,"transaction on "+e);const o={path:e,update:n,onComplete:s,status:null,order:KS(),applyLocally:i,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Gm(t,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{pl("transaction failed: Data returned ",l,o.path),o.status=0;const c=ph(t.transactionQueueTree_,e),h=gi(c)||[];h.push(o),zm(c,h);let d;typeof l=="object"&&l!==null&&rs(l,".priority")?(d=ti(l,".priority"),H($a(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(dh(t.serverSyncTree_,e)||be.EMPTY_NODE).getPriority().val();const f=gl(t),m=wt(l,d),g=$m(m,a,f);o.currentOutputSnapshotRaw=m,o.currentOutputSnapshotResolved=g,o.currentWriteId=wh(t);const y=Dm(t.serverSyncTree_,e,g,o.currentWriteId,o.applyLocally);Dn(t.eventQueue_,e,y),_h(t,t.transactionQueueTree_)}}function Gm(t,e,n){return dh(t.serverSyncTree_,e,n)||be.EMPTY_NODE}function _h(t,e=t.transactionQueueTree_){if(e||Sh(t,e),gi(e)){const n=tb(t,e);H(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&oO(t,fl(e),n)}else Wx(e)&&mh(e,n=>{_h(t,n)})}function oO(t,e,n){const s=n.map(c=>c.currentWriteId),r=Gm(t,e,s);let i=r;const o=r.hash();for(let c=0;c<n.length;c++){const h=n[c];H(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=hn(e,h.path);i=i.updateChild(d,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;t.server_.put(l.toString(),a,c=>{So(t,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const d=[];for(let f=0;f<n.length;f++)n[f].status=2,h=h.concat(rr(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&d.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Sh(t,ph(t.transactionQueueTree_,e)),_h(t,t.transactionQueueTree_),Dn(t.eventQueue_,e,h);for(let f=0;f<d.length;f++)vo(d[f])}else{if(c==="datastale")for(let d=0;d<n.length;d++)n[d].status===3?n[d].status=4:n[d].status=0;else{sn("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<n.length;d++)n[d].status=4,n[d].abortReason=c}no(t,e)}},o)}function no(t,e){const n=eb(t,e),s=fl(n),r=tb(t,n);return aO(t,r,s),s}function aO(t,e,n){if(e.length===0)return;const s=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=hn(n,l.path);let h=!1,d;if(H(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,r=r.concat(rr(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=qM)h=!0,d="maxretry",r=r.concat(rr(t.serverSyncTree_,l.currentWriteId,!0));else{const f=Gm(t,l.path,o);l.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){pl("transaction failed: Data returned ",m,l.path);let g=wt(m);typeof m=="object"&&m!=null&&rs(m,".priority")||(g=g.updatePriority(f.getPriority()));const S=l.currentWriteId,T=gl(t),w=$m(g,f,T);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=w,l.currentWriteId=wh(t),o.splice(o.indexOf(S),1),r=r.concat(Dm(t.serverSyncTree_,l.path,w,l.currentWriteId,l.applyLocally)),r=r.concat(rr(t.serverSyncTree_,S,!0))}else h=!0,d="nodata",r=r.concat(rr(t.serverSyncTree_,l.currentWriteId,!0))}Dn(t.eventQueue_,n,r),r=[],h&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(d),!1,null))))}Sh(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)vo(s[a]);_h(t,t.transactionQueueTree_)}function eb(t,e){let n,s=t.transactionQueueTree_;for(n=Fe(e);n!==null&&gi(s)===void 0;)s=ph(s,n),e=it(e),n=Fe(e);return s}function tb(t,e){const n=[];return nb(t,e,n),n.sort((s,r)=>s.order-r.order),n}function nb(t,e,n){const s=gi(e);if(s)for(let r=0;r<s.length;r++)n.push(s[r]);mh(e,r=>{nb(t,r,n)})}function Sh(t,e){const n=gi(e);if(n){let s=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[s]=n[r],s++);n.length=s,zm(e,n.length>0?n:void 0)}mh(e,s=>{Sh(t,s)})}function qm(t,e){const n=fl(eb(t,e)),s=ph(t.transactionQueueTree_,e);return LM(s,r=>{ef(t,r)}),ef(t,s),Hx(s,r=>{ef(t,r)}),n}function ef(t,e){const n=gi(e);if(n){const s=[];let r=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(H(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(H(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(rr(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?zm(e,void 0):n.length=i+1,Dn(t.eventQueue_,fl(e),r);for(let o=0;o<s.length;o++)vo(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let r=n[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function cO(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):sn(`Invalid query segment '${n}' in query '${t}'`)}return e}const sp=function(t,e){const n=uO(t),s=n.namespace;n.domain==="firebase.com"&&ws(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&ws("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||wP();const r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new lx(n.host,n.secure,s,r,e,"",s!==n.subdomain),path:new tt(n.pathString)}},uO=function(t){let e="",n="",s="",r="",i="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let h=t.indexOf("/");h===-1&&(h=t.length);let d=t.indexOf("?");d===-1&&(d=t.length),e=t.substring(0,Math.min(h,d)),h<d&&(r=lO(t.substring(h,d)));const f=cO(t.substring(Math.min(t.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const m=e.slice(0,c);if(m.toLowerCase()==="localhost")n="localhost";else if(m.split(".").length<=2)n=m;else{const g=e.indexOf(".");s=e.substring(0,g).toLowerCase(),n=e.substring(g+1),i=s}"ns"in f&&(i=f.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",hO=function(){let t=0;const e=[];return function(n){const s=n===t;t=n;let r;const i=new Array(8);for(r=7;r>=0;r--)i[r]=fw.charAt(n%64),n=Math.floor(n/64);H(n===0,"Cannot push at time == 0");let o=i.join("");if(s){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=fw.charAt(e[r]);return H(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb{constructor(e,n,s,r){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Dt(this.snapshot.exportVal())}}class rb{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return H(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new Nn;return eO(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Jn("OnDisconnect.remove",this._path);const e=new Nn;return dw(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Jn("OnDisconnect.set",this._path),_s("OnDisconnect.set",e,this._path,!1);const n=new Nn;return dw(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Jn("OnDisconnect.setWithPriority",this._path),_s("OnDisconnect.setWithPriority",e,this._path,!1),Vm("OnDisconnect.setWithPriority",n);const s=new Nn;return tO(this._repo,this._path,e,n,s.wrapCallback(()=>{})),s.promise}update(e){Jn("OnDisconnect.update",this._path),qx("OnDisconnect.update",e,this._path);const n=new Nn;return nO(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e,n,s,r){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=r}get key(){return Le(this._path)?null:wm(this._path)}get ref(){return new Gn(this._repo,this._path)}get _queryIdentifier(){const e=Jv(this._queryParams),n=mm(e);return n==="{}"?"default":n}get _queryObject(){return Jv(this._queryParams)}isEqual(e){if(e=Ue(e),!(e instanceof _n))return!1;const n=this._repo===e._repo,s=_m(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+nD(this._path)}}function xh(t,e){if(t._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Er(t){let e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ms){const s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==fr)throw new Error(s);if(typeof e!="string")throw new Error(r)}if(t.hasEnd()){if(t.getIndexEndName()!==Ls)throw new Error(s);if(typeof n!="string")throw new Error(r)}}else if(t.getIndex()===ht){if(e!=null&&!$a(e)||n!=null&&!$a(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(H(t.getIndex()instanceof bm||t.getIndex()===Cm,"unknown index type."),e!=null&&typeof e=="object"||n!=null&&typeof n=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function bh(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Gn extends _n{constructor(e,n){super(e,n,new ah,!1)}get parent(){const e=yx(this._path);return e===null?null:new Gn(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class vr{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new tt(e),s=li(this.ref,e);return new vr(this._node.getChild(n),s,ht)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new vr(r,li(this.ref,s),ht)))}hasChild(e){const n=new tt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Z(t,e){return t=Ue(t),t._checkNotDeleted("ref"),e!==void 0?li(t._root,e):t._root}function dO(t,e){t=Ue(t),t._checkNotDeleted("refFromURL");const n=sp(e,t._repo.repoInfo_.nodeAdmin);Kx("refFromURL",n);const s=n.repoInfo;return!t._repo.repoInfo_.isCustomHost()&&s.host!==t._repo.repoInfo_.host&&ws("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+t._repo.repoInfo_.host+")"),Z(t,n.path.toString())}function li(t,e){return t=Ue(t),Fe(t._path)===null?WM("child","path",e,!1):yh("child","path",e,!1),new Gn(t._repo,yt(t._path,e))}function fO(t){return t=Ue(t),new ib(t._repo,t._path)}function Ch(t,e){t=Ue(t),Jn("push",t._path),_s("push",e,t._path,!0);const n=Jx(t._repo),s=hO(n),r=li(t,s),i=li(t,s);let o;return e!=null?o=Pt(i,e).then(()=>i):o=Promise.resolve(i),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function jt(t){return Jn("remove",t._path),Pt(t,null)}function Pt(t,e){t=Ue(t),Jn("set",t._path),_s("set",e,t._path,!1);const n=new Nn;return Hm(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function pO(t,e){t=Ue(t),Jn("setPriority",t._path),Vm("setPriority",e);const n=new Nn;return Hm(t._repo,yt(t._path,".priority"),e,null,n.wrapCallback(()=>{})),n.promise}function mO(t,e,n){if(Jn("setWithPriority",t._path),_s("setWithPriority",e,t._path,!1),Vm("setWithPriority",n),t.key===".length"||t.key===".keys")throw"setWithPriority failed: "+t.key+" is a read-only object.";const s=new Nn;return Hm(t._repo,t._path,e,n,s.wrapCallback(()=>{})),s.promise}function It(t,e){qx("update",e,t._path);const n=new Nn;return JM(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Ye(t){t=Ue(t);const e=new Km(()=>{}),n=new yl(e);return XM(t._repo,t,n).then(s=>new vr(s,new Gn(t._repo,t._path),t._queryParams.getIndex()))}class yl{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new sb("value",this,new vr(e.snapshotNode,new Gn(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new rb(this,e,n):null}matches(e){return e instanceof yl?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Eh{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new rb(this,e,n):null}createEvent(e,n){H(e.childName!=null,"Child events should have a childName.");const s=li(new Gn(n._repo,n._path),e.childName),r=n._queryParams.getIndex();return new sb(e.type,this,new vr(e.snapshotNode,s,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Eh?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function vl(t,e,n,s,r){let i;if(typeof s=="object"&&(i=void 0,r=s),typeof s=="function"&&(i=s),r&&r.onlyOnce){const l=n,c=(h,d)=>{np(t._repo,t,a),l(h,d)};c.userCallback=n.userCallback,c.context=n.context,n=c}const o=new Km(n,i||void 0),a=e==="value"?new yl(o):new Eh(e,o);return sO(t._repo,t,a),()=>np(t._repo,t,a)}function Un(t,e,n,s){return vl(t,"value",e,n,s)}function gO(t,e,n,s){return vl(t,"child_added",e,n,s)}function yO(t,e,n,s){return vl(t,"child_changed",e,n,s)}function vO(t,e,n,s){return vl(t,"child_moved",e,n,s)}function wO(t,e,n,s){return vl(t,"child_removed",e,n,s)}function Ym(t,e,n){let s=null;const r=n?new Km(n):null;e==="value"?s=new yl(r):e&&(s=new Eh(e,r)),np(t._repo,t,s)}class qn{}class ob extends qn{constructor(e,n){super(),this._value=e,this._key=n}_apply(e){_s("endAt",this._value,e._path,!0);const n=Gf(e._queryParams,this._value,this._key);if(bh(n),Er(n),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _n(e._repo,e._path,n,e._orderByCalled)}}function _O(t,e){return ml("endAt","key",e),new ob(t,e)}class SO extends qn{constructor(e,n){super(),this._value=e,this._key=n}_apply(e){_s("endBefore",this._value,e._path,!1);const n=kD(e._queryParams,this._value,this._key);if(bh(n),Er(n),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new _n(e._repo,e._path,n,e._orderByCalled)}}function xO(t,e){return ml("endBefore","key",e),new SO(t,e)}class ab extends qn{constructor(e,n){super(),this._value=e,this._key=n}_apply(e){_s("startAt",this._value,e._path,!0);const n=Hf(e._queryParams,this._value,this._key);if(bh(n),Er(n),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new _n(e._repo,e._path,n,e._orderByCalled)}}function bO(t=null,e){return ml("startAt","key",e),new ab(t,e)}class CO extends qn{constructor(e,n){super(),this._value=e,this._key=n}_apply(e){_s("startAfter",this._value,e._path,!1);const n=ID(e._queryParams,this._value,this._key);if(bh(n),Er(n),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new _n(e._repo,e._path,n,e._orderByCalled)}}function EO(t,e){return ml("startAfter","key",e),new CO(t,e)}class TO extends qn{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new _n(e._repo,e._path,ED(e._queryParams,this._limit),e._orderByCalled)}}function IO(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new TO(t)}class kO extends qn{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new _n(e._repo,e._path,TD(e._queryParams,this._limit),e._orderByCalled)}}function Th(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new kO(t)}class AO extends qn{constructor(e){super(),this._path=e}_apply(e){xh(e,"orderByChild");const n=new tt(this._path);if(Le(n))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const s=new bm(n),r=lh(e._queryParams,s);return Er(r),new _n(e._repo,e._path,r,!0)}}function RO(t){if(t==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(t==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(t==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return yh("orderByChild","path",t,!1),new AO(t)}class NO extends qn{_apply(e){xh(e,"orderByKey");const n=lh(e._queryParams,ms);return Er(n),new _n(e._repo,e._path,n,!0)}}function PO(){return new NO}class DO extends qn{_apply(e){xh(e,"orderByPriority");const n=lh(e._queryParams,ht);return Er(n),new _n(e._repo,e._path,n,!0)}}function MO(){return new DO}class OO extends qn{_apply(e){xh(e,"orderByValue");const n=lh(e._queryParams,Cm);return Er(n),new _n(e._repo,e._path,n,!0)}}function jO(){return new OO}class FO extends qn{constructor(e,n){super(),this._value=e,this._key=n}_apply(e){if(_s("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ob(this._value,this._key)._apply(new ab(this._value,this._key)._apply(e))}}function LO(t,e){return ml("equalTo","key",e),new FO(t,e)}function Ih(t,...e){let n=Ue(t);for(const s of e)n=s._apply(n);return n}gM(Gn);SM(Gn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $O="FIREBASE_DATABASE_EMULATOR_HOST",rp={};let lb=!1;function BO(t,e,n,s){t.repoInfo_=new lx(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function cb(t,e,n,s,r){let i=s||t.options.databaseURL;i===void 0&&(t.options.projectId||ws("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Bt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=sp(i,r),a=o.repoInfo,l,c;typeof process<"u"&&Mv&&(c=Mv[$O]),c?(l=!0,i=`http://${c}?ns=${a.namespace}`,o=sp(i,r),a=o.repoInfo):l=!o.repoInfo.secure;const h=r&&l?new Vi(Vi.OWNER):new RP(t.name,t.options,e);Kx("Invalid Firebase Database URL",o),Le(o.path)||ws("Database URL must point to the root of a Firebase Database (not including a child path).");const d=zO(a,t,h,new AP(t.name,n));return new ub(d,t)}function UO(t,e){const n=rp[e];(!n||n[t.key]!==t)&&ws(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Zx(t),delete n[t.key]}function zO(t,e,n,s){let r=rp[e.name];r||(r={},rp[e.name]=r);let i=r[t.toURLString()];return i&&ws("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new KM(t,lb,n,s),r[t.toURLString()]=i,i}function VO(t){lb=t}class ub{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(YM(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Gn(this._repo,Qe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(UO(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ws("Cannot call "+e+" on a deleted database.")}}function hb(){Ji.IS_TRANSPORT_INITIALIZED&&sn("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function WO(){hb(),sr.forceDisallow()}function HO(){hb(),Fn.forceDisallow(),sr.forceAllow()}function db(t=rl(),e){const n=sl(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const s=sm("database");s&&fb(n,...s)}return n}function fb(t,e,n,s={}){t=Ue(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&ws("Cannot call useEmulator() after instance has already been initialized.");const r=t._repoInternal;let i;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&ws('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new Vi(Vi.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:J0(s.mockUserToken,t.app.options.projectId);i=new Vi(o)}BO(r,e,n,i)}function GO(t){t=Ue(t),t._checkNotDeleted("goOffline"),Zx(t._repo)}function qO(t){t=Ue(t),t._checkNotDeleted("goOnline"),rO(t._repo)}function KO(t,e){QS(t,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YO(t){GS(fi),dr(new js("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return cb(s,r,i,n)},"PUBLIC").setMultipleInstances(!0)),Vn(Ov,jv,t),Vn(Ov,jv,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO={".sv":"timestamp"};function XO(){return QO}function JO(t){return{".sv":{increment:t}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function pa(t,e,n){var s;if(t=Ue(t),Jn("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=(s=n==null?void 0:n.applyLocally)!==null&&s!==void 0?s:!0,i=new Nn,o=(l,c,h)=>{let d=null;l?i.reject(l):(d=new vr(h,new Gn(t._repo,t._path),ht),i.resolve(new pb(c,d)))},a=Un(t,()=>{});return iO(t._repo,t._path,e,o,a,r),i.promise}Wn.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Wn.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};const ZO=function(t){const e=Wn.prototype.put;return Wn.prototype.put=function(n,s,r,i){i!==void 0&&(i=t()),e.call(this,n,s,r,i)},function(){Wn.prototype.put=e}},ej=function(t){VO(t)};YO();const $s=Object.freeze(Object.defineProperty({__proto__:null,DataSnapshot:vr,Database:ub,OnDisconnect:ib,QueryConstraint:qn,TransactionResult:pb,_QueryImpl:_n,_QueryParams:ah,_ReferenceImpl:Gn,_TEST_ACCESS_forceRestClient:ej,_TEST_ACCESS_hijackHash:ZO,_repoManagerDatabaseFromApp:cb,_setSDKVersion:GS,_validatePathString:yh,_validateWritablePath:Jn,child:li,connectDatabaseEmulator:fb,enableLogging:KO,endAt:_O,endBefore:xO,equalTo:LO,forceLongPolling:HO,forceWebSockets:WO,get:Ye,getDatabase:db,goOffline:GO,goOnline:qO,increment:JO,limitToFirst:IO,limitToLast:Th,off:Ym,onChildAdded:gO,onChildChanged:yO,onChildMoved:vO,onChildRemoved:wO,onDisconnect:fO,onValue:Un,orderByChild:RO,orderByKey:PO,orderByPriority:MO,orderByValue:jO,push:Ch,query:Ih,ref:Z,refFromURL:dO,remove:jt,runTransaction:pa,serverTimestamp:XO,set:Pt,setPriority:pO,setWithPriority:mO,startAfter:EO,startAt:bO,update:It},Symbol.toStringTag,{value:"Module"}));var tj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ee,Qm=Qm||{},Ae=tj||self;function kh(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Ah(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function nj(t,e,n){return t.call.apply(t.bind,arguments)}function sj(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,s),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function rn(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?rn=nj:rn=sj,rn.apply(null,arguments)}function nc(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var s=n.slice();return s.push.apply(s,arguments),t.apply(this,s)}}function Vt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(s,r,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(s,o)}}function Tr(){this.s=this.s,this.o=this.o}var rj=0;Tr.prototype.s=!1;Tr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),rj!=0)};Tr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const mb=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Xm(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function pw(t,e){for(let n=1;n<arguments.length;n++){const s=arguments[n];if(kh(s)){const r=t.length||0,i=s.length||0;t.length=r+i;for(let o=0;o<i;o++)t[r+o]=s[o]}else t.push(s)}}function on(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}on.prototype.h=function(){this.defaultPrevented=!0};var ij=function(){if(!Ae.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Ae.addEventListener("test",()=>{},e),Ae.removeEventListener("test",()=>{},e)}catch{}return t}();function Ba(t){return/^[\s\xa0]*$/.test(t)}function Rh(){var t=Ae.navigator;return t&&(t=t.userAgent)?t:""}function us(t){return Rh().indexOf(t)!=-1}function Jm(t){return Jm[" "](t),t}Jm[" "]=function(){};function oj(t,e){var n=Zj;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var aj=us("Opera"),so=us("Trident")||us("MSIE"),gb=us("Edge"),ip=gb||so,yb=us("Gecko")&&!(Rh().toLowerCase().indexOf("webkit")!=-1&&!us("Edge"))&&!(us("Trident")||us("MSIE"))&&!us("Edge"),lj=Rh().toLowerCase().indexOf("webkit")!=-1&&!us("Edge");function vb(){var t=Ae.document;return t?t.documentMode:void 0}var op;e:{var tf="",nf=function(){var t=Rh();if(yb)return/rv:([^\);]+)(\)|;)/.exec(t);if(gb)return/Edge\/([\d\.]+)/.exec(t);if(so)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(lj)return/WebKit\/(\S+)/.exec(t);if(aj)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(nf&&(tf=nf?nf[1]:""),so){var sf=vb();if(sf!=null&&sf>parseFloat(tf)){op=String(sf);break e}}op=tf}var ap;if(Ae.document&&so){var mw=vb();ap=mw||parseInt(op,10)||void 0}else ap=void 0;var cj=ap;function Ua(t,e){if(on.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(yb){e:{try{Jm(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:uj[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ua.$.h.call(this)}}Vt(Ua,on);var uj={2:"touch",3:"pen",4:"mouse"};Ua.prototype.h=function(){Ua.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Nh="closure_listenable_"+(1e6*Math.random()|0),hj=0;function dj(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.la=r,this.key=++hj,this.fa=this.ia=!1}function Ph(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Zm(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function fj(t,e){for(const n in t)e.call(void 0,t[n],n,t)}function wb(t){const e={};for(const n in t)e[n]=t[n];return e}const gw="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _b(t,e){let n,s;for(let r=1;r<arguments.length;r++){s=arguments[r];for(n in s)t[n]=s[n];for(let i=0;i<gw.length;i++)n=gw[i],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Dh(t){this.src=t,this.g={},this.h=0}Dh.prototype.add=function(t,e,n,s,r){var i=t.toString();t=this.g[i],t||(t=this.g[i]=[],this.h++);var o=cp(t,e,s,r);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new dj(e,this.src,i,!!s,r),e.ia=n,t.push(e)),e};function lp(t,e){var n=e.type;if(n in t.g){var s=t.g[n],r=mb(s,e),i;(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Ph(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function cp(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==s)return r}return-1}var eg="closure_lm_"+(1e6*Math.random()|0),rf={};function Sb(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Sb(t,e[i],n,s,r);return null}return n=Cb(n),t&&t[Nh]?t.O(e,n,Ah(s)?!!s.capture:!1,r):pj(t,e,n,!1,s,r)}function pj(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=Ah(r)?!!r.capture:!!r,a=ng(t);if(a||(t[eg]=a=new Dh(t)),n=a.add(e,n,s,o,i),n.proxy)return n;if(s=mj(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)ij||(r=o),r===void 0&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(bb(e.toString()),s);else if(t.addListener&&t.removeListener)t.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return n}function mj(){function t(n){return e.call(t.src,t.listener,n)}const e=gj;return t}function xb(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)xb(t,e[i],n,s,r);else s=Ah(s)?!!s.capture:!!s,n=Cb(n),t&&t[Nh]?(t=t.i,e=String(e).toString(),e in t.g&&(i=t.g[e],n=cp(i,n,s,r),-1<n&&(Ph(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete t.g[e],t.h--)))):t&&(t=ng(t))&&(e=t.g[e.toString()],t=-1,e&&(t=cp(e,n,s,r)),(n=-1<t?e[t]:null)&&tg(n))}function tg(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[Nh])lp(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(bb(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=ng(e))?(lp(n,t),n.h==0&&(n.src=null,e[eg]=null)):Ph(t)}}}function bb(t){return t in rf?rf[t]:rf[t]="on"+t}function gj(t,e){if(t.fa)t=!0;else{e=new Ua(e,this);var n=t.listener,s=t.la||t.src;t.ia&&tg(t),t=n.call(s,e)}return t}function ng(t){return t=t[eg],t instanceof Dh?t:null}var of="__closure_events_fn_"+(1e9*Math.random()>>>0);function Cb(t){return typeof t=="function"?t:(t[of]||(t[of]=function(e){return t.handleEvent(e)}),t[of])}function zt(){Tr.call(this),this.i=new Dh(this),this.S=this,this.J=null}Vt(zt,Tr);zt.prototype[Nh]=!0;zt.prototype.removeEventListener=function(t,e,n,s){xb(this,t,e,n,s)};function Yt(t,e){var n,s=t.J;if(s)for(n=[];s;s=s.J)n.push(s);if(t=t.S,s=e.type||e,typeof e=="string")e=new on(e,t);else if(e instanceof on)e.target=e.target||t;else{var r=e;e=new on(s,t),_b(e,r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=sc(o,s,!0,e)&&r}if(o=e.g=t,r=sc(o,s,!0,e)&&r,r=sc(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)o=e.g=n[i],r=sc(o,s,!1,e)&&r}zt.prototype.N=function(){if(zt.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)Ph(n[s]);delete t.g[e],t.h--}}this.J=null};zt.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)};zt.prototype.P=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};function sc(t,e,n,s){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&lp(t.i,o),r=a.call(l,s)!==!1&&r}}return r&&!s.defaultPrevented}var sg=Ae.JSON.stringify;class yj{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function vj(){var t=rg;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class wj{constructor(){this.h=this.g=null}add(e,n){const s=Eb.get();s.set(e,n),this.h?this.h.next=s:this.g=s,this.h=s}}var Eb=new yj(()=>new _j,t=>t.reset());class _j{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function Sj(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function xj(t){Ae.setTimeout(()=>{throw t},0)}let za,Va=!1,rg=new wj,Tb=()=>{const t=Ae.Promise.resolve(void 0);za=()=>{t.then(bj)}};var bj=()=>{for(var t;t=vj();){try{t.h.call(t.g)}catch(n){xj(n)}var e=Eb;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Va=!1};function Mh(t,e){zt.call(this),this.h=t||1,this.g=e||Ae,this.j=rn(this.qb,this),this.l=Date.now()}Vt(Mh,zt);ee=Mh.prototype;ee.ga=!1;ee.T=null;ee.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Yt(this,"tick"),this.ga&&(ig(this),this.start()))}};ee.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ig(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}ee.N=function(){Mh.$.N.call(this),ig(this),delete this.g};function og(t,e,n){if(typeof t=="function")n&&(t=rn(t,n));else if(t&&typeof t.handleEvent=="function")t=rn(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Ae.setTimeout(t,e||0)}function Ib(t){t.g=og(()=>{t.g=null,t.i&&(t.i=!1,Ib(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class Cj extends Tr{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ib(this)}N(){super.N(),this.g&&(Ae.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wa(t){Tr.call(this),this.h=t,this.g={}}Vt(Wa,Tr);var yw=[];function kb(t,e,n,s){Array.isArray(n)||(n&&(yw[0]=n.toString()),n=yw);for(var r=0;r<n.length;r++){var i=Sb(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Ab(t){Zm(t.g,function(e,n){this.g.hasOwnProperty(n)&&tg(e)},t),t.g={}}Wa.prototype.N=function(){Wa.$.N.call(this),Ab(this)};Wa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Oh(){this.g=!0}Oh.prototype.Ea=function(){this.g=!1};function Ej(t,e,n,s,r,i){t.info(function(){if(t.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var h=c[0];c=c[1];var d=h.split("_");o=2<=d.length&&d[1]=="type"?o+(h+"="+c+"&"):o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+`
`+n+`
`+o})}function Tj(t,e,n,s,r,i,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+`
`+n+`
`+i+" "+o})}function Oi(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+kj(t,n)+(s?" "+s:"")})}function Ij(t,e){t.info(function(){return"TIMEOUT: "+e})}Oh.prototype.info=function(){};function kj(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return sg(n)}catch{return e}}var yi={},vw=null;function jh(){return vw=vw||new zt}yi.Ta="serverreachability";function Rb(t){on.call(this,yi.Ta,t)}Vt(Rb,on);function Ha(t){const e=jh();Yt(e,new Rb(e))}yi.STAT_EVENT="statevent";function Nb(t,e){on.call(this,yi.STAT_EVENT,t),this.stat=e}Vt(Nb,on);function dn(t){const e=jh();Yt(e,new Nb(e,t))}yi.Ua="timingevent";function Pb(t,e){on.call(this,yi.Ua,t),this.size=e}Vt(Pb,on);function wl(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return Ae.setTimeout(function(){t()},e)}var Fh={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Db={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ag(){}ag.prototype.h=null;function ww(t){return t.h||(t.h=t.i())}function Mb(){}var _l={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function lg(){on.call(this,"d")}Vt(lg,on);function cg(){on.call(this,"c")}Vt(cg,on);var up;function Lh(){}Vt(Lh,ag);Lh.prototype.g=function(){return new XMLHttpRequest};Lh.prototype.i=function(){return{}};up=new Lh;function Sl(t,e,n,s){this.l=t,this.j=e,this.m=n,this.W=s||1,this.U=new Wa(this),this.P=Aj,t=ip?125:void 0,this.V=new Mh(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ob}function Ob(){this.i=null,this.g="",this.h=!1}var Aj=45e3,hp={},Su={};ee=Sl.prototype;ee.setTimeout=function(t){this.P=t};function dp(t,e,n){t.L=1,t.v=Bh(Bs(e)),t.s=n,t.S=!0,jb(t,null)}function jb(t,e){t.G=Date.now(),xl(t),t.A=Bs(t.v);var n=t.A,s=t.W;Array.isArray(s)||(s=[String(s)]),Wb(n.i,"t",s),t.C=0,n=t.l.J,t.h=new Ob,t.g=hC(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Cj(rn(t.Pa,t,t.g),t.O)),kb(t.U,t.g,"readystatechange",t.nb),e=t.I?wb(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Ha(),Ej(t.j,t.u,t.A,t.m,t.W,t.s)}ee.nb=function(t){t=t.target;const e=this.M;e&&hs(t)==3?e.l():this.Pa(t)};ee.Pa=function(t){try{if(t==this.g)e:{const h=hs(this.g);var e=this.g.Ia();const d=this.g.da();if(!(3>h)&&(h!=3||ip||this.g&&(this.h.h||this.g.ja()||bw(this.g)))){this.J||h!=4||e==7||(e==8||0>=d?Ha(3):Ha(2)),$h(this);var n=this.g.da();this.ca=n;t:if(Fb(this)){var s=bw(this.g);t="";var r=s.length,i=hs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Hr(this),ma(this);var o="";break t}this.h.i=new Ae.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Tj(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ba(a)){var c=a;break t}}c=null}if(n=c)Oi(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fp(this,n);else{this.i=!1,this.o=3,dn(12),Hr(this),ma(this);break e}}this.S?(Lb(this,h,o),ip&&this.i&&h==3&&(kb(this.U,this.V,"tick",this.mb),this.V.start())):(Oi(this.j,this.m,o,null),fp(this,o)),h==4&&Hr(this),this.i&&!this.J&&(h==4?aC(this.l,this):(this.i=!1,xl(this)))}else Qj(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.o=3,dn(12)):(this.o=0,dn(13)),Hr(this),ma(this)}}}catch{}finally{}};function Fb(t){return t.g?t.u=="GET"&&t.L!=2&&t.l.Ha:!1}function Lb(t,e,n){let s=!0,r;for(;!t.J&&t.C<n.length;)if(r=Rj(t,n),r==Su){e==4&&(t.o=4,dn(14),s=!1),Oi(t.j,t.m,null,"[Incomplete Response]");break}else if(r==hp){t.o=4,dn(15),Oi(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}else Oi(t.j,t.m,r,null),fp(t,r);Fb(t)&&r!=Su&&r!=hp&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,dn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),mg(e),e.M=!0,dn(11))):(Oi(t.j,t.m,n,"[Invalid Chunked Response]"),Hr(t),ma(t))}ee.mb=function(){if(this.g){var t=hs(this.g),e=this.g.ja();this.C<e.length&&($h(this),Lb(this,t,e),this.i&&t!=4&&xl(this))}};function Rj(t,e){var n=t.C,s=e.indexOf(`
`,n);return s==-1?Su:(n=Number(e.substring(n,s)),isNaN(n)?hp:(s+=1,s+n>e.length?Su:(e=e.slice(s,s+n),t.C=s+n,e)))}ee.cancel=function(){this.J=!0,Hr(this)};function xl(t){t.Y=Date.now()+t.P,$b(t,t.P)}function $b(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=wl(rn(t.lb,t),e)}function $h(t){t.B&&(Ae.clearTimeout(t.B),t.B=null)}ee.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(Ij(this.j,this.A),this.L!=2&&(Ha(),dn(17)),Hr(this),this.o=2,ma(this)):$b(this,this.Y-t)};function ma(t){t.l.H==0||t.J||aC(t.l,t)}function Hr(t){$h(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,ig(t.V),Ab(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function fp(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||pp(n.i,t))){if(!t.K&&pp(n.i,t)&&n.H==3){try{var s=n.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var r=s;if(r[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Cu(n),Vh(n);else break e;pg(n),dn(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&n.A==0&&!n.v&&(n.v=wl(rn(n.ib,n),6e3));if(1>=qb(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Gr(n,11)}else if((t.K||n.g==t)&&Cu(n),!Ba(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];const h=c[3];h!=null&&(n.ra=h,n.l.info("VER="+n.ra));const d=c[4];d!=null&&(n.Ga=d,n.l.info("SVER="+n.Ga));const f=c[5];f!=null&&typeof f=="number"&&0<f&&(s=1.5*f,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;const m=t.g;if(m){const g=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var i=s.i;i.g||g.indexOf("spdy")==-1&&g.indexOf("quic")==-1&&g.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(ug(i,i.h),i.h=null))}if(s.F){const y=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;y&&(s.Da=y,pt(s.I,s.F,y))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),s=n;var o=t;if(s.wa=uC(s,s.J?s.pa:null,s.Y),o.K){Kb(s.i,o);var a=o,l=s.L;l&&a.setTimeout(l),a.B&&($h(a),xl(a)),s.g=o}else iC(s);0<n.j.length&&Wh(n)}else c[0]!="stop"&&c[0]!="close"||Gr(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Gr(n,7):fg(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}Ha(4)}catch{}}function Nj(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(kh(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}e=[],n=0;for(s in t)e[n++]=t[s];return e}function Pj(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(kh(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}function Bb(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(kh(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Pj(t),s=Nj(t),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}var Ub=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Dj(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Xr(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Xr){this.h=t.h,xu(this,t.j),this.s=t.s,this.g=t.g,bu(this,t.m),this.l=t.l;var e=t.i,n=new Ga;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),_w(this,n),this.o=t.o}else t&&(e=String(t).match(Ub))?(this.h=!1,xu(this,e[1]||"",!0),this.s=Zo(e[2]||""),this.g=Zo(e[3]||"",!0),bu(this,e[4]),this.l=Zo(e[5]||"",!0),_w(this,e[6]||"",!0),this.o=Zo(e[7]||"")):(this.h=!1,this.i=new Ga(null,this.h))}Xr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ea(e,Sw,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(ea(e,Sw,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(ea(n,n.charAt(0)=="/"?jj:Oj,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ea(n,Lj)),t.join("")};function Bs(t){return new Xr(t)}function xu(t,e,n){t.j=n?Zo(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function bu(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function _w(t,e,n){e instanceof Ga?(t.i=e,$j(t.i,t.h)):(n||(e=ea(e,Fj)),t.i=new Ga(e,t.h))}function pt(t,e,n){t.i.set(e,n)}function Bh(t){return pt(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Zo(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ea(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,Mj),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Mj(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Sw=/[#\/\?@]/g,Oj=/[#\?:]/g,jj=/[#\?]/g,Fj=/[#\?@]/g,Lj=/#/g;function Ga(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ir(t){t.g||(t.g=new Map,t.h=0,t.i&&Dj(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}ee=Ga.prototype;ee.add=function(t,e){Ir(this),this.i=null,t=xo(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function zb(t,e){Ir(t),e=xo(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Vb(t,e){return Ir(t),e=xo(t,e),t.g.has(e)}ee.forEach=function(t,e){Ir(this),this.g.forEach(function(n,s){n.forEach(function(r){t.call(e,r,s,this)},this)},this)};ee.ta=function(){Ir(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const r=t[s];for(let i=0;i<r.length;i++)n.push(e[s])}return n};ee.Z=function(t){Ir(this);let e=[];if(typeof t=="string")Vb(this,t)&&(e=e.concat(this.g.get(xo(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};ee.set=function(t,e){return Ir(this),this.i=null,t=xo(this,t),Vb(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};ee.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function Wb(t,e,n){zb(t,e),0<n.length&&(t.i=null,t.g.set(xo(t,e),Xm(n)),t.h+=n.length)}ee.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;o[s]!==""&&(r+="="+encodeURIComponent(String(o[s]))),t.push(r)}}return this.i=t.join("&")};function xo(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function $j(t,e){e&&!t.j&&(Ir(t),t.i=null,t.g.forEach(function(n,s){var r=s.toLowerCase();s!=r&&(zb(this,s),Wb(this,r,n))},t)),t.j=e}var Bj=class{constructor(t,e){this.g=t,this.map=e}};function Hb(t){this.l=t||Uj,Ae.PerformanceNavigationTiming?(t=Ae.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(Ae.g&&Ae.g.Ka&&Ae.g.Ka()&&Ae.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Uj=10;function Gb(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function qb(t){return t.h?1:t.g?t.g.size:0}function pp(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function ug(t,e){t.g?t.g.add(e):t.h=e}function Kb(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}Hb.prototype.cancel=function(){if(this.i=Yb(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function Yb(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Xm(t.i)}var zj=class{stringify(t){return Ae.JSON.stringify(t,void 0)}parse(t){return Ae.JSON.parse(t,void 0)}};function Vj(){this.g=new zj}function Wj(t,e,n){const s=n||"";try{Bb(t,function(r,i){let o=r;Ah(r)&&(o=sg(r)),e.push(s+i+"="+encodeURIComponent(o))})}catch(r){throw e.push(s+"type="+encodeURIComponent("_badmap")),r}}function Hj(t,e){const n=new Oh;if(Ae.Image){const s=new Image;s.onload=nc(rc,n,s,"TestLoadImage: loaded",!0,e),s.onerror=nc(rc,n,s,"TestLoadImage: error",!1,e),s.onabort=nc(rc,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=nc(rc,n,s,"TestLoadImage: timeout",!1,e),Ae.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}function rc(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch{}}function bl(t){this.l=t.fc||null,this.j=t.ob||!1}Vt(bl,ag);bl.prototype.g=function(){return new Uh(this.l,this.j)};bl.prototype.i=function(t){return function(){return t}}({});function Uh(t,e){zt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=hg,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vt(Uh,zt);var hg=0;ee=Uh.prototype;ee.open=function(t,e){if(this.readyState!=hg)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,qa(this)};ee.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Ae).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};ee.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Cl(this)),this.readyState=hg};ee.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,qa(this)),this.g&&(this.readyState=3,qa(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Ae.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Qb(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function Qb(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}ee.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Cl(this):qa(this),this.readyState==3&&Qb(this)}};ee.Za=function(t){this.g&&(this.response=this.responseText=t,Cl(this))};ee.Ya=function(t){this.g&&(this.response=t,Cl(this))};ee.ka=function(){this.g&&Cl(this)};function Cl(t){t.readyState=4,t.l=null,t.j=null,t.A=null,qa(t)}ee.setRequestHeader=function(t,e){this.v.append(t,e)};ee.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};ee.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function qa(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Uh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Gj=Ae.JSON.parse;function Ct(t){zt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Xb,this.L=this.M=!1}Vt(Ct,zt);var Xb="",qj=/^https?$/i,Kj=["POST","PUT"];ee=Ct.prototype;ee.Oa=function(t){this.M=t};ee.ha=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():up.g(),this.C=this.u?ww(this.u):ww(up),this.g.onreadystatechange=rn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(i){xw(this,i);return}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else if(typeof s.keys=="function"&&typeof s.get=="function")for(const i of s.keys())n.set(i,s.get(i));else throw Error("Unknown input type for opt_headers: "+String(s));s=Array.from(n.keys()).find(i=>i.toLowerCase()=="content-type"),r=Ae.FormData&&t instanceof Ae.FormData,!(0<=mb(Kj,e))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{eC(this),0<this.B&&((this.L=Yj(this.g))?(this.g.timeout=this.B,this.g.ontimeout=rn(this.ua,this)):this.A=og(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){xw(this,i)}};function Yj(t){return so&&typeof t.timeout=="number"&&t.ontimeout!==void 0}ee.ua=function(){typeof Qm<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Yt(this,"timeout"),this.abort(8))};function xw(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Jb(t),zh(t)}function Jb(t){t.F||(t.F=!0,Yt(t,"complete"),Yt(t,"error"))}ee.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Yt(this,"complete"),Yt(this,"abort"),zh(this))};ee.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zh(this,!0)),Ct.$.N.call(this)};ee.La=function(){this.s||(this.G||this.v||this.l?Zb(this):this.kb())};ee.kb=function(){Zb(this)};function Zb(t){if(t.h&&typeof Qm<"u"&&(!t.C[1]||hs(t)!=4||t.da()!=2)){if(t.v&&hs(t)==4)og(t.La,0,t);else if(Yt(t,"readystatechange"),hs(t)==4){t.h=!1;try{const o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var s;if(s=o===0){var r=String(t.I).match(Ub)[1]||null;!r&&Ae.self&&Ae.self.location&&(r=Ae.self.location.protocol.slice(0,-1)),s=!qj.test(r?r.toLowerCase():"")}n=s}if(n)Yt(t,"complete"),Yt(t,"success");else{t.m=6;try{var i=2<hs(t)?t.g.statusText:""}catch{i=""}t.j=i+" ["+t.da()+"]",Jb(t)}}finally{zh(t)}}}}function zh(t,e){if(t.g){eC(t);const n=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Yt(t,"ready");try{n.onreadystatechange=s}catch{}}}function eC(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Ae.clearTimeout(t.A),t.A=null)}ee.isActive=function(){return!!this.g};function hs(t){return t.g?t.g.readyState:0}ee.da=function(){try{return 2<hs(this)?this.g.status:-1}catch{return-1}};ee.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};ee.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Gj(e)}};function bw(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Xb:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function Qj(t){const e={};t=(t.g&&2<=hs(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let s=0;s<t.length;s++){if(Ba(t[s]))continue;var n=Sj(t[s]);const r=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();const i=e[r]||[];e[r]=i,i.push(n)}fj(e,function(s){return s.join(", ")})}ee.Ia=function(){return this.m};ee.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function tC(t){let e="";return Zm(t,function(n,s){e+=s,e+=":",e+=n,e+=`\r
`}),e}function dg(t,e,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=tC(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):pt(t,e,n))}function Ho(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function nC(t){this.Ga=0,this.j=[],this.l=new Oh,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Ho("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Ho("baseRetryDelayMs",5e3,t),this.hb=Ho("retryDelaySeedMs",1e4,t),this.eb=Ho("forwardChannelMaxRetries",2,t),this.xa=Ho("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Hb(t&&t.concurrentRequestLimit),this.Ja=new Vj,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}ee=nC.prototype;ee.ra=8;ee.H=1;function fg(t){if(sC(t),t.H==3){var e=t.W++,n=Bs(t.I);if(pt(n,"SID",t.K),pt(n,"RID",e),pt(n,"TYPE","terminate"),El(t,n),e=new Sl(t,t.l,e),e.L=2,e.v=Bh(Bs(n)),n=!1,Ae.navigator&&Ae.navigator.sendBeacon)try{n=Ae.navigator.sendBeacon(e.v.toString(),"")}catch{}!n&&Ae.Image&&(new Image().src=e.v,n=!0),n||(e.g=hC(e.l,null),e.g.ha(e.v)),e.G=Date.now(),xl(e)}cC(t)}function Vh(t){t.g&&(mg(t),t.g.cancel(),t.g=null)}function sC(t){Vh(t),t.u&&(Ae.clearTimeout(t.u),t.u=null),Cu(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&Ae.clearTimeout(t.m),t.m=null)}function Wh(t){if(!Gb(t.i)&&!t.m){t.m=!0;var e=t.Na;za||Tb(),Va||(za(),Va=!0),rg.add(e,t),t.C=0}}function Xj(t,e){return qb(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=wl(rn(t.Na,t,e),lC(t,t.C)),t.C++,!0)}ee.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new Sl(this,this.l,t);let i=this.s;if(this.U&&(i?(i=wb(i),_b(i,this.U)):i=this.U),this.o!==null||this.O||(r.I=i,i=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var s=this.j[n];if("__data__"in s.map&&(s=s.map.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=rC(this,r,e),n=Bs(this.I),pt(n,"RID",t),pt(n,"CVER",22),this.F&&pt(n,"X-HTTP-Session-Id",this.F),El(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(tC(i)))+"&"+e:this.o&&dg(n,this.o,i)),ug(this.i,r),this.bb&&pt(n,"TYPE","init"),this.P?(pt(n,"$req",e),pt(n,"SID","null"),r.aa=!0,dp(r,n,null)):dp(r,n,e),this.H=2}}else this.H==3&&(t?Cw(this,t):this.j.length==0||Gb(this.i)||Cw(this))};function Cw(t,e){var n;e?n=e.m:n=t.W++;const s=Bs(t.I);pt(s,"SID",t.K),pt(s,"RID",n),pt(s,"AID",t.V),El(t,s),t.o&&t.s&&dg(s,t.o,t.s),n=new Sl(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=rC(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),ug(t.i,n),dp(n,s,e)}function El(t,e){t.na&&Zm(t.na,function(n,s){pt(e,s,n)}),t.h&&Bb({},function(n,s){pt(e,s,n)})}function rC(t,e,n){n=Math.min(t.j.length,n);var s=t.h?rn(t.h.Va,t.h,t):null;e:{var r=t.j;let i=-1;for(;;){const o=["count="+n];i==-1?0<n?(i=r[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<n;l++){let c=r[l].g;const h=r[l].map;if(c-=i,0>c)i=Math.max(0,r[l].g-100),a=!1;else try{Wj(h,o,"req"+c+"_")}catch{s&&s(h)}}if(a){s=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,s}function iC(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;za||Tb(),Va||(za(),Va=!0),rg.add(e,t),t.A=0}}function pg(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=wl(rn(t.Ma,t),lC(t,t.A)),t.A++,!0)}ee.Ma=function(){if(this.u=null,oC(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=wl(rn(this.jb,this),t)}};ee.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,dn(10),Vh(this),oC(this))};function mg(t){t.B!=null&&(Ae.clearTimeout(t.B),t.B=null)}function oC(t){t.g=new Sl(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=Bs(t.wa);pt(e,"RID","rpc"),pt(e,"SID",t.K),pt(e,"AID",t.V),pt(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&pt(e,"TO",t.qa),pt(e,"TYPE","xmlhttp"),El(t,e),t.o&&t.s&&dg(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=Bh(Bs(e)),n.s=null,n.S=!0,jb(n,t)}ee.ib=function(){this.v!=null&&(this.v=null,Vh(this),pg(this),dn(19))};function Cu(t){t.v!=null&&(Ae.clearTimeout(t.v),t.v=null)}function aC(t,e){var n=null;if(t.g==e){Cu(t),mg(t),t.g=null;var s=2}else if(pp(t.i,e))n=e.F,Kb(t.i,e),s=1;else return;if(t.H!=0){if(e.i)if(s==1){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;s=jh(),Yt(s,new Pb(s,n)),Wh(t)}else iC(t);else if(r=e.o,r==3||r==0&&0<e.ca||!(s==1&&Xj(t,e)||s==2&&pg(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Gr(t,5);break;case 4:Gr(t,10);break;case 3:Gr(t,6);break;default:Gr(t,2)}}}function lC(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Gr(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var s=rn(t.pb,t);n||(n=new Xr("//www.google.com/images/cleardot.gif"),Ae.location&&Ae.location.protocol=="http"||xu(n,"https"),Bh(n)),Hj(n.toString(),s)}else dn(2);t.H=0,t.h&&t.h.za(e),cC(t),sC(t)}ee.pb=function(t){t?(this.l.info("Successfully pinged google.com"),dn(2)):(this.l.info("Failed to ping google.com"),dn(1))};function cC(t){if(t.H=0,t.ma=[],t.h){const e=Yb(t.i);(e.length!=0||t.j.length!=0)&&(pw(t.ma,e),pw(t.ma,t.j),t.i.i.length=0,Xm(t.j),t.j.length=0),t.h.ya()}}function uC(t,e,n){var s=n instanceof Xr?Bs(n):new Xr(n);if(s.g!="")e&&(s.g=e+"."+s.g),bu(s,s.m);else{var r=Ae.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new Xr(null);s&&xu(i,s),e&&(i.g=e),r&&bu(i,r),n&&(i.l=n),s=i}return n=t.F,e=t.Da,n&&e&&pt(s,n,e),pt(s,"VER",t.ra),El(t,s),s}function hC(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Ha&&!t.va?new Ct(new bl({ob:!0})):new Ct(t.va),e.Oa(t.J),e}ee.isActive=function(){return!!this.h&&this.h.isActive(this)};function dC(){}ee=dC.prototype;ee.Ba=function(){};ee.Aa=function(){};ee.za=function(){};ee.ya=function(){};ee.isActive=function(){return!0};ee.Va=function(){};function Eu(){if(so&&!(10<=Number(cj)))throw Error("Environmental error: no available transport.")}Eu.prototype.g=function(t,e){return new Mn(t,e)};function Mn(t,e){zt.call(this),this.g=new nC(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Ba(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ba(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new bo(this)}Vt(Mn,zt);Mn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;dn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=uC(t,null,t.Y),Wh(t)};Mn.prototype.close=function(){fg(this.g)};Mn.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=sg(t),t=n);e.j.push(new Bj(e.fb++,t)),e.H==3&&Wh(e)};Mn.prototype.N=function(){this.g.h=null,delete this.j,fg(this.g),delete this.g,Mn.$.N.call(this)};function fC(t){lg.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Vt(fC,lg);function pC(){cg.call(this),this.status=1}Vt(pC,cg);function bo(t){this.g=t}Vt(bo,dC);bo.prototype.Ba=function(){Yt(this.g,"a")};bo.prototype.Aa=function(t){Yt(this.g,new fC(t))};bo.prototype.za=function(t){Yt(this.g,new pC)};bo.prototype.ya=function(){Yt(this.g,"b")};function Jj(){this.blockSize=-1}function ns(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Vt(ns,Jj);ns.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function af(t,e,n){n||(n=0);var s=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)s[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var i=t.g[3],o=e+(i^n&(r^i))+s[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[1]+3905402710&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[2]+606105819&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[3]+3250441966&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[5]+1200080426&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[6]+2821735955&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[7]+4249261313&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[9]+2336552879&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[10]+4294925233&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[11]+2304563134&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[13]+4254626195&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[14]+2792965006&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[15]+1236535329&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(r^i&(n^r))+s[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[6]+3225465664&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[11]+643717713&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[0]+3921069994&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[10]+38016083&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[15]+3634488961&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[4]+3889429448&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[14]+3275163606&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[3]+4107603335&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[8]+1163531501&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[2]+4243563512&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[7]+1735328473&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[12]+2368359562&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(n^r^i)+s[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[8]+2272392833&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[11]+1839030562&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[14]+4259657740&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[4]+1272893353&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[7]+4139469664&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[10]+3200236656&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[0]+3936430074&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[3]+3572445317&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[6]+76029189&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[12]+3873151461&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[15]+530742520&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[2]+3299628645&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(r^(n|~i))+s[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[7]+1126891415&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[14]+2878612391&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[5]+4237533241&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[3]+2399980690&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[10]+4293915773&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[1]+2240044497&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[15]+4264355552&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[6]+2734768916&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[13]+1309151649&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[11]+3174756917&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[2]+718787259&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+i&4294967295}ns.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,s=this.m,r=this.h,i=0;i<e;){if(r==0)for(;i<=n;)af(this,t,i),i+=this.blockSize;if(typeof t=="string"){for(;i<e;)if(s[r++]=t.charCodeAt(i++),r==this.blockSize){af(this,s),r=0;break}}else for(;i<e;)if(s[r++]=t[i++],r==this.blockSize){af(this,s),r=0;break}}this.h=r,this.i+=e};ns.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};function nt(t,e){this.h=e;for(var n=[],s=!0,r=t.length-1;0<=r;r--){var i=t[r]|0;s&&i==e||(n[r]=i,s=!1)}this.g=n}var Zj={};function gg(t){return-128<=t&&128>t?oj(t,function(e){return new nt([e|0],0>e?-1:0)}):new nt([t|0],0>t?-1:0)}function ds(t){if(isNaN(t)||!isFinite(t))return Wi;if(0>t)return qt(ds(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=mp;return new nt(e,0)}function mC(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return qt(mC(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=ds(Math.pow(e,8)),s=Wi,r=0;r<t.length;r+=8){var i=Math.min(8,t.length-r),o=parseInt(t.substring(r,r+i),e);8>i?(i=ds(Math.pow(e,i)),s=s.R(i).add(ds(o))):(s=s.R(n),s=s.add(ds(o)))}return s}var mp=4294967296,Wi=gg(0),gp=gg(1),Ew=gg(16777216);ee=nt.prototype;ee.ea=function(){if(Ln(this))return-qt(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.D(n);t+=(0<=s?s:mp+s)*e,e*=mp}return t};ee.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Ps(this))return"0";if(Ln(this))return"-"+qt(this).toString(t);for(var e=ds(Math.pow(t,6)),n=this,s="";;){var r=Iu(n,e).g;n=Tu(n,r.R(e));var i=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=r,Ps(n))return i+s;for(;6>i.length;)i="0"+i;s=i+s}};ee.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Ps(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function Ln(t){return t.h==-1}ee.X=function(t){return t=Tu(this,t),Ln(t)?-1:Ps(t)?0:1};function qt(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new nt(n,~t.h).add(gp)}ee.abs=function(){return Ln(this)?qt(this):this};ee.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,r=0;r<=e;r++){var i=s+(this.D(r)&65535)+(t.D(r)&65535),o=(i>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);s=o>>>16,i&=65535,o&=65535,n[r]=o<<16|i}return new nt(n,n[n.length-1]&-2147483648?-1:0)};function Tu(t,e){return t.add(qt(e))}ee.R=function(t){if(Ps(this)||Ps(t))return Wi;if(Ln(this))return Ln(t)?qt(this).R(qt(t)):qt(qt(this).R(t));if(Ln(t))return qt(this.R(qt(t)));if(0>this.X(Ew)&&0>t.X(Ew))return ds(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<t.g.length;r++){var i=this.D(s)>>>16,o=this.D(s)&65535,a=t.D(r)>>>16,l=t.D(r)&65535;n[2*s+2*r]+=o*l,ic(n,2*s+2*r),n[2*s+2*r+1]+=i*l,ic(n,2*s+2*r+1),n[2*s+2*r+1]+=o*a,ic(n,2*s+2*r+1),n[2*s+2*r+2]+=i*a,ic(n,2*s+2*r+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new nt(n,0)};function ic(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Go(t,e){this.g=t,this.h=e}function Iu(t,e){if(Ps(e))throw Error("division by zero");if(Ps(t))return new Go(Wi,Wi);if(Ln(t))return e=Iu(qt(t),e),new Go(qt(e.g),qt(e.h));if(Ln(e))return e=Iu(t,qt(e)),new Go(qt(e.g),e.h);if(30<t.g.length){if(Ln(t)||Ln(e))throw Error("slowDivide_ only works with positive integers.");for(var n=gp,s=e;0>=s.X(t);)n=Tw(n),s=Tw(s);var r=Ai(n,1),i=Ai(s,1);for(s=Ai(s,2),n=Ai(n,2);!Ps(s);){var o=i.add(s);0>=o.X(t)&&(r=r.add(n),i=o),s=Ai(s,1),n=Ai(n,1)}return e=Tu(t,r.R(e)),new Go(r,e)}for(r=Wi;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),s=Math.ceil(Math.log(n)/Math.LN2),s=48>=s?1:Math.pow(2,s-48),i=ds(n),o=i.R(e);Ln(o)||0<o.X(t);)n-=s,i=ds(n),o=i.R(e);Ps(i)&&(i=gp),r=r.add(i),t=Tu(t,o)}return new Go(r,t)}ee.gb=function(t){return Iu(this,t).h};ee.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)&t.D(s);return new nt(n,this.h&t.h)};ee.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)|t.D(s);return new nt(n,this.h|t.h)};ee.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)^t.D(s);return new nt(n,this.h^t.h)};function Tw(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.D(s)<<1|t.D(s-1)>>>31;return new nt(n,t.h)}function Ai(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,r=[],i=0;i<s;i++)r[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new nt(r,t.h)}Eu.prototype.createWebChannel=Eu.prototype.g;Mn.prototype.send=Mn.prototype.u;Mn.prototype.open=Mn.prototype.m;Mn.prototype.close=Mn.prototype.close;Fh.NO_ERROR=0;Fh.TIMEOUT=8;Fh.HTTP_ERROR=6;Db.COMPLETE="complete";Mb.EventType=_l;_l.OPEN="a";_l.CLOSE="b";_l.ERROR="c";_l.MESSAGE="d";zt.prototype.listen=zt.prototype.O;Ct.prototype.listenOnce=Ct.prototype.P;Ct.prototype.getLastError=Ct.prototype.Sa;Ct.prototype.getLastErrorCode=Ct.prototype.Ia;Ct.prototype.getStatus=Ct.prototype.da;Ct.prototype.getResponseJson=Ct.prototype.Wa;Ct.prototype.getResponseText=Ct.prototype.ja;Ct.prototype.send=Ct.prototype.ha;Ct.prototype.setWithCredentials=Ct.prototype.Oa;ns.prototype.digest=ns.prototype.l;ns.prototype.reset=ns.prototype.reset;ns.prototype.update=ns.prototype.j;nt.prototype.add=nt.prototype.add;nt.prototype.multiply=nt.prototype.R;nt.prototype.modulo=nt.prototype.gb;nt.prototype.compare=nt.prototype.X;nt.prototype.toNumber=nt.prototype.ea;nt.prototype.toString=nt.prototype.toString;nt.prototype.getBits=nt.prototype.D;nt.fromNumber=ds;nt.fromString=mC;var eF=function(){return new Eu},tF=function(){return jh()},lf=Fh,nF=Db,sF=yi,Iw={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},rF=bl,oc=Mb,iF=Ct,oF=ns,Hi=nt;const kw="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}en.UNAUTHENTICATED=new en(null),en.GOOGLE_CREDENTIALS=new en("google-credentials-uid"),en.FIRST_PARTY=new en("first-party-uid"),en.MOCK_USER=new en("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Co="9.23.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new Zu("@firebase/firestore");function Aw(){return ci.logLevel}function ge(t,...e){if(ci.logLevel<=Ke.DEBUG){const n=e.map(yg);ci.debug(`Firestore (${Co}): ${t}`,...n)}}function Us(t,...e){if(ci.logLevel<=Ke.ERROR){const n=e.map(yg);ci.error(`Firestore (${Co}): ${t}`,...n)}}function ro(t,...e){if(ci.logLevel<=Ke.WARN){const n=e.map(yg);ci.warn(`Firestore (${Co}): ${t}`,...n)}}function yg(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(t="Unexpected state"){const e=`FIRESTORE (${Co}) INTERNAL ASSERTION FAILED: `+t;throw Us(e),new Error(e)}function gt(t,e){t||ke()}function De(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pe extends xs{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class aF{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(en.UNAUTHENTICATED))}shutdown(){}}class lF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class cF{constructor(e){this.t=e,this.currentUser=en.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let s=this.i;const r=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve();let i=new Jr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Jr,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{ge("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ge("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Jr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(ge("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(gt(typeof s.accessToken=="string"),new gC(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return gt(e===null||typeof e=="string"),new en(e)}}class uF{constructor(e,n,s){this.h=e,this.l=n,this.m=s,this.type="FirstParty",this.user=en.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class hF{constructor(e,n,s){this.h=e,this.l=n,this.m=s}getToken(){return Promise.resolve(new uF(this.h,this.l,this.m))}start(e,n){e.enqueueRetryable(()=>n(en.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dF{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fF{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,n){const s=i=>{i.error!=null&&ge("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.T;return this.T=i.token,ge("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{ge("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.I.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.I.getImmediate({optional:!0});i?r(i):ge("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(gt(typeof n.token=="string"),this.T=n.token,new dF(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pF(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const r=pF(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<n&&(s+=e.charAt(r[i]%e.length))}return s}}function Xe(t,e){return t<e?-1:t>e?1:0}function io(t,e,n){return t.length===e.length&&t.every((s,r)=>n(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new pe(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new pe(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new pe(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pe(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Mt.fromMillis(Date.now())}static fromDate(e){return Mt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*n));return new Mt(n,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Xe(this.nanoseconds,e.nanoseconds):Xe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Re(e)}static min(){return new Re(new Mt(0,0))}static max(){return new Re(new Mt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(e,n,s){n===void 0?n=0:n>e.length&&ke(),s===void 0?s=e.length-n:s>e.length-n&&ke(),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return Ka.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ka?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let r=0;r<s;r++){const i=e.get(r),o=n.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class mt extends Ka{construct(e,n,s){return new mt(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new pe(L.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(r=>r.length>0))}return new mt(n)}static emptyPath(){return new mt([])}}const mF=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nn extends Ka{construct(e,n,s){return new nn(e,n,s)}static isValidIdentifier(e){return mF.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new nn(["__name__"])}static fromServerFormat(e){const n=[];let s="",r=0;const i=()=>{if(s.length===0)throw new pe(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new pe(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new pe(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new pe(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nn(n)}static emptyPath(){return new nn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.path=e}static fromPath(e){return new _e(mt.fromString(e))}static fromName(e){return new _e(mt.fromString(e).popFirst(5))}static empty(){return new _e(mt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&mt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return mt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _e(new mt(e.slice()))}}function gF(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=Re.fromTimestamp(s===1e9?new Mt(n+1,0):new Mt(n,s));return new wr(r,_e.empty(),e)}function yF(t){return new wr(t.readTime,t.key,-1)}class wr{constructor(e,n,s){this.readTime=e,this.documentKey=n,this.largestBatchId=s}static min(){return new wr(Re.min(),_e.empty(),-1)}static max(){return new wr(Re.max(),_e.empty(),-1)}}function vF(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=_e.comparator(t.documentKey,e.documentKey),n!==0?n:Xe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _F{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tl(t){if(t.code!==L.FAILED_PRECONDITION||t.message!==wF)throw t;ge("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ke(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new V((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(n,i).next(s,r)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof V?n:V.resolve(n)}catch(n){return V.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):V.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):V.reject(n)}static resolve(e){return new V((n,s)=>{n(e)})}static reject(e){return new V((n,s)=>{s(e)})}static waitFor(e){return new V((n,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&n()},l=>s(l))}),o=!0,i===r&&n()})}static or(e){let n=V.resolve(!1);for(const s of e)n=n.next(r=>r?V.resolve(r):s());return n}static forEach(e,n){const s=[];return e.forEach((r,i)=>{s.push(n.call(this,r,i))}),this.waitFor(s)}static mapArray(e,n){return new V((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;n(e[c]).next(h=>{o[c]=h,++a,a===i&&s(o)},h=>r(h))}})}static doWhile(e,n){return new V((s,r)=>{const i=()=>{e()===!0?n().next(()=>{i()},r):s()};i()})}}function Il(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.ot(s),this.ut=s=>n.writeSequenceNumber(s))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}vg.ct=-1;function Hh(t){return t==null}function ku(t){return t===0&&1/t==-1/0}function SF(t){return typeof t=="number"&&Number.isInteger(t)&&!ku(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Eo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,n){this.comparator=e,this.root=n||Gt.EMPTY}insert(e,n){return new _t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(e){return new _t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return n+s.left.size;r<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ac(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ac(this.root,e,this.comparator,!1)}getReverseIterator(){return new ac(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ac(this.root,e,this.comparator,!0)}}class ac{constructor(e,n,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?s(e.key,n):1,n&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gt{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??Gt.RED,this.left=r??Gt.EMPTY,this.right=i??Gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,r,i){return new Gt(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r.copy(null,n,null,null,null):r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,r=this;if(n(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),n(e,r.key)===0){if(r.right.isEmpty())return Gt.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ke();const e=this.left.check();if(e!==this.right.check())throw ke();return e+(this.isRed()?0:1)}}Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw ke()}get value(){throw ke()}get color(){throw ke()}get left(){throw ke()}get right(){throw ke()}copy(t,e,n,s,r){return this}insert(t,e,n){return new Gt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.comparator=e,this.data=new _t(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;n(r.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Nw(this.data.getIterator())}getIteratorFrom(e){return new Nw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof an)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const r=n.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new an(this.comparator);return n.data=e,n}}class Nw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e){this.fields=e,e.sort(nn.comparator)}static empty(){return new Zn([])}unionWith(e){let n=new an(nn.comparator);for(const s of this.fields)n=n.add(s);for(const s of e)n=n.add(s);return new Zn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return io(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new wC("Invalid base64 string: "+r):r}}(e);return new cn(n)}static fromUint8Array(e){const n=function(s){let r="";for(let i=0;i<s.length;++i)r+=String.fromCharCode(s[i]);return r}(e);return new cn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Xe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cn.EMPTY_BYTE_STRING=new cn("");const xF=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _r(t){if(gt(!!t),typeof t=="string"){let e=0;const n=xF.exec(t);if(gt(!!n),n[1]){let r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:kt(t.seconds),nanos:kt(t.nanos)}}function kt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ui(t){return typeof t=="string"?cn.fromBase64String(t):cn.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wg(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function _g(t){const e=t.mapValue.fields.__previous_value__;return wg(e)?_g(e):e}function Ya(t){const e=_r(t.mapValue.fields.__local_write_time__.timestampValue);return new Mt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{constructor(e,n,s,r,i,o,a,l,c){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Qa{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new Qa("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Qa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lc={mapValue:{}};function hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wg(t)?4:CF(t)?9007199254740991:10:ke()}function Ss(t,e){if(t===e)return!0;const n=hi(t);if(n!==hi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ya(t).isEqual(Ya(e));case 3:return function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const i=_r(s.timestampValue),o=_r(r.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,r){return ui(s.bytesValue).isEqual(ui(r.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,r){return kt(s.geoPointValue.latitude)===kt(r.geoPointValue.latitude)&&kt(s.geoPointValue.longitude)===kt(r.geoPointValue.longitude)}(t,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return kt(s.integerValue)===kt(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const i=kt(s.doubleValue),o=kt(r.doubleValue);return i===o?ku(i)===ku(o):isNaN(i)&&isNaN(o)}return!1}(t,e);case 9:return io(t.arrayValue.values||[],e.arrayValue.values||[],Ss);case 10:return function(s,r){const i=s.mapValue.fields||{},o=r.mapValue.fields||{};if(Rw(i)!==Rw(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(o[a]===void 0||!Ss(i[a],o[a])))return!1;return!0}(t,e);default:return ke()}}function Xa(t,e){return(t.values||[]).find(n=>Ss(n,e))!==void 0}function oo(t,e){if(t===e)return 0;const n=hi(t),s=hi(e);if(n!==s)return Xe(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Xe(t.booleanValue,e.booleanValue);case 2:return function(r,i){const o=kt(r.integerValue||r.doubleValue),a=kt(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Pw(t.timestampValue,e.timestampValue);case 4:return Pw(Ya(t),Ya(e));case 5:return Xe(t.stringValue,e.stringValue);case 6:return function(r,i){const o=ui(r),a=ui(i);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(r,i){const o=r.split("/"),a=i.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=Xe(o[l],a[l]);if(c!==0)return c}return Xe(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(r,i){const o=Xe(kt(r.latitude),kt(i.latitude));return o!==0?o:Xe(kt(r.longitude),kt(i.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(r,i){const o=r.values||[],a=i.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=oo(o[l],a[l]);if(c)return c}return Xe(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(r,i){if(r===lc.mapValue&&i===lc.mapValue)return 0;if(r===lc.mapValue)return 1;if(i===lc.mapValue)return-1;const o=r.fields||{},a=Object.keys(o),l=i.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let h=0;h<a.length&&h<c.length;++h){const d=Xe(a[h],c[h]);if(d!==0)return d;const f=oo(o[a[h]],l[c[h]]);if(f!==0)return f}return Xe(a.length,c.length)}(t.mapValue,e.mapValue);default:throw ke()}}function Pw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Xe(t,e);const n=_r(t),s=_r(e),r=Xe(n.seconds,s.seconds);return r!==0?r:Xe(n.nanos,s.nanos)}function ao(t){return yp(t)}function yp(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const r=_r(s);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ui(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,_e.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(s){let r="[",i=!0;for(const o of s.values||[])i?i=!1:r+=",",r+=yp(o);return r+"]"}(t.arrayValue):"mapValue"in t?function(s){const r=Object.keys(s.fields||{}).sort();let i="{",o=!0;for(const a of r)o?o=!1:i+=",",i+=`${a}:${yp(s.fields[a])}`;return i+"}"}(t.mapValue):ke();var e,n}function Dw(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function vp(t){return!!t&&"integerValue"in t}function Sg(t){return!!t&&"arrayValue"in t}function Mw(t){return!!t&&"nullValue"in t}function Ow(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Dc(t){return!!t&&"mapValue"in t}function ga(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Eo(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=ga(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ga(t.arrayValue.values[n]);return e}return Object.assign({},t)}function CF(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.value=e}static empty(){return new $n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!Dc(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=ga(n)}setAll(e){let n=nn.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,s,r),s={},r=[],n=a.popLast()}o?s[a.lastSegment()]=ga(o):r.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,s,r)}delete(e){const n=this.field(e.popLast());Dc(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ss(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=n.mapValue.fields[e.get(s)];Dc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=r),n=r}return n.mapValue.fields}applyChanges(e,n,s){Eo(n,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new $n(ga(this.value))}}function _C(t){const e=[];return Eo(t.fields,(n,s)=>{const r=new nn([n]);if(Dc(s)){const i=_C(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new Zn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,n,s,r,i,o,a){this.key=e,this.documentType=n,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new tn(e,0,Re.min(),Re.min(),Re.min(),$n.empty(),0)}static newFoundDocument(e,n,s,r){return new tn(e,1,n,Re.min(),s,r,0)}static newNoDocument(e,n){return new tn(e,2,n,Re.min(),Re.min(),$n.empty(),0)}static newUnknownDocument(e,n){return new tn(e,3,n,Re.min(),Re.min(),$n.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$n.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$n.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof tn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new tn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,n){this.position=e,this.inclusive=n}}function jw(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(i.field.isKeyField()?s=_e.comparator(_e.fromName(o.referenceValue),n.key):s=oo(o,n.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function Fw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ss(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e,n="asc"){this.field=e,this.dir=n}}function EF(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{}class At extends SC{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,s):new IF(e,n,s):n==="array-contains"?new RF(e,s):n==="in"?new NF(e,s):n==="not-in"?new PF(e,s):n==="array-contains-any"?new DF(e,s):new At(e,n,s)}static createKeyFieldInFilter(e,n,s){return n==="in"?new kF(e,s):new AF(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(oo(n,this.value)):n!==null&&hi(this.value)===hi(n)&&this.matchesComparison(oo(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ke()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ss extends SC{constructor(e,n){super(),this.filters=e,this.op=n,this.lt=null}static create(e,n){return new ss(e,n)}matches(e){return xC(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.lt!==null||(this.lt=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(n=>n.isInequality());return e!==null?e.field:null}ft(e){for(const n of this.getFlattenedFilters())if(e(n))return n;return null}}function xC(t){return t.op==="and"}function bC(t){return TF(t)&&xC(t)}function TF(t){for(const e of t.filters)if(e instanceof ss)return!1;return!0}function wp(t){if(t instanceof At)return t.field.canonicalString()+t.op.toString()+ao(t.value);if(bC(t))return t.filters.map(e=>wp(e)).join(",");{const e=t.filters.map(n=>wp(n)).join(",");return`${t.op}(${e})`}}function CC(t,e){return t instanceof At?function(n,s){return s instanceof At&&n.op===s.op&&n.field.isEqual(s.field)&&Ss(n.value,s.value)}(t,e):t instanceof ss?function(n,s){return s instanceof ss&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((r,i,o)=>r&&CC(i,s.filters[o]),!0):!1}(t,e):void ke()}function EC(t){return t instanceof At?function(e){return`${e.field.canonicalString()} ${e.op} ${ao(e.value)}`}(t):t instanceof ss?function(e){return e.op.toString()+" {"+e.getFilters().map(EC).join(" ,")+"}"}(t):"Filter"}class IF extends At{constructor(e,n,s){super(e,n,s),this.key=_e.fromName(s.referenceValue)}matches(e){const n=_e.comparator(e.key,this.key);return this.matchesComparison(n)}}class kF extends At{constructor(e,n){super(e,"in",n),this.keys=TC("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class AF extends At{constructor(e,n){super(e,"not-in",n),this.keys=TC("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function TC(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>_e.fromName(s.referenceValue))}class RF extends At{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Sg(n)&&Xa(n.arrayValue,this.value)}}class NF extends At{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Xa(this.value.arrayValue,n)}}class PF extends At{constructor(e,n){super(e,"not-in",n)}matches(e){if(Xa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Xa(this.value.arrayValue,n)}}class DF extends At{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Sg(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>Xa(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e,n=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.dt=null}}function Lw(t,e=null,n=[],s=[],r=null,i=null,o=null){return new MF(t,e,n,s,r,i,o)}function xg(t){const e=De(t);if(e.dt===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>wp(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(r){return r.field.canonicalString()+r.dir}(s)).join(","),Hh(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>ao(s)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>ao(s)).join(",")),e.dt=n}return e.dt}function bg(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!EF(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!CC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Fw(t.startAt,e.startAt)&&Fw(t.endAt,e.endAt)}function _p(t){return _e.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,n=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.wt=null,this._t=null,this.startAt,this.endAt}}function OF(t,e,n,s,r,i,o,a){return new kl(t,e,n,s,r,i,o,a)}function Cg(t){return new kl(t)}function $w(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function IC(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Eg(t){for(const e of t.filters){const n=e.getFirstInequalityField();if(n!==null)return n}return null}function kC(t){return t.collectionGroup!==null}function Gi(t){const e=De(t);if(e.wt===null){e.wt=[];const n=Eg(e),s=IC(e);if(n!==null&&s===null)n.isKeyField()||e.wt.push(new ya(n)),e.wt.push(new ya(nn.keyField(),"asc"));else{let r=!1;for(const i of e.explicitOrderBy)e.wt.push(i),i.field.isKeyField()&&(r=!0);if(!r){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new ya(nn.keyField(),i))}}}return e.wt}function zs(t){const e=De(t);if(!e._t)if(e.limitType==="F")e._t=Lw(e.path,e.collectionGroup,Gi(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const i of Gi(e)){const o=i.dir==="desc"?"asc":"desc";n.push(new ya(i.field,o))}const s=e.endAt?new Au(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Au(e.startAt.position,e.startAt.inclusive):null;e._t=Lw(e.path,e.collectionGroup,n,e.filters,e.limit,s,r)}return e._t}function Sp(t,e){e.getFirstInequalityField(),Eg(t);const n=t.filters.concat([e]);return new kl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function xp(t,e,n){return new kl(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Gh(t,e){return bg(zs(t),zs(e))&&t.limitType===e.limitType}function AC(t){return`${xg(zs(t))}|lt:${t.limitType}`}function bp(t){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(s=>EC(s)).join(", ")}]`),Hh(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(s=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(s)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(s=>ao(s)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(s=>ao(s)).join(",")),`Target(${n})`}(zs(t))}; limitType=${t.limitType})`}function qh(t,e){return e.isFoundDocument()&&function(n,s){const r=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):_e.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)}(t,e)&&function(n,s){for(const r of Gi(n))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0}(t,e)&&function(n,s){for(const r of n.filters)if(!r.matches(s))return!1;return!0}(t,e)&&function(n,s){return!(n.startAt&&!function(r,i,o){const a=jw(r,i,o);return r.inclusive?a<=0:a<0}(n.startAt,Gi(n),s)||n.endAt&&!function(r,i,o){const a=jw(r,i,o);return r.inclusive?a>=0:a>0}(n.endAt,Gi(n),s))}(t,e)}function jF(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function RC(t){return(e,n)=>{let s=!1;for(const r of Gi(t)){const i=FF(r,e,n);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function FF(t,e,n){const s=t.field.isKeyField()?_e.comparator(e.key,n.key):function(r,i,o){const a=i.data.field(r),l=o.data.field(r);return a!==null&&l!==null?oo(a,l):ke()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return ke()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,n]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,n]);r.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[n]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Eo(this.inner,(n,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return vC(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LF=new _t(_e.comparator);function Vs(){return LF}const NC=new _t(_e.comparator);function ta(...t){let e=NC;for(const n of t)e=e.insert(n.key,n);return e}function PC(t){let e=NC;return t.forEach((n,s)=>e=e.insert(n,s.overlayedDocument)),e}function qr(){return va()}function DC(){return va()}function va(){return new To(t=>t.toString(),(t,e)=>t.isEqual(e))}const $F=new _t(_e.comparator),BF=new an(_e.comparator);function Ve(...t){let e=BF;for(const n of t)e=e.add(n);return e}const UF=new an(Xe);function zF(){return UF}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MC(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ku(e)?"-0":e}}function OC(t){return{integerValue:""+t}}function VF(t,e){return SF(e)?OC(e):MC(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(){this._=void 0}}function WF(t,e,n){return t instanceof Ru?function(s,r){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&wg(r)&&(r=_g(r)),r&&(i.fields.__previous_value__=r),{mapValue:i}}(n,e):t instanceof Ja?FC(t,e):t instanceof Za?LC(t,e):function(s,r){const i=jC(s,r),o=Bw(i)+Bw(s.gt);return vp(i)&&vp(s.gt)?OC(o):MC(s.serializer,o)}(t,e)}function HF(t,e,n){return t instanceof Ja?FC(t,e):t instanceof Za?LC(t,e):n}function jC(t,e){return t instanceof Nu?vp(n=e)||function(s){return!!s&&"doubleValue"in s}(n)?e:{integerValue:0}:null;var n}class Ru extends Kh{}class Ja extends Kh{constructor(e){super(),this.elements=e}}function FC(t,e){const n=$C(e);for(const s of t.elements)n.some(r=>Ss(r,s))||n.push(s);return{arrayValue:{values:n}}}class Za extends Kh{constructor(e){super(),this.elements=e}}function LC(t,e){let n=$C(e);for(const s of t.elements)n=n.filter(r=>!Ss(r,s));return{arrayValue:{values:n}}}class Nu extends Kh{constructor(e,n){super(),this.serializer=e,this.gt=n}}function Bw(t){return kt(t.integerValue||t.doubleValue)}function $C(t){return Sg(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function GF(t,e){return t.field.isEqual(e.field)&&function(n,s){return n instanceof Ja&&s instanceof Ja||n instanceof Za&&s instanceof Za?io(n.elements,s.elements,Ss):n instanceof Nu&&s instanceof Nu?Ss(n.gt,s.gt):n instanceof Ru&&s instanceof Ru}(t.transform,e.transform)}class qF{constructor(e,n){this.version=e,this.transformResults=n}}class Ds{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ds}static exists(e){return new Ds(void 0,e)}static updateTime(e){return new Ds(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Mc(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Yh{}function BC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new zC(t.key,Ds.none()):new Al(t.key,t.data,Ds.none());{const n=t.data,s=$n.empty();let r=new an(nn.comparator);for(let i of e.fields)if(!r.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new vi(t.key,s,new Zn(r.toArray()),Ds.none())}}function KF(t,e,n){t instanceof Al?function(s,r,i){const o=s.value.clone(),a=zw(s.fieldTransforms,r,i.transformResults);o.setAll(a),r.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(t,e,n):t instanceof vi?function(s,r,i){if(!Mc(s.precondition,r))return void r.convertToUnknownDocument(i.version);const o=zw(s.fieldTransforms,r,i.transformResults),a=r.data;a.setAll(UC(s)),a.setAll(o),r.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(t,e,n):function(s,r,i){r.convertToNoDocument(i.version).setHasCommittedMutations()}(0,e,n)}function wa(t,e,n,s){return t instanceof Al?function(r,i,o,a){if(!Mc(r.precondition,i))return o;const l=r.value.clone(),c=Vw(r.fieldTransforms,a,i);return l.setAll(c),i.convertToFoundDocument(i.version,l).setHasLocalMutations(),null}(t,e,n,s):t instanceof vi?function(r,i,o,a){if(!Mc(r.precondition,i))return o;const l=Vw(r.fieldTransforms,a,i),c=i.data;return c.setAll(UC(r)),c.setAll(l),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),o===null?null:o.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(h=>h.field))}(t,e,n,s):function(r,i,o){return Mc(r.precondition,i)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o}(t,e,n)}function YF(t,e){let n=null;for(const s of t.fieldTransforms){const r=e.data.field(s.field),i=jC(s.transform,r||null);i!=null&&(n===null&&(n=$n.empty()),n.set(s.field,i))}return n||null}function Uw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&io(n,s,(r,i)=>GF(r,i))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Al extends Yh{constructor(e,n,s,r=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class vi extends Yh{constructor(e,n,s,r,i=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function UC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function zw(t,e,n){const s=new Map;gt(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,HF(o,a,n[r]))}return s}function Vw(t,e,n){const s=new Map;for(const r of t){const i=r.transform,o=n.data.field(r.field);s.set(r.field,WF(i,o,e))}return s}class zC extends Yh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class QF extends Yh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XF{constructor(e,n,s,r){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&KF(i,e,s[r])}}applyToLocalView(e,n){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(n=wa(s,e,n,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(n=wa(s,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const s=DC();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(r.key)?null:a;const l=BC(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(Re.min())}),s}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&io(this.mutations,e.mutations,(n,s)=>Uw(n,s))&&io(this.baseMutations,e.baseMutations,(n,s)=>Uw(n,s))}}class Tg{constructor(e,n,s,r){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=r}static from(e,n,s){gt(e.mutations.length===s.length);let r=$F;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new Tg(e,n,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tt,Ge;function eL(t){switch(t){default:return ke();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}function VC(t){if(t===void 0)return Us("GRPC error has no .code"),L.UNKNOWN;switch(t){case Tt.OK:return L.OK;case Tt.CANCELLED:return L.CANCELLED;case Tt.UNKNOWN:return L.UNKNOWN;case Tt.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Tt.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Tt.INTERNAL:return L.INTERNAL;case Tt.UNAVAILABLE:return L.UNAVAILABLE;case Tt.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Tt.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Tt.NOT_FOUND:return L.NOT_FOUND;case Tt.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Tt.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Tt.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Tt.ABORTED:return L.ABORTED;case Tt.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Tt.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Tt.DATA_LOSS:return L.DATA_LOSS;default:return ke()}}(Ge=Tt||(Tt={}))[Ge.OK=0]="OK",Ge[Ge.CANCELLED=1]="CANCELLED",Ge[Ge.UNKNOWN=2]="UNKNOWN",Ge[Ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ge[Ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ge[Ge.NOT_FOUND=5]="NOT_FOUND",Ge[Ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ge[Ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ge[Ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ge[Ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ge[Ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ge[Ge.ABORTED=10]="ABORTED",Ge[Ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ge[Ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ge[Ge.INTERNAL=13]="INTERNAL",Ge[Ge.UNAVAILABLE=14]="UNAVAILABLE",Ge[Ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return cc}static getOrCreateInstance(){return cc===null&&(cc=new Ig),cc}onExistenceFilterMismatch(e){const n=Symbol();return this.onExistenceFilterMismatchCallbacks.set(n,e),()=>this.onExistenceFilterMismatchCallbacks.delete(n)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(n=>n(e))}}let cc=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nL=new Hi([4294967295,4294967295],0);function Ww(t){const e=tL().encode(t),n=new oF;return n.update(e),new Uint8Array(n.digest())}function Hw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Hi([n,s],0),new Hi([r,i],0)]}class kg{constructor(e,n,s){if(this.bitmap=e,this.padding=n,this.hashCount=s,n<0||n>=8)throw new na(`Invalid padding: ${n}`);if(s<0)throw new na(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new na(`Invalid hash count: ${s}`);if(e.length===0&&n!==0)throw new na(`Invalid padding when bitmap length is 0: ${n}`);this.It=8*e.length-n,this.Tt=Hi.fromNumber(this.It)}Et(e,n,s){let r=e.add(n.multiply(Hi.fromNumber(s)));return r.compare(nL)===1&&(r=new Hi([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}vt(e){if(this.It===0)return!1;const n=Ww(e),[s,r]=Hw(n);for(let i=0;i<this.hashCount;i++){const o=this.Et(s,r,i);if(!this.At(o))return!1}return!0}static create(e,n,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new kg(i,r,n);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.It===0)return;const n=Ww(e),[s,r]=Hw(n);for(let i=0;i<this.hashCount;i++){const o=this.Et(s,r,i);this.Rt(o)}}Rt(e){const n=Math.floor(e/8),s=e%8;this.bitmap[n]|=1<<s}}class na extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qh{constructor(e,n,s,r,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,s){const r=new Map;return r.set(e,Rl.createSynthesizedTargetChangeForCurrentChange(e,n,s)),new Qh(Re.min(),r,new _t(Xe),Vs(),Ve())}}class Rl{constructor(e,n,s,r,i){this.resumeToken=e,this.current=n,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,s){return new Rl(s,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,n,s,r){this.Pt=e,this.removedTargetIds=n,this.key=s,this.bt=r}}class WC{constructor(e,n){this.targetId=e,this.Vt=n}}class HC{constructor(e,n,s=cn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=n,this.resumeToken=s,this.cause=r}}class Gw{constructor(){this.St=0,this.Dt=Kw(),this.Ct=cn.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return this.St!==0}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=Ve(),n=Ve(),s=Ve();return this.Dt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:n=n.add(r);break;case 1:s=s.add(r);break;default:ke()}}),new Rl(this.Ct,this.xt,e,n,s)}Ft(){this.Nt=!1,this.Dt=Kw()}Bt(e,n){this.Nt=!0,this.Dt=this.Dt.insert(e,n)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class sL{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Vs(),this.zt=qw(),this.Wt=new _t(Xe)}Ht(e){for(const n of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(n,e.bt):this.Yt(n,e.key,e.bt);for(const n of e.removedTargetIds)this.Yt(n,e.key,e.bt)}Xt(e){this.forEachTarget(e,n=>{const s=this.Zt(n);switch(e.state){case 0:this.te(n)&&s.$t(e.resumeToken);break;case 1:s.Ut(),s.kt||s.Ft(),s.$t(e.resumeToken);break;case 2:s.Ut(),s.kt||this.removeTarget(n);break;case 3:this.te(n)&&(s.Kt(),s.$t(e.resumeToken));break;case 4:this.te(n)&&(this.ee(n),s.$t(e.resumeToken));break;default:ke()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Qt.forEach((s,r)=>{this.te(r)&&n(r)})}ne(e){var n;const s=e.targetId,r=e.Vt.count,i=this.se(s);if(i){const o=i.target;if(_p(o))if(r===0){const a=new _e(o.path);this.Yt(s,a,tn.newNoDocument(a,Re.min()))}else gt(r===1);else{const a=this.ie(s);if(a!==r){const l=this.re(e,a);if(l!==0){this.ee(s);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(s,c)}(n=Ig.instance)===null||n===void 0||n.notifyOnExistenceFilterMismatch(function(c,h,d){var f,m,g,y,S,T;const w={localCacheCount:h,existenceFilterCount:d.count},b=d.unchangedNames;return b&&(w.bloomFilter={applied:c===0,hashCount:(f=b==null?void 0:b.hashCount)!==null&&f!==void 0?f:0,bitmapLength:(y=(g=(m=b==null?void 0:b.bits)===null||m===void 0?void 0:m.bitmap)===null||g===void 0?void 0:g.length)!==null&&y!==void 0?y:0,padding:(T=(S=b==null?void 0:b.bits)===null||S===void 0?void 0:S.padding)!==null&&T!==void 0?T:0}),w}(l,a,e.Vt))}}}}re(e,n){const{unchangedNames:s,count:r}=e.Vt;if(!s||!s.bits)return 1;const{bits:{bitmap:i="",padding:o=0},hashCount:a=0}=s;let l,c;try{l=ui(i).toUint8Array()}catch(h){if(h instanceof wC)return ro("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw h}try{c=new kg(l,o,a)}catch(h){return ro(h instanceof na?"BloomFilter error: ":"Applying bloom filter failed: ",h),1}return c.It===0?1:r!==n-this.oe(e.targetId,c)?2:0}oe(e,n){const s=this.Gt.getRemoteKeysForTarget(e);let r=0;return s.forEach(i=>{const o=this.Gt.ue(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;n.vt(a)||(this.Yt(e,i,null),r++)}),r}ce(e){const n=new Map;this.Qt.forEach((i,o)=>{const a=this.se(o);if(a){if(i.current&&_p(a.target)){const l=new _e(a.target.path);this.jt.get(l)!==null||this.ae(o,l)||this.Yt(o,l,tn.newNoDocument(l,e))}i.Mt&&(n.set(o,i.Ot()),i.Ft())}});let s=Ve();this.zt.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.se(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(i))}),this.jt.forEach((i,o)=>o.setReadTime(e));const r=new Qh(e,n,this.Wt,this.jt,s);return this.jt=Vs(),this.zt=qw(),this.Wt=new _t(Xe),r}Jt(e,n){if(!this.te(e))return;const s=this.ae(e,n.key)?2:0;this.Zt(e).Bt(n.key,s),this.jt=this.jt.insert(n.key,n),this.zt=this.zt.insert(n.key,this.he(n.key).add(e))}Yt(e,n,s){if(!this.te(e))return;const r=this.Zt(e);this.ae(e,n)?r.Bt(n,1):r.Lt(n),this.zt=this.zt.insert(n,this.he(n).delete(e)),s&&(this.jt=this.jt.insert(n,s))}removeTarget(e){this.Qt.delete(e)}ie(e){const n=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let n=this.Qt.get(e);return n||(n=new Gw,this.Qt.set(e,n)),n}he(e){let n=this.zt.get(e);return n||(n=new an(Xe),this.zt=this.zt.insert(e,n)),n}te(e){const n=this.se(e)!==null;return n||ge("WatchChangeAggregator","Detected inactive target",e),n}se(e){const n=this.Qt.get(e);return n&&n.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new Gw),this.Gt.getRemoteKeysForTarget(e).forEach(n=>{this.Yt(e,n,null)})}ae(e,n){return this.Gt.getRemoteKeysForTarget(e).has(n)}}function qw(){return new _t(_e.comparator)}function Kw(){return new _t(_e.comparator)}const rL={asc:"ASCENDING",desc:"DESCENDING"},iL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oL={and:"AND",or:"OR"};class aL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Cp(t,e){return t.useProto3Json||Hh(e)?e:{value:e}}function Pu(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function GC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function lL(t,e){return Pu(t,e.toTimestamp())}function gs(t){return gt(!!t),Re.fromTimestamp(function(e){const n=_r(e);return new Mt(n.seconds,n.nanos)}(t))}function Ag(t,e){return function(n){return new mt(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function qC(t){const e=mt.fromString(t);return gt(XC(e)),e}function Ep(t,e){return Ag(t.databaseId,e.path)}function cf(t,e){const n=qC(e);if(n.get(1)!==t.databaseId.projectId)throw new pe(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new pe(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new _e(KC(n))}function Tp(t,e){return Ag(t.databaseId,e)}function cL(t){const e=qC(t);return e.length===4?mt.emptyPath():KC(e)}function Ip(t){return new mt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function KC(t){return gt(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Yw(t,e,n){return{name:Ep(t,e),fields:n.value.mapValue.fields}}function uL(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:ke()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(l,c){return l.useProto3Json?(gt(c===void 0||typeof c=="string"),cn.fromBase64String(c||"")):(gt(c===void 0||c instanceof Uint8Array),cn.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=l.code===void 0?L.UNKNOWN:VC(l.code);return new pe(c,l.message||"")}(o);n=new HC(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=cf(t,s.document.name),i=gs(s.document.updateTime),o=s.document.createTime?gs(s.document.createTime):Re.min(),a=new $n({mapValue:{fields:s.document.fields}}),l=tn.newFoundDocument(r,i,o,a),c=s.targetIds||[],h=s.removedTargetIds||[];n=new Oc(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=cf(t,s.document),i=s.readTime?gs(s.readTime):Re.min(),o=tn.newNoDocument(r,i),a=s.removedTargetIds||[];n=new Oc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=cf(t,s.document),i=s.removedTargetIds||[];n=new Oc([],i,r,null)}else{if(!("filter"in e))return ke();{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new ZF(r,i),a=s.targetId;n=new WC(a,o)}}return n}function hL(t,e){let n;if(e instanceof Al)n={update:Yw(t,e.key,e.value)};else if(e instanceof zC)n={delete:Ep(t,e.key)};else if(e instanceof vi)n={update:Yw(t,e.key,e.data),updateMask:_L(e.fieldMask)};else{if(!(e instanceof QF))return ke();n={verify:Ep(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(r,i){const o=i.transform;if(o instanceof Ru)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Ja)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Za)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Nu)return{fieldPath:i.field.canonicalString(),increment:o.gt};throw ke()}(0,s))),e.precondition.isNone||(n.currentDocument=function(s,r){return r.updateTime!==void 0?{updateTime:lL(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:ke()}(t,e.precondition)),n}function dL(t,e){return t&&t.length>0?(gt(e!==void 0),t.map(n=>function(s,r){let i=s.updateTime?gs(s.updateTime):gs(r);return i.isEqual(Re.min())&&(i=gs(r)),new qF(i,s.transformResults||[])}(n,e))):[]}function fL(t,e){return{documents:[Tp(t,e.path)]}}function pL(t,e){const n={structuredQuery:{}},s=e.path;e.collectionGroup!==null?(n.parent=Tp(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Tp(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(l){if(l.length!==0)return QC(ss.create(l,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const i=function(l){if(l.length!==0)return l.map(c=>function(h){return{field:Di(h.field),direction:yL(h.dir)}}(c))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=Cp(t,e.limit);var a;return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),n}function mL(t){let e=cL(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){gt(s===1);const h=n.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(h){const d=YC(h);return d instanceof ss&&bC(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(h=>function(d){return new ya(Mi(d.field),function(f){switch(f){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction))}(h)));let a=null;n.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Hh(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(h){const d=!!h.before,f=h.values||[];return new Au(f,d)}(n.startAt));let c=null;return n.endAt&&(c=function(h){const d=!h.before,f=h.values||[];return new Au(f,d)}(n.endAt)),OF(e,r,o,i,a,"F",l,c)}function gL(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ke()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function YC(t){return t.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=Mi(e.unaryFilter.field);return At.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Mi(e.unaryFilter.field);return At.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Mi(e.unaryFilter.field);return At.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Mi(e.unaryFilter.field);return At.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ke()}}(t):t.fieldFilter!==void 0?function(e){return At.create(Mi(e.fieldFilter.field),function(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ke()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(e){return ss.create(e.compositeFilter.filters.map(n=>YC(n)),function(n){switch(n){case"AND":return"and";case"OR":return"or";default:return ke()}}(e.compositeFilter.op))}(t):ke()}function yL(t){return rL[t]}function vL(t){return iL[t]}function wL(t){return oL[t]}function Di(t){return{fieldPath:t.canonicalString()}}function Mi(t){return nn.fromServerFormat(t.fieldPath)}function QC(t){return t instanceof At?function(e){if(e.op==="=="){if(Ow(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NAN"}};if(Mw(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ow(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NOT_NAN"}};if(Mw(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Di(e.field),op:vL(e.op),value:e.value}}}(t):t instanceof ss?function(e){const n=e.getFilters().map(s=>QC(s));return n.length===1?n[0]:{compositeFilter:{op:wL(e.op),filters:n}}}(t):ke()}function _L(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function XC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,n,s,r,i=Re.min(),o=Re.min(),a=cn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ir(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL{constructor(e){this.fe=e}}function xL(t){const e=mL({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?xp(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bL{constructor(){this.rn=new CL}addToCollectionParentIndex(e,n){return this.rn.add(n),V.resolve()}getCollectionParents(e,n){return V.resolve(this.rn.getEntries(n))}addFieldIndex(e,n){return V.resolve()}deleteFieldIndex(e,n){return V.resolve()}getDocumentsMatchingTarget(e,n){return V.resolve(null)}getIndexType(e,n){return V.resolve(0)}getFieldIndexes(e,n){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,n){return V.resolve(wr.min())}getMinOffsetFromCollectionGroup(e,n){return V.resolve(wr.min())}updateCollectionGroup(e,n,s){return V.resolve()}updateIndexEntries(e,n){return V.resolve()}}class CL{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n]||new an(mt.comparator),i=!r.has(s);return this.index[n]=r.add(s),i}has(e){const n=e.lastSegment(),s=e.popLast(),r=this.index[n];return r&&r.has(s)}getEntries(e){return(this.index[e]||new an(mt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new lo(0)}static Mn(){return new lo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(){this.changes=new To(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,tn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?V.resolve(s):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TL{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IL{constructor(e,n,s,r){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,n){let s=null;return this.documentOverlayCache.getOverlay(e,n).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,n))).next(r=>(s!==null&&wa(s.mutation,r,Zn.empty(),Mt.now()),r))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.getLocalViewOfDocuments(e,s,Ve()).next(()=>s))}getLocalViewOfDocuments(e,n,s=Ve()){const r=qr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,s).next(i=>{let o=ta();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const s=qr();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,Ve()))}populateOverlays(e,n,s){const r=[];return s.forEach(i=>{n.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,s,r){let i=Vs();const o=va(),a=va();return n.forEach((l,c)=>{const h=s.get(c.key);r.has(c.key)&&(h===void 0||h.mutation instanceof vi)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),wa(h.mutation,c,h.mutation.getFieldMask(),Mt.now())):o.set(c.key,Zn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),n.forEach((c,h)=>{var d;return a.set(c,new TL(h,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){const s=va();let r=new _t((o,a)=>o-a),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let h=s.get(l)||Zn.empty();h=a.applyToLocalView(c,h),s.set(l,h);const d=(r.get(a.batchId)||Ve()).add(l);r=r.insert(a.batchId,d)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,d=DC();h.forEach(f=>{if(!i.has(f)){const m=BC(n.get(f),s.get(f));m!==null&&d.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return V.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,n,s){return function(r){return _e.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):kC(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,s):this.getDocumentsMatchingCollectionQuery(e,n,s)}getNextDocuments(e,n,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,s.largestBatchId,r-i.size):V.resolve(qr());let a=-1,l=i;return o.next(c=>V.forEach(c,(h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next(f=>{l=l.insert(h,f)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ve())).next(h=>({batchId:a,changes:PC(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new _e(n)).next(s=>{let r=ta();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,n,s){const r=n.collectionGroup;let i=ta();return this.indexManager.getCollectionParents(e,r).next(o=>V.forEach(o,a=>{const l=function(c,h){return new kl(h,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(n,a.child(r));return this.getDocumentsMatchingCollectionQuery(e,l,s).next(c=>{c.forEach((h,d)=>{i=i.insert(h,d)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,s.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,s,r))).next(i=>{r.forEach((a,l)=>{const c=l.getKey();i.get(c)===null&&(i=i.insert(c,tn.newInvalidDocument(c)))});let o=ta();return i.forEach((a,l)=>{const c=r.get(a);c!==void 0&&wa(c.mutation,l,Zn.empty(),Mt.now()),qh(n,l)&&(o=o.insert(a,l))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,n){return V.resolve(this.cs.get(n))}saveBundleMetadata(e,n){var s;return this.cs.set(n.id,{id:(s=n).id,version:s.version,createTime:gs(s.createTime)}),V.resolve()}getNamedQuery(e,n){return V.resolve(this.hs.get(n))}saveNamedQuery(e,n){return this.hs.set(n.name,function(s){return{name:s.name,query:xL(s.bundledQuery),readTime:gs(s.readTime)}}(n)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(){this.overlays=new _t(_e.comparator),this.ls=new Map}getOverlay(e,n){return V.resolve(this.overlays.get(n))}getOverlays(e,n){const s=qr();return V.forEach(n,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,n,s){return s.forEach((r,i)=>{this.we(e,n,i)}),V.resolve()}removeOverlaysForBatchId(e,n,s){const r=this.ls.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.ls.delete(s)),V.resolve()}getOverlaysForCollection(e,n,s){const r=qr(),i=n.length+1,o=new _e(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return V.resolve(r)}getOverlaysForCollectionGroup(e,n,s,r){let i=new _t((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>s){let h=i.get(c.largestBatchId);h===null&&(h=qr(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=qr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=r)););return V.resolve(a)}we(e,n,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.ls.get(r.largestBatchId).delete(s.key);this.ls.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new JF(n,s));let i=this.ls.get(n);i===void 0&&(i=Ve(),this.ls.set(n,i)),this.ls.set(n,i.add(s.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(){this.fs=new an(Lt.ds),this.ws=new an(Lt._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,n){const s=new Lt(e,n);this.fs=this.fs.add(s),this.ws=this.ws.add(s)}gs(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.ys(new Lt(e,n))}ps(e,n){e.forEach(s=>this.removeReference(s,n))}Is(e){const n=new _e(new mt([])),s=new Lt(n,e),r=new Lt(n,e+1),i=[];return this.ws.forEachInRange([s,r],o=>{this.ys(o),i.push(o.key)}),i}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const n=new _e(new mt([])),s=new Lt(n,e),r=new Lt(n,e+1);let i=Ve();return this.ws.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new Lt(e,0),s=this.fs.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class Lt{constructor(e,n){this.key=e,this.As=n}static ds(e,n){return _e.comparator(e.key,n.key)||Xe(e.As,n.As)}static _s(e,n){return Xe(e.As,n.As)||_e.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RL{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.vs=1,this.Rs=new an(Lt.ds)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,s,r){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new XF(i,n,s,r);this.mutationQueue.push(o);for(const a of r)this.Rs=this.Rs.add(new Lt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,n){return V.resolve(this.Ps(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,r=this.bs(s),i=r<0?0:r;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?-1:this.vs-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new Lt(n,0),r=new Lt(n,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([s,r],o=>{const a=this.Ps(o.As);i.push(a)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new an(Xe);return n.forEach(r=>{const i=new Lt(r,0),o=new Lt(r,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([i,o],a=>{s=s.add(a.As)})}),V.resolve(this.Vs(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,r=s.length+1;let i=s;_e.isDocumentKey(i)||(i=i.child(""));const o=new Lt(new _e(i),0);let a=new an(Xe);return this.Rs.forEachWhile(l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===r&&(a=a.add(l.As)),!0)},o),V.resolve(this.Vs(a))}Vs(e){const n=[];return e.forEach(s=>{const r=this.Ps(s);r!==null&&n.push(r)}),n}removeMutationBatch(e,n){gt(this.Ss(n.batchId,"removed")===0),this.mutationQueue.shift();let s=this.Rs;return V.forEach(n.mutations,r=>{const i=new Lt(r.key,n.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Rs=s})}Cn(e){}containsKey(e,n){const s=new Lt(n,0),r=this.Rs.firstAfterOrEqual(s);return V.resolve(n.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}Ss(e,n){return this.bs(e)}bs(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Ps(e){const n=this.bs(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NL{constructor(e){this.Ds=e,this.docs=new _t(_e.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const s=n.key,r=this.docs.get(s),i=r?r.size:0,o=this.Ds(n);return this.docs=this.docs.insert(s,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return V.resolve(s?s.document.mutableCopy():tn.newInvalidDocument(n))}getEntries(e,n){let s=Vs();return n.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():tn.newInvalidDocument(r))}),V.resolve(s)}getDocumentsMatchingQuery(e,n,s,r){let i=Vs();const o=n.path,a=new _e(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||vF(yF(h),s)<=0||(r.has(h.key)||qh(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,n,s,r){ke()}Cs(e,n){return V.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new PL(this)}getSize(e){return V.resolve(this.size)}}class PL extends EL{constructor(e){super(),this.os=e}applyChanges(e){const n=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?n.push(this.os.addEntry(e,r)):this.os.removeEntry(s)}),V.waitFor(n)}getFromCache(e,n){return this.os.getEntry(e,n)}getAllFromCache(e,n){return this.os.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DL{constructor(e){this.persistence=e,this.xs=new To(n=>xg(n),bg),this.lastRemoteSnapshotVersion=Re.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Rg,this.targetCount=0,this.Ms=lo.kn()}forEachTarget(e,n){return this.xs.forEach((s,r)=>n(r)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.Ns&&(this.Ns=n),V.resolve()}Fn(e){this.xs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Ms=new lo(n),this.highestTargetId=n),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,n){return this.Fn(n),this.targetCount+=1,V.resolve()}updateTargetData(e,n){return this.Fn(n),V.resolve()}removeTargetData(e,n){return this.xs.delete(n.target),this.ks.Is(n.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,n,s){let r=0;const i=[];return this.xs.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.xs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),V.waitFor(i).next(()=>r)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,n){const s=this.xs.get(n)||null;return V.resolve(s)}addMatchingKeys(e,n,s){return this.ks.gs(n,s),V.resolve()}removeMatchingKeys(e,n,s){this.ks.ps(n,s);const r=this.persistence.referenceDelegate,i=[];return r&&n.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this.ks.Is(n),V.resolve()}getMatchingKeysForTargetId(e,n){const s=this.ks.Es(n);return V.resolve(s)}containsKey(e,n){return V.resolve(this.ks.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e,n){this.$s={},this.overlays={},this.Os=new vg(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new DL(this),this.indexManager=new bL,this.remoteDocumentCache=function(s){return new NL(s)}(s=>this.referenceDelegate.Ls(s)),this.serializer=new SL(n),this.qs=new kL(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new AL,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let s=this.$s[e.toKey()];return s||(s=new RL(n,this.referenceDelegate),this.$s[e.toKey()]=s),s}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,n,s){ge("MemoryPersistence","Starting transaction:",e);const r=new OL(this.Os.next());return this.referenceDelegate.Us(),s(r).next(i=>this.referenceDelegate.Ks(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Gs(e,n){return V.or(Object.values(this.$s).map(s=>()=>s.containsKey(e,n)))}}class OL extends _F{constructor(e){super(),this.currentSequenceNumber=e}}class Ng{constructor(e){this.persistence=e,this.Qs=new Rg,this.js=null}static zs(e){return new Ng(e)}get Ws(){if(this.js)return this.js;throw ke()}addReference(e,n,s){return this.Qs.addReference(s,n),this.Ws.delete(s.toString()),V.resolve()}removeReference(e,n,s){return this.Qs.removeReference(s,n),this.Ws.add(s.toString()),V.resolve()}markPotentiallyOrphaned(e,n){return this.Ws.add(n.toString()),V.resolve()}removeTarget(e,n){this.Qs.Is(n.targetId).forEach(r=>this.Ws.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(r=>{r.forEach(i=>this.Ws.add(i.toString()))}).next(()=>s.removeTargetData(e,n))}Us(){this.js=new Set}Ks(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.Ws,s=>{const r=_e.fromPath(s);return this.Hs(e,r).next(i=>{i||n.removeEntry(r,Re.min())})}).next(()=>(this.js=null,n.apply(e)))}updateLimboDocument(e,n){return this.Hs(e,n).next(s=>{s?this.Ws.delete(n.toString()):this.Ws.add(n.toString())})}Ls(e){return 0}Hs(e,n){return V.or([()=>V.resolve(this.Qs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gs(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e,n,s,r){this.targetId=e,this.fromCache=n,this.Fi=s,this.Bi=r}static Li(e,n){let s=Ve(),r=Ve();for(const i of n.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Pg(e,n.fromCache,s,r)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{constructor(){this.qi=!1}initialize(e,n){this.Ui=e,this.indexManager=n,this.qi=!0}getDocumentsMatchingQuery(e,n,s,r){return this.Ki(e,n).next(i=>i||this.Gi(e,n,r,s)).next(i=>i||this.Qi(e,n))}Ki(e,n){if($w(n))return V.resolve(null);let s=zs(n);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(n.limit!==null&&r===1&&(n=xp(n,null,"F"),s=zs(n)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=Ve(...i);return this.Ui.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const c=this.ji(n,a);return this.zi(n,c,o,l.readTime)?this.Ki(e,xp(n,null,"F")):this.Wi(e,c,n,l)}))})))}Gi(e,n,s,r){return $w(n)||r.isEqual(Re.min())?this.Qi(e,n):this.Ui.getDocuments(e,s).next(i=>{const o=this.ji(n,i);return this.zi(n,o,s,r)?this.Qi(e,n):(Aw()<=Ke.DEBUG&&ge("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),bp(n)),this.Wi(e,o,n,gF(r,-1)))})}ji(e,n){let s=new an(RC(e));return n.forEach((r,i)=>{qh(e,i)&&(s=s.add(i))}),s}zi(e,n,s,r){if(e.limit===null)return!1;if(s.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,n){return Aw()<=Ke.DEBUG&&ge("QueryEngine","Using full collection scan to execute query:",bp(n)),this.Ui.getDocumentsMatchingQuery(e,n,wr.min())}Wi(e,n,s,r){return this.Ui.getDocumentsMatchingQuery(e,s,r).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FL{constructor(e,n,s,r){this.persistence=e,this.Hi=n,this.serializer=r,this.Ji=new _t(Xe),this.Yi=new To(i=>xg(i),bg),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(s)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new IL(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ji))}}function LL(t,e,n,s){return new FL(t,e,n,s)}async function JC(t,e){const n=De(t);return await n.persistence.runTransaction("Handle user change","readonly",s=>{let r;return n.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,n.tr(e),n.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=Ve();for(const c of r){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return n.localDocuments.getDocuments(s,l).next(c=>({er:c,removedBatchIds:o,addedBatchIds:a}))})})}function $L(t,e){const n=De(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const h=l.batch,d=h.keys();let f=V.resolve();return d.forEach(m=>{f=f.next(()=>c.getEntry(a,m)).next(g=>{const y=l.docVersions.get(m);gt(y!==null),g.version.compareTo(y)<0&&(h.applyToRemoteDocument(g,l),g.isValidDocument()&&(g.setReadTime(l.commitVersion),c.addEntry(g)))})}),f.next(()=>o.mutationQueue.removeMutationBatch(a,h))}(n,s,e,i).next(()=>i.apply(s)).next(()=>n.mutationQueue.performConsistencyCheck(s)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(o){let a=Ve();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>n.localDocuments.getDocuments(s,r))})}function ZC(t){const e=De(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Bs.getLastRemoteSnapshotVersion(n))}function BL(t,e){const n=De(t),s=e.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const a=[];e.targetChanges.forEach((h,d)=>{const f=r.get(d);if(!f)return;a.push(n.Bs.removeMatchingKeys(i,h.removedDocuments,d).next(()=>n.Bs.addMatchingKeys(i,h.addedDocuments,d)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(cn.EMPTY_BYTE_STRING,Re.min()).withLastLimboFreeSnapshotVersion(Re.min()):h.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(h.resumeToken,s)),r=r.insert(d,m),function(g,y,S){return g.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(f,m,h)&&a.push(n.Bs.updateTargetData(i,m))});let l=Vs(),c=Ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(UL(i,o,e.documentUpdates).next(h=>{l=h.nr,c=h.sr})),!s.isEqual(Re.min())){const h=n.Bs.getLastRemoteSnapshotVersion(i).next(d=>n.Bs.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(h)}return V.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(n.Ji=r,i))}function UL(t,e,n){let s=Ve(),r=Ve();return n.forEach(i=>s=s.add(i)),e.getEntries(t,s).next(i=>{let o=Vs();return n.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(Re.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ge("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{nr:o,sr:r}})}function zL(t,e){const n=De(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function VL(t,e){const n=De(t);return n.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return n.Bs.getTargetData(s,e).next(i=>i?(r=i,V.resolve(r)):n.Bs.allocateTargetId(s).next(o=>(r=new ir(e,o,"TargetPurposeListen",s.currentSequenceNumber),n.Bs.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=n.Ji.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(s.targetId,s),n.Yi.set(e,s.targetId)),s})}async function kp(t,e,n){const s=De(t),r=s.Ji.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Il(o))throw o;ge("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ji=s.Ji.remove(e),s.Yi.delete(r.target)}function Qw(t,e,n){const s=De(t);let r=Re.min(),i=Ve();return s.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const h=De(a),d=h.Yi.get(c);return d!==void 0?V.resolve(h.Ji.get(d)):h.Bs.getTargetData(l,c)}(s,o,zs(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Bs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Hi.getDocumentsMatchingQuery(o,e,n?r:Re.min(),n?i:Ve())).next(a=>(WL(s,jF(e),a),{documents:a,ir:i})))}function WL(t,e,n){let s=t.Xi.get(e)||Re.min();n.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),t.Xi.set(e,s)}class Xw{constructor(){this.activeTargetIds=zF()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HL{constructor(){this.Hr=new Xw,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,n,s){this.Jr[e]=n}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Xw,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL{Yr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){ge("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){ge("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uc=null;function uf(){return uc===null?uc=268435456+Math.round(2147483648*Math.random()):uc++,"0x"+uc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt="WebChannelConnection";class YL extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.mo=n+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,n,s,r,i){const o=uf(),a=this.To(e,n);ge("RestConnection",`Sending RPC '${e}' ${o}:`,a,s);const l={};return this.Eo(l,r,i),this.Ao(e,a,l,s).then(c=>(ge("RestConnection",`Received RPC '${e}' ${o}: `,c),c),c=>{throw ro("RestConnection",`RPC '${e}' ${o} failed with error: `,c,"url: ",a,"request:",s),c})}vo(e,n,s,r,i,o){return this.Io(e,n,s,r,i)}Eo(e,n,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+Co,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}To(e,n){const s=qL[e];return`${this.mo}/v1/${n}:${s}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,n,s,r){const i=uf();return new Promise((o,a)=>{const l=new iF;l.setWithCredentials(!0),l.listenOnce(nF.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case lf.NO_ERROR:const h=l.getResponseJson();ge(Zt,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case lf.TIMEOUT:ge(Zt,`RPC '${e}' ${i} timed out`),a(new pe(L.DEADLINE_EXCEEDED,"Request time out"));break;case lf.HTTP_ERROR:const d=l.getStatus();if(ge(Zt,`RPC '${e}' ${i} failed with status:`,d,"response text:",l.getResponseText()),d>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const g=function(y){const S=y.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(S)>=0?S:L.UNKNOWN}(m.status);a(new pe(g,m.message))}else a(new pe(L.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new pe(L.UNAVAILABLE,"Connection failed."));break;default:ke()}}finally{ge(Zt,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(r);ge(Zt,`RPC '${e}' ${i} sending request:`,r),l.send(n,"POST",c,s,15)})}Ro(e,n,s){const r=uf(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=eF(),a=tF(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.xmlHttpFactory=new rF({})),this.Eo(l.initMessageHeaders,n,s),l.encodeInitMessageHeaders=!0;const h=i.join("");ge(Zt,`Creating RPC '${e}' stream ${r}: ${h}`,l);const d=o.createWebChannel(h,l);let f=!1,m=!1;const g=new KL({ro:S=>{m?ge(Zt,`Not sending because RPC '${e}' stream ${r} is closed:`,S):(f||(ge(Zt,`Opening RPC '${e}' stream ${r} transport.`),d.open(),f=!0),ge(Zt,`RPC '${e}' stream ${r} sending:`,S),d.send(S))},oo:()=>d.close()}),y=(S,T,w)=>{S.listen(T,b=>{try{w(b)}catch(_){setTimeout(()=>{throw _},0)}})};return y(d,oc.EventType.OPEN,()=>{m||ge(Zt,`RPC '${e}' stream ${r} transport opened.`)}),y(d,oc.EventType.CLOSE,()=>{m||(m=!0,ge(Zt,`RPC '${e}' stream ${r} transport closed`),g.wo())}),y(d,oc.EventType.ERROR,S=>{m||(m=!0,ro(Zt,`RPC '${e}' stream ${r} transport errored:`,S),g.wo(new pe(L.UNAVAILABLE,"The operation could not be completed")))}),y(d,oc.EventType.MESSAGE,S=>{var T;if(!m){const w=S.data[0];gt(!!w);const b=w,_=b.error||((T=b[0])===null||T===void 0?void 0:T.error);if(_){ge(Zt,`RPC '${e}' stream ${r} received error:`,_);const k=_.status;let O=function(I){const N=Tt[I];if(N!==void 0)return VC(N)}(k),q=_.message;O===void 0&&(O=L.INTERNAL,q="Unknown error status: "+k+" with message "+_.message),m=!0,g.wo(new pe(O,q)),d.close()}else ge(Zt,`RPC '${e}' stream ${r} received:`,w),g._o(w)}}),y(a,sF.STAT_EVENT,S=>{S.stat===Iw.PROXY?ge(Zt,`RPC '${e}' stream ${r} detected buffering proxy`):S.stat===Iw.NOPROXY&&ge(Zt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.fo()},0),g}}function hf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(t){return new aL(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e,n,s=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=n,this.Po=s,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const n=Math.floor(this.So+this.ko()),s=Math.max(0,Date.now()-this.Co),r=Math.max(0,n-s);r>0&&ge("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){this.Do!==null&&(this.Do.skipDelay(),this.Do=null)}cancel(){this.Do!==null&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tE{constructor(e,n,s,r,i,o,a,l){this.ii=e,this.$o=s,this.Oo=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new eE(e,n)}Uo(){return this.state===1||this.state===5||this.Ko()}Ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&this.Bo===null&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,n){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,e!==4?this.qo.reset():n&&n.code===L.RESOURCE_EXHAUSTED?(Us(n.toString()),Us("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):n&&n.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(n)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),n=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.Fo===n&&this.Zo(s,r)},s=>{e(()=>{const r=new pe(L.UNKNOWN,"Fetching auth token failed: "+s.message);return this.tu(r)})})}Zo(e,n){const s=this.Xo(this.Fo);this.stream=this.eu(e,n),this.stream.uo(()=>{s(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(r=>{s(()=>this.tu(r))}),this.stream.onMessage(r=>{s(()=>this.onMessage(r))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return ge("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return n=>{this.ii.enqueueAndForget(()=>this.Fo===e?n():(ge("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QL extends tE{constructor(e,n,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,r,o),this.serializer=i}eu(e,n){return this.connection.Ro("Listen",e,n)}onMessage(e){this.qo.reset();const n=uL(this.serializer,e),s=function(r){if(!("targetChange"in r))return Re.min();const i=r.targetChange;return i.targetIds&&i.targetIds.length?Re.min():i.readTime?gs(i.readTime):Re.min()}(e);return this.listener.nu(n,s)}su(e){const n={};n.database=Ip(this.serializer),n.addTarget=function(r,i){let o;const a=i.target;if(o=_p(a)?{documents:fL(r,a)}:{query:pL(r,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){o.resumeToken=GC(r,i.resumeToken);const l=Cp(r,i.expectedCount);l!==null&&(o.expectedCount=l)}else if(i.snapshotVersion.compareTo(Re.min())>0){o.readTime=Pu(r,i.snapshotVersion.toTimestamp());const l=Cp(r,i.expectedCount);l!==null&&(o.expectedCount=l)}return o}(this.serializer,e);const s=gL(this.serializer,e);s&&(n.labels=s),this.Wo(n)}iu(e){const n={};n.database=Ip(this.serializer),n.removeTarget=e,this.Wo(n)}}class XL extends tE{constructor(e,n,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,r,o),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,n){return this.connection.Ro("Write",e,n)}onMessage(e){if(gt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const n=dL(e.writeResults,e.commitTime),s=gs(e.commitTime);return this.listener.cu(s,n)}return gt(!e.writeResults||e.writeResults.length===0),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Ip(this.serializer),this.Wo(e)}uu(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>hL(this.serializer,s))};this.Wo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL extends class{}{constructor(e,n,s,r){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=s,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new pe(L.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,n,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Io(e,n,s,r,i)).catch(r=>{throw r.name==="FirebaseError"?(r.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new pe(L.UNKNOWN,r.toString())})}vo(e,n,s,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.vo(e,n,s,i,o,r)).catch(i=>{throw i.name==="FirebaseError"?(i.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new pe(L.UNKNOWN,i.toString())})}terminate(){this.lu=!0}}class ZL{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){this.wu===0&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){this.state==="Online"?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,e==="Online"&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(Us(n),this.mu=!1):ge("OnlineStateTracker",n)}Tu(){this._u!==null&&(this._u.cancel(),this._u=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e${constructor(e,n,s,r,i){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr(o=>{s.enqueueAndForget(async()=>{wi(this)&&(ge("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=De(a);l.vu.add(4),await Nl(l),l.bu.set("Unknown"),l.vu.delete(4),await Jh(l)}(this))})}),this.bu=new ZL(s,r)}}async function Jh(t){if(wi(t))for(const e of t.Ru)await e(!0)}async function Nl(t){for(const e of t.Ru)await e(!1)}function nE(t,e){const n=De(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),Og(n)?Mg(n):Io(n).Ko()&&Dg(n,e))}function sE(t,e){const n=De(t),s=Io(n);n.Au.delete(e),s.Ko()&&rE(n,e),n.Au.size===0&&(s.Ko()?s.jo():wi(n)&&n.bu.set("Unknown"))}function Dg(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Re.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Io(t).su(e)}function rE(t,e){t.Vu.qt(e),Io(t).iu(e)}function Mg(t){t.Vu=new sL({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),Io(t).start(),t.bu.gu()}function Og(t){return wi(t)&&!Io(t).Uo()&&t.Au.size>0}function wi(t){return De(t).vu.size===0}function iE(t){t.Vu=void 0}async function t$(t){t.Au.forEach((e,n)=>{Dg(t,e)})}async function n$(t,e){iE(t),Og(t)?(t.bu.Iu(e),Mg(t)):t.bu.set("Unknown")}async function s$(t,e,n){if(t.bu.set("Online"),e instanceof HC&&e.state===2&&e.cause)try{await async function(s,r){const i=r.cause;for(const o of r.targetIds)s.Au.has(o)&&(await s.remoteSyncer.rejectListen(o,i),s.Au.delete(o),s.Vu.removeTarget(o))}(t,e)}catch(s){ge("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Du(t,s)}else if(e instanceof Oc?t.Vu.Ht(e):e instanceof WC?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(Re.min()))try{const s=await ZC(t.localStore);n.compareTo(s)>=0&&await function(r,i){const o=r.Vu.ce(i);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=r.Au.get(l);c&&r.Au.set(l,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach((a,l)=>{const c=r.Au.get(a);if(!c)return;r.Au.set(a,c.withResumeToken(cn.EMPTY_BYTE_STRING,c.snapshotVersion)),rE(r,a);const h=new ir(c.target,a,l,c.sequenceNumber);Dg(r,h)}),r.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(s){ge("RemoteStore","Failed to raise snapshot:",s),await Du(t,s)}}async function Du(t,e,n){if(!Il(e))throw e;t.vu.add(1),await Nl(t),t.bu.set("Offline"),n||(n=()=>ZC(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ge("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Jh(t)})}function oE(t,e){return e().catch(n=>Du(t,n,e))}async function Zh(t){const e=De(t),n=Sr(e);let s=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;r$(e);)try{const r=await zL(e.localStore,s);if(r===null){e.Eu.length===0&&n.jo();break}s=r.batchId,i$(e,r)}catch(r){await Du(e,r)}aE(e)&&lE(e)}function r$(t){return wi(t)&&t.Eu.length<10}function i$(t,e){t.Eu.push(e);const n=Sr(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function aE(t){return wi(t)&&!Sr(t).Uo()&&t.Eu.length>0}function lE(t){Sr(t).start()}async function o$(t){Sr(t).hu()}async function a$(t){const e=Sr(t);for(const n of t.Eu)e.uu(n.mutations)}async function l$(t,e,n){const s=t.Eu.shift(),r=Tg.from(s,e,n);await oE(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await Zh(t)}async function c$(t,e){e&&Sr(t).ou&&await async function(n,s){if(r=s.code,eL(r)&&r!==L.ABORTED){const i=n.Eu.shift();Sr(n).Qo(),await oE(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Zh(n)}var r}(t,e),aE(t)&&lE(t)}async function Zw(t,e){const n=De(t);n.asyncQueue.verifyOperationInProgress(),ge("RemoteStore","RemoteStore received new credentials");const s=wi(n);n.vu.add(3),await Nl(n),s&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Jh(n)}async function u$(t,e){const n=De(t);e?(n.vu.delete(2),await Jh(n)):e||(n.vu.add(2),await Nl(n),n.bu.set("Unknown"))}function Io(t){return t.Su||(t.Su=function(e,n,s){const r=De(e);return r.fu(),new QL(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(t.datastore,t.asyncQueue,{uo:t$.bind(null,t),ao:n$.bind(null,t),nu:s$.bind(null,t)}),t.Ru.push(async e=>{e?(t.Su.Qo(),Og(t)?Mg(t):t.bu.set("Unknown")):(await t.Su.stop(),iE(t))})),t.Su}function Sr(t){return t.Du||(t.Du=function(e,n,s){const r=De(e);return r.fu(),new XL(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(t.datastore,t.asyncQueue,{uo:o$.bind(null,t),ao:c$.bind(null,t),au:a$.bind(null,t),cu:l$.bind(null,t)}),t.Ru.push(async e=>{e?(t.Du.Qo(),await Zh(t)):(await t.Du.stop(),t.Eu.length>0&&(ge("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))})),t.Du}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,n,s,r,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Jr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,s,r,i){const o=Date.now()+s,a=new jg(e,n,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new pe(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fg(t,e){if(Us("AsyncQueue",`${e}: ${t}`),Il(t))return new pe(L.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e){this.comparator=e?(n,s)=>e(n,s)||_e.comparator(n.key,s.key):(n,s)=>_e.comparator(n.key,s.key),this.keyedMap=ta(),this.sortedSet=new _t(this.comparator)}static emptySet(e){return new qi(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,s)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof qi)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;n.hasNext();){const r=n.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const s=new qi;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=n,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_{constructor(){this.Cu=new _t(_e.comparator)}track(e){const n=e.doc.key,s=this.Cu.get(n);s?e.type!==0&&s.type===3?this.Cu=this.Cu.insert(n,e):e.type===3&&s.type!==1?this.Cu=this.Cu.insert(n,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.Cu=this.Cu.insert(n,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.Cu=this.Cu.remove(n):e.type===1&&s.type===2?this.Cu=this.Cu.insert(n,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.Cu=this.Cu.insert(n,{type:2,doc:e.doc}):ke():this.Cu=this.Cu.insert(n,e)}xu(){const e=[];return this.Cu.inorderTraversal((n,s)=>{e.push(s)}),e}}class co{constructor(e,n,s,r,i,o,a,l,c){this.query=e,this.docs=n,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,n,s,r,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new co(e,n,qi.emptySet(n),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,s=e.docChanges;if(n.length!==s.length)return!1;for(let r=0;r<n.length;r++)if(n[r].type!==s[r].type||!n[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(){this.Nu=void 0,this.listeners=[]}}class d${constructor(){this.queries=new To(e=>AC(e),Gh),this.onlineState="Unknown",this.ku=new Set}}async function f$(t,e){const n=De(t),s=e.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new h$),r)try{i.Nu=await n.onListen(s)}catch(o){const a=Fg(o,`Initialization of query '${bp(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.listeners.push(e),e.Mu(n.onlineState),i.Nu&&e.$u(i.Nu)&&Lg(n)}async function p$(t,e){const n=De(t),s=e.query;let r=!1;const i=n.queries.get(s);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),r=i.listeners.length===0)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function m$(t,e){const n=De(t);let s=!1;for(const r of e){const i=r.query,o=n.queries.get(i);if(o){for(const a of o.listeners)a.$u(r)&&(s=!0);o.Nu=r}}s&&Lg(n)}function g$(t,e,n){const s=De(t),r=s.queries.get(e);if(r)for(const i of r.listeners)i.onError(n);s.queries.delete(e)}function Lg(t){t.ku.forEach(e=>{e.next()})}class y${constructor(e,n,s){this.query=e,this.Ou=n,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=s||{}}$u(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new co(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),n=!0):this.qu(e,this.onlineState)&&(this.Uu(e),n=!0),this.Bu=e,n}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let n=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),n=!0),n}qu(e,n){if(!e.fromCache)return!0;const s=n!=="Offline";return(!this.options.Ku||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Lu(e){if(e.docChanges.length>0)return!0;const n=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Uu(e){e=co.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{constructor(e){this.key=e}}class uE{constructor(e){this.key=e}}class v${constructor(e,n){this.query=e,this.Yu=n,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Ve(),this.mutatedKeys=Ve(),this.tc=RC(e),this.ec=new qi(this.tc)}get nc(){return this.Yu}sc(e,n){const s=n?n.ic:new e_,r=n?n.ec:this.ec;let i=n?n.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((h,d)=>{const f=r.get(h),m=qh(this.query,d)?d:null,g=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let S=!1;f&&m?f.data.isEqual(m.data)?g!==y&&(s.track({type:3,doc:m}),S=!0):this.rc(f,m)||(s.track({type:2,doc:m}),S=!0,(l&&this.tc(m,l)>0||c&&this.tc(m,c)<0)&&(a=!0)):!f&&m?(s.track({type:0,doc:m}),S=!0):f&&!m&&(s.track({type:1,doc:f}),S=!0,(l||c)&&(a=!0)),S&&(m?(o=o.add(m),i=y?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),s.track({type:1,doc:h})}return{ec:o,ic:s,zi:a,mutatedKeys:i}}rc(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,s){const r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort((c,h)=>function(d,f){const m=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ke()}};return m(d)-m(f)}(c.type,h.type)||this.tc(c.doc,h.doc)),this.oc(s);const o=n?this.uc():[],a=this.Zu.size===0&&this.current?1:0,l=a!==this.Xu;return this.Xu=a,i.length!==0||l?{snapshot:new co(this.query,e.ec,r,i,e.mutatedKeys,a===0,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),cc:o}:{cc:o}}Mu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ec:this.ec,ic:new e_,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(n=>this.Yu=this.Yu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Yu=this.Yu.delete(n)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=Ve(),this.ec.forEach(s=>{this.ac(s.key)&&(this.Zu=this.Zu.add(s.key))});const n=[];return e.forEach(s=>{this.Zu.has(s)||n.push(new uE(s))}),this.Zu.forEach(s=>{e.has(s)||n.push(new cE(s))}),n}hc(e){this.Yu=e.ir,this.Zu=Ve();const n=this.sc(e.documents);return this.applyChanges(n,!0)}lc(){return co.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,this.Xu===0,this.hasCachedResults)}}class w${constructor(e,n,s){this.query=e,this.targetId=n,this.view=s}}class _${constructor(e){this.key=e,this.fc=!1}}class S${constructor(e,n,s,r,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.dc={},this.wc=new To(a=>AC(a),Gh),this._c=new Map,this.mc=new Set,this.gc=new _t(_e.comparator),this.yc=new Map,this.Ic=new Rg,this.Tc={},this.Ec=new Map,this.Ac=lo.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return this.vc===!0}}async function x$(t,e){const n=P$(t);let s,r;const i=n.wc.get(e);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.lc();else{const o=await VL(n.localStore,zs(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);s=o.targetId,r=await b$(n,e,s,a==="current",o.resumeToken),n.isPrimaryClient&&nE(n.remoteStore,o)}return r}async function b$(t,e,n,s,r){t.Rc=(d,f,m)=>async function(g,y,S,T){let w=y.view.sc(S);w.zi&&(w=await Qw(g.localStore,y.query,!1).then(({documents:k})=>y.view.sc(k,w)));const b=T&&T.targetChanges.get(y.targetId),_=y.view.applyChanges(w,g.isPrimaryClient,b);return n_(g,y.targetId,_.cc),_.snapshot}(t,d,f,m);const i=await Qw(t.localStore,e,!0),o=new v$(e,i.ir),a=o.sc(i.documents),l=Rl.createSynthesizedTargetChangeForCurrentChange(n,s&&t.onlineState!=="Offline",r),c=o.applyChanges(a,t.isPrimaryClient,l);n_(t,n,c.cc);const h=new w$(e,n,o);return t.wc.set(e,h),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),c.snapshot}async function C$(t,e){const n=De(t),s=n.wc.get(e),r=n._c.get(s.targetId);if(r.length>1)return n._c.set(s.targetId,r.filter(i=>!Gh(i,e))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await kp(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),sE(n.remoteStore,s.targetId),Ap(n,s.targetId)}).catch(Tl)):(Ap(n,s.targetId),await kp(n.localStore,s.targetId,!0))}async function E$(t,e,n){const s=D$(t);try{const r=await function(i,o){const a=De(i),l=Mt.now(),c=o.reduce((f,m)=>f.add(m.key),Ve());let h,d;return a.persistence.runTransaction("Locally write mutations","readwrite",f=>{let m=Vs(),g=Ve();return a.Zi.getEntries(f,c).next(y=>{m=y,m.forEach((S,T)=>{T.isValidDocument()||(g=g.add(S))})}).next(()=>a.localDocuments.getOverlayedDocuments(f,m)).next(y=>{h=y;const S=[];for(const T of o){const w=YF(T,h.get(T.key).overlayedDocument);w!=null&&S.push(new vi(T.key,w,_C(w.value.mapValue),Ds.exists(!0)))}return a.mutationQueue.addMutationBatch(f,l,S,o)}).next(y=>{d=y;const S=y.applyToLocalDocumentSet(h,g);return a.documentOverlayCache.saveOverlays(f,y.batchId,S)})}).then(()=>({batchId:d.batchId,changes:PC(h)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(i,o,a){let l=i.Tc[i.currentUser.toKey()];l||(l=new _t(Xe)),l=l.insert(o,a),i.Tc[i.currentUser.toKey()]=l}(s,r.batchId,n),await Pl(s,r.changes),await Zh(s.remoteStore)}catch(r){const i=Fg(r,"Failed to persist write");n.reject(i)}}async function hE(t,e){const n=De(t);try{const s=await BL(n.localStore,e);e.targetChanges.forEach((r,i)=>{const o=n.yc.get(i);o&&(gt(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?o.fc=!0:r.modifiedDocuments.size>0?gt(o.fc):r.removedDocuments.size>0&&(gt(o.fc),o.fc=!1))}),await Pl(n,s,e)}catch(s){await Tl(s)}}function t_(t,e,n){const s=De(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const r=[];s.wc.forEach((i,o)=>{const a=o.view.Mu(e);a.snapshot&&r.push(a.snapshot)}),function(i,o){const a=De(i);a.onlineState=o;let l=!1;a.queries.forEach((c,h)=>{for(const d of h.listeners)d.Mu(o)&&(l=!0)}),l&&Lg(a)}(s.eventManager,e),r.length&&s.dc.nu(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function T$(t,e,n){const s=De(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.yc.get(e),i=r&&r.key;if(i){let o=new _t(_e.comparator);o=o.insert(i,tn.newNoDocument(i,Re.min()));const a=Ve().add(i),l=new Qh(Re.min(),new Map,new _t(Xe),o,a);await hE(s,l),s.gc=s.gc.remove(i),s.yc.delete(e),$g(s)}else await kp(s.localStore,e,!1).then(()=>Ap(s,e,n)).catch(Tl)}async function I$(t,e){const n=De(t),s=e.batch.batchId;try{const r=await $L(n.localStore,e);fE(n,s,null),dE(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Pl(n,r)}catch(r){await Tl(r)}}async function k$(t,e,n){const s=De(t);try{const r=await function(i,o){const a=De(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.mutationQueue.lookupMutationBatch(l,o).next(h=>(gt(h!==null),c=h.keys(),a.mutationQueue.removeMutationBatch(l,h))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>a.localDocuments.getDocuments(l,c))})}(s.localStore,e);fE(s,e,n),dE(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Pl(s,r)}catch(r){await Tl(r)}}function dE(t,e){(t.Ec.get(e)||[]).forEach(n=>{n.resolve()}),t.Ec.delete(e)}function fE(t,e,n){const s=De(t);let r=s.Tc[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(n?i.reject(n):i.resolve(),r=r.remove(e)),s.Tc[s.currentUser.toKey()]=r}}function Ap(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t._c.get(e))t.wc.delete(s),n&&t.dc.Pc(s,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach(s=>{t.Ic.containsKey(s)||pE(t,s)})}function pE(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);n!==null&&(sE(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),$g(t))}function n_(t,e,n){for(const s of n)s instanceof cE?(t.Ic.addReference(s.key,e),A$(t,s)):s instanceof uE?(ge("SyncEngine","Document no longer in limbo: "+s.key),t.Ic.removeReference(s.key,e),t.Ic.containsKey(s.key)||pE(t,s.key)):ke()}function A$(t,e){const n=e.key,s=n.path.canonicalString();t.gc.get(n)||t.mc.has(s)||(ge("SyncEngine","New document in limbo: "+n),t.mc.add(s),$g(t))}function $g(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new _e(mt.fromString(e)),s=t.Ac.next();t.yc.set(s,new _$(n)),t.gc=t.gc.insert(n,s),nE(t.remoteStore,new ir(zs(Cg(n.path)),s,"TargetPurposeLimboResolution",vg.ct))}}async function Pl(t,e,n){const s=De(t),r=[],i=[],o=[];s.wc.isEmpty()||(s.wc.forEach((a,l)=>{o.push(s.Rc(l,e,n).then(c=>{if((c||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(l.targetId,c!=null&&c.fromCache?"not-current":"current"),c){r.push(c);const h=Pg.Li(l.targetId,c);i.push(h)}}))}),await Promise.all(o),s.dc.nu(r),await async function(a,l){const c=De(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>V.forEach(l,d=>V.forEach(d.Fi,f=>c.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>V.forEach(d.Bi,f=>c.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Il(h))throw h;ge("LocalStore","Failed to update sequence numbers: "+h)}for(const h of l){const d=h.targetId;if(!h.fromCache){const f=c.Ji.get(d),m=f.snapshotVersion,g=f.withLastLimboFreeSnapshotVersion(m);c.Ji=c.Ji.insert(d,g)}}}(s.localStore,i))}async function R$(t,e){const n=De(t);if(!n.currentUser.isEqual(e)){ge("SyncEngine","User change. New user:",e.toKey());const s=await JC(n.localStore,e);n.currentUser=e,function(r,i){r.Ec.forEach(o=>{o.forEach(a=>{a.reject(new pe(L.CANCELLED,i))})}),r.Ec.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Pl(n,s.er)}}function N$(t,e){const n=De(t),s=n.yc.get(e);if(s&&s.fc)return Ve().add(s.key);{let r=Ve();const i=n._c.get(e);if(!i)return r;for(const o of i){const a=n.wc.get(o);r=r.unionWith(a.view.nc)}return r}}function P$(t){const e=De(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=hE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=N$.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=T$.bind(null,e),e.dc.nu=m$.bind(null,e.eventManager),e.dc.Pc=g$.bind(null,e.eventManager),e}function D$(t){const e=De(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=I$.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=k$.bind(null,e),e}class s_{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Xh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return LL(this.persistence,new jL,e.initialUser,this.serializer)}createPersistence(e){return new ML(Ng.zs,this.serializer)}createSharedClientState(e){return new HL}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class M${async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>t_(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=R$.bind(null,this.syncEngine),await u$(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new d$}createDatastore(e){const n=Xh(e.databaseInfo.databaseId),s=(r=e.databaseInfo,new YL(r));var r;return function(i,o,a,l){return new JL(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,n)}createRemoteStore(e){return n=this.localStore,s=this.datastore,r=e.asyncQueue,i=a=>t_(this.syncEngine,a,0),o=Jw.D()?new Jw:new GL,new e$(n,s,r,i,o);var n,s,r,i,o}createSyncEngine(e,n){return function(s,r,i,o,a,l,c){const h=new S$(s,r,i,o,a,l);return c&&(h.vc=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=De(e);ge("RemoteStore","RemoteStore shutting down."),n.vu.add(5),await Nl(n),n.Pu.shutdown(),n.bu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O${constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):Us("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j${constructor(e,n,s,r){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=r,this.user=en.UNAUTHENTICATED,this.clientId=yC.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async i=>{ge("FirestoreClient","Received user=",i.uid),await this.authCredentialListener(i),this.user=i}),this.appCheckCredentials.start(s,i=>(ge("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new pe(L.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Jr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const s=Fg(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function df(t,e){t.asyncQueue.verifyOperationInProgress(),ge("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async r=>{s.isEqual(r)||(await JC(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function r_(t,e){t.asyncQueue.verifyOperationInProgress();const n=await L$(t);ge("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener(r=>Zw(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>Zw(e.remoteStore,i)),t._onlineComponents=e}function F$(t){return t.name==="FirebaseError"?t.code===L.FAILED_PRECONDITION||t.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function L$(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ge("FirestoreClient","Using user provided OfflineComponentProvider");try{await df(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!F$(n))throw n;ro("Error using user provided cache. Falling back to memory cache: "+n),await df(t,new s_)}}else ge("FirestoreClient","Using default OfflineComponentProvider"),await df(t,new s_);return t._offlineComponents}async function mE(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ge("FirestoreClient","Using user provided OnlineComponentProvider"),await r_(t,t._uninitializedComponentsProvider._online)):(ge("FirestoreClient","Using default OnlineComponentProvider"),await r_(t,new M$))),t._onlineComponents}function $$(t){return mE(t).then(e=>e.syncEngine)}async function i_(t){const e=await mE(t),n=e.eventManager;return n.onListen=x$.bind(null,e.syncEngine),n.onUnlisten=C$.bind(null,e.syncEngine),n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gE(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(t,e,n){if(!n)throw new pe(L.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function B$(t,e,n,s){if(e===!0&&s===!0)throw new pe(L.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function a_(t){if(!_e.isDocumentKey(t))throw new pe(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function l_(t){if(_e.isDocumentKey(t))throw new pe(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ed(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ke()}function _a(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new pe(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ed(t);throw new pe(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new pe(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}B$("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gE((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new pe(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new pe(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new pe(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(n=this.experimentalLongPollingOptions,s=e.experimentalLongPollingOptions,n.timeoutSeconds===s.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var n,s}}class td{constructor(e,n,s,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new c_({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new pe(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new pe(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new c_(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new aF;switch(n.type){case"firstParty":return new hF(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new pe(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=o_.get(e);n&&(ge("ComponentProvider","Removing Datastore"),o_.delete(e),n.terminate())}(this),Promise.resolve()}}function U$(t,e,n,s={}){var r;const i=(t=_a(t,td))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&ro("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let a,l;if(typeof s.mockUserToken=="string")a=s.mockUserToken,l=en.MOCK_USER;else{a=J0(s.mockUserToken,(r=t._app)===null||r===void 0?void 0:r.options.projectId);const c=s.mockUserToken.sub||s.mockUserToken.user_id;if(!c)throw new pe(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new en(c)}t._authCredentials=new lF(new gC(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pn(this.firestore,e,this._key)}}class ko{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ko(this.firestore,e,this._query)}}class hr extends ko{constructor(e,n,s){super(e,n,Cg(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pn(this.firestore,null,new _e(e))}withConverter(e){return new hr(this.firestore,e,this._path)}}function vE(t,e,...n){if(t=Ue(t),yE("collection","path",e),t instanceof td){const s=mt.fromString(e,...n);return l_(s),new hr(t,null,s)}{if(!(t instanceof Pn||t instanceof hr))throw new pe(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(mt.fromString(e,...n));return l_(s),new hr(t.firestore,null,s)}}function z$(t,e,...n){if(t=Ue(t),arguments.length===1&&(e=yC.A()),yE("doc","path",e),t instanceof td){const s=mt.fromString(e,...n);return a_(s),new Pn(t,null,new _e(s))}{if(!(t instanceof Pn||t instanceof hr))throw new pe(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(mt.fromString(e,...n));return a_(s),new Pn(t.firestore,t instanceof hr?t.converter:null,new _e(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V${constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new eE(this,"async_queue_retry"),this.Xc=()=>{const n=hf();n&&ge("AsyncQueue","Visibility state changed to "+n.visibilityState),this.qo.Mo()};const e=hf();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const n=hf();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const n=new Jr;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(this.Qc.length!==0){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!Il(e))throw e;ge("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){const n=this.Gc.then(()=>(this.Hc=!0,e().catch(s=>{this.Wc=s,this.Hc=!1;const r=function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),o}(s);throw Us("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.Hc=!1,s))));return this.Gc=n,n}enqueueAfterDelay(e,n,s){this.Zc(),this.Yc.indexOf(e)>-1&&(n=0);const r=jg.createAndSchedule(this,e,n,s,i=>this.na(i));return this.zc.push(r),r}Zc(){this.Wc&&ke()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(const n of this.zc)if(n.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.zc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const n=this.zc.indexOf(e);this.zc.splice(n,1)}}function u_(t){return function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const r of n)if(r in s&&typeof s[r]=="function")return!0;return!1}(t,["next","error","complete"])}class Mu extends td{constructor(e,n,s,r){super(e,n,s,r),this.type="firestore",this._queue=new V$,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||_E(this),this._firestoreClient.terminate()}}function W$(t,e){const n=typeof t=="object"?t:rl(),s=typeof t=="string"?t:"(default)",r=sl(n,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=sm("firestore");i&&U$(r,...i)}return r}function wE(t){return t._firestoreClient||_E(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _E(t){var e,n,s;const r=t._freezeSettings(),i=function(o,a,l,c){return new bF(o,a,l,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,gE(c.experimentalLongPollingOptions),c.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new j$(t._authCredentials,t._appCheckCredentials,t._queue,i),!((n=r.cache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=r.cache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uo(cn.fromBase64String(e))}catch(n){throw new pe(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new uo(cn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new pe(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new pe(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new pe(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Xe(this._lat,e._lat)||Xe(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H$=/^__.*__$/;class G${constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new vi(e,this.data,this.fieldMask,n,this.fieldTransforms):new Al(e,this.data,n,this.fieldTransforms)}}function xE(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ke()}}class zg{constructor(e,n,s,r,i,o){this.settings=e,this.databaseId=n,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new zg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.aa({path:s,la:!1});return r.fa(e),r}da(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),r=this.aa({path:s,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Ou(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(e.length===0)throw this._a("Document fields must not be empty");if(xE(this.ca)&&H$.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class q${constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=s||Xh(e)}ya(e,n,s,r=!1){return new zg({ca:e,methodName:n,ga:s,path:nn.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bE(t){const e=t._freezeSettings(),n=Xh(t._databaseId);return new q$(t._databaseId,!!e.ignoreUndefinedProperties,n)}function K$(t,e,n,s,r,i={}){const o=t.ya(i.merge||i.mergeFields?2:0,e,n,r);TE("Data must be an object, but it was:",o,s);const a=CE(s,o);let l,c;if(i.merge)l=new Zn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const d of i.mergeFields){const f=Q$(e,d,n);if(!o.contains(f))throw new pe(L.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);J$(h,f)||h.push(f)}l=new Zn(h),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new G$(new $n(a),l,c)}function Y$(t,e,n,s=!1){return Vg(n,t.ya(s?4:3,e))}function Vg(t,e){if(EE(t=Ue(t)))return TE("Unsupported field value:",e,t),CE(t,e);if(t instanceof SE)return function(n,s){if(!xE(s.ca))throw s._a(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s._a(`${n._methodName}() is not currently supported inside arrays`);const r=n._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&e.ca!==4)throw e._a("Nested arrays are not supported");return function(n,s){const r=[];let i=0;for(const o of n){let a=Vg(o,s.wa(i));a==null&&(a={nullValue:"NULL_VALUE"}),r.push(a),i++}return{arrayValue:{values:r}}}(t,e)}return function(n,s){if((n=Ue(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return VF(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const r=Mt.fromDate(n);return{timestampValue:Pu(s.serializer,r)}}if(n instanceof Mt){const r=new Mt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Pu(s.serializer,r)}}if(n instanceof Ug)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof uo)return{bytesValue:GC(s.serializer,n._byteString)};if(n instanceof Pn){const r=s.databaseId,i=n.firestore._databaseId;if(!i.isEqual(r))throw s._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Ag(n.firestore._databaseId||s.databaseId,n._key.path)}}throw s._a(`Unsupported field value: ${ed(n)}`)}(t,e)}function CE(t,e){const n={};return vC(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Eo(t,(s,r)=>{const i=Vg(r,e.ha(s));i!=null&&(n[s]=i)}),{mapValue:{fields:n}}}function EE(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Mt||t instanceof Ug||t instanceof uo||t instanceof Pn||t instanceof SE)}function TE(t,e,n){if(!EE(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const s=ed(n);throw s==="an object"?e._a(t+" a custom object"):e._a(t+" "+s)}}function Q$(t,e,n){if((e=Ue(e))instanceof Bg)return e._internalPath;if(typeof e=="string")return IE(t,e);throw Ou("Field path arguments must be of type string or ",t,!1,void 0,n)}const X$=new RegExp("[~\\*/\\[\\]]");function IE(t,e,n){if(e.search(X$)>=0)throw Ou(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Bg(...e.split("."))._internalPath}catch{throw Ou(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ou(t,e,n,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new pe(L.INVALID_ARGUMENT,a+t+l)}function J$(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(e,n,s,r,i){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Pn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Z$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Wg("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Z$ extends kE{data(){return super.data()}}function Wg(t,e){return typeof e=="string"?IE(t,e):e instanceof Bg?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new pe(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hg{}class t2 extends Hg{}function n2(t,e,...n){let s=[];e instanceof Hg&&s.push(e),s=s.concat(n),function(r){const i=r.filter(a=>a instanceof Gg).length,o=r.filter(a=>a instanceof nd).length;if(i>1||i>0&&o>0)throw new pe(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)t=r._apply(t);return t}class nd extends t2{constructor(e,n,s){super(),this._field=e,this._op=n,this._value=s,this.type="where"}static _create(e,n,s){return new nd(e,n,s)}_apply(e){const n=this._parse(e);return AE(e._query,n),new ko(e.firestore,e.converter,Sp(e._query,n))}_parse(e){const n=bE(e.firestore);return function(r,i,o,a,l,c,h){let d;if(l.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new pe(L.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){d_(h,c);const f=[];for(const m of h)f.push(h_(a,r,m));d={arrayValue:{values:f}}}else d=h_(a,r,h)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||d_(h,c),d=Y$(o,i,h,c==="in"||c==="not-in");return At.create(l,c,d)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function s2(t,e,n){const s=e,r=Wg("where",t);return nd._create(r,s,n)}class Gg extends Hg{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Gg(e,n)}_parse(e){const n=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return n.length===1?n[0]:ss.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,r){let i=s;const o=r.getFlattenedFilters();for(const a of o)AE(i,a),i=Sp(i,a)}(e._query,n),new ko(e.firestore,e.converter,Sp(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function h_(t,e,n){if(typeof(n=Ue(n))=="string"){if(n==="")throw new pe(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kC(e)&&n.indexOf("/")!==-1)throw new pe(L.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(mt.fromString(n));if(!_e.isDocumentKey(s))throw new pe(L.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Dw(t,new _e(s))}if(n instanceof Pn)return Dw(t,n._key);throw new pe(L.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ed(n)}.`)}function d_(t,e){if(!Array.isArray(t)||t.length===0)throw new pe(L.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function AE(t,e){if(e.isInequality()){const s=Eg(t),r=e.field;if(s!==null&&!s.isEqual(r))throw new pe(L.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${s.toString()}' and '${r.toString()}'`);const i=IC(t);i!==null&&r2(t,r,i)}const n=function(s,r){for(const i of s)for(const o of i.getFlattenedFilters())if(r.indexOf(o.op)>=0)return o.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new pe(L.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new pe(L.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function r2(t,e,n){if(!n.isEqual(e))throw new pe(L.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class i2{convertValue(e,n="none"){switch(hi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return kt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ui(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw ke()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const s={};return Eo(e,(r,i)=>{s[r]=this.convertValue(i,n)}),s}convertGeoPoint(e){return new Ug(kt(e.latitude),kt(e.longitude))}convertArray(e,n){return(e.values||[]).map(s=>this.convertValue(s,n))}convertServerTimestamp(e,n){switch(n){case"previous":const s=_g(e);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(Ya(e));default:return null}}convertTimestamp(e){const n=_r(e);return new Mt(n.seconds,n.nanos)}convertDocumentKey(e,n){const s=mt.fromString(e);gt(XC(s));const r=new Qa(s.get(1),s.get(3)),i=new _e(s.popFirst(5));return r.isEqual(n)||Us(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(t,e,n){let s;return s=t?t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class RE extends kE{constructor(e,n,s,r,i,o){super(e,n,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new jc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const s=this._document.data.field(Wg("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}}class jc extends RE{data(e={}){return super.data(e)}}class a2{constructor(e,n,s,r){this._firestore=e,this._userDataWriter=n,this._snapshot=r,this.metadata=new sa(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new jc(this._firestore,this._userDataWriter,s.key,s,new sa(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new pe(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let i=0;return s._snapshot.docChanges.map(o=>{const a=new jc(s._firestore,s._userDataWriter,o.doc.key,o.doc,new sa(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:i++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>r||o.type!==3).map(o=>{const a=new jc(s._firestore,s._userDataWriter,o.doc.key,o.doc,new sa(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let l=-1,c=-1;return o.type!==0&&(l=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),o.type!==1&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:l2(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function l2(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ke()}}class NE extends i2{constructor(e){super(),this.firestore=e}convertBytes(e){return new uo(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Pn(this.firestore,null,n)}}function c2(t,e){const n=_a(t.firestore,Mu),s=z$(t),r=o2(t.converter,e);return u2(n,[K$(bE(t.firestore),"addDoc",s._key,r,t.converter!==null,{}).toMutation(s._key,Ds.exists(!1))]).then(()=>s)}function PE(t,...e){var n,s,r;t=Ue(t);let i={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||u_(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(u_(e[o])){const d=e[o];e[o]=(n=d.next)===null||n===void 0?void 0:n.bind(d),e[o+1]=(s=d.error)===null||s===void 0?void 0:s.bind(d),e[o+2]=(r=d.complete)===null||r===void 0?void 0:r.bind(d)}let l,c,h;if(t instanceof Pn)c=_a(t.firestore,Mu),h=Cg(t._key.path),l={next:d=>{e[o]&&e[o](h2(c,t,d))},error:e[o+1],complete:e[o+2]};else{const d=_a(t,ko);c=_a(d.firestore,Mu),h=d._query;const f=new NE(c);l={next:m=>{e[o]&&e[o](new a2(c,f,d,m))},error:e[o+1],complete:e[o+2]},e2(t._query)}return function(d,f,m,g){const y=new O$(g),S=new y$(f,y,m);return d.asyncQueue.enqueueAndForget(async()=>f$(await i_(d),S)),()=>{y.Dc(),d.asyncQueue.enqueueAndForget(async()=>p$(await i_(d),S))}}(wE(c),h,a,l)}function u2(t,e){return function(n,s){const r=new Jr;return n.asyncQueue.enqueueAndForget(async()=>E$(await $$(n),s,r)),r.promise}(wE(t),e)}function h2(t,e,n){const s=n.docs.get(e._key),r=new NE(t);return new RE(t,r,e._key,s,new sa(n.hasPendingWrites,n.fromCache),e.converter)}(function(t,e=!0){(function(n){Co=n})(fi),dr(new js("firestore",(n,{instanceIdentifier:s,options:r})=>{const i=n.getProvider("app").getImmediate(),o=new Mu(new cF(n.getProvider("auth-internal")),new fF(n.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new pe(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qa(a.options.projectId,l)}(i,s),i);return r=Object.assign({useFetchStreams:e},r),o._setSettings(r),o},"PUBLIC").setMultipleInstances(!0)),Vn(kw,"3.13.0",t),Vn(kw,"3.13.0","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2="type.googleapis.com/google.protobuf.Int64Value",f2="type.googleapis.com/google.protobuf.UInt64Value";function DE(t,e){const n={};for(const s in t)t.hasOwnProperty(s)&&(n[s]=e(t[s]));return n}function Rp(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>Rp(e));if(typeof t=="function"||typeof t=="object")return DE(t,e=>Rp(e));throw new Error("Data cannot be encoded in JSON: "+t)}function ju(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case d2:case f2:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>ju(e)):typeof t=="function"||typeof t=="object"?DE(t,e=>ju(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ki extends xs{constructor(e,n,s){super(`${qg}/${e}`,n||""),this.details=s}}function p2(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function m2(t,e){let n=p2(t),s=n,r;try{const i=e&&e.error;if(i){const o=i.status;if(typeof o=="string"){if(!f_[o])return new Ki("internal","internal");n=f_[o],s=o}const a=i.message;typeof a=="string"&&(s=a),r=i.details,r!==void 0&&(r=ju(r))}}catch{}return n==="ok"?null:new Ki(n,s,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(e,n,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||e.get().then(r=>this.auth=r,()=>{}),this.messaging||n.get().then(r=>this.messaging=r,()=>{}),this.appCheck||s.get().then(r=>this.appCheck=r,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),s=await this.getMessagingToken(),r=await this.getAppCheckToken(e);return{authToken:n,messagingToken:s,appCheckToken:r}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np="us-central1";function y2(t){let e=null;return{promise:new Promise((n,s)=>{e=setTimeout(()=>{s(new Ki("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class v2{constructor(e,n,s,r,i=Np,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new g2(n,s,r),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(i);this.customDomain=a.origin,this.region=Np}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function w2(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}function _2(t,e,n){return s=>x2(t,e,s,{})}async function S2(t,e,n,s){n["Content-Type"]="application/json";let r;try{r=await s(t,{method:"POST",body:JSON.stringify(e),headers:n})}catch{return{status:0,json:null}}let i=null;try{i=await r.json()}catch{}return{status:r.status,json:i}}function x2(t,e,n,s){const r=t._url(e);return b2(t,r,n,s)}async function b2(t,e,n,s){n=Rp(n);const r={data:n},i={},o=await t.contextProvider.getContext(s.limitedUseAppCheckTokens);o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken);const a=s.timeout||7e4,l=y2(a),c=await Promise.race([S2(e,r,i,t.fetchImpl),l.promise,t.cancelAllRequests]);if(l.cancel(),!c)throw new Ki("cancelled","Firebase Functions instance was deleted.");const h=m2(c.status,c.json);if(h)throw h;if(!c.json)throw new Ki("internal","Response is not valid JSON object.");let d=c.json.data;if(typeof d>"u"&&(d=c.json.result),typeof d>"u")throw new Ki("internal","Response is missing data field.");return{data:ju(d)}}const p_="@firebase/functions",m_="0.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2="auth-internal",E2="app-check-internal",T2="messaging-internal";function I2(t,e){const n=(s,{instanceIdentifier:r})=>{const i=s.getProvider("app").getImmediate(),o=s.getProvider(C2),a=s.getProvider(T2),l=s.getProvider(E2);return new v2(i,o,a,l,r,t)};dr(new js(qg,n,"PUBLIC").setMultipleInstances(!0)),Vn(p_,m_,e),Vn(p_,m_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k2(t=rl(),e=Np){const s=sl(Ue(t),qg).getImmediate({identifier:e}),r=sm("functions");return r&&A2(s,...r),s}function A2(t,e,n){w2(Ue(t),e,n)}function Dl(t,e,n){return _2(Ue(t),e)}I2(fetch.bind(self));const Kg={apiKey:"AIzaSyCr81IrmH5LQedoRSQHorEjK5-sWMdVf_k",authDomain:"better-wrodle.firebaseapp.com",projectId:"better-wrodle",storageBucket:"better-wrodle.firebasestorage.app",messagingSenderId:"445700190808",appId:"1:445700190808:web:c4da4d756ac143583f102d",databaseURL:"https://better-wrodle-default-rtdb.firebaseio.com".trim()||"https://better-wrodle-default-rtdb.firebaseio.com"};{const t=["your-api-key","your-auth-domain","your-project-id","your-storage-bucket","your-messaging-sender-id","your-app-id"];if(Object.values(Kg).some(n=>typeof n=="string"&&t.some(s=>n.includes(s))))throw new Error("Invalid Firebase configuration: one or more VITE_FIREBASE_* environment variables are missing or still use placeholder values.")}let ho;try{ho=rl()}catch{ho=sS(Kg)}const ue=pP(ho),K=db(ho,Kg.databaseURL),ME=W$(ho),Ml=k2(ho),IB=()=>Dl(Ml,"createGiftCheckoutSession"),kB=()=>Dl(Ml,"adminGiftSubscription"),AB=()=>Dl(Ml,"getSubscriptionDetails"),RB=()=>Dl(Ml,"updateSubscriptionAutoRenew"),NB=()=>Dl(Ml,"cancelSubscription"),g_=new ks;function Zr(t){return Number.isFinite(t)?Math.max(1,Math.min(Ia,t)):1}function Fc(t,e=2,n=8){return Number.isFinite(t)?Math.max(e,Math.min(n,t)):e}function y_(t){const e=[];return!t||typeof t!="object"?{isValid:!1,errors:["Game state must be an object"]}:(Array.isArray(t.boards)?t.boards.forEach((n,s)=>{if(!n||typeof n!="object"){e.push(`Board ${s} must be an object`);return}(typeof n.solution!="string"||n.solution.length!==bt)&&e.push(`Board ${s} must have a valid solution string`),Array.isArray(n.guesses)||e.push(`Board ${s} must have a guesses array`)}):e.push("Game state must have a boards array"),{isValid:e.length===0,errors:e})}function PB(t){if(t==null)return null;const e=typeof t=="string"?parseInt(t,10):t;return Number.isFinite(e)?Zr(e):null}function DB(t){return typeof t=="boolean"?t:typeof t=="string"?t==="true"||t==="1":!!t}function MB(t){return typeof t=="string"&&["daily","marathon","multiplayer","solutionhunt"].includes(t)?t:"daily"}function R2(t,e=1,n=50){const s=[];if(typeof t!="string")return{isValid:!1,value:null,errors:["Username must be a string"]};const r=t.trim();return r.length<e&&s.push(`Username must be at least ${e} character${e!==1?"s":""}`),r.length>n&&s.push(`Username must be at most ${n} characters`),/[\x00-\x1F\x7F]/.test(r)&&s.push("Username contains invalid characters"),{isValid:s.length===0,value:s.length===0?r:null,errors:s}}function ff(t){const e=[];if(typeof t!="string")return{isValid:!1,value:null,errors:["Game code must be a string"]};const n=t.trim();return n.length!==6&&e.push("Game code must be exactly 6 digits"),/^\d{6}$/.test(n)||e.push("Game code must contain only digits"),{isValid:e.length===0,value:e.length===0?n:null,errors:e}}function N2(t){return!t||!t.code?(t==null?void 0:t.message)||"An unexpected error occurred":{"auth/invalid-email":"Invalid email address","auth/user-disabled":"This account has been disabled","auth/user-not-found":"No account found with this email","auth/wrong-password":"Incorrect password","auth/email-already-in-use":"This email is already registered","auth/weak-password":"Password is too weak. Please use at least 6 characters","auth/operation-not-allowed":"This operation is not allowed","auth/too-many-requests":"Too many requests. Please try again later","auth/network-request-failed":"Network error. Please check your connection","auth/popup-closed-by-user":"Sign-in popup was closed","auth/cancelled-popup-request":"Sign-in was cancelled"}[t.code]||t.message||"An authentication error occurred"}function P2(t){return!t||!t.code?(t==null?void 0:t.message)||"A database error occurred":{"permission-denied":"You do not have permission to perform this action",unavailable:"Service temporarily unavailable. Please try again","network-error":"Network error. Please check your connection"}[t.code]||t.message||"A database error occurred"}function ji(t){return typeof t=="string"?t:t?t.code&&t.code.startsWith("auth/")?N2(t):t.code&&(t.code==="permission-denied"||t.code==="unavailable")?P2(t):t.message||"An unexpected error occurred":"An unexpected error occurred"}function OB(t,e=""){}function ts(){const t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${s}`}class Yi{constructor(e){this.seed=e%2147483647,this.seed<=0&&(this.seed+=2147483646)}next(){return this.seed=this.seed*16807%2147483647,(this.seed-1)/2147483646}}function Lc(t,e=0,n="daily",s=!1,r=null,i=1){let o=0;const a=`${t}-${n}-${s}-${e}-${i}-${r||"none"}`;for(let l=0;l<a.length;l++){const c=a.charCodeAt(l);o=(o<<5)-o+c,o=o|0}return Math.abs(o)+e*1e6+i*1e4+(r||0)*1e5}function D2(t,e,n=0,s="daily",r=!1,i=null,o=1){if(!t||t.length===0)throw new Error("Word list is empty");const a=Lc(e,n,s,r,i,o),l=new Yi(a),c=Math.floor(l.next()*t.length);return t[c]}function v_(t,e,n="daily",s=!1,r=null,i=[1,2,3,4],o=null){const a=o||ts(),l=[],c=new Set;if(n==="marathon"&&r!==null&&r>0)for(let f=0;f<r;f++){const m=i[f]||1,g=new Set;for(let y=0;y<m;y++){let S,T=0;const w=t.length;do{if(S=D2(t,a,y,n,s,f,m),T>0){const b=Lc(a,y+T*1e3,n,s,f,m),_=new Yi(b),k=Math.floor(_.next()*t.length);S=t[k]}T++}while(g.has(S)&&T<w);g.add(S),c.add(S)}}const h=c.size>0?t.filter(f=>!c.has(f)):t,d=h.length>0?h:t;for(let f=0;f<e;f++){let m,g=0;const y=d.length;do{const S=Lc(a,f,n,s,r,e),T=new Yi(S),w=Math.floor(T.next()*d.length);if(m=d[w],g>0){const b=Lc(a,f+g*1e3,n,s,r,e),_=new Yi(b),k=Math.floor(_.next()*d.length);m=d[k]}g++}while(c.has(m)&&g<y);c.add(m),l.push(m)}return l}const di="mw:";function zn(t,e=null){try{const n=window.localStorage.getItem(t);return n?JSON.parse(n):e}catch{return e}}function Qt(t,e){try{window.localStorage.setItem(t,JSON.stringify(e))}catch{}}function M2(t,e,n=null){const s=n||ts();return`${di}game:daily:${t}:${e?"speedrun":"standard"}:${s}`}function w_(t,e=null){const n=e||ts();return`${di}game:marathon:${t?"speedrun":"standard"}:${n}`}function O2(t=null){const e=t||ts();return`${di}game:solutionhunt:standard:${e}`}function el(t){return`${di}meta:marathon:${t?"speedrun":"standard"}`}function Fi(t,e,n,s=null,r=null){const i=r||ts();return t==="marathon"?`${di}solved:${t}:${e}:${n?"speedrun":"standard"}:${s}:${i}`:`${di}solved:${t}:${e}:${n?"speedrun":"standard"}:${i}`}function sd(t,e){return`${di}streak:${t}:${e?"speedrun":"standard"}`}function __(t){if(!t)return null;const e=t.split("-");if(e.length!==3)return null;const[n,s,r]=e.map(o=>parseInt(o,10));if(!Number.isFinite(n)||!Number.isFinite(s)||!Number.isFinite(r))return null;const i=new Date(Date.UTC(n,s-1,r));return Number.isNaN(i.getTime())?null:i}function j2(t,e){const n=__(t),s=__(e);if(!n||!s)return!1;const r=24*60*60*1e3;return Math.round((s-n)/r)===1}function OE(t,e){const n=sd(t,e),s=zn(n,null);return s?{current:typeof s.current=="number"?s.current:0,best:typeof s.best=="number"?s.best:0,lastDate:s.lastDate||null}:{current:0,best:0,lastDate:null}}function F2(t,e,n=null){const s=n||ts(),r=sd(t,e),i=zn(r,null);if(!i){const f={current:1,best:1,lastDate:s};return Qt(r,f),f}const o=i.lastDate||null,a=typeof i.current=="number"?i.current:0,l=typeof i.best=="number"?i.best:0;if(o===s)return{current:a,best:l,lastDate:s};const c=o&&j2(o,s)?a+1:1,h=Math.max(l,c),d={current:c,best:h,lastDate:s};return Qt(r,d),d}async function jE(t,e,n,s,r){if(!t)throw new Error("User must be signed in to submit scores");const i=Z(K,`leaderboard/${n}`),o=Ch(i),a={userId:t,userName:e||"Anonymous",numBoards:s,timeMs:r,timestamp:Date.now()};return await Pt(o,a),o.key}function jB(t,e=null,n=100){const[s,r]=p.useState([]),[i,o]=p.useState(!0),[a,l]=p.useState(null);return p.useEffect(()=>{if(!t){o(!1);return}o(!0),l(null);const c=Z(K,`leaderboard/${t}`),h=new Date,d=Date.UTC(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate()),f=Date.UTC(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate()+1),m=Ih(c,Th(Math.min(n*3,500))),g=Un(m,y=>{try{const S=y.val();if(!S){r([]),o(!1);return}let T=Object.entries(S).map(([w,b])=>({id:w,...b})).map(w=>{const b={...w},_=Number(b.timeMs);b.timeMs=Number.isFinite(_)?_:NaN;const k=Number(b.numBoards);return b.numBoards=Number.isFinite(k)?k:null,b}).filter(w=>Number.isFinite(w.timeMs));T=T.filter(w=>typeof w.timestamp!="number"?!1:w.timestamp>=d&&w.timestamp<f),e!==null&&(T=T.filter(w=>w.numBoards===e)),T.sort((w,b)=>w.timeMs!==b.timeMs?w.timeMs-b.timeMs:w.timestamp-b.timestamp),T=T.slice(0,n),r(T),o(!1)}catch(S){l(S.message),o(!1)}},y=>{l(y.message),o(!1)});return()=>{g()}},[t,e,n]),{entries:s,loading:i,error:a}}const Fu="mw:pendingLeaderboard";function L2(t){const e=zn(Fu,[]);Array.isArray(e)&&(e.push({mode:t.mode,numBoards:t.numBoards,timeMs:t.timeMs}),Qt(Fu,e))}function $2(){const t=zn(Fu,[]);return Qt(Fu,[]),Array.isArray(t)?t:[]}async function B2(t){if(!(t!=null&&t.uid))return;const e=$2(),n=t.displayName||t.email||"Anonymous";for(const s of e)try{await jE(t.uid,n,s.mode,s.numBoards,s.timeMs)}catch{}}class U2{constructor(e={}){this.offlineQueue=[],this.isOnline=typeof navigator<"u"?navigator.onLine:!0,this.retryAttempts=e.retryAttempts||3,this.retryDelay=e.retryDelay||1e3,this.maxQueueSize=e.maxQueueSize||100,typeof window<"u"&&(window.addEventListener("online",()=>{this.isOnline=!0,this.processQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1}))}async sync(e,n,s){if(!n&&!s)return null;if(!n)return s;if(!s)return n;const r=typeof n.timestamp=="number"?n.timestamp:0;return(typeof s.timestamp=="number"?s.timestamp:0)>=r?s:n}queueUpdate(e,n,s={}){this.offlineQueue.length>=this.maxQueueSize&&this.offlineQueue.shift(),this.offlineQueue.push({key:e,updateFn:n,metadata:s,timestamp:Date.now(),attempts:0}),this.isOnline&&this.processQueue()}async processQueue(){if(!this.isOnline||this.offlineQueue.length===0)return;const e=[...this.offlineQueue];this.offlineQueue=[];for(const n of e)try{await n.updateFn()}catch{n.attempts++,n.attempts<this.retryAttempts?setTimeout(()=>{this.offlineQueue.push(n),this.processQueue()},this.retryDelay*Math.pow(2,n.attempts-1)):(`${n.key}${this.retryAttempts}`,void 0)}}getConnectionStatus(){return this.isOnline}getQueueSize(){return this.offlineQueue.length}clearQueue(){this.offlineQueue=[]}}const ys=new U2;async function FE({authUser:t,database:e,solvedKey:n}){let s=null,r=null;if(t&&e)try{const{ref:o,get:a}=await Je(async()=>{const{ref:h,get:d}=await Promise.resolve().then(()=>$s);return{ref:h,get:d}},void 0),l=o(e,`users/${t.uid}/singlePlayer/solvedStates/${n}`),c=await a(l);c.exists()&&(s=c.val()||null)}catch{}r=zn(n,null);const i=await ys.sync(n,r,s);return i&&i===s&&i!==r&&Qt(n,i),i&&i===r&&i!==s&&t&&e&&ys.queueUpdate(`sync-${n}`,async()=>{const{ref:o,set:a}=await Je(async()=>{const{ref:c,set:h}=await Promise.resolve().then(()=>$s);return{ref:c,set:h}},void 0),l=o(e,`users/${t.uid}/singlePlayer/solvedStates/${n}`);await a(l,i)},{type:"solvedState",key:n}),i}async function Pp({authUser:t,database:e,solvedKey:n,value:s}){const r=s?{...s,timestamp:Date.now()}:null;Qt(n,r),t&&e&&s&&(ys.queueUpdate(`save-${n}`,async()=>{const{ref:i,set:o}=await Je(async()=>{const{ref:l,set:c}=await Promise.resolve().then(()=>$s);return{ref:l,set:c}},void 0),a=i(e,`users/${t.uid}/singlePlayer/solvedStates/${n}`);await o(a,r)},{type:"solvedState",key:n}),ys.getConnectionStatus()&&ys.processQueue())}async function LE({authUser:t,database:e,gameStateKey:n}){let s=null,r=0,i=null,o=0;if(t&&e)try{const{ref:a,get:l}=await Je(async()=>{const{ref:d,get:f}=await Promise.resolve().then(()=>$s);return{ref:d,get:f}},void 0),c=a(e,`users/${t.uid}/singlePlayer/gameStates/${n}`),h=await l(c);if(h.exists()&&(s=h.val()||null,s)){const d=y_(s);d.isValid?typeof s.timestamp=="number"&&(r=s.timestamp):(`${d.errors.join(", ")}`,s=null)}}catch{}if(i=zn(n,null),i){const a=y_(i);a.isValid?typeof i.timestamp=="number"&&(o=i.timestamp):(`${a.errors.join(", ")}`,i=null)}if(s&&i){if(r>=o)return Qt(n,s),s;if(t&&e)try{const{ref:a,set:l}=await Je(async()=>{const{ref:h,set:d}=await Promise.resolve().then(()=>$s);return{ref:h,set:d}},void 0),c=a(e,`users/${t.uid}/singlePlayer/gameStates/${n}`);await l(c,i)}catch{}return i}return s||i}async function z2({authUser:t,database:e,gameStateKey:n,value:s}){const r=s?{...s,timestamp:Date.now()}:null;Qt(n,r),t&&e&&(ys.queueUpdate(`save-${n}`,async()=>{const{ref:i,set:o}=await Je(async()=>{const{ref:l,set:c}=await Promise.resolve().then(()=>$s);return{ref:l,set:c}},void 0),a=i(e,`users/${t.uid}/singlePlayer/gameStates/${n}`);await o(a,r)},{type:"gameState",key:n}),ys.getConnectionStatus()&&ys.processQueue())}async function $E({authUser:t,database:e,mode:n,speedrunEnabled:s}){const o=`${n==="daily"?"daily":"marathon"}_${s?"speedrun":"standard"}`,a=sd(n,s);if(!t||!e)return zn(a,null);try{const{ref:l,get:c}=await Je(async()=>{const{ref:m,get:g}=await Promise.resolve().then(()=>$s);return{ref:m,get:g}},void 0),h=l(e,`users/${t.uid}/streaks/${o}`),d=await c(h);if(!d.exists()){const m=zn(a,null);return m&&(typeof m.current=="number"&&m.current>0||typeof m.best=="number"&&m.best>0)&&await rd({authUser:t,database:e,mode:n,speedrunEnabled:s,streakInfo:{current:m.current,best:m.best,lastDate:m.lastDate||null}}),m}const f=d.val()||null;return f?(Qt(a,f),f):zn(a,null)}catch{return zn(a,null)}}async function rd({authUser:t,database:e,mode:n,speedrunEnabled:s,streakInfo:r}){const i=sd(n,s);if(Qt(i,r),!t||!e)return;const l=`${n==="daily"?"daily":"marathon"}_${s?"speedrun":"standard"}`;try{const{ref:c,set:h}=await Je(async()=>{const{ref:f,set:m}=await Promise.resolve().then(()=>$s);return{ref:f,set:m}},void 0),d=c(e,`users/${t.uid}/streaks/${l}`);await h(d,r)}catch{}}async function BE(t,e){if(!(t!=null&&t.uid)||!e)return;const n=[{mode:"daily",speedrunEnabled:!1},{mode:"daily",speedrunEnabled:!0},{mode:"marathon",speedrunEnabled:!1},{mode:"marathon",speedrunEnabled:!0}];try{const{ref:s,get:r}=await Je(async()=>{const{ref:d,get:f}=await Promise.resolve().then(()=>$s);return{ref:d,get:f}},void 0),i=s(e,`users/${t.uid}/streaks`),o=await r(i),a=o.exists()?o.val()||{}:{},l=d=>d==="daily"?"daily":"marathon",c=d=>d?"speedrun":"standard",h=(d,f)=>`${l(d)}_${c(f)}`;for(const{mode:d,speedrunEnabled:f}of n){const m=h(d,f);if(a[m])continue;const g=OE(d,f);(typeof g.current=="number"&&g.current>0||typeof g.best=="number"&&g.best>0)&&await rd({authUser:t,database:e,mode:d,speedrunEnabled:f,streakInfo:{current:g.current,best:g.best,lastDate:g.lastDate||null}})}}catch{}}const V2=Object.freeze(Object.defineProperty({__proto__:null,loadGameState:LE,loadSolvedState:FE,loadStreakRemoteAware:$E,saveGameState:z2,saveSolvedState:Pp,saveStreakRemoteAware:rd,syncLocalStreaksToRemoteOnLogin:BE},Symbol.toStringTag,{value:"Module"})),Yg=30*60*1e3;function UE(t){const[e,n]=p.useState(null),[s,r]=p.useState(!0);p.useEffect(()=>{if(!(t!=null&&t.uid)){n(null),r(!1);return}const o=`users/${t.uid}/notificationSeenAt`,a=Z(K,o),l=Un(a,c=>{const h=c.val();n(typeof h=="number"?h:null),r(!1)},c=>{r(!1)});return()=>l()},[t==null?void 0:t.uid]);const i=p.useCallback(async()=>{if(!(t!=null&&t.uid))return;const o=`users/${t.uid}/notificationSeenAt`,a=Date.now();n(a);const l=Z(K,o);Pt(l,a).catch(c=>{})},[t==null?void 0:t.uid]);return{notificationSeenAt:e,markNotificationsSeen:i,loading:s}}function Dp(t){if(t&&typeof t.timestamp=="number")return t.timestamp;if(t&&t.sentAt){const e=new Date(t.sentAt).getTime();if(!Number.isNaN(e))return e}return 0}function W2(t,e,n){const s=n||0,r=Array.isArray(t)?t.filter(o=>Dp(o)>s).length:0,i=Array.isArray(e)?e.filter(o=>(o.createdAt||0)>s).length:0;return r+i}function S_(t,e,n){const s=n||0,r=Array.isArray(t)?t.filter(o=>Dp(o)>s).map(o=>({id:o.id,type:"friendRequest",label:`Friend request from ${o.fromName||"Someone"}`,time:Dp(o),fromUserId:o.id})):[],i=Array.isArray(e)?e.filter(o=>(o.createdAt||0)>s).map(o=>({id:o.id,type:"challenge",label:`Game invitation from ${o.fromUserName||"Someone"}`,time:o.createdAt||0,fromUserId:o.fromUserId})):[];return[...r,...i].sort((o,a)=>a.time-o.time)}function Dr(t){if(!t)return!1;const n=(t.providerData||[]).some(s=>s&&s.providerId==="google.com");return!!t.emailVerified||n}function Nt(t){if(!t)return null;if(typeof t=="string")return t;const e=t.code||"";return e==="auth/network-request-failed"?"Network error. Please check your internet connection and try again.":e==="auth/too-many-requests"?"Too many attempts. Please wait a bit and try again.":t.message||"Something went wrong with authentication. Please try again."}const hc="linkGoogleReturnTo";function On(){const t=br(),[e,n]=p.useState(null),[s,r]=p.useState(!0),[i,o]=p.useState(null),[a,l]=p.useState([]),[c,h]=p.useState([]),[d,f]=p.useState([]),[m,g]=p.useState([]),[y,S]=p.useState(!1);p.useEffect(()=>{AN(ue).then(v=>{if(v){n(ue.currentUser),S(!0);const x=sessionStorage.getItem(hc)||"/profile";sessionStorage.removeItem(hc),t(x)}}).catch(v=>{v.code==="auth/credential-already-in-use"||v.code==="auth/provider-already-linked"?o("Google account is already linked."):o(Nt(v)),sessionStorage.removeItem(hc)})},[t]),p.useEffect(()=>{let v=!0,x=null,A=null,P=null,Q=null;const U=JR(ue,R=>{if(x&&(x(),x=null),A&&(A(),A=null),P&&(P(),P=null),n(R),R){(async()=>{try{await B2(R),await BE(R,K)}catch{}})();const ie=(R.providerData||[]).some(se=>se&&se.providerId==="password"),he=!!R.displayName;if(ie&&!he){const de=`wuzzle-games-player-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;Cv(R,{displayName:de}).then(()=>{v&&n({...R,displayName:de})}).catch(ae=>{console.error("Failed to assign default username:",ae)})}(async()=>{try{const se=Z(K,`users/${R.uid}/profile`),de=R.email||null,ae=R.displayName||null,re=new Date().toISOString();if(await Pt(se,{uid:R.uid,email:de,username:ae,updatedAt:re}),ae){const ye=ae.trim().toLowerCase();ye&&await Pt(Z(K,`usernames/${ye}`),{uid:R.uid})}if(de){const ye=de.trim().toLowerCase().replace(/[.#$\[\]]/g,"_");ye&&await Pt(Z(K,`emails/${ye}`),{uid:R.uid})}}catch(se){console.error("Failed to update user profile indexes:",se)}})()}if(R){if(!Dr(R)){l([]),h([]),f([]),g([]),r(!1),o(null);return}const he=Z(K,`users/${R.uid}/friends`);x=Un(he,re=>{if(re.exists()){const ye=re.val(),Ne=Object.entries(ye).map(([Te,E])=>({id:Te,...E}));l(Ne)}else l([])});const se=Z(K,`users/${R.uid}/friendRequests`);A=Un(se,re=>{if(re.exists()){const ye=re.val(),Ne=Object.entries(ye).map(([Te,E])=>({id:Te,...E}));h(Ne)}else h([])});const de=Z(K,`users/${R.uid}/challenges`);P=Un(de,re=>{if(re.exists()){const ye=re.val(),Ne=Object.entries(ye).map(([Te,E])=>({id:Te,...E}));Ne.sort((Te,E)=>{const z=Te.createdAt||Te.sentAt||0;return(E.createdAt||E.sentAt||0)-z}),f(Ne)}else f([])});const ae=Z(K,`users/${R.uid}/sentChallenges`);Q=Un(ae,re=>{if(re.exists()){const ye=re.val(),Ne=Object.entries(ye).map(([Te,E])=>({id:Te,...E}));Ne.sort((Te,E)=>{const z=Te.createdAt||Te.sentAt||0;return(E.createdAt||E.sentAt||0)-z}),g(Ne)}else g([])}),r(!1),o(null)}else l([]),h([]),f([]),g([]),r(!1),o(null)});return()=>{v=!1,x&&x(),A&&A(),P&&P(),Q&&Q(),U()}},[]);const T=p.useCallback(async()=>{var v;try{return o(null),r(!0),(await SN(ue,g_)).user}catch(x){if(x.code==="auth/account-exists-with-different-credential"){const A=((v=x.customData)==null?void 0:v.email)||x.email||null,P="An account with this email already exists. Please sign in with email and password, then link Google from your Profile.";try{if(A&&!(await KR(ue,A)).includes("password"))throw o(x.message),x}catch(U){console.error("Error handling account-exists-with-different-credential:",U)}const Q=new Error(P);throw Q.code=x.code,A&&(Q.email=A),o(Q.message),Q}throw o(Nt(x)),x}finally{r(!1)}},[]),w=p.useCallback(async(v,x)=>{try{o(null),r(!0);const A=await HR(ue,v,x);try{await bv(A.user)}catch(P){console.error("Failed to send verification email:",P)}return A.user}catch(A){throw o(Nt(A)),A}finally{r(!1)}},[]),b=p.useCallback(async(v,x)=>{try{return o(null),r(!0),(await GR(ue,v,x)).user}catch(A){throw o(Nt(A)),A}finally{r(!1)}},[]),_=p.useCallback(async v=>{try{if(o(null),r(!0),!v)throw new Error("Please enter your email address to reset your password.");return await WR(ue,v),!0}catch(x){throw o(Nt(x)),x}finally{r(!1)}},[]),k=p.useCallback(async()=>{try{o(null),await ZR(ue)}catch(v){throw o(Nt(v)),v}},[]),O=p.useCallback(async v=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");const x=(v||"").trim();if(!x)throw new Error("Username cannot be empty");const A=ue.currentUser.uid,P=ue.currentUser.displayName||null,Q=P?P.trim().toLowerCase():null;await Cv(ue.currentUser,{displayName:x}),n({...ue.currentUser,displayName:x});const U=new Date().toISOString(),R=Z(K,`users/${A}/profile`);await It(R,{username:x,updatedAt:U});const ie=x.toLowerCase();if(ie&&await Pt(Z(K,`usernames/${ie}`),{uid:A}),Q&&Q!==ie)try{await jt(Z(K,`usernames/${Q}`))}catch(he){console.error("Failed to remove old username index:",he)}return!0}catch(x){throw o(Nt(x)),x}},[]),q=p.useCallback(async()=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");const v=ue.currentUser.uid,x=ue.currentUser.email||null,A=ue.currentUser.displayName||null;try{const P=Z(K,`users/${v}`);if(await jt(P),A){const Q=A.trim().toLowerCase();Q&&await jt(Z(K,`usernames/${Q}`))}if(x){const Q=x.trim().toLowerCase().replace(/[.#$\[\]]/g,"_");Q&&await jt(Z(K,`emails/${Q}`))}}catch(P){console.error("Failed to remove user social data before account deletion:",P)}return await eN(ue.currentUser),!0}catch(v){throw o(Nt(v)),v}},[]),I=p.useCallback(async(v,x)=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");if(!Dr(ue.currentUser))throw new Error("You must verify your email or sign in with Google to use friends.");if(!x||typeof x!="string")throw new Error("Invalid friend ID");const A=ue.currentUser.displayName||ue.currentUser.email||"Unknown",P=R2(A),Q=P.isValid?P.value:A,U=Z(K,`users/${x}/friendRequests/${ue.currentUser.uid}`),R=Z(K,`users/${ue.currentUser.uid}/friendRequests/${x}`),he={from:ue.currentUser.uid,fromName:Q,sentAt:new Date().toISOString(),timestamp:Date.now()};await pa(U,ae=>ae&&typeof ae=="object"?{...ae,...he}:he);const se=Z(K,`users/${ue.currentUser.uid}/friendRequests/${x}`);return(await Ye(se)).exists(),!0}catch(A){const P=ji(A)||Nt(A)||"Failed to send friend request";throw o(P),A}},[]),N=p.useCallback(async(v,x)=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");if(!Dr(ue.currentUser))throw new Error("You must verify your email or sign in with Google to use friends.");const A=new Date().toISOString(),P=Z(K,`users/${ue.currentUser.uid}/friends/${v}`);await Pt(P,{name:x,addedAt:A});const Q=Z(K,`users/${v}/friends/${ue.currentUser.uid}`);await Pt(Q,{name:ue.currentUser.displayName||"Unknown",addedAt:A});const U=Z(K,`users/${ue.currentUser.uid}/friendRequests/${v}`);return await jt(U),h(R=>R.filter(ie=>ie.id!==v)),l(R=>R.some(ie=>ie.id===v)?R:[...R,{id:v,name:x,addedAt:A}]),!0}catch(A){throw o(Nt(A)),A}},[]),M=p.useCallback(async(v,x=null,A=null)=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");if(!Dr(ue.currentUser))throw new Error("You must verify your email or sign in with Google to use friends.");const P=Z(K,`users/${ue.currentUser.uid}/friendRequests/${v}`);if(await jt(P),x&&typeof A=="function")try{await A(x,"declined")}catch(Q){console.error("Failed to update multiplayer friendRequestStatus:",Q)}return!0}catch(P){throw o(Nt(P)),P}},[]),j=p.useCallback(async v=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");if(!Dr(ue.currentUser))throw new Error("You must verify your email or sign in with Google to use friends.");const x=Z(K,`users/${ue.currentUser.uid}/friends/${v}`);await jt(x);const A=Z(K,`users/${v}/friends/${ue.currentUser.uid}`);return await jt(A),l(P=>P.filter(Q=>Q.id!==v)),!0}catch(x){throw o(Nt(x)),x}},[]),ne=p.useCallback(async(v,x,A,P,Q)=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");if(!Dr(ue.currentUser))throw new Error("You must verify your email or sign in with Google to use friends.");const U=ue.currentUser.uid,R=ue.currentUser.displayName||ue.currentUser.email||"Unknown",ie=Z(K,`users/${U}/challenges`),he=await Ye(ie);if(he.exists()){const ye=he.val();if(Object.values(ye).some(Te=>Te&&Te.fromUserId===v&&(Te.status==="pending"||Te.status===void 0||Te.status===null)))return!1}let se="standard";typeof Q=="string"?se=Q:Q===!0&&(se="speedrun");const de=Date.now(),ae={fromUserId:U,fromUserName:R,toUserId:v,toUserName:x,gameCode:A,boards:P,variant:se,speedrun:se==="speedrun",solutionHunt:se==="solutionhunt",status:"pending",createdAt:de},re={};return re[`users/${v}/challenges/${A}`]=ae,re[`users/${U}/sentChallenges/${A}`]=ae,await It(Z(K),re),!0}catch(U){throw console.error("sendChallenge error:",U),o(Nt(U)),U}},[]),oe=p.useCallback(async v=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");const x=Z(K,`users/${ue.currentUser.uid}/challenges/${v}`),A=await Ye(x);if(!A.exists())throw new Error("Challenge not found");const P=A.val();return await jt(x),P}catch(x){throw console.error("acceptChallenge error:",x),o(Nt(x)),x}},[]),ve=p.useCallback(async(v,x=null)=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");const A=Z(K,`users/${ue.currentUser.uid}/challenges/${v}`),P=await Ye(A);let Q=null,U=x||v;if(P.exists()){const R=P.val();Q=R.fromUserId||null,U||(U=R.gameCode||v)}if(await jt(A),Q&&U)try{const R=Z(K,`users/${Q}/sentChallenges/${U}`);await jt(R)}catch(R){console.error("Failed to remove challenge from sender's sentChallenges after dismiss:",R)}if(U)try{const R=Z(K,`multiplayer/${U}`),ie=await Ye(R);if(ie.exists()){const he=ie.val(),se=Object.keys(he.players||{}).length;if(he.challengeOnly===!0&&se<=1){const de=ue.currentUser.displayName||ue.currentUser.email||"Your friend";await It(R,{status:"cancelled",cancelledByName:de})}}}catch(R){console.error("Failed to mark multiplayer game as cancelled after dismissing challenge:",R)}return!0}catch(A){throw console.error("dismissChallenge error:",A),o(Nt(A)),A}},[]),Se=p.useCallback(async v=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");const x=ue.currentUser.uid,A=Z(K,`users/${x}/sentChallenges/${v}`),P=await Ye(A);let Q=null,U=!1;if(P.exists()){const R=P.val();Q=R.toUserId||R.friendId||null,U=(R.createdAt||0)+Yg<Date.now()}if(await jt(A),Q&&!U)try{const R=Z(K,`users/${Q}/challenges/${v}`);await jt(R)}catch(R){console.error("Failed to remove incoming challenge after host cancelled sent challenge:",R)}try{const R=Z(K,`multiplayer/${v}`),ie=await Ye(R);if(ie.exists()&&ie.val().challengeOnly===!0){const se=ue.currentUser.displayName||ue.currentUser.email||"You";await It(R,{status:"cancelled",cancelledByName:se})}}catch(R){console.error("Failed to mark multiplayer game as cancelled after host cancelled sent challenge:",R)}return!0}catch(x){throw console.error("cancelSentChallenge error:",x),o(Nt(x)),x}},[]),Y=p.useCallback(async v=>{const x=(v||"").trim();if(!x)throw new Error("Please enter an email or username.");const A=x.includes("@"),P=x.toLowerCase();let Q;if(A){const re=P.replace(/[.#$\[\]]/g,"_");Q=Z(K,`emails/${re}`)}else Q=Z(K,`usernames/${P}`);const U=await Ye(Q);if(!U.exists())return null;const R=U.val(),ie=typeof R=="string"?R:R==null?void 0:R.uid;if(!ie)return null;if(ue.currentUser&&ue.currentUser.uid===ie)throw new Error("You cannot add yourself as a friend.");const he=await Ye(Z(K,`users/${ie}/profile`));let se=null,de=null;if(he.exists()){const re=he.val()||{};se=re.username||re.displayName||null,de=re.email||null}return{uid:ie,name:se||de||"Player"}},[]),C=p.useCallback(async v=>{try{o(null);const x=await Y(v);if(!x)throw new Error("No user found with that email or username.");return await I(x.name,x.uid),!0}catch(x){throw console.error("sendFriendRequestByIdentifier error:",x),o(Nt(x)),x}},[Y,I]),$=Dr(e),G=p.useCallback(async()=>{try{if(o(null),!ue.currentUser)throw new Error("No user signed in");return await bv(ue.currentUser),!0}catch(v){throw o(Nt(v)),v}},[]),B=p.useCallback(async(v="/profile")=>{if(o(null),!ue.currentUser)throw new Error("No user signed in");sessionStorage.setItem(hc,v),await IN(ue.currentUser,g_)},[]),D=p.useCallback(()=>{S(!1)},[]);return{user:e,loading:s,error:i,friends:a,friendRequests:c,incomingChallenges:d,sentChallenges:m,isVerifiedUser:$,signInWithGoogle:T,signUpWithEmail:w,signInWithEmail:b,resetPassword:_,signOut:k,updateUsername:O,deleteAccount:q,sendFriendRequest:I,sendFriendRequestByIdentifier:C,acceptFriendRequest:N,declineFriendRequest:M,removeFriend:j,sendChallenge:ne,acceptChallenge:oe,dismissChallenge:ve,cancelSentChallenge:Se,resendVerificationEmail:G,linkGoogleAccount:B,linkGoogleJustCompleted:y,clearLinkGoogleJustCompleted:D,formatAuthErrorForDisplay:Nt}}const H2="/better-wordle/logo.png",dc="registered";function G2(t){const[e,n]=p.useState({}),[s,r]=p.useState(!0),[i,o]=p.useState(null),a=p.useRef(!1);return p.useEffect(()=>{if(!(t!=null&&t.uid)){n({}),r(!1),o(null),a.current=!1;return}let l=!0;async function c(){r(!0),o(null);try{const h=Z(K,`users/${t.uid}/badges`),f=(await Ye(h)).val()||{},m=typeof f=="object"&&!Array.isArray(f)?f:{};!(m[dc]===!0||m[dc]!=null)&&!a.current?(a.current=!0,await Pt(h,{...m,[dc]:!0}),n({...m,[dc]:!0})):n(m)}catch(h){l&&(o((h==null?void 0:h.message)||"Failed to load badges"),n({}))}finally{r(!1)}}return c(),()=>{l=!1}},[t==null?void 0:t.uid]),{userBadges:e,loading:s,error:i}}function Qg(t){const[e,n]=p.useState({}),[s,r]=p.useState(!0);return p.useEffect(()=>{if(!t){n({}),r(!1);return}let i=!0;return r(!0),Ye(Z(K,`users/${t}/badges`)).then(o=>{const a=o.val()||{},l=typeof a=="object"&&!Array.isArray(a)?a:{};n(l)}).catch(()=>{i&&n({})}).finally(()=>{r(!1)}),()=>{i=!1}},[t]),{userBadges:e,loading:s}}async function Sa({database:t,uid:e,badgeId:n}){if(!e||!n)return;const s=Z(t,`users/${e}/badges`);if(((await Ye(s)).val()||{})[n]!=null)return;const o={[`users/${e}/badges/${n}`]:{earnedAt:Date.now()}};await It(Z(t),o)}const pf="premium_member",q2=600;function id(t){const[e,n]=p.useState(!1),[s,r]=p.useState(!0),[i,o]=p.useState(!1),[a,l]=p.useState(null),[c,h]=p.useState(null),[d,f]=p.useState(null),m=p.useRef(null),g=p.useRef(null),y=p.useRef(null),S=p.useRef(null),T=p.useRef({isSubscribed:e,loading:s});T.current={isSubscribed:e,loading:s};const w=async()=>{var b;try{if(!ue.currentUser)return null;const _=await ue.currentUser.getIdTokenResult(!0);return((b=_==null?void 0:_.claims)==null?void 0:b.stripeRole)||null}catch(_){return console.error("Failed to get custom claim:",_),null}};return p.useEffect(()=>{if(!(t!=null&&t.uid)){n(!1),r(!1),o(!1),l(null),h(null),f(null),S.current&&(clearTimeout(S.current),S.current=null);return}let b=!0;r(!0),l(null),w().then(M=>{b&&(y.current=M,f(M))});const _=n2(vE(ME,"customers",t.uid,"subscriptions"),s2("status","in",["trialing","active"])),k=PE(_,async M=>{var C;const j=M.docs.filter($=>{const B=$.data().status;return B==="active"||B==="trialing"}),ne=j.length>0,oe=((C=j[0])==null?void 0:C.data())||null;h(oe);const ve=await w();y.current=ve,f(ve);const Se=ve||d,Y=ne||(Se==null?void 0:Se.toLowerCase())==="premium";n(Y),Y&&oe&&K2(t.uid,oe).catch($=>{console.error("Failed to sync subscription to Realtime Database:",$)}),Y&&Sa({database:K,uid:t.uid,badgeId:pf}).catch($=>{console.error("Failed to grant premium badge:",$)}),r(!1)},M=>{b&&(console.error("Firestore subscription error:",M),w().then(j=>{b&&(y.current=j,f(j),n((j==null?void 0:j.toLowerCase())==="premium"),r(!1))}))});g.current=k;const O=`users/${t.uid}/subscription`,q=Z(K,O),I=Un(q,M=>{const j=M.val();if(j&&typeof j=="object"){const ne=j.status,oe=j.expiresAt,ve=Date.now();ne==="active"&&(oe==null||typeof oe=="number"&&oe>ve)&&!T.current.isSubscribed&&(n(!0),Sa({database:K,uid:t.uid,badgeId:pf}).catch(Y=>{console.error("Failed to grant premium badge:",Y)}))}},M=>{console.error("Realtime DB subscription error:",M)});m.current=I;const N=setInterval(async()=>{if(!b||!ue.currentUser)return;const M=await w();if(b){const j=y.current;y.current=M,f(M),(M==null?void 0:M.toLowerCase())==="premium"&&(j==null?void 0:j.toLowerCase())!=="premium"&&(n(!0),Sa({database:K,uid:t.uid,badgeId:pf}).catch(ne=>{console.error("Failed to grant premium badge:",ne)}))}},3e4);return()=>{b=!1,clearInterval(N),y.current=null,g.current&&(g.current(),g.current=null),m.current&&(Ym(q),m.current=null)}},[t==null?void 0:t.uid]),p.useEffect(()=>{if(s||e){S.current&&(clearTimeout(S.current),S.current=null),o(!1);return}return S.current=setTimeout(()=>{S.current=null,T.current.isSubscribed||o(!0)},q2),()=>{S.current&&(clearTimeout(S.current),S.current=null)}},[s,e]),{isSubscribed:e,loading:s,showSubscriptionGate:i,error:a,subscriptionData:c,stripeRole:d}}async function K2(t,e){if(!t||!e)return;const n=Z(K,`users/${t}/subscription`),s=e.status;let r=e.current_period_end,i=null;r&&(typeof r=="object"&&r.toMillis?i=r.toMillis():typeof r=="number"&&(i=r>1e12?r:r*1e3));let o=Date.now();e.created&&(typeof e.created=="object"&&e.created.toMillis?o=e.created.toMillis():typeof e.created=="number"&&(o=e.created>1e12?e.created:e.created*1e3));const a={status:s==="active"||s==="trialing"?"active":"inactive",activatedAt:o,expiresAt:i,autoRenew:s==="active"||s==="trialing",stripeSubscriptionId:e.id||null,updatedAt:Date.now()};await Pt(n,a)}function Y2(){const[t,e]=p.useState("");return p.useEffect(()=>{const n=()=>{const r=new Date,i=new Date(r);i.setDate(i.getDate()+1),i.setHours(0,0,0,0);const o=i-r,a=Math.floor(o/(1e3*60*60)),l=Math.floor(o%(1e3*60*60)/(1e3*60)),c=Math.floor(o%(1e3*60)/1e3);a>0?e(`${a}h ${l}m`):l>0?e(`${l}m ${c}s`):e(`${c}s`)};n();const s=setInterval(n,1e3);return()=>clearInterval(s)},[]),t}const Q2=[{id:"registered",name:"Wuzzle Games Member",description:"Earned by creating an account and joining the community. Welcome to Wuzzle Games!"},{id:"daily_player",name:"Daily Player",description:"Earned by completing at least one game of Daily Wuzzle Games."},{id:"premium_member",name:"Premium Member",description:"Unlocked by subscribing to Wuzzle Games Premium. Access to themed wordles, custom colors, and more!"},{id:"party_starter",name:"Party starter",description:"Earn this badge by creating a multiplayer room for the first time."}];function X2(t){return!t||typeof t!="object"?[]:Q2.filter(e=>t[e.id]===!0||t[e.id]!=null)}function J2(t){return t===!0?0:t&&typeof t=="object"&&typeof t.earnedAt=="number"?t.earnedAt:0}function Lu(t){const n=X2(t).map(s=>({def:s,t:J2(t[s.id])}));return n.sort((s,r)=>r.t-s.t),n.map(s=>s.def)}const Xg=rt.memo(function({isOpen:e,onRequestClose:n,onSignUpComplete:s}){const[r,i]=p.useState(!1),[o,a]=p.useState(!1),[l,c]=p.useState(""),[h,d]=p.useState(""),[f,m]=p.useState(""),[g,y]=p.useState(""),{signInWithGoogle:S,signUpWithEmail:T,signInWithEmail:w,resetPassword:b,loading:_}=On(),k=p.useCallback(async()=>{try{m(""),await S(),n()}catch(ve){m(ve.message||"Failed to sign in with Google")}},[S,n]),O=p.useCallback(async ve=>{if(ve.preventDefault(),m(""),y(""),!l||!h){m("Please enter both email and password");return}try{r?(await T(l,h),s&&s(l)):await w(l,h),n(),c(""),d("")}catch(Se){m(Se.message||`Failed to ${r?"sign up":"sign in"}`)}},[r,l,h,T,w,n,s]),q=p.useCallback(()=>{c(""),d(""),m(""),y(""),i(!1),a(!1),n()},[n]),I=p.useCallback(()=>{i(ve=>!ve),a(!1),m(""),y("")},[]),N=p.useCallback(async()=>{m(""),y(""),a(!0)},[]),M=p.useCallback(async()=>{m(""),y("");try{if(!l){m("Please enter your email.");return}await b(l),y("Password reset email sent. Please check your inbox.")}catch(ve){m(ve.message||"Failed to send password reset email")}},[l,b]),j=p.useCallback(()=>{a(!1),m(""),y("")},[]),ne=p.useCallback(ve=>c(ve.target.value),[]),oe=p.useCallback(ve=>d(ve.target.value),[]);return u.jsx(vs,{isOpen:e,onRequestClose:q,titleId:"auth-modal-title",zIndex:1e4,children:u.jsxs("div",{style:{position:"relative",padding:"8px 0",textAlign:"left"},children:[u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsx("h2",{id:"auth-modal-title",style:{margin:0,marginBottom:"8px",fontSize:"24px",fontWeight:"bold",color:"#ffffff"},children:o?"Reset Password":r?"Create Account":"Sign In"}),u.jsx("p",{style:{margin:0,fontSize:"14px",color:"#d7dadc"},children:o?"Enter your email to receive a reset link":r?"Create an account to sync your progress":"Sign in to access your account"})]}),f&&u.jsx("div",{style:{padding:"12px",marginBottom:"16px",backgroundColor:"#372F41",border:"1px solid #ED2939",borderRadius:"6px",color:"#ED2939",fontSize:"14px"},children:f}),g&&u.jsx("div",{style:{padding:"12px",marginBottom:"16px",backgroundColor:"#372F41",border:"1px solid #50a339",borderRadius:"6px",color:"#50a339",fontSize:"14px"},children:g}),u.jsxs("button",{onClick:k,disabled:_,style:{width:"100%",padding:"12px",marginBottom:"16px",backgroundColor:"#4285f4",border:"none",borderRadius:"6px",color:"#ffffff",fontSize:"16px",fontWeight:"bold",cursor:_?"not-allowed":"pointer",opacity:_?.6:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[u.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",children:[u.jsx("path",{d:"M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z",fill:"#4285F4"}),u.jsx("path",{d:"M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z",fill:"#34A853"}),u.jsx("path",{d:"M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z",fill:"#FBBC05"}),u.jsx("path",{d:"M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.293C4.672 5.163 6.656 3.58 9 3.58z",fill:"#EA4335"})]}),_?"Signing in...":"Continue with Google"]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"},children:[u.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#3A3A3C"}}),u.jsx("span",{style:{padding:"0 12px",color:"#818384",fontSize:"14px"},children:"or"}),u.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#3A3A3C"}})]}),u.jsxs("form",{onSubmit:O,children:[u.jsx("div",{style:{marginBottom:"16px"},children:u.jsx("input",{type:"email",placeholder:"Email",value:l,onChange:ne,disabled:_,style:{width:"100%",padding:"12px",backgroundColor:"#212121",border:"1px solid #3A3A3C",borderRadius:"6px",color:"#ffffff",fontSize:"16px",boxSizing:"border-box"}})}),!o&&u.jsx("div",{style:{marginBottom:"8px"},children:u.jsx("input",{type:"password",placeholder:"Password",value:h,onChange:oe,disabled:_,style:{width:"100%",padding:"12px",backgroundColor:"#212121",border:"1px solid #3A3A3C",borderRadius:"6px",color:"#ffffff",fontSize:"16px",boxSizing:"border-box"}})}),!r&&!o&&u.jsx("div",{style:{marginBottom:"20px",textAlign:"right"},children:u.jsx("button",{type:"button",onClick:N,disabled:_,style:{background:"none",border:"none",color:"#e56b6f",cursor:_?"not-allowed":"pointer",fontSize:"13px",textDecoration:"underline",padding:0},children:"Forgot password?"})}),o?u.jsx("button",{type:"button",onClick:M,disabled:_,className:"homeBtn homeBtnGreen homeBtnLg"+(_?" homeBtnNeutral":""),style:{width:"100%",marginBottom:"12px",cursor:_?"not-allowed":"pointer",opacity:_?.8:1},children:_?"Please wait...":"Send Reset Link"}):u.jsx("button",{type:"submit",disabled:_,className:"homeBtn homeBtnGreen homeBtnLg"+(_?" homeBtnNeutral":""),style:{width:"100%",marginBottom:"12px",cursor:_?"not-allowed":"pointer",opacity:_?.8:1},children:_?"Please wait...":r?"Create Account":"Sign In"})]}),u.jsx("div",{style:{textAlign:"center"},children:o?u.jsx("button",{onClick:j,disabled:_,style:{background:"none",border:"none",color:"#e56b6f",cursor:_?"not-allowed":"pointer",fontSize:"14px",textDecoration:"underline"},children:"Back to Sign In"}):u.jsx("button",{onClick:I,disabled:_,style:{background:"none",border:"none",color:"#e56b6f",cursor:_?"not-allowed":"pointer",fontSize:"14px",textDecoration:"underline"},children:r?"Already have an account? Sign in":"Don't have an account? Sign up"})}),u.jsx("button",{onClick:q,style:{position:"absolute",top:"0",right:"0",background:"none",border:"none",color:"#818384",fontSize:"24px",cursor:"pointer",padding:"0",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})})}),x_=[{value:"1m",label:"1 Month",days:30,pricePerMonth:2,savings:null},{value:"3m",label:"3 Months",days:90,pricePerMonth:1.8,savings:"17%"},{value:"6m",label:"6 Months",days:180,pricePerMonth:1.7,savings:"21%"},{value:"12m",label:"1 Year",days:365,pricePerMonth:1.5,savings:"25%"}];function od({isOpen:t,onRequestClose:e,onSubscriptionComplete:n}){const{user:s}=On(),[r,i]=p.useState(!1),[o,a]=p.useState(null),[l,c]=p.useState(!1),[h,d]=p.useState("1m"),f=p.useRef(null),m=p.useRef(null),y={"1m":void 0,"3m":void 0,"6m":void 0,"12m":void 0}[h],S=x_.find(b=>b.value===h);p.useEffect(()=>()=>{f.current&&(f.current(),f.current=null),m.current&&(clearTimeout(m.current),m.current=null)},[]);const T=async()=>{if(!(s!=null&&s.uid)){a("You must be signed in to subscribe");return}if(!y){a("Stripe Price ID not configured. Please set VITE_STRIPE_PRICE_ID_1M in your .env file.");return}f.current&&(f.current(),f.current=null),m.current&&(clearTimeout(m.current),m.current=null),i(!0),a(null),c(!0);try{const b="/better-wordle/",_=b.endsWith("/")?b.slice(0,-1):b,k=`${window.location.origin}${_}`,O=await c2(vE(ME,"customers",s.uid,"checkout_sessions"),{price:y,success_url:`${k}/?subscription=success`,cancel_url:`${k}/?subscription=cancelled`}),q=PE(O,I=>{if(!I.exists())return;const N=I.data();if(N!=null&&N.error){a(N.error.message||"An error occurred while creating the checkout session."),c(!1),i(!1),f.current&&(f.current(),f.current=null),m.current&&(clearTimeout(m.current),m.current=null);return}N!=null&&N.url&&(f.current&&(f.current(),f.current=null),m.current&&(clearTimeout(m.current),m.current=null),window.location.assign(N.url))});f.current=q,m.current=setTimeout(()=>{f.current&&(f.current(),f.current=null),l&&(a("Timeout waiting for checkout session. Please try again."),c(!1),i(!1)),m.current=null},3e4)}catch(b){console.error("Subscription error:",b),a((b==null?void 0:b.message)||"Failed to start subscription. Please try again."),c(!1),i(!1),f.current&&(f.current(),f.current=null),m.current&&(clearTimeout(m.current),m.current=null)}},w=()=>{!r&&!l&&(a(null),e())};return u.jsx(vs,{isOpen:t,onRequestClose:w,titleId:"subscribe-modal-title",zIndex:3100,children:u.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:16,padding:32,maxWidth:480,width:"92vw",textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,0.8)"},children:[u.jsx("h2",{id:"subscribe-modal-title",style:{margin:0,marginBottom:16,fontSize:24,fontWeight:"bold",color:"#ffffff",letterSpacing:1},children:"Subscribe to Premium"}),u.jsxs("div",{style:{marginBottom:24,fontSize:16,color:"#d7dadc",lineHeight:1.6},children:[u.jsx("div",{style:{marginBottom:12},children:"Unlock premium features. Choose your plan:"}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8,marginBottom:16},children:x_.map(b=>u.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",backgroundColor:h===b.value?"#6d597a":"#372F41",borderRadius:8,border:h===b.value?"2px solid #50a339":"1px solid #3A3A3C",cursor:"pointer"},children:[u.jsx("input",{type:"radio",name:"duration",value:b.value,checked:h===b.value,onChange:()=>d(b.value),style:{cursor:"pointer"}}),u.jsx("span",{style:{flex:1,color:"#ffffff",fontWeight:500},children:b.label}),u.jsxs("span",{style:{color:"#50a339",fontWeight:"bold"},children:["$",b.pricePerMonth,"/month",b.savings&&u.jsxs("span",{style:{marginLeft:6,fontSize:12,color:"#818384"},children:["(save ",b.savings,")"]})]})]},b.value))}),u.jsxs("div",{style:{textAlign:"left",backgroundColor:"#372F41",padding:16,borderRadius:8,marginBottom:16},children:[u.jsx("div",{style:{fontSize:14,color:"#d7dadc",marginBottom:8},children:u.jsx("strong",{style:{color:"#50a339"},children:"Premium Features:"})}),u.jsxs("ul",{style:{margin:0,paddingLeft:20,fontSize:14,color:"#d7dadc",lineHeight:1.8},children:[u.jsx("li",{children:"Themed Wuzzle games"}),u.jsx("li",{children:"Custom color themes"}),u.jsx("li",{children:"Premium Member badge"}),u.jsx("li",{children:"And more coming soon!"})]})]}),u.jsx("div",{style:{fontSize:12,color:"#818384",fontStyle:"italic"},children:"Subscription auto-renews based on plan. Cancel anytime."})]}),o&&u.jsx("div",{style:{marginBottom:16,padding:12,backgroundColor:"#7f1d1d",borderRadius:8,color:"#fca5a5",fontSize:14},children:o}),u.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[u.jsx("button",{onClick:w,disabled:r||l,style:{flex:1,minWidth:120,padding:"14px 0",borderRadius:10,border:"1px solid #3A3A3C",background:"transparent",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:r||l?"not-allowed":"pointer",letterSpacing:1,textTransform:"uppercase",opacity:r||l?.5:1},children:"Cancel"}),u.jsx("button",{onClick:T,disabled:r||l,style:{flex:1,minWidth:120,padding:"14px 0",borderRadius:10,border:"none",background:l?"#818384":"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:r||l?"not-allowed":"pointer",letterSpacing:1,textTransform:"uppercase"},children:l?"Processing...":r?"Loading...":`Subscribe for $${(S==null?void 0:S.pricePerMonth)??2}/month`})]}),u.jsx("div",{style:{marginTop:16,fontSize:11,color:"#818384",lineHeight:1.4},children:"By subscribing, you agree to our terms of service. Payment will be processed securely."})]})})}function Z2({isOpen:t,onRequestClose:e,title:n="Sign in required",message:s="You need to sign in to access this feature.",onSignUpComplete:r}){const[i,o]=p.useState(!1),a=p.useCallback(()=>{o(!0)},[]),l=p.useCallback(()=>{o(!1),e()},[e]);return u.jsxs(u.Fragment,{children:[u.jsx(vs,{isOpen:t,onRequestClose:e,children:u.jsxs("div",{style:{padding:"24px"},children:[u.jsx("h2",{style:{margin:0,marginBottom:"16px",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:n}),u.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[u.jsx("p",{style:{marginBottom:"20px",color:"#d7dadc"},children:s}),u.jsx("button",{onClick:a,className:"homeBtn homeBtnGreen homeBtnLg",style:{minWidth:140},children:"Sign In"})]})]})}),u.jsx(Xg,{isOpen:i,onRequestClose:l,onSignUpComplete:r})]})}const e3="/better-wordle/First%20Solve.png",t3="/better-wordle/First%20Solve.png",n3="/better-wordle/Multiboard%20starter.png",s3="/better-wordle/Party%20starter.png",r3="/better-wordle/Premium%20Member.png",i3="/better-wordle/Speedrun%20beginner.png",o3="/better-wordle/Wuzzle%20Games%20Member.png",a3="/better-wordle/logo.png",l3=Object.assign({"../../images/Daily Player.png":e3,"../../images/First Solve.png":t3,"../../images/Multiboard starter.png":n3,"../../images/Party starter.png":s3,"../../images/Premium Member.png":r3,"../../images/Speedrun beginner.png":i3,"../../images/Wuzzle Games Member.png":o3,"../../images/logo.png":a3});function xa({badge:t,className:e="",size:n="md",title:s,profileCard:r=!1}){const i=`../../images/${t.name}.png`,o=l3[i]||null,a=s??t.name;return o?u.jsx("span",{className:`badgeIcon badgeIcon--${n} ${r?"badgeIcon--profileCard":""} ${e}`.trim(),role:"img","aria-label":a,title:a,children:u.jsx("img",{src:o,alt:"",className:"badgeIcon-img","aria-hidden":"true"})}):u.jsx("span",{className:`badgeIcon badgeIcon--${n} ${r?"badgeIcon--profileCard":""} ${e}`.trim(),role:"img","aria-label":a,title:a,children:"?"})}const c3={id:"premium_member",name:"Premium Member",description:"Unlocked by subscribing to Wuzzle Games Premium."};function zE({username:t,badges:e=[],earnedBadges:n=[],isYou:s=!1,isPremium:r=!1,href:i,onClick:o,className:a="",size:l="md"}){const c=t||"Player",h=s?" (You)":"",d=!!(i||o),[f,m]=p.useState(!1),g=n.length>0?n[0]:null,y=n.length>0,S=l==="sm"?"sm":"md",T=u.jsxs(u.Fragment,{children:[r&&u.jsx("span",{className:"userCard-premiumBadge",title:"Premium Member",children:u.jsx(xa,{badge:c3,size:S})}),u.jsxs("span",{className:"userCard-name",children:[c,h]}),u.jsx("div",{className:"userCard-badges","aria-hidden":"true",children:e.length>0?e.map(_=>u.jsxs("span",{className:"userCard-badge",title:typeof _=="object"&&_.label?_.label:void 0,children:[typeof _=="object"&&_.icon!=null?_.icon:null,typeof _=="object"&&_.label?_.label:String(_)]},_.id||_.label)):null})]}),w=`userCard userCard--${l} ${a}`.trim(),b=s?"Your badges":"Badges";return u.jsxs("div",{className:w,role:"presentation",children:[d?u.jsx("button",{type:"button",className:"userCard-main userCard--clickable",onClick:o,"aria-label":s?`${c} (You)  go to profile`:`${c}  go to profile`,children:T}):u.jsx("div",{className:"userCard-main",children:T}),y&&g&&u.jsxs("div",{className:"userCard-earnedWrap",children:[u.jsx("button",{type:"button",className:"userCard-earnedIcon",onClick:_=>{_.stopPropagation(),m(!0)},"aria-label":`Badge: ${g.name}. Click to see all badges.`,"aria-expanded":f,children:u.jsx(xa,{badge:g,size:S})}),u.jsx(vs,{isOpen:f,onRequestClose:()=>m(!1),titleId:"userCard-badges-modal-title",panelClassName:"userCard-badgesModalPanel",children:u.jsxs("div",{className:"userCard-badgesModalContent",children:[u.jsx("h2",{id:"userCard-badges-modal-title",className:"userCard-badgesModalTitle",children:b}),u.jsx("div",{className:"userCard-badgesModalList",children:n.map(_=>u.jsxs("div",{className:"userCard-badgesModalItem",children:[u.jsx(xa,{badge:_,profileCard:!0}),u.jsxs("div",{className:"userCard-badgesModalItemText",children:[u.jsx("div",{className:"userCard-badgesModalItemName",children:_.name}),_.description?u.jsx("div",{className:"userCard-badgesModalItemDesc",children:_.description}):null]})]},_.id))})]})})]})]})}const u3="premium_member";function xr({userId:t,...e}){const{userBadges:n,loading:s}=Qg(t||null),r=s?[]:Lu(n),i=!s&&n&&!!n[u3];return u.jsx(zE,{...e,earnedBadges:r,isPremium:i})}function b_(t){return((t==null?void 0:t.createdAt)||0)+Yg<Date.now()}const h3=p.lazy(()=>Je(()=>import("./FriendsModal-D7MusmLV.js"),__vite__mapDeps([0,1,2]))),C_=p.lazy(()=>Je(()=>import("./OpenRoomsModal-6fe7ClJM.js"),__vite__mapDeps([3,1,4]))),d3={profile:{title:"Profile",message:"You need to sign in to access your profile."},friends:{title:"Friends",message:"You need to sign in to use Friends."},challenges:{title:"Challenges",message:"You need to sign in to view challenges."},openRooms:{title:"Open Rooms",message:"You need to sign in to browse open rooms."}};function f3({onOpenFeedback:t,onSignUpComplete:e}){const n=br(),{user:s,friendRequests:r,incomingChallenges:i,sentChallenges:o,isVerifiedUser:a,acceptChallenge:l,dismissChallenge:c,cancelSentChallenge:h}=On(),[d,f]=p.useState(!1),[m,g]=p.useState(!1),[y,S]=p.useState(!1),[T,w]=p.useState(!1),[b,_]=p.useState(!1),[k,O]=p.useState(null),q=p.useCallback(I=>{O(d3[I]||{title:"Sign in required",message:"You need to sign in to access this feature."}),f(!1)},[]);return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{position:"relative"},children:[u.jsx("button",{className:"homeBtn homeBtnOutline",onClick:()=>f(!d),style:{padding:"4px 6px",fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center",border:"none",background:"transparent",color:"#ffffff",cursor:"pointer"},title:"Menu",children:""}),d&&u.jsxs("div",{style:{position:"absolute",top:"calc(100% + 4px)",right:0,background:"#372F41",border:"1px solid #3A3A3C",borderRadius:"8px",minWidth:"140px",zIndex:1e3,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.5)"},children:[u.jsx("button",{onClick:()=>{n("/"),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"Home"}),u.jsx("button",{onClick:()=>{n("/how-to-play"),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"How to Play"}),u.jsx("button",{onClick:()=>{if(!s){q("profile");return}n("/profile"),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"Profile"}),u.jsxs("button",{onClick:()=>{if(!s){q("friends");return}if(!a){alert("Verify your email or sign in with Google to use friends."),f(!1);return}g(!0),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C",position:"relative",display:"flex",alignItems:"center"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:["Friends",s&&r&&r.length>0&&u.jsx("div",{style:{marginLeft:"8px",width:"20px",height:"20px",borderRadius:"50%",background:"#ED2939",color:"#ffffff",fontSize:"11px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"},children:r.length})]}),u.jsxs("button",{onClick:()=>{if(!s){q("challenges");return}if(!a){alert("Verify your email or sign in with Google to use challenges."),f(!1);return}S(!0),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C",position:"relative",display:"flex",alignItems:"center"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:["Challenges",s&&i&&i.length>0&&u.jsx("div",{style:{marginLeft:"8px",width:"20px",height:"20px",borderRadius:"50%",background:"#B1A04C",color:"#212121",fontSize:"11px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"},children:i.length})]}),u.jsx("button",{onClick:()=>{if(!s){q("openRooms");return}w(!0),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"Open Rooms"}),s&&s.email==="abhijeetsridhar14@gmail.com"&&u.jsx("button",{onClick:()=>{_(!0),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease",borderBottom:"1px solid #3A3A3C"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"View all rooms"}),u.jsx("button",{onClick:()=>{t(),f(!1)},style:{width:"100%",padding:"10px 16px",background:"transparent",border:"none",color:"#ffffff",fontSize:"13px",textAlign:"left",cursor:"pointer",fontWeight:"600",letterSpacing:"0.3px",transition:"all 0.2s ease"},onMouseEnter:I=>I.target.style.background="#6d597a",onMouseLeave:I=>I.target.style.background="transparent",children:"Feedback"})]})]}),d&&u.jsx("div",{onClick:()=>f(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999}}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(h3,{isOpen:m,onRequestClose:()=>g(!1)})}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(C_,{isOpen:T,onRequestClose:()=>w(!1)})}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(C_,{isOpen:b,onRequestClose:()=>_(!1),adminMode:!0})}),u.jsx(vs,{isOpen:y,onRequestClose:()=>S(!1),children:u.jsxs("div",{style:{padding:"24px",width:"100%",boxSizing:"border-box"},children:[u.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:"Challenges"}),(!o||o.length===0)&&(!i||i.length===0)?u.jsx("div",{style:{padding:"24px 8px 16px",color:"#818384",fontSize:14},children:"You have no challenges right now."}):u.jsxs(u.Fragment,{children:[u.jsx("h3",{style:{margin:"8px 0 8px",fontSize:14,fontWeight:"bold",color:"#d7dadc",textAlign:"left"},children:"Sent"}),!o||o.length===0?u.jsx("div",{style:{padding:"8px 0 12px",color:"#818384",fontSize:12},children:"You haven't sent any challenges yet."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",maxHeight:"160px",overflowY:"auto",marginBottom:"12px"},children:o.map(I=>{const N=b_(I);return u.jsxs("div",{style:{padding:"10px 12px",borderRadius:8,border:"1px solid #3A3A3C",background:"#372F41",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[u.jsxs("div",{style:{textAlign:"left",flex:1},children:[u.jsx("div",{style:{marginBottom:2},children:u.jsx(xr,{userId:I.toUserId,username:I.toUserName||I.friendName||"Unknown friend",size:"sm"})}),u.jsxs("div",{style:{color:"#d7dadc",fontSize:12},children:[I.boards||1," board",(I.boards||1)>1?"s":"","  ",I.speedrun?"Speedrun":"Standard",N&&u.jsx("span",{style:{marginLeft:8,fontSize:11,color:"#818384",fontWeight:"600"},children:"Expired"})]})]}),N?u.jsx("button",{onClick:async()=>{try{await h(I.gameCode||I.id)}catch(M){alert((M==null?void 0:M.message)||"Failed to dismiss challenge")}},className:"homeBtn homeBtnOutline",style:{padding:"6px 10px",fontSize:11,borderRadius:6,color:"#818384"},children:"Dismiss"}):u.jsx("div",{style:{display:"flex",gap:"6px"},children:u.jsx("button",{onClick:async()=>{try{await h(I.gameCode||I.id)}catch(M){alert((M==null?void 0:M.message)||"Failed to cancel challenge")}},className:"homeBtn homeBtnOutline",style:{padding:"6px 10px",fontSize:11,borderRadius:6},children:"Cancel"})})]},I.id)})}),u.jsx("h3",{style:{margin:"8px 0 8px",fontSize:14,fontWeight:"bold",color:"#d7dadc",textAlign:"left"},children:"Received"}),!i||i.length===0?u.jsx("div",{style:{padding:"8px 0 12px",color:"#818384",fontSize:12},children:"You have no incoming challenges."}):u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",maxHeight:"160px",overflowY:"auto",marginBottom:"16px"},children:i.map(I=>{const N=b_(I);return u.jsxs("div",{style:{padding:"10px 12px",borderRadius:8,border:"1px solid #3A3A3C",background:"#372F41",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[u.jsxs("div",{style:{textAlign:"left",flex:1},children:[u.jsx("div",{style:{marginBottom:2},children:u.jsx(xr,{userId:I.fromUserId,username:I.fromUserName||"Unknown",size:"sm"})}),u.jsxs("div",{style:{color:"#d7dadc",fontSize:12},children:[I.boards||1," board",(I.boards||1)>1?"s":"","  ",I.variant==="solutionhunt"?"Solution Hunt":I.variant==="speedrun"||I.speedrun?"Speedrun":"Standard",N&&u.jsx("span",{style:{marginLeft:8,fontSize:11,color:"#818384",fontWeight:"600"},children:"Expired"})]})]}),N?u.jsx("button",{onClick:async()=>{try{await c(I.id,I.gameCode)}catch(M){alert((M==null?void 0:M.message)||"Failed to dismiss challenge")}},className:"homeBtn homeBtnOutline",style:{padding:"6px 10px",fontSize:11,borderRadius:6,color:"#818384"},children:"Dismiss"}):u.jsxs("div",{style:{display:"flex",gap:"6px"},children:[u.jsx("button",{onClick:async()=>{try{const M=await l(I.id);S(!1);const j=M.boards||1,ne=M.variant||(M.speedrun?"speedrun":"standard");n(`/game?mode=multiplayer&code=${M.gameCode}&variant=${ne}&boards=${j}`)}catch(M){alert((M==null?void 0:M.message)||"Failed to accept challenge")}},className:"homeBtn homeBtnGreen",style:{padding:"6px 10px",fontSize:11,borderRadius:6},children:"Accept"}),u.jsx("button",{onClick:async()=>{try{await c(I.id,I.gameCode)}catch(M){alert((M==null?void 0:M.message)||"Failed to dismiss challenge")}},className:"homeBtn homeBtnOutline",style:{padding:"6px 10px",fontSize:11,borderRadius:6},children:"Dismiss"})]})]},I.id)})})]}),u.jsx("button",{onClick:()=>S(!1),className:"homeBtn homeBtnGreen homeBtnLg",style:{marginTop:4},children:"Close"})]})}),k&&u.jsx(Z2,{isOpen:!!k,onRequestClose:()=>O(null),title:k.title,message:k.message,onSignUpComplete:e})]})}const VE={padding:"6px 10px",borderRadius:6,border:"none",background:"#e56b6f",color:"#ffffff",fontWeight:"bold",fontSize:11,cursor:"pointer"},p3={...VE,border:"1px solid #3A3A3C",background:"#355070"};function E_({fromUserId:t,title:e,subline:n,isFriendRequest:s,onDismiss:r,onViewBadges:i}){const{userBadges:o}=Qg(t),a=Lu(o)[0]??null,l=`notificationsModalCard${s?" notificationsModalCard--friendRequest":""}`;return u.jsxs("div",{className:l,style:{display:"flex",alignItems:"stretch",gap:0},children:[a?u.jsx(xa,{badge:a,profileCard:!0}):u.jsx("span",{style:{width:80,minWidth:80,background:"rgba(0,0,0,0.2)",borderRadius:"8px 0 0 8px"},"aria-hidden":!0}),u.jsxs("div",{className:"notificationsModalCardContent",style:{flex:1},children:[u.jsx("div",{className:"notificationsModalCardTitle",children:e}),u.jsx("div",{className:"notificationsModalCardSub",children:n})]}),u.jsxs("div",{className:"notificationsModalCardActions",style:{padding:"12px 14px"},children:[u.jsx("button",{type:"button",onClick:r,style:p3,children:"Dismiss"}),u.jsx("button",{type:"button",onClick:i,style:VE,children:"View badges"})]})]})}function m3({isOpen:t,onRequestClose:e}){const n=br(),{user:s,isVerifiedUser:r,friendRequests:i,incomingChallenges:o,sentChallenges:a,declineFriendRequest:l,dismissChallenge:c,cancelSentChallenge:h}=On(),{markNotificationsSeen:d}=UE(s);p.useEffect(()=>{t&&(s!=null&&s.uid)&&d()},[t,s==null?void 0:s.uid,d]);const f=k=>(k.createdAt||0)+Yg<Date.now(),m=async k=>{try{await l(k)}catch(O){alert((O==null?void 0:O.message)||"Failed to dismiss")}},g=async k=>{try{await l(k),e==null||e(),n("/profile",{state:{openYourBadges:!0}})}catch(O){alert((O==null?void 0:O.message)||"Failed to dismiss")}},y=async k=>{try{await c(k.id,k.gameCode)}catch(O){alert((O==null?void 0:O.message)||"Failed to dismiss")}},S=async k=>{try{await c(k.id,k.gameCode),e==null||e(),n("/profile",{state:{openYourBadges:!0}})}catch(O){alert((O==null?void 0:O.message)||"Failed to dismiss")}};if(!s)return null;if(!r)return u.jsx(vs,{isOpen:t,onRequestClose:e,children:u.jsxs("div",{style:{padding:"24px",width:"100%",boxSizing:"border-box"},children:[u.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"22px",fontWeight:"bold"},children:"Notifications"}),u.jsx("p",{style:{marginBottom:"16px",color:"#d7dadc",fontSize:"14px"},children:"Verify your email or sign in with Google to see notifications."}),u.jsx("button",{type:"button",onClick:e,style:{padding:"10px 16px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontWeight:"bold",fontSize:13,cursor:"pointer"},children:"Close"})]})});const T=i&&i.length>0,w=o&&o.length>0,b=a&&a.length>0,_=T||w||b;return u.jsx(vs,{isOpen:t,onRequestClose:e,children:u.jsxs("div",{style:{padding:"24px",maxHeight:"85vh",overflowY:"auto",width:"100%",boxSizing:"border-box"},children:[u.jsx("h2",{style:{margin:"0 0 24px 0",fontSize:"24px",fontWeight:"bold"},children:"Notifications"}),_?u.jsxs(u.Fragment,{children:[T&&u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsxs("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",fontWeight:"bold",color:"#d7dadc",textAlign:"left"},children:["Friend Requests (",i.length,")"]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"16px",paddingBottom:"16px",borderBottom:"1px solid #3A3A3C"},children:i.map(k=>u.jsx(E_,{fromUserId:k.id,title:k.fromName||"Someone",subline:"wants to be friends",isFriendRequest:!0,onDismiss:()=>m(k.id),onViewBadges:()=>g(k.id)},k.id))})]}),w&&u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsx("h3",{style:{margin:"0 0 4px 0",fontSize:"16px",fontWeight:"bold",color:"#d7dadc",textAlign:"left"},children:"Challenges"}),u.jsx("p",{style:{margin:"0 0 12px 0",fontSize:11,color:"#818384",textAlign:"left"},children:"Challenges expire 30 minutes after they're sent. Dismiss expired ones to clear them."}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"16px",paddingBottom:"16px",borderBottom:"1px solid #3A3A3C"},children:o.map(k=>{const O=f(k),q=`${k.boards||1} board${(k.boards||1)>1?"s":""}  ${k.speedrun?"Speedrun":"Standard"}  ${O?"Expired":"Active"}`;return u.jsx(E_,{fromUserId:k.fromUserId??null,title:`Game invitation from ${k.fromUserName||"Someone"}`,subline:q,isFriendRequest:!1,onDismiss:()=>y(k),onViewBadges:()=>S(k)},k.id)})})]}),b&&u.jsxs("div",{style:{marginBottom:"24px"},children:[u.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",fontWeight:"bold",color:"#d7dadc",textAlign:"left"},children:"Sent challenges"}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"16px",paddingBottom:"16px",borderBottom:"1px solid #3A3A3C"},children:a.map(k=>{const O=f(k);return u.jsxs("div",{style:{padding:"10px 12px",borderRadius:8,border:"1px solid #3A3A3C",background:"#372F41",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[u.jsxs("div",{style:{textAlign:"left",flex:1},children:[u.jsxs("div",{style:{color:"#ffffff",fontWeight:"600",fontSize:13},children:["Challenge to ",k.toUserName||"friend"]}),u.jsxs("div",{style:{color:"#d7dadc",fontSize:12},children:[k.boards||1," board",(k.boards||1)>1?"s":"","  ",k.speedrun?"Speedrun":"Standard",u.jsx("span",{style:{marginLeft:8,fontSize:11,color:O?"#818384":"#50a339",fontWeight:"600"},children:O?"Expired":"Active"})]})]}),u.jsx("button",{type:"button",onClick:async()=>{try{await h(k.gameCode||k.id)}catch(q){alert((q==null?void 0:q.message)||"Failed to dismiss")}},style:{padding:"6px 10px",borderRadius:6,border:"1px solid #3A3A3C",background:"#355070",color:O?"#818384":"#ffffff",fontWeight:"bold",fontSize:11,cursor:"pointer"},children:O?"Dismiss":"Cancel"})]},k.id)})})]})]}):u.jsx("p",{style:{color:"#818384",fontSize:"14px",marginBottom:"20px"},children:"No notifications right now."}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:8},children:u.jsx("button",{type:"button",onClick:e,style:{padding:"10px 16px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontWeight:"bold",fontSize:13,cursor:"pointer"},children:"Close"})})]})})}const g3=5e3;function y3({message:t,badge:e,onClick:n,onDismiss:s,durationMs:r=g3}){if(p.useEffect(()=>{if(!t||!s)return;const a=window.setTimeout(s,r);return()=>window.clearTimeout(a)},[t,s,r]),!t)return null;const i=typeof t=="string"?t:String(t),o=e&&typeof e=="object"&&e.id&&e.name;return u.jsx("button",{type:"button",onClick:n,role:"status","aria-live":"polite","aria-label":`${i} Click to view notifications`,className:"notificationToast",children:o?u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"notificationToast-badgeWrap",children:u.jsx(xa,{badge:e,profileCard:!0})}),u.jsxs("span",{className:"notificationToast-text",children:[u.jsx("span",{className:"notificationToast-message",children:i}),u.jsx("span",{className:"notificationToast-cta",children:"Click to view"})]})]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"notificationToast-message",children:i}),u.jsx("span",{className:"notificationToast-cta",style:{fontSize:12,opacity:.9},children:"Click to view"})]})})}const fc={current:new Set},T_={current:new Set},mf={current:""},gf={current:null},I_={current:0},v3=3e3;function Br({onOpenFeedback:t,onSignUpComplete:e,onHomeClick:n}){const s=br(),{pathname:r}=O_(),{user:i,signOut:o,friendRequests:a,incomingChallenges:l}=On(),{userBadges:c}=G2(i),{notificationSeenAt:h,markNotificationsSeen:d}=UE(i),{showSubscriptionGate:f,isSubscribed:m}=id(i),g=Lu(c),y=m||c&&!!c.premium_member,S=Y2(),T=W2(a||[],l||[],h),[w,b]=p.useState(!1),[_,k]=p.useState(!1),[O,q]=p.useState(!1),[I,N]=p.useState(null),M=I?I.type==="friendRequest"?I.id:I.fromUserId||null:null,{userBadges:j}=Qg(M),ne=I&&M?Lu(j)[0]??null:null;p.useEffect(()=>{const x=S_(a||[],l||[],h);r!==mf.current||(i==null?void 0:i.uid)!==gf.current?(mf.current=r,gf.current=(i==null?void 0:i.uid)??null,fc.current=new Set(x.map(P=>P.id)),I_.current=Date.now()):(i==null?void 0:i.uid)!=null&&fc.current.size===0&&(gf.current!=null||mf.current!=="")&&Date.now()-I_.current<v3&&(fc.current=new Set(x.map(P=>P.id)))},[r,i==null?void 0:i.uid,a,l,h]),p.useEffect(()=>{if(I)return;const A=S_(a||[],l||[],h).find(P=>!fc.current.has(P.id)&&!T_.current.has(P.id));A&&(T_.current.add(A.id),N(A))},[a,l,h,I]);const oe=p.useCallback(()=>{b(!0)},[]),ve=p.useCallback(()=>{b(!1)},[]),Se=p.useCallback(()=>{s("/leaderboard")},[s]),Y=p.useCallback(()=>{s("/")},[s]),C=p.useCallback(async()=>{try{await o()}catch(x){console.error("Failed to sign out",x)}},[o]),$=p.useCallback(()=>{i?k(!0):b(!0)},[i]),G=p.useCallback(()=>{k(!1)},[]),B=p.useCallback(()=>{k(!1)},[]),D=p.useCallback(()=>N(null),[]),v=p.useCallback(()=>{q(!0),N(null)},[]);return u.jsxs(u.Fragment,{children:[u.jsxs("header",{style:{padding:"10px 16px 8px",borderBottom:"1px solid #3A3A3C",backgroundColor:"#212121",marginBottom:"12px"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:12},children:[u.jsx("button",{type:"button",onClick:n??Y,"aria-label":"Home",style:{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,border:"1px solid #3A3A3C",background:"transparent",cursor:"pointer",padding:0},children:u.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:u.jsx("path",{d:"M4 10.5L12 3L20 10.5V20H14V14H10V20H4V10.5Z",stroke:"#ffffff",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})})}),u.jsx("div",{style:{flex:1,textAlign:"center"},children:u.jsx("img",{src:H2,alt:"Wuzzle Games",style:{height:50}})}),u.jsxs("div",{className:"flexRow justifyEnd",style:{alignItems:"center",gap:8,minWidth:32},children:[i&&u.jsxs("button",{type:"button",onClick:()=>{d(),q(!0)},"aria-label":T>0?`Notifications, ${T} unread`:"Notifications",style:{position:"relative",width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,border:"1px solid #3A3A3C",background:"transparent",cursor:"pointer",padding:0},children:[u.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:u.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z",fill:"#ffffff"})}),T>0&&u.jsx("span",{style:{position:"absolute",top:-4,right:-4,minWidth:18,height:18,borderRadius:9,background:"#ED2939",color:"#ffffff",fontSize:11,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px"},children:T>99?"99+":T})]}),u.jsx(f3,{onOpenFeedback:t||(()=>{}),onSignUpComplete:e})]})]}),u.jsxs("div",{style:{marginTop:8,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[u.jsxs("div",{style:{fontSize:12,color:"#d7dadc",whiteSpace:"nowrap"},children:["Reset in: ",S]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:"auto"},children:[u.jsx("button",{type:"button",className:"homeBtn homeBtnOutline",onClick:Se,style:{padding:"4px 10px",fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:"Leaderboard"}),i?u.jsx("button",{type:"button",className:"homeBtn homeBtnOutline",onClick:C,style:{padding:"4px 10px",fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:"Sign Out"}):u.jsx("button",{type:"button",className:"homeBtn homeBtnOutline",onClick:oe,style:{padding:"4px 10px",fontSize:12,textTransform:"uppercase",letterSpacing:.5},children:"Sign In"})]})]}),i&&u.jsxs("div",{style:{marginTop:6,display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[u.jsx("span",{style:{fontSize:12,color:"#d7dadc"},children:"Signed in as"}),u.jsx(zE,{username:i.displayName||i.email||"Unknown user",onClick:()=>s("/profile"),size:"sm",earnedBadges:g,isPremium:y}),f&&u.jsx("button",{type:"button",className:"homeBtn",onClick:$,style:{padding:"4px 12px",fontSize:12,textTransform:"uppercase",letterSpacing:.5,background:"#e56b6f",color:"#ffffff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Subscribe"})]})]}),u.jsx(Xg,{isOpen:w,onRequestClose:ve,onSignUpComplete:e}),u.jsx(od,{isOpen:_,onRequestClose:G,onSubscriptionComplete:B}),u.jsx(m3,{isOpen:O,onRequestClose:()=>q(!1)}),I&&u.jsx(y3,{message:I.label,badge:ne,onClick:v,onDismiss:D})]})}const WE={index:0,cumulativeMs:0,stageTimes:[]};function HE(t){if(!t||typeof t!="object")return{...WE};const e=typeof t.index=="number"&&Number.isFinite(t.index)?t.index:0,n=typeof t.cumulativeMs=="number"&&Number.isFinite(t.cumulativeMs)?t.cumulativeMs:0,s=Array.isArray(t.stageTimes)?t.stageTimes:[];return{index:e,cumulativeMs:n,stageTimes:s}}function $u(t){const e=el(t),n=zn(e,WE);return HE(n)}function k_(t,e){const n=el(t),s=$u(t),r=HE({...s,...e});return Qt(n,r),r}const w3=p.lazy(()=>Je(()=>import("./FeedbackModal-DtP9FLlv.js"),__vite__mapDeps([5,1]))),_3=p.lazy(()=>Je(()=>import("./MultiplayerModal-BdC_u0Tz.js"),__vite__mapDeps([6,1]))),S3=Array.from({length:Ia},(t,e)=>e+1),Ri=rt.memo(function({title:e,desc:n,buttonText:s,onClick:r,variant:i="green",titleRight:o,modeVariant:a="daily"}){const l=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r&&r())};return u.jsx("div",{className:`modeRow modeRow--${a}`,role:"button",tabIndex:0,"aria-label":s||e,onClick:r,onKeyDown:l,children:u.jsxs("div",{className:"modeRowText",children:[u.jsxs("div",{className:"modeRowTitle",children:[e,o?u.jsx("span",{className:"modeRowTitleRight",children:o}):null]}),u.jsx("div",{className:"modeRowDesc",children:n})]})})});function x3({dailyBoards:t,setDailyBoards:e,marathonLevels:n}){const s=br(),[r,i]=p.useState(!1),[o,a]=p.useState(!1),[l,c]=p.useState(!1),[h,d]=p.useState(!1),[f,m]=p.useState(""),{user:g}=On(),[y,S]=p.useState(0),[T,w]=p.useState(0);p.useEffect(()=>{const j=async ne=>{const oe=el(ne);let ve=null;if(g)try{const Se=Z(K,`users/${g.uid}/singlePlayer/meta/${oe}`),Y=await Ye(Se);Y.exists()&&(ve=Y.val()||null,ve&&Qt(oe,ve))}catch(Se){console.error("Failed to load remote marathon meta for home",Se)}return ve||(ve=$u(ne)),ve};return(async()=>{const[ne,oe]=await Promise.all([j(!1),j(!0)]),ve=ne&&typeof ne.index=="number"?ne.index:0,Se=oe&&typeof oe.index=="number"?oe.index:0;S(ve),w(Se)})(),()=>{}},[g]),p.useMemo(()=>n[n.length-1],[n]),p.useMemo(()=>n[y]||n[0],[n,y]),p.useMemo(()=>n[T]||n[0],[n,T]);const b=p.useCallback(()=>i(!1),[]),_=p.useCallback(()=>i(!0),[]),k=p.useCallback(()=>{Qt("mw:dailyBoards",t),s(`/game/daily/${t}`)},[t,s]),O=p.useCallback(()=>{Qt("mw:dailyBoards",t),s(`/game/daily/${t}/speedrun`)},[t,s]),q=p.useCallback(()=>{s("/game/solutionhunt")},[s]),I=p.useCallback(()=>{s("/game/marathon")},[s]),N=p.useCallback(()=>{s("/game?mode=marathon&speedrun=true")},[s]),M=p.useMemo(()=>`${t} board${t>1?"s":""}`,[t]);return u.jsxs(u.Fragment,{children:[u.jsxs(Qc,{children:[u.jsx("title",{children:"Wuzzle Games"}),u.jsx("meta",{name:"description",content:"Wuzzle Games is a Wordle alternative with multi-board daily puzzles, marathon and speedrun modes, and Multiplayer Mode battles with friends."})]}),u.jsx("div",{className:"homeRoot",children:u.jsxs("div",{className:"homeInner",children:[u.jsx(Br,{onOpenFeedback:_,onSignUpComplete:j=>{m(j),d(!0)}}),u.jsx(vs,{isOpen:h,onRequestClose:()=>d(!1),titleId:"verify-email-modal-title",children:u.jsxs("div",{style:{padding:"24px",textAlign:"left"},children:[u.jsx("h2",{id:"verify-email-modal-title",style:{margin:"0 0 16px 0",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:"Verify your email"}),u.jsxs("p",{style:{margin:"0 0 12px 0",fontSize:14,color:"#d7dadc",lineHeight:1.5},children:["We've sent a verification link to"," ",u.jsx("span",{style:{fontWeight:"bold"},children:f||"your email address"}),"."]}),u.jsx("p",{style:{margin:"0 0 16px 0",fontSize:14,color:"#d7dadc",lineHeight:1.5},children:"Please open that email and click the link to verify your account. Once verified, you'll be able to play Multiplayer Mode and add friends. Check your Spam or Junk folder for the verification link."}),u.jsx("div",{className:"flexRow justifyEnd",children:u.jsx("button",{type:"button",className:"homeBtn homeBtnGreen homeBtnLg",onClick:()=>d(!1),style:{minWidth:120},children:"Got it"})})]})}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(w3,{isOpen:r,onRequestClose:b})}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(_3,{isOpen:o,onRequestClose:()=>a(!1),showConfigFirst:l,onConfigClose:()=>c(!1),onConfigOpen:()=>c(!0)})}),u.jsxs("main",{children:[u.jsxs("section",{className:"panel",children:[u.jsxs("div",{className:"panelTop",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"panelTitle",children:"Daily Puzzles"}),u.jsx("div",{className:"panelDesc",children:"Choose how many words you want to play simultaneously."})]}),u.jsxs("div",{className:"selector",children:[u.jsx("label",{className:"label",htmlFor:"dailyBoards",children:"Simultaneous words"}),u.jsx("select",{id:"dailyBoards",value:t,onChange:j=>e(parseInt(j.target.value,10)),className:"select",children:S3.map(j=>u.jsx("option",{value:j,children:j},j))})]})]}),u.jsxs("div",{className:"panelBody",children:[u.jsx(Ri,{title:"Daily (standard)",desc:"Limited turns. No timer. Good for casual play.",buttonText:"Play Daily",onClick:k,variant:"green",modeVariant:"daily",titleRight:M}),u.jsx(Ri,{title:"Daily (speedrun)",desc:"Unlimited guesses. Timer starts immediately.",buttonText:"Speedrun Daily",onClick:O,variant:"green",modeVariant:"daily",titleRight:M}),u.jsx(Ri,{title:"Solution Hunt",desc:"See all possible remaining words as you guess. Great for learning.",buttonText:"Play Solution Hunt",onClick:q,variant:"green",modeVariant:"daily",titleRight:"1 board"})]})]}),u.jsxs("section",{className:"panel",children:[u.jsx("div",{className:"panelTop",children:u.jsxs("div",{children:[u.jsx("h2",{className:"panelTitle",children:"Marathon Puzzles"}),u.jsx("div",{className:"panelDesc",children:"Solve 1 word, then 2, then 3, ending at 4. Complete all stages to win."})]})}),u.jsxs("div",{className:"panelBody",children:[u.jsx(Ri,{title:"Marathon (standard)",desc:"Play standard marathon. Limited turns. No timer.",buttonText:"Play Marathon",onClick:I,variant:"gold",modeVariant:"marathon",titleRight:`Stage ${y+1}/${n.length}`}),u.jsx(Ri,{title:"Marathon (speedrun)",desc:"Play speedrun marathon. Unlimited guesses, timed cumulative.",buttonText:"Speedrun Marathon",onClick:N,variant:"gold",modeVariant:"marathon",titleRight:`Stage ${T+1}/${n.length}`})]})]}),u.jsxs("section",{className:"panel",children:[u.jsx("div",{className:"panelTop",children:u.jsxs("div",{children:[u.jsx("h2",{className:"panelTitle",children:"Multiplayer Wordle Battles With Friends"}),u.jsx("div",{className:"panelDesc",children:"Host or join real-time rooms with friends and play together."})]})}),u.jsx("div",{className:"panelBody",children:u.jsx(Ri,{title:"Multiplayer Mode",desc:"Create a room, invite friends, or join by code.",buttonText:"Play Multiplayer",onClick:()=>a(!0),variant:"gold",modeVariant:"pvp"})})]}),u.jsx("section",{className:"homeIntro",children:u.jsxs("details",{className:"homeIntroDetails",children:[u.jsx("summary",{className:"homeIntroSummary",children:"Click here to know more about Wuzzle Games."}),u.jsx("h1",{className:"homeTitle",children:"Wuzzle Games  Advanced Multi-Board & Multiplayer Wordle-Style Game"}),u.jsx("p",{className:"homeIntroParagraph",children:"Wuzzle Games is a free, browser-based Wordle-style puzzle game that you can play on any device. No downloads or sign-in required to get started  just open the site and start solving."}),u.jsx("p",{className:"homeIntroParagraph",children:"Play up to 32 boards at once with daily multi-board puzzles, push yourself with marathon stages and speedrun timers, and challenge friends in real-time Multiplayer Mode battles. Your best speedrun times can appear on the global Wuzzle Games leaderboard."}),u.jsxs("p",{className:"homeIntroParagraph",children:["New to Wuzzle Games? Read the"," ",u.jsx(Ti,{to:"/faq",className:"homeLink",children:"Wuzzle Games FAQ"})," ","or jump straight to the"," ",u.jsx(Ti,{to:"/leaderboard",className:"homeLink",children:"global Wuzzle Games leaderboard"})," ","to see top players. You can also explore specific modes: ",u.jsx(Ti,{to:"/multiplayer-wuzzle",className:"homeLink",children:"multiplayer battles"}),","," ",u.jsx(Ti,{to:"/multi-board-wuzzle",className:"homeLink",children:"multi-board Wordle"}),","," ",u.jsx(Ti,{to:"/wuzzle-speedrun",className:"homeLink",children:"Wordle speedrun"}),", and"," ",u.jsx(Ti,{to:"/wuzzle-marathon",className:"homeLink",children:"Wordle marathon"}),"."]})]})})]})]})})]})}class GE{constructor(e={}){this.wordLength=e.wordLength||bt,this.defaultMaxTurns=e.defaultMaxTurns||z0,this.allowedWords=e.allowedWords||new Set}scoreGuess(e,n){return typeof e!="string"||typeof n!="string"?Array(this.wordLength).fill("grey"):e.length!==this.wordLength||n.length!==this.wordLength?Array(this.wordLength).fill("grey"):Xu(e,n)}validateGuess(e,n=null){const s=n||this.allowedWords;return typeof e!="string"?{isValid:!1,error:"Guess must be a string"}:e.length!==this.wordLength?{isValid:!1,error:`Guess must be exactly ${this.wordLength} letters`}:!s||!(s instanceof Set)?{isValid:!1,error:"Word list not available"}:s.has(e.toUpperCase())?{isValid:!0,error:null}:{isValid:!1,error:"Not in word list."}}isBoardSolved(e){return!e||typeof e!="object"?!1:e.isSolved===!0?!0:e.solution&&Array.isArray(e.guesses)?e.guesses.some(n=>n&&typeof n.word=="string"&&n.word===e.solution):!1}isBoardDead(e,n){return!e||typeof e!="object"?!1:e.isDead===!0?!0:Array.isArray(e.guesses)&&n>0?e.guesses.length>=n&&!this.isBoardSolved(e):!1}checkAllBoardsSolved(e){return!Array.isArray(e)||e.length===0?!1:e.every(n=>this.isBoardSolved(n))}checkAllBoardsFinished(e,n,s=!1){return!Array.isArray(e)||e.length===0?!1:s?e.every(r=>this.isBoardSolved(r)):e.every(r=>this.isBoardSolved(r)||this.isBoardDead(r,n))}getMaxTurns(e){return!Number.isFinite(e)||e<1?this.defaultMaxTurns:oa(e)}processGuess(e,n,s,r=!1,i=null){if(!e||typeof e!="object")throw new Error("Invalid board state");if(this.isBoardSolved(e)||!r&&this.isBoardDead(e,s))return e;const o=this.validateGuess(n,this.allowedWords);if(!o.isValid)throw new Error(o.error);const a=this.scoreGuess(n,e.solution||""),c=[...Array.isArray(e.guesses)?e.guesses:[],{word:n,colors:a}],h=n===e.solution,d=!r&&!h&&c.length>=s;return{...e,guesses:c,isSolved:h,isDead:d,lastRevealId:i}}countSolvedBoards(e){return Array.isArray(e)?e.filter(n=>this.isBoardSolved(n)).length:0}getTurnsUsed(e){if(!Array.isArray(e)||e.length===0)return 0;let n=0;for(const s of e)if(s&&Array.isArray(s.guesses)){const r=s.guesses.length||0;r>n&&(n=r)}return n}createBoardState(e){if(typeof e!="string"||e.length!==this.wordLength)throw new Error(`Solution must be a ${this.wordLength}-letter string`);return{solution:e.toUpperCase(),guesses:[],isSolved:!1,isDead:!1,lastRevealId:null}}createBoards(e){if(!Array.isArray(e))throw new Error("Solutions must be an array");return e.map(n=>this.createBoardState(n))}}function b3(t={}){return new GE(t)}new GE;function C3(t={}){return p.useMemo(()=>b3(t),[t.allowedWords])}function E3(t){return t==="green"?"":t==="yellow"?"":""}function T3(t,e,n,s,r,i,o,a,l,c,h,d=null){if(!t||t.length===0)return"Play Wuzzle Games!";const f=[],m=e==="marathon",g=e==="daily",y=e==="solutionhunt";let S="Wuzzle Games";if(y?S="Wuzzle Games - Daily Solution Hunt":g&&s?S="Wuzzle Games - Daily Speedrun":g?S="Wuzzle Games - Daily Standard":m&&s?S="Wuzzle Games - Marathon Speedrun":m&&(S="Wuzzle Games - Marathon Standard"),f.push(S),m&&Array.isArray(d)&&d.length>0){if(f.push(""),d.forEach((T,w)=>{const b=T.boards??0,_=`Stage ${w+1} (${b} board${b===1?"":"s"}):`;f.push(_);const k=typeof T.solvedCount=="number"?T.solvedCount:null,O=k!=null&&b>0?k>=b:!0,q=T.turnsUsed??0,I=T.maxTurns??l;if(!O){if(!s&&k&&k>0){const N=k===1?"board":"boards";f.push(`${k} ${N} solved. Guesses used: ${q}/${I}`)}else f.push("Not solved");return}if(s){const N=T.stageElapsedMs??0;f.push(`Time: ${o(N)}`)}else f.push(`Guesses used: ${q}/${I}`)}),f.push(""),s){const T=i||r||0;f.push(`Total time: ${o(T)}`)}else f.push(`Total guesses used: ${a}/${l}`);return f.push(""),f.push("Play Wuzzle Games!"),f.push("https://wisdom-githb.github.io/wuzzle-games/"),f.join(`
`)}if(n===1&&(g||y)){const T=t[0];if(f.push(""),T&&Array.isArray(T.guesses)&&T.guesses.forEach(w=>{const b=(w.colors||[]).map(_=>E3(_)).join("");b.length>0&&f.push(b)}),f.push(""),y)f.push(`Guesses: ${a}/${l}`),f.push(c?"Solved!":"Not solved!");else if(s){const w=i||r||0;f.push(`Time: ${o(w)}`),f.push(`Guesses: ${a}`)}else f.push(`Guesses: ${a}/${l}`),f.push(c?"Solved!":"Not solved!")}else if(n===1){if(f.push(""),s){const T=i||r||0;f.push(`Time: ${o(T)}`)}f.push(`Guesses: ${a}/${l}`),f.push(c?"Solved!":"Not solved!")}else if(f.push(""),f.push(`Boards: ${n}`),s){const T=i||r||0;f.push(`Time: ${o(T)}`),f.push(`Guesses used: ${a}`)}else f.push(`Guesses used: ${a}/${l}`),f.push(`Solved: ${h}/${n}`);return f.push(""),f.push("Play Wuzzle Games!"),f.push("https://wisdom-githb.github.io/wuzzle-games/"),f.join(`
`)}function I3(t,e,n){const s=ts();let r=0,i=0,o=0,a=0;const l=[];return t.forEach((h,d)=>{const f=Fi("marathon",h,e,d,s),m=zn(f,null);let g=0,y=n,S=0,T=0;m&&(a+=1,g=typeof m.turnsUsed=="number"?m.turnsUsed:aa(m.boards||[]),y=typeof m.maxTurns=="number"?m.maxTurns:n,S=typeof m.solvedCount=="number"?m.solvedCount:Array.isArray(m.boards)?m.boards.filter(w=>w&&w.isSolved).length:0,T=typeof m.stageElapsedMs=="number"?m.stageElapsedMs:0,r+=g,i+=y,o+=S),l.push({boards:h,turnsUsed:g,maxTurns:y,solvedCount:S,stageElapsedMs:T})}),a===0?null:{totalBoards:t.reduce((h,d)=>h+d,0),totalTurnsUsed:r,totalMaxTurns:i,totalSolvedCount:o,stages:l}}function A_(){const e=typeof navigator<"u"&&typeof navigator.userAgent=="string"&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),s=typeof window<"u"&&window.innerWidth<=768&&"ontouchstart"in window;return e||s}function R_(t){return t==="green"?"#50a339":t==="yellow"?"#B1A04C":t==="grey"?"#3A3A3C":"#212121"}const k3=14;function Ol(t,e){return`${t==="daily"?"daily":"marathon"}_${e?"speedrun":"standard"}`}async function A3({mode:t,speedrunEnabled:e,dateString:n,solutions:s,numBoards:r}){var i;try{if(!(t==="daily"&&r===1||t==="marathon"))return;const a=Ol(t,e),l=Z(K,`archive/${a}/${n}`);await Pt(l,{solutions:s,numBoards:r,savedAt:Date.now()})}catch(o){(o==null?void 0:o.code)==="permission-denied"||(i=o==null?void 0:o.message)!=null&&i.includes("Permission denied")}}async function R3({mode:t,speedrunEnabled:e,dateString:n}){var s;try{const r=Ol(t,e),i=Z(K,`archive/${r}/${n}`),o=await Ye(i);if(o.exists()){const a=o.val();return(a==null?void 0:a.solutions)||null}return null}catch(r){return(r==null?void 0:r.code)==="permission-denied"||(s=r==null?void 0:r.message)!=null&&s.includes("Permission denied"),null}}async function N3({uid:t,mode:e,speedrunEnabled:n,dateString:s,gameState:r}){if(t)try{const i=Ol(e,n),o=Z(K,`users/${t}/archiveGames/${i}/${s}`);await Pt(o,{...r,updatedAt:Date.now()})}catch{}}async function P3({uid:t,mode:e,speedrunEnabled:n,dateString:s}){if(!t)return null;try{const r=Ol(e,n),i=Z(K,`users/${t}/archiveGames/${r}/${s}`),o=await Ye(i);return o.exists()?o.val():null}catch{return null}}function Jg(){const t=[],e=new Date;for(let n=1;n<=k3;n++){const s=new Date(e);s.setDate(s.getDate()-n);const r=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");t.push(`${r}-${i}-${o}`)}return t}function Bu(t){const e=new Date(t+"T00:00:00");return Number.isNaN(e.getTime())?t&&typeof t=="string"?t:"Invalid date":e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function D3(t){return Jg().includes(t)}async function M3({mode:t,speedrunEnabled:e}){try{const n=Ol(t,e),s=Z(K,`archive/${n}`),r=await Ye(s);if(!r.exists())return;const i=r.val()||{},o=Jg(),a=new Set(o),l=[];for(const c of Object.keys(i))a.has(c)||l.push(jt(Z(K,`archive/${n}/${c}`)));await Promise.all(l)}catch{}}const Uu=Object.freeze(Object.defineProperty({__proto__:null,cleanupOldArchive:M3,formatArchiveDate:Bu,getArchiveDates:Jg,isDateInArchiveWindow:D3,loadArchiveGameState:P3,loadArchiveSolution:R3,saveArchiveGameState:N3,saveArchiveSolution:A3},Symbol.toStringTag,{value:"Module"}));function qE(t=""){const[e,n]=p.useState(t),s=p.useRef(null),r=p.useCallback(()=>{s.current&&(clearTimeout(s.current),s.current=null)},[]),i=p.useCallback((o,a=Qs)=>{r(),n(o),s.current=setTimeout(()=>{n(""),s.current=null},a)},[r]);return p.useEffect(()=>()=>r(),[r]),{message:e,setMessage:n,setTimedMessage:i,clearMessageTimer:r}}function O3(t){let e="";try{if(typeof window<"u"&&window.location){const{origin:n,pathname:s}=window.location,r="/game",i=s.indexOf(r),a=`${i!==-1?s.slice(0,i):""}${r}`;e=`${n}${a}?mode=multiplayer&code=${t}`}}catch{}return e||(e=`/game?mode=multiplayer&code=${t}`),`Join my Wuzzle Games multiplayer game
Link: ${e}
Room code: ${t}`}function KE(t,e){const n=p.useCallback(async()=>{const r=A_();try{if(r&&navigator.share)try{await navigator.share({title:"Wuzzle Games",text:t});return}catch(i){if(i.name==="AbortError")return;console.error("Share failed, falling back to clipboard:",i)}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t),e("Copied to clipboard!",2e3);else{const i=document.createElement("textarea");i.value=t,i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="2em",i.style.height="2em",i.style.padding="0",i.style.border="none",i.style.outline="none",i.style.boxShadow="none",i.style.background="transparent",i.style.opacity="0",document.body.appendChild(i),i.focus(),i.select();try{document.execCommand("copy")?e("Copied to clipboard!",2e3):e("Failed to copy. Please copy manually.",3e3)}catch(o){console.error("Fallback copy failed:",o),e("Failed to copy. Please copy manually.",3e3)}document.body.removeChild(i)}}catch(i){console.error("Error in handleShare:",i),e("Failed to copy. Please copy manually.",3e3)}},[t,e]),s=p.useCallback(async r=>{const i=A_(),o=O3(r);try{if(i&&navigator.share)try{await navigator.share({title:"Join my Wuzzle Games game!",text:o});return}catch(a){if(a.name==="AbortError")return;console.error("Share failed, falling back to clipboard:",a)}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(o),e("Code copied to clipboard!",2e3);else{const a=document.createElement("textarea");a.value=o,a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="2em",a.style.height="2em",a.style.padding="0",a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",a.style.opacity="0",document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy")&&e("Code copied to clipboard!",2e3)}catch(l){console.error("Fallback copy failed:",l)}document.body.removeChild(a)}}catch(a){console.error("Error in handleShareCode:",a)}},[e]);return{handleShare:n,handleShareCode:s}}let pc=null,mc=null;async function j3(){return pc||mc||(mc=(async()=>{const t="/better-wordle/",[e,n]=await Promise.all([fetch(`${t}wordle-answers-alphabetical.txt`),fetch(`${t}valid-wordle-words.txt`)]);if(!e.ok)throw new Error(`Failed to load answers: ${e.status} ${e.statusText}`);if(!n.ok)throw new Error(`Failed to load guesses: ${n.status} ${n.statusText}`);const s=await e.text(),r=await n.text(),i=s.split(`
`).map(a=>a.trim()).filter(a=>a.length===5).map(a=>a.toUpperCase()),o=r.split(`
`).map(a=>a.trim()).filter(a=>a.length===5).map(a=>a.toUpperCase());return pc={answerWords:i,allowedGuesses:o,allowedSet:new Set(o)},pc})(),mc)}async function or(){const t=await j3();return{ANSWER_WORDS:t.answerWords,ALLOWED_GUESSES:t.allowedGuesses}}function F3({speedrunEnabled:t,solvedState:e,committedRef:n,committedStageMsRef:s,setStageTimerSeed:r}){const i=e&&e.stageElapsedMs||0;typeof r=="function"&&r({elapsedMs:i,frozen:!!t}),t?(n.current=!0,s.current=i):(n.current=!1,s.current=0)}function L3({speedrunEnabled:t,savedGameState:e,committedRef:n,committedStageMsRef:s,setStageTimerSeed:r}){if(!t||!e){if(n.current=!1,s.current=0,typeof r=="function"){const a=e&&e.stageElapsedMs||0;r({elapsedMs:a,frozen:!1})}return}const i=e.stageElapsedMs||0,o=e.stageElapsedMs>0&&e.stageElapsedMs===e.committedStageMs;typeof r=="function"&&r({elapsedMs:i,frozen:!!o}),n.current=!!o,s.current=o?e.committedStageMs||i:0}function $3({mode:t,speedrunEnabled:e,numBoards:n,marathonIndex:s,marathonLevels:r,getGameStateKey:i,savedSolvedStateRef:o,committedRef:a,committedStageMsRef:l,setBoards:c,setCurrentGuess:h,setMessage:d,clearMessageTimer:f,setShowOutOfGuesses:m,setIsUnlimited:g,setSelectedBoardIndex:y,setRevealId:S,setIsFlipping:T,setMaxTurns:w,setAllowedSet:b,setIsLoading:_,setShowPopup:k,setTimedMessage:O,setStageTimerSeed:q,archiveDate:I=null,setAnswerWords:N=null}){const{user:M,loading:j}=On(),ne=p.useRef(null),oe=p.useRef(!0);p.useEffect(()=>{if(oe.current=!0,j)return;async function ve(){if(I&&!M){oe.current&&(_(!1),O("You must be signed in to play archive games.",5e3));return}try{oe.current&&_(!0);const Se=I||ts(),Y=Fi(t,n,e,t==="marathon"?s:null,Se),C=await FE({authUser:M,database:K,solvedKey:Y}),$=C&&Array.isArray(C.boards)?C.boards.length:0,G=$>0&&$===n;if(C&&G){const de=Array.isArray(C.boards)?C.boards:[],ae=!!C.exitedDueToOutOfGuesses;F3({speedrunEnabled:e,solvedState:C,committedRef:a,committedStageMsRef:l,setStageTimerSeed:q});const re=1,ye=de.map(W=>W&&(!ae&&W.isSolved?{...W,lastRevealId:re}:ae&&Array.isArray(W.guesses)&&W.guesses.length>0?{...W,lastRevealId:re}:{...W,lastRevealId:W.lastRevealId??null})),Ne={...C,boards:ye};o.current=Ne,c(ye),h(""),d(""),f(),m(!1),g(!1),y(null),S(re),T(!1);const Te=oa(n);w(Te);const{ALLOWED_GUESSES:E,ANSWER_WORDS:z}=await or();b(new Set(E)),t==="solutionhunt"&&typeof N=="function"&&N(z),_(!1),ae?k(!0):(ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{ne.current=null,oe.current&&k(!0)},la));return}o.current=null;let B=null;if(I&&M){const{loadArchiveGameState:de}=await Je(async()=>{const{loadArchiveGameState:ae}=await Promise.resolve().then(()=>Uu);return{loadArchiveGameState:ae}},void 0);B=await de({uid:M.uid,mode:t,speedrunEnabled:e,dateString:I})}const D=i(),v=B||(I?null:await LE({authUser:M,database:K,gameStateKey:D})),x=v&&Array.isArray(v.boards)?v.boards.length:0,A=x>0&&x===n;if(v&&A&&!v.boards.every(ae=>ae.isSolved)){const{ALLOWED_GUESSES:ae,ANSWER_WORDS:re}=await or();b(new Set(ae)),t==="solutionhunt"&&typeof N=="function"&&N(re),c(v.boards),h(v.currentGuess||""),w(v.maxTurns||oa(n)),g(v.isUnlimited||!1),y(null),L3({speedrunEnabled:e,savedGameState:v,committedRef:a,committedStageMsRef:l,setStageTimerSeed:q}),S(v.revealId||0),T(!1),k(!1),m(!1),d(""),f(),_(!1);return}const{ANSWER_WORDS:P,ALLOWED_GUESSES:Q}=await or();b(new Set(Q)),t==="solutionhunt"&&typeof N=="function"&&N(P);const U=oa(n);w(U);const R=t==="marathon"?s:null,ie=t==="marathon"?r||[1,2,3,4]:[1,2,3,4];let he;if(I){const{loadArchiveSolution:de,saveArchiveSolution:ae}=await Je(async()=>{const{loadArchiveSolution:ye,saveArchiveSolution:Ne}=await Promise.resolve().then(()=>Uu);return{loadArchiveSolution:ye,saveArchiveSolution:Ne}},void 0),re=await de({mode:t,speedrunEnabled:e,dateString:I});re&&re.length>=n?he=re.slice(0,n):(he=v_(P,n,t,e,R,ie,I),await ae({mode:t,speedrunEnabled:e,dateString:I,solutions:he,numBoards:n}))}else he=v_(P,n,t,e,R,ie);const se=he.map(de=>g1(de));c(se),h(""),d(""),f(),k(!1),m(!1),g(!!e),y(null),a.current=!1,l.current=0,typeof q=="function"&&q({elapsedMs:0,frozen:!1}),S(0),T(!1),_(!1)}catch(Se){if(oe.current){_(!1);const Y=ji(Se)||"Failed to load word lists. Please refresh the page.";O(Y,V0)}}}return ve(),()=>{oe.current=!1,ne.current&&(clearTimeout(ne.current),ne.current=null)}},[n,t,e,s,M,j,I])}function YE({disabled:t,onEnter:e,onBackspace:n,onLetter:s}){const r=p.useRef(t),i=p.useRef(e),o=p.useRef(n),a=p.useRef(s);p.useEffect(()=>{r.current=t},[t]),p.useEffect(()=>{i.current=e},[e]),p.useEffect(()=>{o.current=n},[n]),p.useEffect(()=>{a.current=s},[s]),p.useEffect(()=>{const l=c=>{var m,g,y;if(r.current)return;const h=c.target;if(h&&(h.tagName==="INPUT"||h.tagName==="TEXTAREA"||h.isContentEditable||typeof h.getAttribute=="function"&&h.getAttribute("data-chat-input")==="true"||typeof h.closest=="function"&&h.closest("input")||typeof h.closest=="function"&&h.closest("textarea")||typeof h.closest=="function"&&h.closest('[contenteditable="true"]')||typeof h.closest=="function"&&h.closest('[data-chat-input="true"]')))return;const d=c.key;if(d==="Backspace"){c.preventDefault(),(m=o.current)==null||m.call(o);return}if(d==="Enter"){c.preventDefault(),(g=i.current)==null||g.call(i);return}const f=d.toUpperCase();/^[A-Z]$/.test(f)&&((y=a.current)==null||y.call(a,f))};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[])}function QE(t,e,n){const s=Array.isArray(t)?t:[],r=p.useMemo(()=>s.map(l=>_1(Array.isArray(l==null?void 0:l.guesses)?l.guesses:[])),[s]),i=p.useMemo(()=>e==null?null:r[e]||null,[e,r]),o=p.useMemo(()=>Math.ceil(Math.sqrt(Math.max(n||s.length||1,1))),[n,s.length]),a=p.useMemo(()=>Math.ceil((n||s.length||1)/o),[n,s.length,o]);return{perBoardLetterMaps:r,focusedLetterMap:i,gridCols:o,gridRows:a}}function B3(t,e=250,n={}){const{initialElapsedMs:s=0,initiallyFrozen:r=!1}=n||{},i=p.useRef(null),o=p.useRef(null),[a,l]=p.useState(Date.now()),[c,h]=p.useState(r),d=p.useCallback(()=>{const g=Date.now();i.current=g,o.current=null,h(!1),l(g)},[]),f=p.useCallback(()=>i.current?(o.current==null&&(o.current=Date.now()),h(!0),l(o.current),(o.current??Date.now())-i.current):0,[]);p.useEffect(()=>{if(t&&i.current==null&&s>0){const g=Date.now();r?(i.current=g-s,o.current=g):(i.current=g-s,o.current=null),l(g)}},[t,s,r]);const m=!t||!i.current?0:(o.current??a)-i.current;return p.useEffect(()=>{if(!t)return;let g=null;const y=()=>{document.visibilityState==="visible"&&l(Date.now())};g=window.setInterval(y,e);const S=()=>y();return document.addEventListener("visibilitychange",S),()=>{g!=null&&window.clearInterval(g),document.removeEventListener("visibilitychange",S)}},[t,e]),{start:d,freeze:f,elapsedMs:m,isFrozen:c}}function XE(t,e){if(!t||t.length===0)return[];if(!e||e.length===0)return t;const n=U3(e);return t.filter(s=>z3(s,n))}function U3(t){const e=Array(bt).fill(null),n=Array(bt).fill(null).map(()=>new Set),s=new Map,r=new Set,i=new Map;for(const o of t){if(!o||typeof o.word!="string"||!Array.isArray(o.colors))continue;const a=o.word.toUpperCase(),l=o.colors,c=new Map;for(let h=0;h<bt&&h<a.length&&h<l.length;h++){const d=a[h],f=l[h];c.has(d)||c.set(d,{green:0,yellow:0,grey:0});const m=c.get(d);f==="green"?(m.green++,e[h]=d):f==="yellow"?(m.yellow++,n[h].add(d)):f==="grey"&&m.grey++}for(const[h,d]of c){const f=d.green+d.yellow;if(f>0){const m=s.get(h)||0;if(s.set(h,Math.max(m,f)),d.grey>0){const g=f,y=i.get(h);(y===void 0||g<y)&&i.set(h,g)}r.delete(h)}else d.grey>0&&(s.has(h)||r.add(h))}}return{greenPositions:e,yellowPositions:n,mustContain:s,cannotContain:r,maxCounts:i}}function z3(t,e){const{greenPositions:n,yellowPositions:s,mustContain:r,cannotContain:i,maxCounts:o}=e,a=new Map;for(const l of t)a.set(l,(a.get(l)||0)+1);for(let l=0;l<bt;l++)if(n[l]!==null&&t[l]!==n[l])return!1;for(let l=0;l<bt;l++)if(s[l].has(t[l]))return!1;for(const[l,c]of r)if((a.get(l)||0)<c)return!1;for(const l of i)if(a.has(l)&&a.get(l)>0)return!1;for(const[l,c]of o)if((a.get(l)||0)>c)return!1;return!0}function Mp({mode:t,numBoards:e,speedrunEnabled:n,archiveDate:s=null}){let r="WUZZLE GAMES";if(s){const i=Bu(s);t==="marathon"?r=`ARCHIVE OF ${i.toUpperCase()}  MARATHON (${e} boards)`:t==="daily"?r=`ARCHIVE OF ${i.toUpperCase()}  DAILY`:r=`ARCHIVE OF ${i.toUpperCase()}`,n&&(r+="  SPEEDRUN")}else t==="marathon"?r=`MARATHON (${e} boards)`:t==="daily"?r="DAILY GAME":t==="multiplayer"&&(r=`MULTIPLAYER (${e} board${e>1?"s":""})`);return!s&&n&&(r+="  SPEEDRUN"),u.jsx("div",{style:{padding:"16px 16px 8px",backgroundColor:"#212121",textAlign:"center"},children:u.jsx("div",{style:{fontWeight:"bold",letterSpacing:2,fontSize:14},children:r})})}function V3({numBoards:t,speedrunEnabled:e,isMarathonSpeedrun:n,formatElapsed:s,stageElapsedMs:r,displayTotalMs:i,turnsUsed:o,maxTurns:a}){return u.jsxs("div",{style:{padding:"10px 12px",borderRadius:8,border:"1px solid #3a3a3c",background:"#372F41",display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",gap:12},children:[u.jsxs("div",{style:{fontSize:12,color:"#d7dadc",textTransform:"uppercase",letterSpacing:.5},children:["Boards:"," ",u.jsx("span",{style:{fontWeight:"bold"},children:t})]}),u.jsx("div",{style:{flex:1,textAlign:"center"},children:e?u.jsx("div",{style:{fontSize:22,fontWeight:"bold",letterSpacing:1,color:"#ffffff"},children:n?u.jsxs(u.Fragment,{children:[s(r||0),u.jsxs("span",{style:{display:"block",marginTop:2,fontSize:11,fontWeight:"normal",color:"#a1a1aa"},children:["Total ",s(i||0)]})]}):u.jsx(u.Fragment,{children:s(r||0)})}):u.jsxs("div",{style:{fontSize:18,fontWeight:"bold",color:"#ffffff"},children:["Guesses: ",o,"/",a]})}),u.jsxs("div",{style:{fontSize:12,color:"#d7dadc",textTransform:"uppercase",letterSpacing:.5,textAlign:"right"},children:["Guesses:"," ",u.jsx("span",{style:{fontWeight:"bold"},children:e?"Unlimited":a})]})]})}function JE({message:t}){if(!t)return null;const n=(typeof t=="string"?t:String(t)).toLowerCase(),s=/not in word list|failed|error|must |not your turn|cannot|can't/i.test(n),r={position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",padding:"12px 20px",borderRadius:10,fontSize:14,fontWeight:"bold",boxShadow:"0 10px 30px rgba(0,0,0,0.55)",zIndex:3e3,pointerEvents:"none",maxWidth:"90vw",textAlign:"center",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:8,backdropFilter:"blur(6px)"},i=s?{backgroundColor:"#2b0004",color:"#ff6b6b",border:"1px solid #ff6b6b"}:{backgroundColor:"rgba(24,24,27,0.96)",color:"#e5e7eb",border:"1px solid #4b5563"};return u.jsxs("div",{role:"status","aria-live":"polite",style:{...r,...i},children:[s&&u.jsx("span",{"aria-hidden":"true",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:18,height:18,borderRadius:"999px",border:"1px solid currentColor",fontSize:11},children:"!"}),u.jsx("span",{children:t})]})}function W3({board:t,rowIdx:e,currentGuess:n,invalidCurrentGuess:s,numBoards:r,maxTurns:i,isUnlimited:o,revealId:a,isJustRevealedRow:l}){const c=Array.isArray(t==null?void 0:t.guesses)?t.guesses:[],h=c[e];c.length;const d=!h&&!t.isSolved&&(o||!t.isDead)&&e===c.length,f=d&&s,m=S1(c),g=r>=16?28:32,y=r>=16?1.5:2,S=5*(g+y*2);return u.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:4,minHeight:`${g+4}px`,flexShrink:0,height:`${g+4}px`,width:"100%",maxWidth:`${S}px`,marginLeft:"auto",marginRight:"auto"},children:Array.from({length:bt}).map((T,w)=>{const b=d?n[w]:"",_=h?h.word[w]:b||(d?m[w]:""),k=!h&&d&&!b&&!!m[w],O=h?h.colors[w]:void 0;if(!h){let ne="#212121",oe=d?"#565758":"#3A3A3C",ve=k?"rgba(255,255,255,0.45)":"#ffffff";return f&&(oe="#ef4444",ne="#2a0f10",ve="#ffffff"),u.jsx("div",{style:{width:g,height:g,margin:y,borderRadius:4,border:`2px solid ${oe}`,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:r>=16?16:18,backgroundColor:ne,textTransform:"uppercase",color:ve,flexShrink:0,boxSizing:"border-box"},children:_},w)}if(!(l&&t.lastRevealId!=null&&t.lastRevealId===a)){const ne=R_(O);return u.jsx("div",{style:{width:g,height:g,margin:y,borderRadius:4,border:"2px solid transparent",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:r>=16?16:18,backgroundColor:ne,textTransform:"uppercase",color:"#ffffff",flexShrink:0,boxSizing:"border-box"},children:_},w)}const I="#212121",N="#3A3A3C",M=R_(O),j=w*W0;return u.jsx("div",{className:"mw-tile",style:{width:g,height:g,margin:y},children:u.jsxs("div",{className:"mw-card mw-flip",style:{animationDelay:`${j}ms`},children:[u.jsx("div",{className:"mw-face mw-front",style:{backgroundColor:I,border:`2px solid ${N}`,color:"#ffffff",fontSize:r>=16?16:18},children:_}),u.jsx("div",{className:"mw-face mw-back",style:{backgroundColor:M,border:"2px solid transparent",color:"#ffffff",fontSize:r>=16?16:18},children:_})]},`${a}-${e}-${w}`)},w)})})}function H3({board:t,index:e,numBoards:n,maxTurns:s,isUnlimited:r,currentGuess:i,invalidCurrentGuess:o,revealId:a,isSelected:l,onToggleSelect:c,boardRef:h,speedrunEnabled:d,isCurrentTurn:f=!1}){const m=Array.isArray(t==null?void 0:t.guesses)?t.guesses:[],g=m.length,y=t.isSolved?g:Math.min(g+1,Math.max(s||0,g+1)),S=m.length-1;return u.jsxs("div",{ref:h,onClick:c,style:{borderRadius:8,border:l?"2px solid #B1A04C":"1px solid #3A3A3C",padding:8,background:"#372F41",cursor:"pointer",boxShadow:l?"0 0 0 1px rgba(250,204,21,0.53)":"none",display:"flex",flexDirection:"column",minWidth:0,width:"100%",boxSizing:"border-box"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6,fontSize:12,color:"#d7dadc"},children:[u.jsxs("span",{children:["Board ",e+1," ",l?" focused":""]}),!d&&u.jsx("span",{children:t.isSolved?"Solved":!r&&t.isDead?"Failed":`${g}/${s}`})]}),Array.from({length:y}).map((T,w)=>{const _=!!m[w]&&w===S;return u.jsx(W3,{board:t,rowIdx:w,currentGuess:i,invalidCurrentGuess:o,numBoards:n,maxTurns:s,isUnlimited:r,revealId:a,isJustRevealedRow:_},w)})]})}const ZE=p.memo(H3,(t,e)=>t.board===e.board&&t.index===e.index&&t.numBoards===e.numBoards&&t.maxTurns===e.maxTurns&&t.isUnlimited===e.isUnlimited&&t.currentGuess===e.currentGuess&&t.invalidCurrentGuess===e.invalidCurrentGuess&&t.revealId===e.revealId&&t.isSelected===e.isSelected&&t.speedrunEnabled===e.speedrunEnabled&&t.isCurrentTurn===e.isCurrentTurn);function G3({marathonNextBoards:t,onNextStage:e}){return u.jsx("div",{style:{position:"fixed",bottom:190,right:20,zIndex:1200,padding:0,background:"transparent",borderTop:"none"},children:u.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:u.jsxs("button",{onClick:e,style:{marginLeft:"auto",padding:"10px 14px",borderRadius:10,border:"none",background:"#B1A04C",color:"#212121",fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:["Next: ",t," boards"]})})})}function eT({numBoards:t,showBoardSelector:e,setShowBoardSelector:n,boards:s,selectedBoardIndex:r,setSelectedBoardIndex:i,boardRefs:o,isUnlimited:a,speedrunEnabled:l,statusText:c}){return t<=1?null:u.jsxs(u.Fragment,{children:[u.jsx("button",{onClick:()=>n(!e),style:{position:"fixed",bottom:210,left:20,padding:"6px 12px",borderRadius:6,backgroundColor:"#212121",border:"1px solid #ffffff",color:"#ffffff",fontSize:11,fontWeight:"bold",cursor:"pointer",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 16px rgba(0,0,0,0.7)",transition:"all 0.3s ease",outline:"none",whiteSpace:"nowrap"},"aria-label":e?"Close board selection":"Open board selection",children:e?"Close":"Board Selection"}),e&&u.jsx("div",{style:{position:"fixed",bottom:280,left:20,backgroundColor:"#372F41",borderRadius:12,padding:"16px",boxShadow:"0 4px 20px rgba(0,0,0,0.8)",zIndex:9998,border:"1px solid #3A3A3C",maxWidth:"90vw",minWidth:200},children:u.jsxs("div",{className:"flexColumn flexGap12",children:[!l&&c&&u.jsx("div",{style:{fontSize:14,color:"#d7dadc",fontWeight:"bold",marginBottom:4},children:c}),u.jsx("div",{className:"flexRow flexGap6 flexWrap itemsCenter",children:s.map((h,d)=>{const f=r===d,m=h.isSolved,g=!a&&h.isDead;return u.jsxs("button",{onClick:()=>{i(d),n(!1);const y=o.current[d];y&&y.scrollIntoView({behavior:"smooth",block:"center"})},style:{padding:"6px 12px",borderRadius:6,border:f?"2px solid #B1A04C":"1px solid #3A3A3C",background:m?"#50a339":g?"#3A3A3C":f?"#372F41":"transparent",color:"#ffffff",fontSize:13,fontWeight:"bold",cursor:"pointer",transition:"all 0.2s",minWidth:40,textAlign:"center"},children:["B",d+1]},d)})})]})})]})}function q3({maxTurns:t,mode:e,marathonHasNext:n,onExit:s,onContinue:r,onNextStage:i,freezeStageTimer:o,setShowOutOfGuesses:a,setShowPopup:l}){const{user:c}=On(),{showSubscriptionGate:h}=id(c),[d,f]=p.useState(!1),m=()=>{f(!0)},g=()=>{f(!1)},y=()=>{f(!1)};return u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.82)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2100},children:[u.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:16,padding:24,maxWidth:520,width:"92vw",textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,0.8)"},children:[u.jsx("h2",{style:{margin:0,marginBottom:10,fontSize:20,fontWeight:"bold"},children:"All guesses used"}),u.jsxs("div",{style:{marginBottom:16,fontSize:14,color:"#d7dadc",lineHeight:1.4},children:["You reached the max turns (",t,"). Do you want to end the game, continue with unlimited guesses?"]}),u.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[u.jsx("button",{onClick:s,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"1px solid #3A3A3C",background:"transparent",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"End Game"}),u.jsx("button",{onClick:r,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#B1A04C",color:"#212121",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Continue"}),c&&h&&u.jsx("button",{onClick:m,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Subscribe"})]})]}),u.jsx(od,{isOpen:d,onRequestClose:g,onSubscriptionComplete:y})]})}const zu=30*60*1e3;function tl(t){return t?Array.isArray(t.solutions)&&t.solutions.length>0?t.solutions:typeof t.solution=="string"&&t.solution.length>0?[t.solution]:[]:[]}function tT({allSolved:t,boards:e,speedrunEnabled:n,stageElapsedMs:s,popupTotalMs:r,formatElapsed:i,solvedCount:o,mode:a,marathonHasNext:l,turnsUsed:c,maxTurns:h,onShare:d,onClose:f,onNextStage:m,freezeStageTimer:g,isMarathonSpeedrun:y,commitStageIfNeeded:S,isMultiplayer:T,multiplayerGameState:w,winner:b,isPlayerHost:_,onRematch:k,onChangeMode:O,myScore:q,opponentScore:I,canShare:N=!0,allowNextStageAfterPopup:M=!0,hasCommentsSection:j=!1,streakLabel:ne,currentUserId:oe,onAddFriend:ve,friendRequestSent:Se,friendIds:Y}){br();const{user:C}=On(),{showSubscriptionGate:$}=id(C),[G,B]=p.useState(!1),D=U=>{U.target===U.currentTarget&&f()},v=()=>{B(!0)},x=()=>{B(!1)},A=()=>{B(!1)},P=()=>{const U=g();y&&S(U),f(),m()},Q=!T&&(t||j)&&(a==="daily"||a==="marathon");return u.jsxs("div",{onClick:D,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.82)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:[u.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:16,padding:24,maxWidth:560,width:"92vw",maxHeight:"80vh",overflowY:"auto",textAlign:"center",boxShadow:"0 20px 60px rgba(0,0,0,0.8)"},children:[T?(()=>{const U=(w==null?void 0:w.speedrun)||!1,R=typeof q=="number"||typeof I=="number",ie=w&&w.players&&typeof w.players=="object"?Object.values(w.players).filter(Boolean):null,he=tl(w),se=(E,z,W,le)=>{const fe=Array.isArray(W)?W:[],qe=fe.length,Ce=typeof le=="number"?le:null;let st=!1;if(he.length>0){const Me=fe.map(ce=>typeof ce=="string"?ce.toLowerCase():"");st=he.every(ce=>{const Ee=typeof ce=="string"?ce.toLowerCase():"";return Me.includes(Ee)})}return{id:E||null,name:z||"Player",guessCount:qe,timeMs:Ce,solvedAll:st}},de=[];ie&&ie.length>0&&ie.forEach(E=>{const z=E.id||null,W=E.name||"Player",le=E.guesses||[],fe=E.timeMs;de.push(se(z,W,le,fe))});const ae=E=>U?typeof E.timeMs=="number"?E.timeMs:Number.POSITIVE_INFINITY:E.guessCount,re=(()=>{if(!de.length)return[];const E=[...de].sort((W,le)=>{const fe=ae(W),qe=ae(le);return fe!==qe?fe-qe:(W.name||"").localeCompare(le.name||"")}),z=[];return E.forEach((W,le)=>{if(le===0)z.push({...W,rank:1});else{const fe=z[le-1],qe=ae(W)===ae(fe);z.push({...W,rank:qe?fe.rank:le+1})}}),z})(),ye=E=>{const z=E%100;if(z>=11&&z<=13)return`${E}th`;switch(E%10){case 1:return`${E}st`;case 2:return`${E}nd`;case 3:return`${E}rd`;default:return`${E}th`}};let Ne="Game finished",Te="#B1A04C";if(re.length){const z=(()=>{if(oe){const W=re.find(le=>le.id===oe);if(W)return W}return null})();if(z){const W=re.filter(fe=>fe.rank===z.rank).length,le=ye(z.rank);W>1?Ne=`You are tied for ${le} place`:Ne=`You finished ${le}`,Te=z.rank===1?"#50a339":"#B1A04C"}}return u.jsxs(u.Fragment,{children:[u.jsx("h2",{style:{margin:0,marginBottom:20,fontSize:24,fontWeight:"bold",letterSpacing:1,color:Te},children:Ne}),u.jsxs("div",{style:{marginBottom:20,fontSize:18,color:"#d7dadc"},children:[T&&(w==null?void 0:w.status)==="finished"&&u.jsx("div",{style:{marginBottom:12,fontSize:14,color:"#B1A04C"},children:(()=>{const E=w==null?void 0:w.players;let z=!1,W=!1,le=!1;if(E&&typeof E=="object"&&oe){const fe=Object.values(E).filter(Boolean),qe=E[oe];z=!!(qe!=null&&qe.rematch),W=fe.length>0&&fe.every(Ce=>!!Ce.rematch),le=fe.some(Ce=>!!Ce.rematch)}return W?"Starting rematch...":z&&!W?"Waiting for other players to accept rematch...":!z&&le?"Other players want a rematch":null})()}),u.jsxs("div",{style:{marginBottom:12},children:[u.jsx("div",{style:{fontSize:16,color:"#818384",marginBottom:4},children:U?"Your Time":R?"Your Score":"Your Guesses"}),u.jsx("div",{style:{fontSize:24,color:"#ffffff",fontWeight:"bold"},children:(()=>{if(U){if(!w)return"N/A";let z=null;return oe&&w.players&&w.players[oe]&&(z=w.players[oe].timeMs??null),z!=null?i(z):"N/A"}if(typeof q=="number")return q;if(!w)return"N/A";let E=[];return oe&&w.players&&w.players[oe]&&(E=w.players[oe].guesses||[]),E.length===0&&(E=_?w.hostGuesses||[]:w.guestGuesses||[]),E.length})()})]}),u.jsxs("div",{style:{borderTop:"1px solid #3A3A3C",paddingTop:12},children:[u.jsx("div",{style:{fontSize:16,color:"#818384",marginBottom:4},children:U?"Opponent's Time":R?"Opponent's Score":"Opponent's Guesses"}),u.jsx("div",{style:{fontSize:24,color:"#ffffff",fontWeight:"bold"},children:(()=>{if(U){if(!w)return"N/A";let z=null;if(w.players&&typeof w.players=="object"){const W=Object.values(w.players).find(le=>le.id&&le.id!==oe);W&&(z=W.timeMs??null)}return z!=null?i(z):"N/A"}if(typeof I=="number")return I;if(!w)return"N/A";let E=[];if(w.players&&typeof w.players=="object"){const z=Object.values(w.players).find(W=>W.id&&W.id!==oe);z&&(E=z.guesses||[])}return E.length===0&&(E=_?w.guestGuesses||[]:w.hostGuesses||[]),E.length})()})]}),re.length>0&&u.jsxs("div",{style:{marginTop:20,paddingTop:12,borderTop:"1px solid #3A3A3C",textAlign:"left"},children:[u.jsx("div",{style:{fontSize:14,fontWeight:"bold",color:"#d7dadc",marginBottom:8},children:"Room rankings"}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,fontSize:13},children:re.map(E=>{const z=oe&&E.id===oe,W=U?E.timeMs!=null?i(E.timeMs):"":`${E.guessCount} guess${E.guessCount===1?"":"es"}`,le=he.length?E.solvedAll?"Solved all boards":"Not finished":null;return u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 6px",borderRadius:4,backgroundColor:z?"#6d597a":"transparent"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.jsx("div",{style:{minWidth:36,fontWeight:"bold",color:"#d7dadc"},children:ye(E.rank)}),u.jsx(xr,{userId:E.id,username:E.name||"Player",isYou:z,size:"sm"})]}),u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.jsxs("div",{style:{textAlign:"right",color:"#d7dadc"},children:[u.jsx("div",{children:W}),le&&u.jsx("div",{style:{fontSize:11,color:"#9ca3af"},children:le})]}),!z&&ve&&!(Y!=null&&Y.includes(E.id))&&(()=>{const fe=typeof Se=="object"?Se[E.id]:!!Se;return u.jsx("button",{onClick:()=>ve(E.name,E.id),disabled:fe,style:{padding:"4px 8px",fontSize:12,borderRadius:4,border:"none",backgroundColor:fe?"#3A3A3C":"#e56b6f",color:"#ffffff",cursor:fe?"default":"pointer",fontWeight:"bold",whiteSpace:"nowrap"},children:fe?"":"Add friend"})})()]})]},E.id||E.name)})})]})]})]})})():u.jsxs(u.Fragment,{children:[u.jsx("h2",{style:{margin:0,marginBottom:10,fontSize:22,fontWeight:"bold",letterSpacing:1,color:t?"#50a339":"#d7dadc"},children:t?"Congratulations!":"Stage ended"}),n&&u.jsxs("div",{style:{marginBottom:12,color:"#d7dadc",fontSize:15},children:[u.jsxs("div",{children:["Total time: ",i(r)]}),a==="marathon"&&u.jsxs("div",{children:["Stage time: ",i(s)]})]}),u.jsx("div",{style:{marginBottom:8,fontSize:16,color:"#d7dadc"},children:t?e.length===1?"You solved the word.":`You solved all ${e.length} words.`:`You solved ${o} of ${e.length} word${e.length>1?"s":""}.`}),u.jsx("div",{style:{marginBottom:14,fontSize:18,color:"#ffffff",fontWeight:"bold"},children:n?`Guesses used: ${c}`:`Guesses used: ${c}/${h}`}),ne&&u.jsx("div",{style:{marginBottom:10,fontSize:14,color:"#d7dadc"},children:ne})]}),!T&&u.jsxs(u.Fragment,{children:[u.jsx("div",{style:{marginBottom:10,color:"#ffffff",fontWeight:"bold"},children:"Solutions"}),u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,justifyContent:"center",marginBottom:16},children:(Array.isArray(e)?e:[]).map((U,R)=>u.jsxs("div",{style:{backgroundColor:U&&U.isSolved?"#50a339":"#3A3A3C",color:"#ffffff",padding:"8px 10px",borderRadius:8,fontSize:13},children:["Board ",R+1,": ",U&&U.solution?U.solution:"?"]},(U==null?void 0:U.solution)??`board-${R}`))})]}),T&&((w==null?void 0:w.solution)||(w==null?void 0:w.solutions))&&u.jsxs("div",{style:{marginBottom:16},children:[u.jsx("div",{style:{marginBottom:8,color:"#ffffff",fontWeight:"bold",fontSize:16},children:Array.isArray(w==null?void 0:w.solutions)&&w.solutions.length>1?"Solutions":"Solution"}),(()=>{const U=tl(w);return u.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,justifyContent:"center"},children:U.map((R,ie)=>u.jsxs("div",{style:{backgroundColor:"#50a339",color:"#ffffff",padding:"8px 12px",borderRadius:8,fontSize:16,fontWeight:"bold",letterSpacing:2},children:[U.length>1?`B${ie+1}: `:"",R.toUpperCase()]},typeof R=="string"?R:`sol-${ie}`))})})()]}),u.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[!T&&N&&u.jsx("button",{onClick:d,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Share"}),T&&_&&k&&u.jsx("button",{onClick:k,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Rematch"}),T&&!_&&O&&u.jsx("button",{onClick:O,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"1px solid #3A3A3C",background:"#355070",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"View Config"}),T&&_&&O&&u.jsx("button",{onClick:O,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"1px solid #3A3A3C",background:"#355070",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Change Mode"}),u.jsx("button",{onClick:f,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"1px solid #3A3A3C",background:"#355070",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:Q?"View Comments":"Close"}),a==="marathon"&&l&&M&&t&&u.jsx("button",{onClick:P,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Next Stage"}),C&&$&&u.jsx("button",{onClick:v,style:{flex:1,minWidth:160,padding:"12px 0",borderRadius:10,border:"none",background:"#B1A04C",color:"#212121",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase"},children:"Subscribe"})]})]}),u.jsx(od,{isOpen:G,onRequestClose:x,onSubscriptionComplete:A})]})}function nT({numBoards:t,selectedBoardIndex:e,perBoardLetterMaps:n,focusedLetterMap:s,gridCols:r,gridRows:i,onVirtualKey:o}){return u.jsx("div",{className:"keyboardInner",children:m1.map((a,l)=>u.jsx("div",{className:"keyboardRow",children:a.map(c=>{const h=c==="ENTER",d=c==="BACK",f=/^[A-Z]$/.test(c),m=t>1&&e==null;let g="#3A3A3C";if(!m&&f){const w=e==null?n[0]:s,b=w&&w[c]?w[c]:"none";g=b==="none"?"#3A3A3C":v1(b)}const y=c==="BACK"?"":c==="ENTER"?"Enter":c,S=f&&m,T=f?n.map(w=>w[c]||"none"):[];return u.jsxs("button",{onClick:()=>o(c),className:`keyBtn ${h||d?"keyBtnAction":""}`,style:{backgroundColor:g},"aria-label":c==="BACK"?"Backspace":c==="ENTER"?"Enter":c,children:[u.jsx("div",{className:`keyLabel ${c==="BACK"?"keyLabelBackspace":""}`,children:y}),S&&u.jsxs("div",{className:"keyOverlayGrid",style:{gridTemplateColumns:`repeat(${r}, 1fr)`},children:[T.map((w,b)=>u.jsx("div",{className:"keyOverlayCell",style:{backgroundColor:w1(w)}},b)),Array.from({length:r*i-t}).map((w,b)=>u.jsx("div",{className:"keyOverlayPad"},`pad-${b}`))]})]},c)})},l))})}function K3({threadId:t}){const{user:e}=On(),[n,s]=p.useState(""),[r,i]=p.useState(""),[o,a]=p.useState(!0),[l,c]=p.useState(!1),[h,d]=p.useState(null),[f,m]=p.useState([]),g=p.useMemo(()=>`Wuzzle-games-player-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`,[]),y=p.useMemo(()=>{if(typeof window>"u")return null;try{const w="mw:commentsClientId";let b=window.localStorage.getItem(w);return b||(b=`guest:${Math.random().toString(36).slice(2,10)}`,window.localStorage.setItem(w,b)),b}catch{return null}},[]);p.useEffect(()=>{if(e){const w=e.displayName||e.email||"Unknown user";s(w),a(!1)}else a(!0),s(w=>w||g)},[e,g]),p.useEffect(()=>{if(!t)return;const w=Z(K,`comments/${t}`),b=Ih(w,Th(300)),_=Un(b,k=>{if(!k.exists()){m([]);return}const O=k.val()||{},q=Object.entries(O).map(([I,N])=>({id:I,...N||{}})).sort((I,N)=>{const M=I.createdAt||0;return(N.createdAt||0)-M});m(q)});return()=>{typeof _=="function"&&_()}},[t]);const S=async w=>{if(w.preventDefault(),!t)return;const b=r.trim(),_=n.trim();if(!(!b||!_)){c(!0),d(null);try{const k=Z(K,`comments/${t}`),O=Ch(k);await Pt(O,{username:_,text:b,createdAt:Date.now(),uid:(e==null?void 0:e.uid)||null,userReactions:{}}),i("")}catch{d("Failed to submit comment. Please try again.")}finally{c(!1)}}},T=async(w,b)=>{if(!t||!w)return;const _=e&&e.uid||y;if(_)try{const k=Z(K,`comments/${t}/${w}`),O=f.find(M=>M.id===w),N=((O&&O.userReactions&&typeof O.userReactions=="object"?O.userReactions:{})[_]||null)===b?{[`userReactions/${_}`]:null}:{[`userReactions/${_}`]:b};await It(k,N)}catch{}};return t?u.jsxs("section",{"aria-label":"Comments",style:{marginTop:24,paddingTop:16,borderTop:"1px solid #3a3a3c"},children:[u.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:16,fontWeight:"bold",letterSpacing:1,textTransform:"uppercase"},children:"Comments"}),u.jsxs("form",{onSubmit:S,style:{marginBottom:16},children:[u.jsxs("div",{style:{marginBottom:8},children:[u.jsx("label",{htmlFor:"comment-username",style:{display:"block",fontSize:12,marginBottom:4,color:"#d7dadc"},children:"Username"}),u.jsx("input",{id:"comment-username",type:"text",value:n,onChange:w=>o?s(w.target.value):null,readOnly:!o,style:{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid #3A3A3C",backgroundColor:"#212121",color:"#ffffff",fontSize:14}})]}),u.jsxs("div",{style:{marginBottom:8},children:[u.jsx("label",{htmlFor:"comment-text",style:{display:"block",fontSize:12,marginBottom:4,color:"#d7dadc"},children:"Comment"}),u.jsx("textarea",{id:"comment-text",rows:3,value:r,onChange:w=>i(w.target.value),style:{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid #3A3A3C",backgroundColor:"#212121",color:"#ffffff",fontSize:14,resize:"vertical"}})]}),h&&u.jsx("div",{style:{color:"#f87171",fontSize:12,marginBottom:6},children:h}),u.jsx("button",{type:"submit",disabled:l||!r.trim()||!n.trim(),style:{padding:"8px 14px",borderRadius:8,border:"none",backgroundColor:l||!r.trim()||!n.trim()?"#3A3A3C":"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:l||!r.trim()||!n.trim()?"default":"pointer",textTransform:"uppercase",letterSpacing:1},children:l?"Submitting...":"Post Comment"})]}),u.jsx("div",{children:f.length===0?u.jsx("div",{style:{fontSize:13,color:"#9ca3af"},children:"No comments yet. Be the first to share your thoughts about this puzzle."}):u.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:10},children:f.map(w=>{const b=w.createdAt?new Date(w.createdAt):null,_=b?b.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):null,k=["","","","",""],O=e&&e.uid||y||null,q=w.userReactions&&typeof w.userReactions=="object"?w.userReactions:null;let I={},N=null;return q?(k.forEach(M=>{I[M]=0}),Object.values(q).forEach(M=>{k.includes(M)&&(I[M]=(I[M]||0)+1)}),O&&q[O]&&(N=q[O])):I={},u.jsxs("li",{style:{padding:"8px 10px",borderRadius:10,backgroundColor:"#372F41",border:"1px solid #3A3A3C"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4,gap:8},children:[u.jsx("div",{style:{flexShrink:0,minWidth:0},children:u.jsx(xr,{userId:w.uid||null,username:w.username||"Unknown",size:"sm"})}),_&&u.jsx("div",{style:{fontSize:11,color:"#6b7280",whiteSpace:"nowrap",flexShrink:0},children:_})]}),u.jsx("div",{style:{fontSize:14,color:"#e5e7eb",whiteSpace:"pre-wrap",marginBottom:6},children:w.text}),u.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:2},children:k.map(M=>{const j=Number(I[M]||0),ne=N===M;return u.jsxs("button",{type:"button",onClick:()=>T(w.id,M),style:{border:"none",borderRadius:999,padding:"2px 8px",backgroundColor:ne?"#6d597a":(j>0,"#372F41"),color:"#e5e7eb",fontSize:12,fontWeight:ne?"bold":"normal",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[u.jsx("span",{children:M}),j>0&&u.jsx("span",{children:j})]},M)})})]},w.id)})})})]}):null}function Y3({isOpen:t,onRequestClose:e,words:n=[],onSelectWord:s,totalWords:r=0}){const[i,o]=p.useState(""),a=p.useMemo(()=>{if(!i.trim())return n;const d=i.toUpperCase().trim();return n.filter(f=>f.includes(d))},[n,i]),l=p.useCallback(d=>{s&&s(d),e()},[s,e]),c=p.useCallback(d=>{o(d.target.value)},[]),h=p.useCallback(()=>{o(""),e()},[e]);return u.jsx(vs,{isOpen:t,onRequestClose:h,titleId:"solution-hunt-modal-title",panelClassName:"modalPanel--wide solutionHuntModal",children:u.jsxs("div",{className:"solutionHuntModalContent",children:[u.jsx("h2",{id:"solution-hunt-modal-title",className:"solutionHuntTitle",children:"Possible Words"}),u.jsx("div",{className:"solutionHuntStats",children:u.jsx("span",{className:"solutionHuntCount",children:n.length===r?`${n.length} words`:`${n.length} of ${r} words remaining`})}),u.jsxs("div",{className:"solutionHuntSearchContainer",children:[u.jsx("input",{type:"text",className:"solutionHuntSearch",placeholder:"Filter words...",value:i,onChange:c,autoComplete:"off",autoCapitalize:"characters"}),i&&u.jsx("button",{type:"button",className:"solutionHuntSearchClear",onClick:()=>o(""),"aria-label":"Clear search",children:""})]}),a.length>0?u.jsx("div",{className:"solutionHuntWordGrid",children:a.map(d=>u.jsx("button",{type:"button",className:"solutionHuntWord",onClick:()=>l(d),title:`Click to type "${d}"`,children:d},d))}):u.jsx("div",{className:"solutionHuntEmpty",children:i?"No words match your filter":"No possible words remaining"}),u.jsxs("div",{className:"solutionHuntFooter",children:[u.jsx("p",{className:"solutionHuntHint",children:"Click a word to type it into your guess"}),u.jsx("button",{type:"button",className:"solutionHuntCloseBtn",onClick:h,children:"Close"})]})]})})}const Q3=p.lazy(()=>Je(()=>import("./FeedbackModal-DtP9FLlv.js"),__vite__mapDeps([5,1])));function X3({mode:t,numBoards:e,speedrunEnabled:n,archiveDate:s=null,allSolved:r,finished:i,solutionsText:o,message:a,boards:l,maxTurns:c,turnsUsed:h,isUnlimited:d,currentGuess:f,invalidCurrentGuess:m,revealId:g,selectedBoardIndex:y,setSelectedBoardIndex:S,boardRefs:T,gridCols:w,gridRows:b,perBoardLetterMaps:_,focusedLetterMap:k,showNextStageBar:O,marathonNextBoards:q,goNextStage:I,showBoardSelector:N,setShowBoardSelector:M,statusText:j,showOutOfGuesses:ne,exitFromOutOfGuesses:oe,continueAfterOutOfGuesses:ve,showPopup:Se,stageElapsedMs:Y,popupTotalMs:C,formatElapsed:$,solvedCount:G,marathonHasNext:B,handleShare:D,freezeStageTimer:v,isMarathonSpeedrun:x,commitStageIfNeeded:A,handleVirtualKey:P,allowNextStageAfterPopup:Q,showFeedbackModal:U,setShowFeedbackModal:R,setShowPopup:ie,setShowOutOfGuesses:he,showComments:se,commentThreadId:de,canShare:ae,streakLabel:re,wordListError:ye,onRetryWordLists:Ne,countdownRemaining:Te,isSolutionHuntMode:E=!1,showSolutionHuntModal:z=!1,setShowSolutionHuntModal:W,filteredSolutionWords:le=[],totalSolutionWords:fe=0,onSelectSolutionWord:qe}){const Ce=mT();return u.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#212121",color:"#ffffff"},children:[Ce&&u.jsx(Br,{onOpenFeedback:()=>R(!0)}),n&&Te!=null&&Te>0&&u.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(18, 18, 19, 0.95)",zIndex:9999},"aria-live":"polite","aria-atomic":"true",children:u.jsxs("div",{style:{fontSize:48,fontWeight:"bold",letterSpacing:4,color:"#ffffff",textAlign:"center"},children:["Timer starts in ",Te]})}),u.jsxs("main",{style:{flex:1,overflowY:"auto",overflowX:"hidden",paddingBottom:(i?16:Mf)+(O?62:16)},children:[u.jsx(Mp,{mode:t,numBoards:e,speedrunEnabled:n,archiveDate:s}),o&&o.length>0&&u.jsx("div",{style:{padding:"0 16px 8px",fontSize:12,color:"#d7dadc",textTransform:"uppercase",fontWeight:"normal",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:o}),u.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",alignItems:"center"},children:[u.jsx("div",{style:{width:"100%",maxWidth:600,marginBottom:12},children:u.jsx(V3,{numBoards:e,speedrunEnabled:n,isMarathonSpeedrun:x,formatElapsed:$,stageElapsedMs:Y,displayTotalMs:C||Y,turnsUsed:h,maxTurns:c})}),ye&&u.jsxs("div",{style:{width:"100%",maxWidth:600,marginTop:12,marginBottom:12,padding:"12px 16px",borderRadius:8,backgroundColor:"#3a3a3c",color:"#ffffff",fontSize:14},children:[u.jsx("div",{style:{marginBottom:Ne?8:0},children:ye}),Ne&&u.jsx("button",{type:"button",className:"homeBtn homeBtnGreen",onClick:Ne,style:{marginTop:4},children:"Retry loading word lists"})]}),u.jsx(JE,{message:a}),E&&!i&&u.jsx("div",{style:{width:"100%",maxWidth:600,marginBottom:12},children:u.jsxs("button",{type:"button",onClick:()=>W(!0),style:{width:"100%",padding:"12px 16px",fontSize:14,fontWeight:600,border:"none",borderRadius:8,background:"#50a339",color:"#ffffff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[u.jsx("span",{children:""}),u.jsxs("span",{children:["View Possible Words (",le.length,")"]})]})}),u.jsx("div",{style:{width:"100%",maxWidth:600,display:"grid",gridTemplateColumns:`repeat(auto-fit, minmax(${e>=16?160:180}px, 1fr))`,gap:16},children:l.map((st,Me)=>u.jsx(ZE,{board:st,index:Me,numBoards:e,maxTurns:c,isUnlimited:d,currentGuess:f,invalidCurrentGuess:m,revealId:g,isSelected:y===Me,onToggleSelect:()=>S(ce=>ce===Me?null:Me),boardRef:ce=>{T.current[Me]=ce},speedrunEnabled:n},Me))}),se&&de&&u.jsx(K3,{threadId:de})]})]}),O&&u.jsx(G3,{marathonNextBoards:q,onNextStage:I}),!i&&u.jsx("footer",{className:"keyboardFooter",children:u.jsx(nT,{numBoards:e,selectedBoardIndex:y,perBoardLetterMaps:_,focusedLetterMap:k,gridCols:w,gridRows:b,onVirtualKey:P})}),!i&&u.jsx(eT,{numBoards:e,showBoardSelector:N,setShowBoardSelector:M,boards:l,selectedBoardIndex:y,setSelectedBoardIndex:S,boardRefs:T,isUnlimited:d,speedrunEnabled:n,statusText:j}),ne&&u.jsx(q3,{maxTurns:c,mode:t,marathonHasNext:B,onExit:oe,onContinue:ve,onNextStage:I,freezeStageTimer:v,setShowOutOfGuesses:he,setShowPopup:ie}),Se&&u.jsx(tT,{allSolved:r,boards:l,speedrunEnabled:n,stageElapsedMs:Y,popupTotalMs:C,formatElapsed:$,solvedCount:G,mode:t,marathonHasNext:B,turnsUsed:h,maxTurns:c,onShare:D,onClose:()=>ie(!1),onNextStage:I,freezeStageTimer:v,isMarathonSpeedrun:x,commitStageIfNeeded:A,canShare:ae,allowNextStageAfterPopup:Q,hasCommentsSection:se,streakLabel:re}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(Q3,{isOpen:U,onRequestClose:()=>R(!1)})}),E&&u.jsx(Y3,{isOpen:z,onRequestClose:()=>W(!1),words:le,totalWords:fe,onSelectWord:qe})]})}const J3=[1,2,3,4];function yf(t,e,n){if(!n)return null;const s=typeof n.current=="number"?n.current:0,r=typeof n.best=="number"?n.best:0;return`${`${(t==="daily"?"Daily":t==="marathon"?"Marathon":t==="solutionhunt"?"Solution Hunt":"")||"Streak"} ${e?"Speedrun":"Standard"} streak`}: ${s} day${s===1?"":"s"} (best ${r})`}function $c({mode:t,boardsParam:e,speedrunEnabled:n,marathonLevels:s=J3,archiveDate:r=null}){var Do,Mo;const i=br(),{message:o,setMessage:a,setTimedMessage:l,clearMessageTimer:c}=qE(""),{user:h,isVerifiedUser:d}=On(),{isSubscribed:f,showSubscriptionGate:m}=id(h),[g,y]=p.useState(!1),S=p.useRef(null),T=p.useRef(null),w=p.useRef({isSubscribed:f});w.current={isSubscribed:f},p.useEffect(()=>{if(r&&!h)return l("You must be signed in to play archive games.",3e3),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{S.current=null,i("/profile")},2e3),()=>{S.current&&(clearTimeout(S.current),S.current=null)};r&&h&&m?y(!0):f&&y(!1)},[r,h,f,m,i,l]);const b=p.useCallback((X,xe)=>{if(h)try{const F=Z(K,`users/${h.uid}/${X}`);Pt(F,xe).catch(we=>{})}catch{}},[h]),[_,k]=p.useState(0),O=$u(n),q=O.index||0,I=O.cumulativeMs||0,N=O.stageTimes||[];let M=1;if(t!=="marathon"&&t!=="solutionhunt"&&e){const X=parseInt(e,10);Number.isFinite(X)&&(M=Zr(X))}const j=t==="marathon"?s[q]:t==="solutionhunt"?1:M,ne=t==="solutionhunt",[oe,ve]=p.useState(!1),[Se,Y]=p.useState([]),[C,$]=p.useState([]),[G,B]=p.useState(""),D=p.useRef(""),[v,x]=p.useState(z0),[A,P]=p.useState(new Set),[Q,U]=p.useState(!0),R=C3({allowedWords:A}),[ie,he]=p.useState(!1),[se,de]=p.useState(!1),[ae,re]=p.useState(!1),[ye,Ne]=p.useState(!1),[Te,E]=p.useState(!0),[z,W]=p.useState(!1),le=p.useRef(null),[fe,qe]=p.useState(!1),[Ce,st]=p.useState(null),[Me,ce]=p.useState(0),[Ee,ze]=p.useState(!1),Oe=p.useRef({}),[We,vt]=p.useState(!1),ot=p.useRef(!1),Ze=p.useRef(0),St=p.useRef(!1),J=p.useRef([]),He=p.useRef([]),[xt,Et]=p.useState(null);p.useEffect(()=>()=>{J.current.forEach(X=>clearTimeout(X)),J.current=[],He.current.forEach(X=>clearTimeout(X)),He.current=[]},[]);const[Ot,Sn]=p.useState({elapsedMs:0,frozen:!1}),{start:at,freeze:Ao,elapsedMs:_i}=B3(n,100,{initialElapsedMs:Ot.elapsedMs,initiallyFrozen:Ot.frozen}),Wt=n&&t==="marathon",[Si,bs]=p.useState(null);p.useEffect(()=>{if(!(t==="daily"&&j===1||t==="marathon"||t==="solutionhunt")){bs(null);return}try{const xe=OE(t,n);bs(yf(t,n,xe))}catch{bs(null)}},[t,n,j]),p.useEffect(()=>{if(t==="daily"&&j===1||t==="marathon"||t==="solutionhunt")return(async()=>{try{const xe=await $E({authUser:h,database:K,mode:t,speedrunEnabled:n});if(!xe)return;bs(yf(t,n,xe))}catch{}})(),()=>{}},[h,t,n,j]),p.useEffect(()=>{if(!n||St.current)return;const X=Ot.elapsedMs>0,xe=Ot.frozen;if(X||xe){St.current=!0;return}if(!Q&&C.length>0){const F=ei/3;Et(3);const we=setTimeout(()=>Et(2),F),et=setTimeout(()=>Et(1),F*2),Rt=setTimeout(()=>{Et(null),at(),St.current=!0,He.current=[]},ei);return He.current=[we,et,Rt],()=>{He.current.forEach(mn=>clearTimeout(mn)),He.current=[]}}},[n,Ot,Q,C.length,at]),p.useEffect(()=>{D.current=G},[G]);const kr=p.useCallback(()=>t==="marathon"?w_(n):t==="solutionhunt"?O2():M2(j,n),[t,n,j]),xn=((Do=le.current)==null?void 0:Do.stageElapsedMs)!==void 0?le.current.stageElapsedMs:_i,Ro=p.useCallback(()=>{if(C.length===0||C.every(we=>we.isSolved))return;const xe=kr(),F={boards:C,currentGuess:G,isUnlimited:fe,maxTurns:v,stageElapsedMs:n?xn:0,committedRef:ot.current,committedStageMs:Ze.current,revealId:Me,timestamp:Date.now()};Qt(xe,F),b(`singlePlayer/gameStates/${xe}`,F),r&&h&&(async()=>{try{const{saveArchiveGameState:we}=await Je(async()=>{const{saveArchiveGameState:et}=await Promise.resolve().then(()=>Uu);return{saveArchiveGameState:et}},void 0);await we({uid:h.uid,mode:t,speedrunEnabled:n,dateString:r,gameState:F})}catch{}})()},[C,G,fe,v,n,xn,Me,kr,b,r,h,t]),ad=p.useCallback(()=>{const X=kr();Qt(X,null),b(`singlePlayer/gameStates/${X}`,null)},[kr,b]);$3({mode:t,speedrunEnabled:n,numBoards:j,marathonIndex:q,marathonLevels:s,getGameStateKey:kr,savedSolvedStateRef:le,committedRef:ot,committedStageMsRef:Ze,setBoards:$,setCurrentGuess:B,setMessage:a,clearMessageTimer:c,setShowOutOfGuesses:re,setIsUnlimited:qe,setSelectedBoardIndex:st,setRevealId:ce,setIsFlipping:ze,setMaxTurns:x,setAllowedSet:P,setIsLoading:U,setShowPopup:de,setTimedMessage:l,setStageTimerSeed:Sn,archiveDate:r,setAnswerWords:Y});const ld=Wt&&N.some(X=>X.boards===j);Wt&&I+(ld?0:ot.current?Ze.current:xn);const jl=X=>{if(Wt&&!ot.current&&(ot.current=!0,Ze.current=X,n&&t==="marathon")){const xe=$u(n),F=[...xe.stageTimes||[]],we=F.findIndex(dt=>dt.boards===j);we>=0?F[we]={boards:j,ms:X}:F.push({boards:j,ms:X});const et=F.reduce((dt,Yn)=>dt+Yn.ms,0),Rt={...xe,index:q,cumulativeMs:et,stageTimes:F},mn=k_(n,Rt),Kn=el(n);b(`singlePlayer/meta/${Kn}`,mn)}},ey=G.length===bt&&!A.has(G),{perBoardLetterMaps:Fl,focusedLetterMap:Ll,gridCols:cd,gridRows:$l}=QE(C,Ce,j),ud=p.useMemo(()=>{if(!ne||Se.length===0)return[];const X=C[0];return X?XE(Se,X.guesses||[]):Se},[ne,Se,C]),hd=p.useCallback(X=>{if(!X||typeof X!="string")return;const xe=X.toUpperCase();D.current=xe,B(xe),o&&(a(""),c())},[o,a,c]),xi=p.useMemo(()=>C.filter(X=>X.isSolved).length,[C]),bi=p.useMemo(()=>C.length===0?!1:R.checkAllBoardsFinished(C,v,fe),[C,fe,v,R]);p.useEffect(()=>{!ye&&bi&&se&&Ne(!0)},[ye,bi,se]);const is=p.useMemo(()=>R.checkAllBoardsSolved(C),[C,R]),Bl=p.useCallback(()=>{if(is||se||ae||xt!=null)return!0;if(typeof document<"u"){const X=document.activeElement;if(X&&X instanceof HTMLElement&&(X.tagName==="INPUT"||X.tagName==="TEXTAREA"||X.isContentEditable))return!0}return!1},[is,se,ae,xt]),Ci=X=>{if(D.current.length>=bt)return;const xe=D.current+X;D.current=xe,B(xe),o&&(a(""),c())},Ar=()=>{if(D.current.length===0)return;const X=D.current.slice(0,-1);D.current=X,B(X),o&&(a(""),c())},Rr=()=>n?Ao():0,No=async()=>{if(se||ae)return;const X=D.current;if(X.length!==bt){X.length>0&&(D.current="",B(""));return}const xe=R.validateGuess(X,A);if(!xe.isValid){l(xe.error||"Not in word list.",Qs),D.current="",B("");return}if(R.checkAllBoardsFinished(C,v,fe))return;const we=Me+1,et=C.map(dt=>{if(R.isBoardSolved(dt)||!fe&&R.isBoardDead(dt,v))return dt;try{return R.processGuess(dt,X,v,fe,we)}catch{return dt}});$(et),ce(we),ze(!0),D.current="",B(""),a(""),c();const Rt=setTimeout(()=>{ze(!1)},la);J.current.push(Rt);const mn=R.checkAllBoardsFinished(et,v,fe),Kn=R.checkAllBoardsSolved(et);if(mn&&!Kn&&!fe){Rr();const dt=setTimeout(()=>{re(!0)},la);J.current.push(dt);return}if(mn&&Kn){const dt=Rr();Wt&&jl(dt);const Yn=r||ts(),ty=Fi(t,j,n,t==="marathon"?q:null,Yn),Cs=aa(et);let Es=0;n&&(Wt?Es=N.some(jo=>jo.boards===j)?I:I+dt:Es=dt);const Cd={boards:et,turnsUsed:Cs,maxTurns:v,allSolved:!0,solvedCount:et.length,stageElapsedMs:dt,popupTotalMs:Es,timestamp:Date.now()};Pp({authUser:h,database:K,solvedKey:ty,value:Cd});const gn=t==="marathon"&&q>=s.length-1;!r&&(t==="daily"&&j===1||t==="marathon"&&gn)&&(async()=>{try{const Pr=F2(t,n,Yn);if(await rd({authUser:h,database:K,mode:t,speedrunEnabled:n,streakInfo:Pr}),bs(yf(t,n,Pr)),!r){const jo=et.map(Ei=>Ei.solution).filter(Boolean);if(jo.length>0){const{saveArchiveSolution:Ei}=await Je(async()=>{const{saveArchiveSolution:Gs}=await Promise.resolve().then(()=>Uu);return{saveArchiveSolution:Gs}},void 0);await Ei({mode:t,speedrunEnabled:n,dateString:Yn,solutions:jo,numBoards:j})}if(t==="daily"&&j===1||t==="marathon"){const{saveGameStats:Ei}=await Je(async()=>{const{saveGameStats:Gs}=await import("./statsService-CnGeUBvE.js");return{saveGameStats:Gs}},__vite__mapDeps([7,1]));if(t==="marathon"){let Gs=null,ql=null;const aT=et.reduce((Fo,Lo)=>{var Ts;return Fo+(((Ts=Lo.guesses)==null?void 0:Ts.length)??0)},0)||Cs;if(gn){let Fo=0;try{const{loadSolvedState:Lo}=await Je(async()=>{const{loadSolvedState:Ts}=await Promise.resolve().then(()=>V2);return{loadSolvedState:Ts}},void 0);for(let Ts=0;Ts<s.length;Ts++){const lT=s[Ts],cT=Fi(t,lT,n,Ts,Yn),Ed=await Lo({authUser:h,database:K,solvedKey:cT});Ed&&typeof Ed.turnsUsed=="number"&&(Fo+=Ed.turnsUsed)}Gs=Fo,n&&(ql=Es||I+dt)}catch(Lo){Gs=Gs??Fo??aT,n&&ql==null&&(ql=Es||I+dt)}}await Ei({uid:h.uid,mode:t,speedrunEnabled:n,dateString:Yn,guesses:Cs,solveTimeMs:n?dt:null,numBoards:j,solved:!0,marathonIndex:q,marathonTotalGuesses:Gs,marathonTotalTimeMs:ql,isMarathonComplete:gn})}else await Ei({uid:h.uid,mode:t,speedrunEnabled:n,dateString:Yn,guesses:Cs,solveTimeMs:n?dt:null,numBoards:j,solved:!0})}}}catch{}})(),t==="daily"&&h&&Sa({database:K,uid:h.uid,badgeId:"daily_player"}).catch(Pr=>{});const Oo=n&&Kn&&(t==="daily"||gn),sy=Es||dt,ry=t==="marathon"?s[s.length-1]:j;if(Oo&&h&&d){const Pr=h.displayName||h.email||"Anonymous";jE(h.uid,Pr,t,ry,sy).catch(jo=>{})}else Oo&&!h&&L2({mode:t,numBoards:ry,timeMs:sy});ad();const oT=setTimeout(()=>{de(!0)},la);J.current.push(oT)}};YE({disabled:Bl(),onEnter:No,onBackspace:Ar,onLetter:Ci}),p.useEffect(()=>{C.length>0&&!Q&&(C.every(xe=>xe.isSolved)||Ro())},[C,G,fe]),p.useCallback(()=>{Ro(),i("/")},[Ro,i]);const Ul=X=>{Bl()||(X==="ENTER"?No():X==="BACK"?Ar():Ci(X))},zl=p.useMemo(()=>(Array.isArray(C)?C:[]).map(X=>X&&typeof X.solution=="string"?X.solution:null).filter(Boolean).map(X=>X.toUpperCase()).join("  "),[C]),Nr=p.useMemo(()=>aa(C),[C]),dd=n?"":bi&&!se&&!ae?"Stage complete.":`Guesses used: ${Nr}/${v}${fe?" (unlimited)":""}`,bn=p.useMemo(()=>t==="marathon"&&q<s.length-1,[t,q,s.length]),fd=p.useMemo(()=>bn?s[q+1]:null,[bn,s,q]),pd=t==="marathon"?z||is&&!bn:!0,md=t==="marathon"&&is&&!se&&!ae&&bn,gd=p.useCallback(()=>{if(bn){const X=q+1,xe=k_(n,{index:X}),F=el(n);b(`singlePlayer/meta/${F}`,xe);const we=w_(n);Qt(we,null),b(`singlePlayer/gameStates/${we}`,null),Sn({elapsedMs:0,frozen:!1}),St.current=!1,k(et=>et+1)}},[bn,q,n]),yd=()=>{const X=Rr();re(!1);try{const xe=ts(),F=Fi(t,j,n,t==="marathon"?q:null,xe),we=aa(C),et=C.filter(Kn=>Kn&&Kn.isSolved).length;let Rt=0;n&&(Rt=X);const mn={boards:C,turnsUsed:we,maxTurns:v,allSolved:!1,solvedCount:et,stageElapsedMs:X,popupTotalMs:Rt,exitedDueToOutOfGuesses:!0,timestamp:Date.now()};Pp({authUser:h,database:K,solvedKey:F,value:mn})}catch(xe){console.error("Failed to persist out-of-guesses exit state",xe)}t==="marathon"&&(E(!1),W(!0)),de(!0)},vd=()=>{re(!1),qe(!0),$(X=>X.map(xe=>xe.isSolved?xe:{...xe,isDead:!1}))},wd=p.useMemo(()=>{if(!n)return[];if(Wt){const X=N.slice();X.some(F=>F.boards===j)||X.push({boards:j,ms:xn});const xe=new Map(s.map((F,we)=>[F,we]));return X.slice().sort((F,we)=>(xe.get(F.boards)??999)-(xe.get(we.boards)??999))}return[{boards:j,ms:xn}]},[n,Wt,N,j,xn,s]),Po=((Mo=le.current)==null?void 0:Mo.popupTotalMs)!==void 0?le.current.popupTotalMs:n?Wt?x1(wd):xn:0,Cn=p.useMemo(()=>{if(t!=="marathon"||bn&&!z)return null;try{return I3(s,n,v)}catch{return null}},[t,bn,s,n,v,xi,is,z]),_d=p.useMemo(()=>{if(!C||C.length===0)return"Play Wuzzle Games!";const xe=t==="marathon"&&Cn&&(!bn||z),F=xe?Cn.totalBoards:j,we=xe?Cn.totalTurnsUsed:Nr,et=xe?Cn.totalMaxTurns:v,Rt=xe?Cn.totalSolvedCount:xi,mn=xe?Cn.totalSolvedCount===Cn.totalBoards:is;return T3(C,t,F,n,xn,Po,Xs,we,et,mn,Rt,(Cn==null?void 0:Cn.stages)??null)},[C,t,j,n,xn,Po,Nr,v,is,xi,Cn,bn,z]),{handleShare:Sd}=KE(_d,l),Vl=()=>`${t==="marathon"?"Marathon":t==="daily"?"Daily":t==="solutionhunt"?"Solution Hunt":"Game"}${n?" Speedrun":" Standard"}`,Wl=r?`Archive ${Bu(r)}  ${Vl()} | Wuzzle Games`:t==="marathon"?"Marathon & Speedrun  MultiBoard Game | Wuzzle Games":t==="daily"?"Daily MultiBoard Wordle-Style Game  Wuzzle Games":t==="solutionhunt"?"Daily Solution Hunt  Word Puzzle Helper | Wuzzle Games":"Game  Wuzzle Games",xd=r?`Play the Wuzzle Games ${Vl()} puzzle from ${Bu(r)}.`:t==="marathon"?"Play Wuzzle Games marathon and speedrun modes with multi-board Wordle-style puzzles, cumulative times and increasing difficulty across stages.":t==="daily"?"Play Wuzzle Games daily multi-board Wordle-style puzzles with standard and speedrun options, tracking your guesses and scores across boards.":t==="solutionhunt"?"Play Wuzzle Games Solution Hunt: a daily word puzzle that shows all possible remaining words based on your guesses. Perfect for learning and improving your strategy.":"Play Wuzzle Games game modes including daily, marathon, speedrun and multi-board Wordle-style puzzles.",bd=ye&&(t==="daily"||t==="marathon"||t==="solutionhunt"),Hl=bd?Fi(t,j,n,t==="marathon"?q:null,ts()):null,Gl=!Q&&C.length===0;return Q?u.jsxs(u.Fragment,{children:[u.jsxs(Qc,{children:[u.jsx("title",{children:Wl}),u.jsx("meta",{name:"description",content:xd})]}),u.jsx("div",{className:"loadingContainer",children:"Loading Wuzzle dictionaries..."})]}):u.jsxs(u.Fragment,{children:[u.jsxs(Qc,{children:[u.jsx("title",{children:Wl}),u.jsx("meta",{name:"description",content:xd})]}),u.jsx(X3,{mode:t,numBoards:j,speedrunEnabled:n,archiveDate:r,allSolved:is,finished:bi,solutionsText:zl,message:o,boards:C,maxTurns:v,turnsUsed:Nr,isUnlimited:fe,currentGuess:G,invalidCurrentGuess:ey,revealId:Me,selectedBoardIndex:Ce,setSelectedBoardIndex:st,boardRefs:Oe,gridCols:cd,gridRows:$l,perBoardLetterMaps:Fl,focusedLetterMap:Ll,showNextStageBar:md,marathonNextBoards:fd,goNextStage:gd,showBoardSelector:We,setShowBoardSelector:vt,statusText:dd,showOutOfGuesses:ae,exitFromOutOfGuesses:yd,continueAfterOutOfGuesses:vd,showPopup:se,stageElapsedMs:xn,popupTotalMs:Po,formatElapsed:Xs,solvedCount:xi,marathonHasNext:bn,handleShare:Sd,freezeStageTimer:Rr,isMarathonSpeedrun:Wt,commitStageIfNeeded:jl,handleVirtualKey:Ul,allowNextStageAfterPopup:Te,showFeedbackModal:ie,setShowFeedbackModal:he,setShowPopup:de,setShowOutOfGuesses:re,showComments:bd,commentThreadId:Hl,canShare:pd,streakLabel:Si,countdownRemaining:xt,wordListError:Gl?"Failed to load word lists. Please check your connection and try again.":null,onRetryWordLists:()=>window.location.reload(),isSolutionHuntMode:ne,showSolutionHuntModal:oe,setShowSolutionHuntModal:ve,filteredSolutionWords:ud,totalSolutionWords:Se.length,onSelectSolutionWord:hd}),u.jsx(od,{isOpen:g,onRequestClose:()=>{y(!1),r&&(T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{T.current=null,w.current.isSubscribed||i("/profile")},1e3))},onSubscriptionComplete:()=>{y(!1)}})]})}const FB=Object.freeze(Object.defineProperty({__proto__:null,default:$c},Symbol.toStringTag,{value:"Module"})),Z3="Ensure VITE_FIREBASE_DATABASE_URL in .env matches your Firebase Console Realtime Database URL.",Vu="This room has been closed.",sT="multiplayer_bootstrap_";function eB(t){try{const e=sT+String(t),n=typeof sessionStorage<"u"?sessionStorage.getItem(e):null;if(n){const s=JSON.parse(n);return s&&typeof s=="object"?s:null}}catch{return null}return null}function vf(t,e){try{e&&typeof e=="object"&&typeof sessionStorage<"u"&&sessionStorage.setItem(sT+String(t),JSON.stringify(e))}catch{}}function tB(){return Math.floor(1e5+Math.random()*9e5).toString()}function nB(t=null,e=!1,n=!1,s=null){const[r,i]=p.useState(null),[o,a]=p.useState(null),[l,c]=p.useState(!1),h=p.useRef(null),d=p.useRef(!0),f=p.useRef(null),m=p.useRef(0),g=p.useRef(!1),y=ue.currentUser;p.useEffect(()=>()=>{d.current=!1,h.current=null},[]);const S=1e4;p.useEffect(()=>{if(!t)return;d.current=!0;const Y=`multiplayer/${t}`,C=Z(K,Y);h.current=C;let $=!1;const G=++m.current,B=s&&typeof s=="object";g.current=!1;const D=setTimeout(()=>{m.current!==G||$||g.current||(a("Connection timed out. Please check your connection and try again."),c(!1))},S),v=A=>{const P=A&&typeof A.val=="function"?A.val():null;if(clearTimeout(D),P==null){if(!d.current)return;i(null),c(!1),a(Vu);return}g.current=!0,vf(t,P),i(P),c(!1),a(null)},x=A=>{d.current&&(a(A.message),c(!1))};if(f.current=Un(C,v,x),s&&typeof s=="object")vf(t,s),i(s),c(!1),a(null),clearTimeout(D);else{const A=eB(t);A&&typeof A=="object"?(i(A),c(!1),a(null),clearTimeout(D)):(c(!0),a(null))}return(async()=>{try{const A=await Ye(C);if($)return;if(A.exists()){if(clearTimeout(D),g.current)return;g.current=!0;const P=A.val();vf(t,P),i(P),a(null),c(!1)}else{if(!d.current)return;if(!B){clearTimeout(D),i(null),a(Vu),c(!1);return}clearTimeout(D)}}catch(A){if($||!d.current)return;a(A.message),c(!1)}})(),()=>{$=!0,clearTimeout(D),typeof f.current=="function"?(f.current(),f.current=null):Ym(C)}},[t]);const T=p.useCallback(async(Y={})=>{if(!y)throw new Error("User must be signed in to host a game");const C=Object.prototype.hasOwnProperty.call(Y,"speedrun")?!!Y.speedrun:!!n,$=Number.isFinite(Y.maxPlayers)?Y.maxPlayers:$r,G=Fc($,$r,kc),B=Object.prototype.hasOwnProperty.call(Y,"isPublic")?!!Y.isPublic:!0,D=Number.isFinite(Y.boards)?Y.boards:1,v=Zr(D),x=Y.challengeOnly===!0,A=tB(),P=`multiplayer/${A}`,Q=y.displayName||y.email||"Player 1",U=Date.now(),R={status:"waiting",solution:null,solutions:[],winner:null,speedrun:C,createdAt:U,startedAt:null,hostId:y.uid,maxPlayers:G,isPublic:B,configBoards:v,...x&&{challengeOnly:!0},players:{[y.uid]:{id:y.uid,name:Q,isHost:!0,ready:!1,joinedAt:U,guesses:[],colors:[],timeMs:null,startTime:null}}};try{return await Pt(Z(K,P),R),Sa({database:K,uid:y.uid,badgeId:"party_starter"}).catch(ie=>void 0),{code:A,gameData:R}}catch(ie){throw a(ie.message),ie}},[y,n]),w=p.useCallback(async Y=>{if(!y)throw new Error("User must be signed in to join a game");const C=ff(Y);if(!C.isValid)throw new Error(`Invalid game code: ${C.errors.join(", ")}`);const $=C.value??Y,G=`multiplayer/${$}`,B=Z(K,G);try{const D=await Ye(B);if(!D.exists())throw new Error(`Game code not found at path: ${G}. ${Z3}`);let v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");const x=v.players||null;if(x&&x[y.uid])return{code:$,gameData:v};const A=v.status||"waiting",P=Number.isFinite(v.maxPlayers)?v.maxPlayers:$r,Q=Fc(P,$r,kc),U=typeof v.createdAt=="number"?v.createdAt:null;if(U&&Date.now()-U>zu){try{await jt(B)}catch{}throw new Error("Game code has expired")}await pa(B,he=>{if(!he)return{};const se=he.players||null,de=he.status||"waiting";if(se&&se[y.uid])return he;if(se&&Object.keys(se).length>=Q)throw new Error("Game is full");if(de!=="waiting")throw new Error("Game has already started");const ae=Date.now(),re=y.displayName||y.email||"Player";return{...he,players:{...se||{},[y.uid]:{id:y.uid,name:re,isHost:!1,ready:!1,joinedAt:ae,guesses:[],timeMs:null,startTime:null}}}});const R=await Ye(B),ie=R.exists()?R.val():v;return{code:$,gameData:ie}}catch(D){throw a(D.message),D}},[y]),b=p.useCallback(async(Y,C=!0)=>{if(!y)throw new Error("User must be signed in");const $=ff(Y);if(!$.isValid)throw new Error(`Invalid game code: ${$.errors.join(", ")}`);const B=`multiplayer/${$.value??Y}`,D=Z(K,B);try{await pa(D,v=>{if(!v)return{};const x=v.players||null;if(!x||!x[y.uid])throw new Error("Player not in game");return{...v,players:{...x,[y.uid]:{...x[y.uid],ready:C}}}}),i(v=>!v||!v.players||!v.players[y.uid]?v:{...v,players:{...v.players,[y.uid]:{...v.players[y.uid],ready:C}}})}catch(v){const x=v.message||"Failed to set ready status";throw a(x),v}},[y]),_=p.useCallback(async(Y,C,$={})=>{if(!y)throw new Error("User must be signed in");const G=ff(Y);if(!G.isValid)throw new Error(`Invalid game code: ${G.errors.join(", ")}`);const D=`multiplayer/${G.value??Y}`,v=Z(K,D);try{await pa(v,A=>{var re;if(!A)return{};const P=A.players||null;if(!(P&&((re=P[y.uid])==null?void 0:re.isHost)))throw new Error("Only host can start the game");if(!P)throw new Error("Invalid game state: no players map found");const U=Object.values(P);if(!(U.length>0&&U.every(ye=>ye&&typeof ye.ready=="boolean"?ye.ready:!1)))throw new Error("All players must be ready to start");if(A.status==="playing")throw new Error("Game has already started");const he=Object.prototype.hasOwnProperty.call($,"speedrun")?!!$.speedrun:!!A.speedrun,se=Date.now(),de=Array.isArray(C)?C:[C],ae={};return Object.keys(P).forEach(ye=>{const Ne=P[ye]||{};ae[ye]={...Ne,guesses:[],timeMs:null,startTime:he?se:null,rematch:!1}}),{...A,status:"playing",solution:de[0],solutions:de,speedrun:he,startedAt:se,winner:null,players:ae,nextGameConfig:null}});const x=await Ye(v);x.exists()&&i(x.val())}catch(x){throw a(x.message),x}},[y]),k=p.useCallback(async(Y,C,$)=>{if(!y)throw new Error("User must be signed in");const G=`multiplayer/${Y}`,B=Z(K,G);try{const D=await Ye(B);if(!D.exists())throw new Error("Game not found");const v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");const x=v.players||null;if(!x)throw new Error("Invalid game state: no players map found");const A=Object.keys(x).length,P=Object.values(x).find(de=>de&&de.isHost)||null,Q=!!(P&&P.id===y.uid),U=v.speedrun||!1,R=Date.now(),ie=tl(v),he={};if(x&&x[y.uid]){const de=x[y.uid],ae=[...de.guesses||[],C];if(he[`players/${y.uid}/guesses`]=ae,he[`players/${y.uid}/colors`]=[...de.colors||[],$],U&&ie.length>0&&!de.timeMs&&ie.every(ye=>ae.includes(ye))){const ye=v.startedAt,Ne=ye!=null?ye+ei:R,Te=Math.max(0,R-Ne);he[`players/${y.uid}/timeMs`]=Te}}else throw new Error("Invalid game state: no players map found");await It(B,he);const se=await Ye(B);se.exists()&&i(se.val())}catch(D){throw a(D.message),D}},[y]),O=p.useCallback(async Y=>{var G;if(!y)throw new Error("User must be signed in");const C=`multiplayer/${Y}`,$=Z(K,C);try{const B=await Ye($);if(!B.exists())throw new Error("Game not found");const D=B.val();if(!D||typeof D!="object")throw new Error("Invalid game state");if(D.speedrun)return;const x=((G=(D.players||{})[y.uid])==null?void 0:G.isHost)===!0;if(!(D.currentTurn===(x?"host":"guest")))throw new Error("Not your turn");x?await It($,{currentTurn:"guest"}):await It($,{currentTurn:"host"})}catch(B){throw a(B.message),B}},[y]),q=p.useCallback(async(Y,C)=>{if(!y)throw new Error("User must be signed in");const $=`multiplayer/${Y}`,G=Z(K,$);try{const B=await Ye(G);if(!B.exists())throw new Error("Game not found");const D=B.val();if(!D||typeof D!="object")throw new Error("Invalid game state");await It(G,{status:"finished",winner:C,hostId:D.hostId})}catch(B){throw a(B.message),B}},[y]),I=p.useCallback(async(Y,C)=>{var B;if(!y)throw new Error("User must be signed in");const $=`multiplayer/${Y}`,G=Z(K,$);try{const D=await Ye(G);if(!D.exists())throw new Error("Game not found");const v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");const A=((B=(v.players||{})[y.uid])==null?void 0:B.isHost)===!0;if(C==="pending"){const P={friendRequestStatus:"pending",friendRequestFrom:y.uid};A?(P.hostFriendRequestSent=!0,P.guestFriendRequestSent=!1):(P.guestFriendRequestSent=!0,P.hostFriendRequestSent=!1),P.hostId=v.hostId,await It(G,P)}else C==="declined"?await It(G,{friendRequestStatus:null,friendRequestFrom:null,hostFriendRequestSent:!1,guestFriendRequestSent:!1,hostId:v.hostId}):await It(G,{friendRequestStatus:null,friendRequestFrom:null,hostId:v.hostId})}catch(D){throw a(D.message),D}},[y]),N=p.useCallback(async Y=>{if(!y)throw new Error("User must be signed in");const C=`multiplayer/${Y}`,$=Z(K,C);try{const G=await Ye($);if(!G.exists())throw new Error("Game not found");const B=G.val();if(!B||typeof B!="object")throw new Error("Invalid game state");const D=B.players||null;if(!D||!D[y.uid])throw new Error("Player not in game");await It($,{[`players/${y.uid}/rematch`]:!0})}catch(G){throw a(G.message),G}},[y]),M=p.useCallback(async(Y,C)=>{var B;if(!y)throw new Error("User must be signed in");const $=`multiplayer/${Y}`,G=Z(K,$);try{const D=await Ye(G);if(!D.exists())throw new Error("Game not found");const v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");if(!((B=(v.players||{})[y.uid])!=null&&B.isHost))throw new Error("Only the host can update the room name");const A=(C||"").toString().slice(0,80).trim();await It(G,{roomName:A||null,hostId:v.hostId})}catch(D){throw a(D.message),D}},[y]),j=p.useCallback(async(Y,C)=>{var B;if(!y)throw new Error("User must be signed in");const $=`multiplayer/${Y}`,G=Z(K,$);try{const D=await Ye(G);if(!D.exists())throw new Error("Game not found");const v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");if(!((B=(v.players||{})[y.uid])!=null&&B.isHost))throw new Error("Only host can update game configuration");const A={};C===null?A.nextGameConfig=null:A.nextGameConfig={numBoards:Number.isFinite(C.numBoards)?Zr(C.numBoards):null,speedrun:typeof C.speedrun=="boolean"?C.speedrun:null},A.hostId=v.hostId,await It(G,A)}catch(D){throw a(D.message),D}},[y]),ne=p.useCallback(async Y=>{if(!y)throw new Error("User must be signed in");const C=`multiplayer/${Y}`,$=Z(K,C);try{const G=await Ye($);if(!G.exists())throw new Error("Game not found");const B=G.val();if(!B||typeof B!="object")throw new Error("Invalid game state");const D=B.players||null;let v=D||null;D&&(v={},Object.keys(D).forEach(A=>{const P=D[A]||{};v[A]={...P,ready:!1,guesses:[],timeMs:null,startTime:null}}));const x={status:"waiting",solution:null,solutions:[],currentTurn:null,winner:null,startedAt:null,rematchRequested:!1,hostId:B.hostId};v&&(x.players=v),await It($,x)}catch(G){throw a(G.message),G}},[y]),oe=p.useCallback(async Y=>{var G;if(!Y)return;const C=`multiplayer/${Y}`,$=Z(K,C);try{if(y){const B=await Ye($);if(B.exists()){const D=B.val();if(!D||typeof D!="object")return;const v=D.players||null;if(v&&((G=v[y.uid])==null?void 0:G.isHost)===!0){await jt($);return}const A={};if(v&&v[y.uid]){const P={...v};delete P[y.uid],A.players=P,Object.keys(A).length>0&&await It($,A)}}}}catch(B){a(B.message)}},[y]),ve=p.useCallback(async Y=>{if(!Y)return;const C=`multiplayer/${Y}`,$=Z(K,C);try{await jt($)}catch(G){a(G.message)}},[]),Se=p.useCallback(async(Y,C={})=>{var B;if(!y)throw new Error("User must be signed in");const $=`multiplayer/${Y}`,G=Z(K,$);try{const D=await Ye(G);if(!D.exists())throw new Error("Game not found");const v=D.val();if(!v||typeof v!="object")throw new Error("Invalid game state");const x=v.players||{};if(!((B=x[y.uid])!=null&&B.isHost))throw new Error("Only the host can update room settings");if(v.status!=="waiting")throw new Error("Settings can only be changed before the game starts");const A=Object.keys(x).length||1,P={};if(Object.prototype.hasOwnProperty.call(C,"boards")){const Q=parseInt(C.boards,10);P.configBoards=Number.isFinite(Q)?Zr(Q):1}if(Object.prototype.hasOwnProperty.call(C,"speedrun")&&(P.speedrun=!!C.speedrun),Object.prototype.hasOwnProperty.call(C,"maxPlayers")){const Q=parseInt(C.maxPlayers,10);if(!Number.isFinite(Q))throw new Error("Invalid maxPlayers value");const U=Fc(Q,$r,kc);if(U<A)throw new Error("Max players cannot be less than current players in room");P.maxPlayers=U}if(Object.prototype.hasOwnProperty.call(C,"isPublic")&&(P.isPublic=!!C.isPublic),Object.keys(P).length===0)return;P.hostId=v.hostId,await It(G,P)}catch(D){throw a(D.message),D}},[y]);return p.useMemo(()=>({gameState:r,error:o,loading:l,createGame:T,joinGame:w,setReady:b,startGame:_,submitGuess:k,switchTurn:O,setWinner:q,setFriendRequestStatus:I,requestRematch:N,setRoomName:M,setNextGameConfig:j,resetGame:ne,leaveGame:oe,expireGame:ve,updateConfig:Se}),[r,o,l,T,w,b,_,k,O,q,I,N,M,j,ne,oe,ve,Se])}function N_(t){let e=0;const n=String(t);for(let s=0;s<n.length;s++)e=(e<<5)-e+n.charCodeAt(s),e=e|0;return Math.abs(e)}function sB({isMultiplayer:t,isHost:e,gameCode:n,gameVariant:s,boardsParam:r,numBoards:i,maxPlayersParam:o,isPublicParam:a,authUser:l,isVerifiedUser:c,multiplayerGame:h,boards:d,setBoards:f,maxTurns:m,setMaxTurns:g,allowedSet:y,setAllowedSet:S,setIsUnlimited:T,setIsLoading:w,setShowPopup:b,setCurrentGuess:_,setIsFlipping:k,revealId:O,isFlipping:q,navigate:I,setTimedMessage:N,endingGameRef:M,popupClosedRef:j,shouldShowPopupAfterFlipRef:ne,sendFriendRequest:oe,cancelSentChallenge:ve,maxMultiplayerBoards:Se,onGameCreated:Y,onGameJoined:C}){var Te;const[$,G]=p.useState(null),B=p.useRef(!1),[D,v]=p.useState(!1),[x,A]=p.useState(1),[P,Q]=p.useState("standard");p.useEffect(()=>{if(!h.gameState)return;const E=h.gameState.nextGameConfig;D&&E&&(Number.isFinite(E.numBoards)&&A(E.numBoards),E.variant?Q(E.variant):typeof E.speedrun=="boolean"&&Q(E.speedrun?"speedrun":"standard"))},[t,h.gameState&&h.gameState.nextGameConfig,D]),p.useEffect(()=>{if(!h.gameState)return;h.gameState.status==="playing"&&D&&v(!1)},[t,h.gameState&&h.gameState.status,D]);const U=p.useMemo(()=>{if(!h.gameState||!l)return!1;const E=h.gameState;return E.friendRequestFrom===l.uid&&E.friendRequestStatus==="pending"},[t,h.gameState,l]),R=p.useMemo(()=>{if(!h.gameState||!l)return!1;const E=h.gameState,z=Array.isArray(E.solutions)&&E.solutions.length>0?E.solutions:E.solution?[E.solution]:[];if(z.length===0)return!1;let W=[];return E.players&&E.players[l.uid]&&(W=E.players[l.uid].guesses||[]),z.every(le=>W.includes(le))},[t,h.gameState,l]);p.useEffect(()=>{async function E(){if(!l){w(!1);return}if(!c){N("You must verify your email or sign in with Google to play Multiplayer Mode.",V0),w(!1);return}try{w(!0);const{ALLOWED_GUESSES:z}=await or();if(S(new Set(z)),e&&!n&&!B.current){B.current=!0;let W=$r;if(o!=null){const ce=parseInt(o,10);Number.isFinite(ce)&&(W=Fc(ce,$r,kc))}const le=a==="true";let fe=1;if(r!=null){const ce=parseInt(r,10);Number.isFinite(ce)&&(fe=Zr(ce))}const qe=await h.createGame({variant:s,speedrun:s==="speedrun",solutionHunt:s==="solutionhunt",maxPlayers:W,isPublic:le,boards:fe}),Ce=qe.code;typeof Y=="function"&&Y(qe);const st=r?`&boards=${r}`:"",Me=`&maxPlayers=${W}&isPublic=${le}`;I(`/game?mode=multiplayer&code=${Ce}&host=true&variant=${s}${st}${Me}`,{replace:!0}),w(!1);return}if(!e&&n)if(h.gameState)if(!!(h.gameState.players||{})[l.uid])w(!1);else try{const fe=await h.joinGame(n);fe&&typeof C=="function"&&C(fe)}catch(fe){throw fe}else try{const W=await h.joinGame(n);W&&typeof C=="function"&&C(W)}catch(W){throw W}else w(!1)}catch(z){console.error("multiplayer init error:",z),e&&!n&&(B.current=!1);const W=ji(z)||"Failed to initialize multiplayer game";N(W,Qs),w(!1)}}E()},[t,e,n,l,c,s,r,o,a,h,I,N,S,w,C]),p.useEffect(()=>{async function E(){if(!l){if(n&&!h.gameState)return;w(!1);return}if(h.gameState&&w(!1),!h.gameState)return;const z=h.gameState,{status:W,solution:le,solutions:fe,players:qe}=z,Ce=qe||null;if(!Ce)return;const st=Object.values(Ce).find(Oe=>Oe&&Oe.isHost)||null;st&&(st.id,l.uid);const Me=z.speedrun||!1,ce=Object.keys(Ce);ce.length;const Ee=tl(z),ze=Ee.length||1;if(W==="playing"&&Ee.length>0){if(d.length===0&&y.size===0){w(!0);const{ALLOWED_GUESSES:Ze}=await or();S(new Set(Ze)),w(!1)}const Oe=Me?999:oa(ze);g(Oe),T(Me);const We=Ce[l.uid],vt=We&&Array.isArray(We.guesses)?We.guesses:[],ot=Ee.map((Ze,St)=>{var Wt;const J=d[St],He=vt.indexOf(Ze),xt=He===-1?vt.length:He+1,Et=vt.slice(0,xt).map(Si=>{const bs=Xu(Si,Ze);return{word:Si,colors:bs}}),Ot=He!==-1,Sn=!Me&&!Ot&&Et.length>=m,at=((Wt=J==null?void 0:J.guesses)==null?void 0:Wt.length)??0,_i=Et.length>at?O:(J==null?void 0:J.lastRevealId)??null;return{solution:Ze,guesses:Et,isSolved:Ot,isDead:Sn,lastRevealId:_i}});(d.length!==ot.length||ot.some((Ze,St)=>{var J;return Ze.guesses.length!==(((J=d[St])==null?void 0:J.guesses.length)||0)}))&&f(ot)}if(W==="finished"&&!j.current&&!ne.current){ne.current=!0;return}W==="playing"&&Ee.length>0&&(M.current=!1,j.current=!1,ne.current=!1),W==="playing"&&Ee.length>0&&!M.current&&Ce&&ce.length>0&&ce.every(We=>{const vt=Ce[We],ot=vt&&vt.guesses||[],Ze=Ee.every(J=>ot.includes(J)),St=!Me&&ot.length>=m;return Ze||St})&&(M.current=!0,await h.setWinner(n||"",null))}E()},[t,h.gameState,l,m,n,h,d,y,O,f,S,w,T,g,M,j,ne]);const ie=p.useRef(null);p.useEffect(()=>{const E=h.gameState&&h.gameState.status,z=ie.current;ie.current=E,z==="finished"&&E==="playing"&&(b(!1),j.current=!0,ne.current=!1)},[t,h.gameState&&h.gameState.status,b]),p.useEffect(()=>{h.gameState&&h.gameState.status,ne.current&&!q&&!j.current&&setTimeout(()=>{ne.current&&!j.current&&(b(!0),ne.current=!1)},50)},[q,t,(Te=h.gameState)==null?void 0:Te.status,j,b,ne]);const he=p.useCallback(async()=>{if(n){if(!c){N("You must verify your email or sign in with Google to play Multiplayer Mode.",rv);return}try{const E=h.gameState;if(!E||!E.players||!E.players[l==null?void 0:l.uid])throw new Error("Player not in game");const z=E.players[l.uid].ready||!1;await h.setReady(n,!z)}catch(E){const z=ji(E)||"Failed to set ready status";N(z,Qs)}}},[n,h,l,c,N]),se=p.useCallback(async()=>{if(n){if(!c){N("You must verify your email or sign in with Google to play Multiplayer Mode.",rv);return}try{const{ANSWER_WORDS:E}=await or();let z=1;const W=h.gameState;if(W&&Number.isFinite(W.configBoards)){const Ce=Number.isFinite(Se)?Se:32;z=Math.max(1,Math.min(Ce,W.configBoards))}else if(r!=null){const Ce=parseInt(r,10);if(Number.isFinite(Ce)){const st=Number.isFinite(Se)?Se:32;z=Math.max(1,Math.min(st,Ce))}}else z=Math.max(1,i||1);const le=N_(n)+Date.now(),fe=new Yi(le),qe=Array.from({length:z}).map(()=>{const Ce=Math.floor(fe.next()*E.length);return E[Ce]});await h.startGame(n,qe)}catch(E){N(E.message||"Failed to start game",5e3)}}},[n,h,i,c,N]),de=p.useCallback(async()=>{if(!n){I("/");return}try{await ve(n)}catch(E){const z=ji(E)||"Failed to cancel challenge";N(z,Qs)}I("/")},[n,ve,I,N]),ae=p.useCallback(async(E,z)=>{if(l&&z)try{if(await oe(E,z),t&&n&&h)try{await h.setFriendRequestStatus(n,"pending")}catch(W){console.error("Failed to mark multiplayer friend request pending:",W)}}catch(W){console.error("Failed to send friend request:",W)}},[l,oe,t,n,h]),re=p.useCallback(()=>{if(!h.gameState||!l)return;const E=h.gameState,le=E.nextGameConfig||null||$,fe=Math.max(Array.isArray(E.solutions)&&E.solutions.length||d.length||0,1),qe=le&&Number.isFinite(le.numBoards)?le.numBoards:Array.isArray(E.solutions)&&E.solutions.length>0?E.solutions.length:E.solution?1:fe;let Ce="standard";le&&le.variant?Ce=le.variant:le&&typeof le.speedrun=="boolean"?Ce=le.speedrun?"speedrun":"standard":E.variant?Ce=E.variant:E.solutionHunt?Ce="solutionhunt":E.speedrun&&(Ce="speedrun"),A(qe),Q(Ce),v(!0)},[t,h.gameState,l,$,d]),ye=p.useCallback(async()=>{if(!n)return;const E=Number.isFinite(Se)?Se:32,z=Math.max(1,Math.min(E,x)),W={numBoards:z,variant:P,speedrun:P==="speedrun",solutionHunt:P==="solutionhunt"};G(W);try{await h.setNextGameConfig(n,W)}catch(qe){console.error("Failed to save config to Firebase:",qe),N("Failed to save configuration",C1);return}v(!1);const fe={standard:"standard",speedrun:"speedrun",solutionhunt:"solution hunt"}[P]||"standard";N(`Next rematch will use ${z} board${z>1?"s":""} (${fe} mode).`,Qs)},[n,Se,x,P,h,N]),Ne=p.useCallback(async()=>{var W;if(!n||!l)return;const E=h.gameState;if(!E)return;if(!(E.players&&((W=E.players[l.uid])==null?void 0:W.isHost)===!0)){N("Only the host can start a rematch",Qs);return}try{const{ANSWER_WORDS:le}=await or(),Ce=E.nextGameConfig||null||$;let st=1,Me="standard";if(Ce){if(Number.isFinite(Ce.numBoards)){const Oe=Number.isFinite(Se)?Se:32;st=Math.max(1,Math.min(Oe,Ce.numBoards))}Ce.variant?Me=Ce.variant:typeof Ce.speedrun=="boolean"&&(Me=Ce.speedrun?"speedrun":"standard")}else{const Oe=Array.isArray(E.solutions)?E.solutions:E.solution?[E.solution]:[];st=Math.max(Oe.length||1,1),E.variant?Me=E.variant:E.solutionHunt?Me="solutionhunt":E.speedrun&&(Me="speedrun")}const ce=N_(n)+Date.now(),Ee=new Yi(ce),ze=Array.from({length:st}).map(()=>{const Oe=Math.floor(Ee.next()*le.length);return le[Oe]});await h.startGame(n,ze,{variant:Me,speedrun:Me==="speedrun",solutionHunt:Me==="solutionhunt"}),G(null);try{await h.setNextGameConfig(n,null)}catch(Oe){console.error("Failed to clear config from Firebase:",Oe)}j.current=!0,ne.current=!1,b(!1),f([]),_(""),w(!1)}catch(le){const fe=ji(le)||"Failed to start rematch";N(fe,Qs)}},[n,l,h,$,Se,f,_,b,w,N,ne,j]);return p.useMemo(()=>({friendRequestSent:U,hasPlayerSolvedAllMultiplayerBoards:R,isMultiplayerConfigModalOpen:D,multiplayerConfigBoardsDraft:x,multiplayerConfigVariantDraft:P,setIsMultiplayerConfigModalOpen:v,setMultiplayerConfigBoardsDraft:A,setMultiplayerConfigVariantDraft:Q,handleMultiplayerReady:he,handleMultiplayerStart:se,handleCancelHostedChallenge:de,handleAddFriendRequest:ae,openMultiplayerConfigFromEnd:re,applyMultiplayerConfig:ye,handleRematchStart:Ne}),[U,R,D,x,P,v,A,Q,he,se,de,ae,re,ye,Ne])}function rB({isOpen:t,onRequestClose:e,boardOptions:n,boardsDraft:s,onChangeBoardsDraft:r,variantDraft:i,onChangeVariantDraft:o,onSave:a,isHost:l=!0}){return u.jsx(vs,{isOpen:t,onRequestClose:e,children:u.jsxs("div",{style:{padding:"24px"},children:[u.jsx("h2",{style:{margin:0,marginBottom:"24px",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:l?"Multiplayer Room Configuration":"Next Game Configuration"}),!l&&u.jsx("p",{style:{margin:0,marginBottom:"16px",fontSize:14,color:"#818384"},children:"View the configuration for the next rematch. Only the host can change these settings."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"multiplayer-boards-select",style:{display:"block",marginBottom:"8px",color:"#d7dadc",fontSize:14},children:"Number of Boards"}),u.jsx("select",{id:"multiplayer-boards-select",value:s,onChange:c=>r(parseInt(c.target.value,10)),disabled:!l,style:{width:"100%",padding:"10px",borderRadius:6,border:"1px solid #3A3A3C",background:l?"#372F41":"#212121",color:l?"#ffffff":"#818384",fontSize:14,cursor:l?"pointer":"not-allowed",opacity:l?1:.6},children:n.map(c=>u.jsx("option",{value:c,children:c},c))})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"multiplayer-variant-config-select",style:{display:"block",marginBottom:"8px",color:"#d7dadc",fontSize:14},children:"Game Variant"}),u.jsxs("select",{id:"multiplayer-variant-config-select",value:i,onChange:c=>o(c.target.value),disabled:!l,style:{width:"100%",padding:"10px",borderRadius:6,border:"1px solid #3A3A3C",background:l?"#372F41":"#212121",color:l?"#ffffff":"#818384",fontSize:14,cursor:l?"pointer":"not-allowed",opacity:l?1:.6},children:[u.jsx("option",{value:"standard",children:"Standard (6 guesses)"}),u.jsx("option",{value:"speedrun",children:"Speedrun (Unlimited guesses, timed)"}),u.jsx("option",{value:"solutionhunt",children:"Solution Hunt (See possible words)"})]})]}),u.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"12px"},children:[u.jsx("button",{onClick:e,style:{flex:1,padding:"12px",borderRadius:8,border:"1px solid #3A3A3C",background:"transparent",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Cancel"}),l?u.jsx("button",{onClick:a,style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Save for Rematch"}):u.jsx("div",{style:{flex:1,padding:"12px",borderRadius:8,border:"1px solid #3A3A3C",background:"transparent",color:"#818384",fontSize:14,fontWeight:"bold",textAlign:"center"},children:"View Only"})]})]})]})})}function iB({gameCode:t,gameState:e,isHost:n,onReady:s,onStartGame:r,onAddFriend:i,friendRequestSent:o,onShareCode:a,onCancelChallenge:l,friends:c,authUserId:h,onInviteFriend:d,createdAt:f,waitingNowMs:m,waitingTimeoutMs:g,initialBoards:y,onUpdateConfig:S,roomName:T,onUpdateRoomName:w}){const{status:b,players:_,maxPlayers:k,isPublic:O,speedrun:q}=e||{},I=_||null,N=h||null,M=I?Object.values(I).sort((J,He)=>J.isHost&&!He.isHost?-1:!J.isHost&&He.isHost?1:(J.joinedAt||0)-(He.joinedAt||0)):[],j=!!I&&M.length>0,ne=j&&N&&I[N]?!!I[N].ready:!1,oe=j?M.length>0&&M.every(J=>!!J.ready):!1,[ve,Se]=rt.useState(!1),Y=M.find(J=>!!J.isHost),$=`${(Y==null?void 0:Y.name)||"Host"}'s room`,G=T||$,[B,D]=rt.useState(!1),[v,x]=rt.useState(G);rt.useEffect(()=>{x(G)},[G]);const A=()=>{if(!w||!n)return;const He=v.trim()||$;He!==G&&w(He),D(!1)},P=()=>{x(G),D(!1)},Q=Number.isFinite(e==null?void 0:e.configBoards)?e.configBoards:Number.isFinite(y)?y:1,U=Math.max(1,Q||1),R=Number.isFinite(k)?k:2,ie=O===!0,he=!!q,[se,de]=rt.useState(!1),[ae,re]=rt.useState(U),[ye,Ne]=rt.useState(R),[Te,E]=rt.useState(ie),[z,W]=rt.useState(he),[le,fe]=rt.useState(U),[qe,Ce]=rt.useState(R),[st,Me]=rt.useState(ie),[ce,Ee]=rt.useState(he),[ze,Oe]=rt.useState(!1),[We,vt]=rt.useState(null);rt.useEffect(()=>{re(U),Ne(R),E(ie),W(he),fe(U),Ce(R),Me(ie),Ee(he)},[U,R,ie,he]);const ot=typeof g=="number"?g:30*60*1e3;let Ze=null;if(typeof f=="number"&&typeof m=="number"){const J=m-f,He=Math.max(0,ot-J),xt=Math.floor(He/1e3),Et=Math.floor(xt/60),Ot=xt%60;Ze=Et>0?`${Et}m ${Ot.toString().padStart(2,"0")}s`:`${Ot}s`}const St=()=>{s&&s()};return u.jsx("div",{className:"waitingRoomRoot",children:u.jsxs("div",{className:"waitingRoomCard",children:[n&&w&&B?u.jsxs("div",{className:"waitingRoomTitleEdit",children:[u.jsx("input",{type:"text",value:v,onChange:J=>x(J.target.value),placeholder:"Room name",className:"waitingRoomTitleInput","aria-label":"Room name",autoFocus:!0}),u.jsxs("div",{className:"waitingRoomTitleEditActions",children:[u.jsx("button",{type:"button",onClick:P,className:"waitingRoomSecondaryButton waitingRoomTitleEditBtn",children:"Cancel"}),u.jsx("button",{type:"button",onClick:A,className:"waitingRoomPrimaryButton waitingRoomTitleEditBtn",children:"Save"})]})]}):u.jsxs("div",{className:"waitingRoomTitleRow",children:[u.jsx("h2",{className:"waitingRoomTitle",children:G}),n&&w&&u.jsx("button",{type:"button",onClick:()=>D(!0),className:"waitingRoomTitleEditLink","aria-label":"Edit room name",children:"Edit"})]}),b==="waiting"&&u.jsxs("div",{children:[u.jsx("p",{className:"waitingRoomSubtitle",children:"Waiting for players to join..."}),Ze&&u.jsxs("p",{className:"waitingRoomExpiry",children:["Room expires in ",Ze,"."]}),u.jsxs("div",{className:"waitingRoomCodeCard",children:[u.jsx("div",{className:"waitingRoomCodeLabel",children:"Game Code:"}),u.jsx("div",{className:"waitingRoomCodeValue",children:t}),u.jsx("p",{className:"waitingRoomCodeHelp",children:"Share this code with your opponent"}),n&&a&&u.jsx("button",{type:"button",onClick:()=>a(t),className:"waitingRoomPrimaryButton",children:"Share Code"})]}),n&&l&&u.jsx("button",{type:"button",onClick:()=>l(),className:"waitingRoomSecondaryButton waitingRoomCloseRoomButton",children:"Close Room"}),u.jsxs("div",{className:"waitingRoomSettings",children:[u.jsxs("div",{className:"waitingRoomSettingsHeader",children:[u.jsx("div",{className:"waitingRoomSettingsLabel",children:"Game settings"}),n&&S&&u.jsx("button",{type:"button",onClick:()=>de(J=>!J),className:"waitingRoomSettingsEdit",children:se?"Cancel":"Edit"})]}),!se&&u.jsxs("div",{className:"waitingRoomSettingsSummary",children:["Boards: ",u.jsx("strong",{children:le}),"  Mode:"," ",u.jsx("strong",{children:ce?"Speedrun":"Standard"}),"  Max players: ",u.jsx("strong",{children:qe}),"  Visibility:"," ",u.jsx("strong",{children:st?"Public":"Private"}),ze&&u.jsx("span",{className:"waitingRoomSavingIndicator",children:" (saving...)"}),We&&u.jsxs("div",{className:"waitingRoomConfigError",children:["Error: ",We]})]}),se&&n&&S&&u.jsxs("div",{className:"waitingRoomSettingsEditForm",children:[u.jsxs("div",{className:"waitingRoomSettingsRow",children:[u.jsxs("label",{className:"waitingRoomSettingsField",children:[u.jsx("div",{className:"waitingRoomSettingsFieldLabel",children:"Boards"}),u.jsx("select",{className:"waitingRoomSelect",value:ae,onChange:J=>re(Math.min(Ia,Math.max(1,parseInt(J.target.value,10)||1))),children:Array.from({length:Ia},(J,He)=>He+1).map(J=>u.jsx("option",{value:J,children:J},J))})]}),u.jsxs("label",{className:"waitingRoomSettingsField",children:[u.jsx("div",{className:"waitingRoomSettingsFieldLabel",children:"Max players"}),u.jsx("select",{className:"waitingRoomSelect",value:ye,onChange:J=>Ne(Math.min(8,Math.max(2,parseInt(J.target.value,10)||2))),children:Array.from({length:7},(J,He)=>He+2).map(J=>u.jsx("option",{value:J,children:J},J))})]})]}),u.jsxs("div",{className:"waitingRoomSettingsToggles",children:[u.jsxs("label",{className:"waitingRoomCheckboxLabel",children:[u.jsx("input",{type:"checkbox",checked:z,onChange:J=>W(J.target.checked)}),u.jsx("span",{children:"Speedrun mode"})]}),u.jsxs("div",{className:"waitingRoomVisibilityGroup",children:[u.jsxs("label",{className:"waitingRoomRadioLabel",children:[u.jsx("input",{type:"radio",checked:Te,onChange:()=>E(!0)}),u.jsx("span",{children:"Public"})]}),u.jsxs("label",{className:"waitingRoomRadioLabel",children:[u.jsx("input",{type:"radio",checked:!Te,onChange:()=>E(!1)}),u.jsx("span",{children:"Private"})]})]})]}),u.jsxs("div",{className:"waitingRoomSettingsButtons",children:[u.jsx("button",{type:"button",onClick:()=>{de(!1),re(U),Ne(R),E(ie),W(he)},className:"waitingRoomSecondaryButton waitingRoomSettingsButton",children:"Discard"}),u.jsx("button",{type:"button",onClick:async()=>{if(S){Oe(!0),vt(null),fe(ae),Ce(ye),Me(Te),Ee(z),de(!1);try{await S({boards:ae,maxPlayers:ye,isPublic:Te,speedrun:z})}catch(J){vt(J.message||"Failed to save settings"),fe(U),Ce(R),Me(ie),Ee(he),de(!0)}finally{Oe(!1)}}},disabled:ze,className:"waitingRoomPrimaryButton waitingRoomSettingsButton",children:ze?"Saving...":"Save changes"})]})]})]}),u.jsxs("div",{className:"waitingRoomPlayersSection",children:[u.jsx("div",{className:"waitingRoomPlayersTitle",children:"Players in room:"}),u.jsx("div",{className:"waitingRoomPlayersList",children:M.map(J=>{const He=!!J.isHost,xt=N&&J.id===N,Et=c==null?void 0:c.some(Sn=>Sn.id===J.id),Ot=!xt&&i&&!Et;return u.jsxs("div",{className:"waitingRoomPlayerCard",children:[u.jsxs("div",{className:"waitingRoomPlayerInfo",children:[u.jsx(xr,{userId:J.id,username:J.name||"Player",isYou:xt,badges:He?[{id:"host",label:"Host"}]:[],size:"sm"}),Ot&&u.jsx("button",{type:"button",onClick:()=>!o&&i(J.name,J.id),disabled:o,className:"waitingRoomPlayerFriendButton",title:o?"Friend request sent":`Add ${J.name} as friend`,children:o?"":"Add friend"})]}),u.jsx("span",{className:J.ready?"waitingRoomPlayerReady waitingRoomPlayerReadyOn":"waitingRoomPlayerReady waitingRoomPlayerReadyOff",children:J.ready?" Ready":"Not Ready"})]},J.id)})}),s&&u.jsxs(u.Fragment,{children:[ne?u.jsx("button",{type:"button",onClick:St,disabled:oe,className:oe?"waitingRoomSecondaryButton waitingRoomReadyButton waitingRoomReadyButtonDisabled":"waitingRoomSecondaryButton waitingRoomReadyButton",children:oe?"All ready":"Not Ready"}):u.jsx("button",{type:"button",onClick:St,className:"waitingRoomPrimaryButton waitingRoomReadyButton",children:"Ready"}),oe&&n&&r&&u.jsx("button",{type:"button",onClick:r,className:"waitingRoomStartButton",children:"Start Game"})]})]}),c&&c.length>0&&d&&u.jsxs("div",{className:"waitingRoomInviteSection",children:[u.jsxs("button",{type:"button",onClick:()=>Se(J=>!J),className:"waitingRoomInviteToggle",children:["Invite friends ",ve?"":""]}),ve&&u.jsx("div",{className:"waitingRoomInviteList",children:c.map(J=>u.jsxs("div",{className:"waitingRoomInviteItem",children:[u.jsx(xr,{userId:J.id,username:J.name,size:"sm"}),u.jsx("button",{type:"button",onClick:()=>d(J),className:"waitingRoomPrimaryButton waitingRoomInviteButton",children:"Invite"})]},J.id))})]})]})]})})}function P_({gameCode:t,authUser:e}){const[n,s]=p.useState(!1),[r,i]=p.useState([]),[o,a]=p.useState(""),[l,c]=p.useState(!1),h=p.useRef(null),d=p.useRef(null),f=p.useRef(Date.now()),[m,g]=p.useState(0),y=p.useMemo(()=>!!t&&!!e,[t,e]);p.useEffect(()=>{if(!t)return;const _=Z(K,`multiplayer/${t}/chat`),k=Ih(_,Th(100)),O=Un(k,q=>{if(!q.exists()){i([]);return}const I=q.val()||{},N=Object.entries(I).map(([M,j])=>({id:M,...j||{}})).sort((M,j)=>{const ne=typeof M.createdAt=="number"?M.createdAt:0,oe=typeof j.createdAt=="number"?j.createdAt:0;return ne-oe});i(N)});return()=>{typeof O=="function"&&O()}},[t]),p.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[r.length,n]),p.useEffect(()=>{if(!e||r.length===0){g(0);return}if(n){const _=r.length>0?Math.max(...r.map(k=>typeof k.createdAt=="number"?k.createdAt:0)):Date.now();f.current=_,g(0)}else{const _=r.filter(k=>k.uid===e.uid?!1:(typeof k.createdAt=="number"?k.createdAt:0)>f.current);g(_.length)}},[r,n,e]),p.useEffect(()=>{t&&e&&(f.current=Date.now())},[t,e]);const S=async _=>{if(_&&(_.preventDefault(),_.stopPropagation()),!y)return;const k=o.trim();if(k){c(!0);try{const O=Z(K,`multiplayer/${t}/chat`),q=Ch(O),I=e.displayName||e.email||"Player";await Pt(q,{uid:e.uid,name:I,text:k,createdAt:Date.now()}),a(""),requestAnimationFrame(()=>{d.current&&n&&d.current.focus()})}catch{}finally{c(!1)}}},T=_=>{_.stopPropagation(),typeof _.stopImmediatePropagation=="function"&&_.stopImmediatePropagation(),_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),S(_))},w=_=>{_.stopPropagation(),typeof _.stopImmediatePropagation=="function"&&_.stopImmediatePropagation()},b=_=>{_.stopPropagation(),_.stopImmediatePropagation()};return p.useEffect(()=>{n&&d.current&&setTimeout(()=>{var _;(_=d.current)==null||_.focus()},100)},[n]),!t||!e?null:u.jsxs(u.Fragment,{children:[u.jsxs("button",{type:"button",onClick:()=>s(_=>!_),style:{position:"fixed",bottom:210,right:20,padding:"8px 14px",borderRadius:999,backgroundColor:"#212121",border:"1px solid #ffffff",color:"#ffffff",fontSize:12,fontWeight:"bold",cursor:"pointer",zIndex:9999,display:"flex",alignItems:"center",gap:8,boxShadow:"0 4px 16px rgba(0,0,0,0.7)"},"aria-label":n?"Close room chat":"Open room chat",children:[u.jsxs("span",{style:{display:"inline-flex",width:18,height:18,borderRadius:"50%",border:"2px solid #50a339",alignItems:"center",justifyContent:"center",fontSize:10,position:"relative"},children:["",m>0&&u.jsx("span",{style:{position:"absolute",top:-6,right:-6,minWidth:18,height:18,borderRadius:"50%",backgroundColor:"#ef4444",color:"#ffffff",fontSize:10,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 4px",border:"2px solid #212121",boxShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:m>99?"99+":m})]}),u.jsx("span",{children:n?"Close chat":"Room chat"})]}),n&&u.jsxs("div",{onClick:_=>{_.stopPropagation()},onKeyDown:_=>{_.stopPropagation()},style:{position:"fixed",bottom:280,right:20,width:320,maxWidth:"90vw",maxHeight:"60vh",display:"flex",flexDirection:"column",backgroundColor:"#372F41",borderRadius:12,border:"1px solid #3A3A3C",boxShadow:"0 8px 24px rgba(0,0,0,0.85)",zIndex:9998},children:[u.jsxs("div",{style:{padding:"8px 12px",borderBottom:"1px solid #2f2f31",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[u.jsx("div",{style:{fontSize:13,fontWeight:"bold",color:"#ffffff"},children:"Room chat"}),u.jsx("div",{style:{fontSize:11,color:"#9ca3af"},children:"Visible to players in this room"})]}),u.jsx("div",{ref:h,style:{flex:1,overflowY:"auto",padding:"8px 10px 4px",display:"flex",flexDirection:"column",gap:6},children:r.length===0?u.jsx("div",{style:{fontSize:12,color:"#9ca3af",textAlign:"center",padding:"8px 0"},children:"No messages yet. Say hello to your opponents!"}):r.map(_=>{const k=_.uid&&e&&_.uid===e.uid,O=_.createdAt?new Date(_.createdAt).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):"";return u.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:k?"flex-end":"flex-start"},children:[u.jsxs("div",{style:{maxWidth:"100%",padding:"6px 8px",borderRadius:8,backgroundColor:k?"#2563eb":"#27272a",color:"#f9fafb",fontSize:13,wordBreak:"break-word"},children:[!k&&u.jsx("div",{style:{marginBottom:2},children:u.jsx(xr,{userId:_.uid,username:_.name||"Player",size:"sm"})}),u.jsx("div",{children:_.text})]}),O&&u.jsx("div",{style:{fontSize:10,color:"#6b7280",marginTop:2},children:O})]},_.id)})}),u.jsxs("form",{onSubmit:S,onClick:_=>{_.stopPropagation()},onKeyDown:_=>{_.stopPropagation()},style:{borderTop:"1px solid #2f2f31",padding:"6px 8px",display:"flex",gap:6,alignItems:"center"},children:[u.jsx("input",{ref:d,type:"text","data-chat-input":"true",placeholder:y?"Type a message":"Sign in to chat",value:o,onChange:_=>{_.stopPropagation(),a(_.target.value)},onKeyDown:T,onKeyPress:w,onKeyUp:b,onFocus:_=>{_.stopPropagation()},onBlur:_=>{_.stopPropagation(),n&&requestAnimationFrame(()=>{if(n&&d.current){const k=document.activeElement;k!==d.current&&(k==null?void 0:k.tagName)!=="BUTTON"&&(k==null?void 0:k.type)!=="submit"&&d.current.focus()}})},onClick:_=>{_.stopPropagation()},onMouseDown:_=>{_.stopPropagation()},disabled:!y||l,autoFocus:n,style:{flex:1,padding:"6px 8px",borderRadius:999,border:"1px solid #3A3A3C",backgroundColor:"#212121",color:"#ffffff",fontSize:13,outline:"none"}}),u.jsx("button",{type:"submit",disabled:!y||l||!o.trim(),onMouseDown:_=>{_.preventDefault()},onClick:_=>{_.stopPropagation(),requestAnimationFrame(()=>{d.current&&n&&d.current.focus()})},style:{padding:"6px 10px",borderRadius:999,border:"none",backgroundColor:!y||l||!o.trim()?"#3A3A3C":"#e56b6f",color:"#ffffff",fontSize:12,fontWeight:"bold",cursor:!y||l||!o.trim()?"default":"pointer",textTransform:"uppercase",letterSpacing:.5},children:"Send"})]})]})]})}function oB({mode:t,gameCode:e,authUser:n,authLoading:s,isVerifiedUser:r,multiplayerGame:i,isLoading:o,maxTurns:a,currentGuess:l,invalidCurrentGuess:c,revealId:h,boardRefs:d,boards:f,selectedBoardIndex:m,setSelectedBoardIndex:g,friendRequestSent:y,onAddFriendRequest:S,onShareCode:T,onReady:w,onStartGame:b,onBack:_,onHomeClick:k,onOpenFeedback:O,onRematch:q,setShowFeedbackModal:I,setTimedMessage:N,multiplayerNowMs:M,waitingNowMs:j,initialNumBoards:ne,onChangeMode:oe,friends:ve,onCancelChallenge:Se,onInviteFriend:Y,onUpdateConfig:C,onUpdateRoomName:$,countdownRemaining:G}){var Me;const[B,D]=p.useState(!1),v=i==null?void 0:i.gameState,x=v&&v.players&&typeof v.players=="object"?v.players:null,A=x?Object.keys(x).length:0;if(s)return u.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#212121",color:"#ffffff"},children:[u.jsx(Br,{onOpenFeedback:O,onHomeClick:k}),u.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"24px"},children:"Loading authentication..."})]});if(!n)return u.jsxs(u.Fragment,{children:[u.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#212121",color:"#ffffff"},children:[u.jsx(Br,{onOpenFeedback:O,onHomeClick:k}),u.jsxs("main",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",textAlign:"center"},children:[u.jsx("h2",{style:{fontSize:24,fontWeight:"bold",marginBottom:16},children:"Sign in to play Multiplayer Mode"}),u.jsx("p",{style:{maxWidth:480,fontSize:14,color:"#d7dadc",marginBottom:24,lineHeight:1.6},children:"A Wuzzle Games account is required to host or join multiplayer rooms."}),u.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12,width:"100%",maxWidth:320},children:[u.jsx("button",{type:"button",className:"homeBtn homeBtnGreen homeBtnLg",onClick:()=>D(!0),children:"Sign In"}),u.jsx("button",{type:"button",className:"homeBtn homeBtnOutline homeBtnLg",onClick:_,children:"Back to Home"})]})]})]}),u.jsx(Xg,{isOpen:B,onRequestClose:()=>D(!1)})]});if(v&&v.status==="cancelled"){const ce=v.cancelledByName||"Your friend";return u.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#212121",color:"#ffffff"},children:[u.jsx(Br,{onOpenFeedback:O,onHomeClick:k}),u.jsxs("div",{style:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"24px",textAlign:"center"},children:[u.jsx("h2",{style:{fontSize:22,fontWeight:"bold",marginBottom:16},children:"Multiplayer Challenge"}),u.jsxs("p",{style:{fontSize:16,color:"#d7dadc",marginBottom:16},children:[ce," has declined the challenge."]}),u.jsx("button",{onClick:_,style:{padding:"10px 18px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Home"})]})]})}if(v&&v.status==="waiting"&&r){const ce=v.players&&typeof v.players=="object"?v.players:null,Ee=n&&ce&&((Me=ce[n.uid])==null?void 0:Me.isHost)===!0,ze=typeof v.createdAt=="number"?v.createdAt:null,Oe=typeof v.configBoards=="number"&&Number.isFinite(v.configBoards)?v.configBoards:ne||1,We=typeof v.maxPlayers=="number"&&Number.isFinite(v.maxPlayers)?v.maxPlayers:2,vt=v.roomName||null;return u.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#212121",color:"#ffffff"},children:[u.jsx(Br,{onOpenFeedback:O,onHomeClick:k}),u.jsx(Mp,{mode:t,numBoards:Oe,speedrunEnabled:!1}),u.jsx(iB,{gameCode:e||"",gameState:v,isHost:Ee,currentUserId:(n==null?void 0:n.uid)||null,maxPlayers:We,roomName:vt,onReady:w,onStartGame:b,friendRequestSent:y,onShareCode:T,onCancelChallenge:Ee?Se:void 0,createdAt:ze,waitingNowMs:j,waitingTimeoutMs:zu,initialBoards:ne||1,onUpdateConfig:Ee?C:void 0,onUpdateRoomName:Ee?$:void 0,onAddFriend:(ot,Ze)=>{Ze&&S(ot,Ze)},friends:ve,authUserId:n?n.uid:null,onInviteFriend:Y}),u.jsx(P_,{gameCode:e||"",authUser:n})]})}if((i==null?void 0:i.error)===Vu||typeof(i==null?void 0:i.error)=="string"&&(i.error.includes("Game code not found")||i.error.includes("not found or has expired")))return u.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#212121",color:"#ffffff",flexDirection:"column",gap:"16px",padding:"20px"},children:[u.jsx("div",{style:{textAlign:"center",fontSize:18},children:"The host has left the room"}),u.jsx("div",{style:{color:"#9ca3af",textAlign:"center",fontSize:14},children:Vu}),u.jsx("button",{onClick:_,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:16,fontWeight:"bold",cursor:"pointer"},children:"Go home"})]});if(i!=null&&i.error)return u.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#212121",color:"#ffffff",flexDirection:"column",gap:"16px",padding:"20px"},children:[u.jsxs("div",{style:{color:"#f06272",textAlign:"center"},children:["Error: ",i.error]}),u.jsx("button",{onClick:_,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:16,fontWeight:"bold",cursor:"pointer"},children:"Home"})]});const Q=n&&!r,U=e&&!v&&r;if(o||i!=null&&i.loading||U)return u.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#212121",color:"#ffffff",flexDirection:"column",gap:"16px"},children:n?Q?u.jsxs("div",{style:{textAlign:"center"},children:[u.jsx("div",{children:"You must verify your email to play Multiplayer Mode."}),u.jsx("button",{onClick:_,style:{marginTop:"16px",padding:"10px 18px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Back to Home"})]}):U?u.jsx(u.Fragment,{children:"Connecting to game..."}):o?u.jsx(u.Fragment,{children:"Loading word lists..."}):u.jsx(u.Fragment,{children:"Loading game..."}):u.jsx(u.Fragment,{children:"Loading authentication..."})});if(!v)return Q?u.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#212121",color:"#ffffff",flexDirection:"column",gap:"16px",textAlign:"center"},children:[u.jsx("div",{children:"You must verify your email to play Multiplayer Mode."}),u.jsx("button",{onClick:_,style:{marginTop:"16px",padding:"10px 18px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Back to Home"})]}):null;const R=v.speedrun||!1,ie=n&&x&&x[n.uid]?x[n.uid].isHost:!1,he=x?Object.keys(x):[],se=!!x&&he.length>2,de=typeof v.createdAt=="number"?v.createdAt:null;let ae=null;if(de){const ce=j-de,Ee=Math.max(0,zu-ce),ze=Math.floor(Ee/1e3),Oe=Math.floor(ze/60),We=ze%60;Oe>0?ae=`${Oe}m ${We.toString().padStart(2,"0")}s`:ae=`${We}s`}const re=tl(v),ye=re.map(ce=>ce.toUpperCase()).join("  "),Ne=re.length||1,Te=(()=>{if(x&&n){const ce=n!=null&&n.uid?x[n.uid]:null;if(ce&&Array.isArray(ce.guesses))return ce.guesses}return[]})(),E=(()=>{if(x&&n){const ce=Object.values(x).filter(Ee=>Ee.id!==n.uid);if(ce[0]&&Array.isArray(ce[0].guesses))return ce[0].guesses}return[]})(),z=v.solution&&Te.includes(v.solution);v.solution&&E.includes(v.solution),re.length>1&&re.every(ce=>Te.includes(ce));const le=Te.length;E.length;const fe=R?se?"Multiplayer speedrun: everyone guessing":"Speedrun: everyone guessing":se||A>2?"Multiplayer: everyone guessing":"Standard: everyone guessing",qe=ce=>{if(v!=null&&v.players&&ce){const Ee=v.players[ce],ze=(Ee==null?void 0:Ee.timeMs)||null;if(ze!==null)return Xs(ze);const Oe=v==null?void 0:v.startedAt,We=Oe!=null?Oe+ei:null;if(We!=null){const vt=Math.max(0,M-We);return Xs(vt)}return"0:00"}return"0:00"},Ce=ce=>{const Ee=Array.isArray(ce)?ce:[];return re.map((ze,Oe)=>{const We=typeof ze=="string"?ze.toLowerCase():"",vt=Ee.findIndex(He=>typeof He=="string"?He.toLowerCase()===We:!1),ot=vt===-1?Ee.length:vt+1;let Ze=0,St=0;Ee.slice(0,ot).forEach(He=>{Xu(He.toLowerCase(),ze.toLowerCase()).forEach(Et=>{Et==="green"?Ze+=1:Et==="yellow"&&(St+=1)})});const J=vt!==-1;return{boardIndex:Oe+1,guessCount:ot,greens:Ze,yellows:St,solved:J}})},st=x&&Object.keys(x).length>0?Object.values(x):[];return u.jsx(u.Fragment,{children:u.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",backgroundColor:"#212121",color:"#ffffff"},children:[u.jsx(Br,{onOpenFeedback:O,onHomeClick:k}),R&&v.status==="playing"&&G!=null&&G>0&&u.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(18, 18, 19, 0.95)",zIndex:9999},"aria-live":"polite","aria-atomic":"true",children:u.jsxs("div",{style:{fontSize:48,fontWeight:"bold",letterSpacing:4,color:"#ffffff",textAlign:"center"},children:["Timer starts in ",G]})}),u.jsxs("main",{style:{flex:1,overflowY:"auto",overflowX:"hidden",paddingBottom:(v.status==="finished"?16:Mf)+16},children:[u.jsx(Mp,{mode:t,numBoards:Ne,speedrunEnabled:R}),ye&&ye.length>0&&u.jsx("div",{style:{padding:"0 16px 8px",fontSize:12,color:"#d7dadc",textTransform:"uppercase",fontWeight:"normal",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:ye}),u.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"16px",maxWidth:"1200px",margin:"0 auto",width:"100%"},children:[ae&&u.jsxs("div",{style:{fontSize:11,color:"#9ca3af",textAlign:"center",marginBottom:4},children:["Room expires in ",ae,"."]}),u.jsxs("div",{style:{marginBottom:4,padding:"10px 12px",borderRadius:8,border:"1px solid #3A3A3C",background:"#372F41",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[u.jsxs("div",{style:{fontSize:12,color:"#d7dadc",textTransform:"uppercase",letterSpacing:.5},children:["Boards:"," ",u.jsx("span",{style:{fontWeight:"bold"},children:Ne})]}),u.jsx("div",{style:{flex:1,textAlign:"center"},children:R?u.jsx("div",{style:{fontSize:22,fontWeight:"bold",letterSpacing:1,color:"#ffffff"},children:(()=>{if(G!=null&&G>0)return"0:00";const Ee=v==null?void 0:v.startedAt,ze=Ee!=null?Ee+ei:null;if(v!=null&&v.players&&n){const Oe=v.players[n.uid];if(Oe){if(Oe.timeMs!=null&&typeof Oe.timeMs=="number")return Xs(Oe.timeMs);if(ze!=null){const We=Math.max(0,M-ze);return Xs(We)}}}if(ze!=null){const Oe=Math.max(0,M-ze);return Xs(Oe)}return"0:00"})()}):u.jsxs("div",{style:{fontSize:18,fontWeight:"bold",color:"#ffffff"},children:["Your guesses: ",Te.length,"/",a]})}),u.jsxs("div",{style:{fontSize:12,color:"#d7dadc",textTransform:"uppercase",letterSpacing:.5,textAlign:"right"},children:["Guesses:"," ",u.jsx("span",{style:{fontWeight:"bold"},children:R?"Unlimited":a})]})]}),u.jsx("div",{style:{textAlign:"center",fontSize:14,color:"#d7dadc",marginBottom:"8px"},children:v.status==="finished"?u.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"24px",alignItems:"center"},children:u.jsxs("div",{children:[u.jsx("div",{style:{fontSize:12,color:"#818384"},children:"Your Guesses"}),u.jsx("div",{style:{fontSize:18,fontWeight:"bold",color:"#ffffff"},children:le})]})}):R?u.jsx("div",{style:{fontSize:12,color:"#818384",textAlign:"center"},children:fe}):fe}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px",width:"100%"},children:f.map((ce,Ee)=>u.jsxs("div",{style:{width:"100%"},children:[u.jsxs("div",{style:{fontSize:14,color:"#818384",marginBottom:"8px",textAlign:"center"},children:["Your Board ",f.length>1?`#${Ee+1}`:""]}),u.jsx(ZE,{board:ce,index:Ee,numBoards:f.length,maxTurns:a,isUnlimited:R,currentGuess:l,invalidCurrentGuess:c,revealId:h,isSelected:m===Ee,onToggleSelect:()=>g(ze=>ze===Ee?null:Ee),boardRef:ze=>{d.current[Ee]=ze},speedrunEnabled:R,isCurrentTurn:!0})]},Ee))}),st.length>0&&re.length>0&&u.jsxs("div",{style:{marginTop:16,padding:"12px 12px 10px",borderRadius:8,border:"1px solid #3A3A3C",background:"#372F41"},children:[u.jsx("div",{style:{fontSize:13,color:"#d7dadc",marginBottom:8,textAlign:"left",fontWeight:"bold"},children:"Room progress (per board)"}),u.jsx("div",{style:{maxHeight:260,overflowY:"auto",display:"flex",flexDirection:"column",gap:8},children:st.map(ce=>{const Ee=n&&ce.id===n.uid,ze=Array.isArray(ce.guesses)?ce.guesses:[],Oe=Ce(ze);return u.jsxs("div",{style:{padding:"8px 8px 6px",borderRadius:6,background:"#372F41",display:"flex",flexDirection:"column",gap:4},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[u.jsx(xr,{userId:ce.id,username:ce.name||"Player",isYou:Ee,size:"sm"}),R?u.jsx("div",{style:{fontSize:11,color:Ee?"#50a339":"#B1A04C"},children:qe(ce.id)}):u.jsxs("div",{style:{fontSize:11,color:"#9ca3af"},children:["Total guesses: ",ze.length]})]}),u.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4,fontSize:11,color:"#d7dadc"},children:Oe.map(We=>{const vt=We.guessCount===1?"1 guess":`${We.guessCount} guesses`,ot=[`Board ${We.boardIndex}: ${vt}`,`Green ${We.greens} `,`Yellow ${We.yellows} `];We.solved&&ot.push("Solved");const Ze=ot.join("  ");return u.jsx("div",{style:{padding:"4px 6px",borderRadius:4,background:"#372F41"},children:Ze},We.boardIndex)})})]},ce.id||ce.name)})})]})]})]}),v.status==="finished"&&u.jsx("div",{style:{position:"fixed",bottom:Mf+20,left:"50%",transform:"translateX(-50%)",zIndex:1100,pointerEvents:"auto"},children:u.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",justifyContent:"center"},children:[ie&&u.jsx("button",{onClick:q,style:{padding:"12px 24px",borderRadius:10,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase",boxShadow:"0 4px 12px rgba(0,0,0,0.5)"},children:"Rematch"}),oe&&u.jsx("button",{onClick:oe,style:{padding:"12px 18px",borderRadius:10,border:"1px solid #3A3A3C",background:ie?"#372F41":"#355070",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer",letterSpacing:1,textTransform:"uppercase",boxShadow:"0 4px 12px rgba(0,0,0,0.5)"},children:ie?"Change mode":"View config"})]})}),u.jsx(P_,{gameCode:e||"",authUser:n})]})})}const aB=p.lazy(()=>Je(()=>import("./FeedbackModal-DtP9FLlv.js"),__vite__mapDeps([5,1]))),D_=Array.from({length:Ia},(t,e)=>e+1);function rT(){var Hl,Gl,Do,Mo,X,xe;const[t]=j_(),e=br(),{code:n}=gT(),{message:s,setMessage:r,setTimedMessage:i,clearMessageTimer:o}=qE(""),{user:a,sendFriendRequest:l,isVerifiedUser:c,friends:h,cancelSentChallenge:d,sendChallenge:f,loading:m}=On(),g=t.get("mode"),y=t.get("host")==="true",S=(()=>{if(g==="multiplayer"){const F=t.get("variant");if(F==="speedrun"||F==="solutionhunt"||F==="standard")return F;if(t.get("speedrun")==="true")return"speedrun"}return"standard"})(),T=S==="speedrun",[w,b]=p.useState(!1),[_,k]=p.useState([]),O=t.get("boards"),q=t.get("maxPlayers"),I=t.get("isPublic"),N=n||t.get("code")||null,M=a?N:null,j=p.useRef(null),[ne,oe]=p.useState(null),ve=p.useCallback(F=>{j.current=F},[]),Se=p.useCallback(F=>{oe(F)},[]),Y=((Hl=j.current)==null?void 0:Hl.code)===N?j.current.gameData:(ne==null?void 0:ne.code)===N?ne.gameData:null,C=nB(M,y,T,Y),[$,G]=p.useState([]),[B,D]=p.useState(""),v=p.useRef(""),[x,A]=p.useState(6),[P,Q]=p.useState(new Set),[U,R]=p.useState(!0),[ie,he]=p.useState(!1),[se,de]=p.useState(!1),[ae,re]=p.useState(!1),ye=p.useRef(!1),Ne=p.useRef(!1),Te=p.useRef(!1),[E,z]=p.useState(!1),[W,le]=p.useState(null),[fe,qe]=p.useState(0),[Ce,st]=p.useState(!1),Me=p.useRef({}),[ce,Ee]=p.useState(!1),[ze,Oe]=p.useState(Date.now()),[We,vt]=p.useState(Date.now()),ot=p.useRef(!1),[Ze,St]=p.useState(null),J=p.useRef([]),He=p.useRef(null);p.useEffect(()=>{var we;if(!((we=C.gameState)!=null&&we.speedrun))return;const F=setInterval(()=>{Oe(Date.now())},b1);return()=>clearInterval(F)},[(Gl=C.gameState)==null?void 0:Gl.speedrun]),p.useEffect(()=>{var et;if(!((et=C.gameState)==null?void 0:et.createdAt)){ot.current=!1;return}const we=setInterval(()=>{vt(Date.now())},1e3);return()=>clearInterval(we)},[(Do=C.gameState)==null?void 0:Do.createdAt]);const xt=C.gameState,Et=(xt==null?void 0:xt.status)==="playing"&&!!(xt!=null&&xt.speedrun),Ot=(xt==null?void 0:xt.startedAt)??null;p.useEffect(()=>{if(!Et||!Ot){Et||(He.current=null,St(null));return}if(He.current===Ot)return;He.current=Ot;const F=ei/3;St(3);const we=setTimeout(()=>St(2),F),et=setTimeout(()=>St(1),F*2),Rt=setTimeout(()=>{St(null),J.current=[]},ei);return J.current=[we,et,Rt],()=>{J.current.forEach(mn=>clearTimeout(mn)),J.current=[]}},[Et,Ot]),p.useEffect(()=>{v.current=B},[B]);const Sn=p.useMemo(()=>$.length>0?$.length:1,[$]),at=C.gameState,Ao=p.useMemo(()=>{const F=at&&Number.isFinite(at.configBoards)?at.configBoards:null;if(F!=null)return F;if(O!=null){const we=parseInt(O,10);if(Number.isFinite(we))return Zr(we)}return Sn||1},[at,O,Sn]);p.useEffect(()=>{const F=C.gameState;if(!F||!N||!F.createdAt||ot.current)return;We-F.createdAt>=zu&&(ot.current=!0,(async()=>{try{await C.expireGame(N)}finally{e("/")}})())},[We,(Mo=C.gameState)==null?void 0:Mo.createdAt,N,e,C.expireGame]);const{friendRequestSent:_i,hasPlayerSolvedAllMultiplayerBoards:Wt,isMultiplayerConfigModalOpen:Si,multiplayerConfigBoardsDraft:bs,multiplayerConfigVariantDraft:kr,setIsMultiplayerConfigModalOpen:xn,setMultiplayerConfigBoardsDraft:Ro,setMultiplayerConfigVariantDraft:ad,handleMultiplayerReady:ld,handleMultiplayerStart:jl,handleCancelHostedChallenge:ey,handleAddFriendRequest:Fl,openMultiplayerConfigFromEnd:Ll,applyMultiplayerConfig:cd,handleRematchStart:$l}=sB({isMultiplayer:!0,isHost:y,gameCode:N,gameVariant:S,boardsParam:O,numBoards:Sn,maxPlayersParam:q,isPublicParam:I,authUser:a,isVerifiedUser:c,multiplayerGame:C,boards:$,setBoards:G,maxTurns:x,setMaxTurns:A,allowedSet:P,setAllowedSet:Q,setIsUnlimited:z,setIsLoading:R,setShowPopup:de,setCurrentGuess:D,setIsFlipping:st,revealId:fe,isFlipping:Ce,navigate:e,setTimedMessage:i,endingGameRef:ye,popupClosedRef:Ne,shouldShowPopupAfterFlipRef:Te,sendFriendRequest:l,cancelSentChallenge:d,maxMultiplayerBoards:D_.length,onGameCreated:ve,onGameJoined:Se}),{perBoardLetterMaps:ud,focusedLetterMap:hd,gridCols:xi,gridRows:bi}=QE($,W,Sn),is=B.length===bt&&P.size>0&&!P.has(B),Bl=p.useMemo(()=>$.filter(F=>F.isSolved).length,[$]),Ci=p.useMemo(()=>$.length>0&&$.every(F=>F.isSolved),[$]),Ar=p.useMemo(()=>at?at.variant==="solutionhunt"||at.solutionHunt===!0:!1,[at]);p.useEffect(()=>{!Ar||(at==null?void 0:at.status)!=="playing"||_.length>0||(async()=>{try{const{ANSWER_WORDS:F}=await or();k(F)}catch(F){console.error("Failed to load answer words for Solution Hunt:",F)}})()},[Ar,at==null?void 0:at.status,_.length]),p.useMemo(()=>{if(!Ar||_.length===0)return[];if($.length===0)return _;const F=$[0];if(!F||!F.guesses||F.guesses.length===0)return _;const we=F.guesses.map(et=>({word:et.word,colors:et.colors}));return XE(_,we)},[Ar,_,$]),p.useCallback(F=>{D(F.toLowerCase()),b(!1)},[]);const Rr=p.useCallback(()=>{if(Ci||Wt||se||ae||Ze!=null)return!0;if(typeof document<"u"){const F=document.activeElement;if(F&&F instanceof HTMLElement&&(F.tagName==="INPUT"||F.tagName==="TEXTAREA"||F.isContentEditable))return!0}return!!(C.gameState&&C.gameState.status!=="playing")},[Ci,Wt,se,ae,Ze,C.gameState]),No=F=>{B.length>=bt||(D(we=>we+F),s&&(r(""),o()))},Ul=()=>{B.length!==0&&(D(F=>F.slice(0,-1)),s&&(r(""),o()))},zl=async()=>{if(se||ae)return;const F=v.current;if(F.length!==bt){F.length>0&&D("");return}if(P.size>0&&!P.has(F)){i("Not in word list.",5e3),D("");return}if(C.gameState){const we=C.gameState,et=we.speedrun||!1,Rt=Array.isArray(we.solutions)&&we.solutions.length>0?we.solutions:we.solution?[we.solution]:[];if(Rt.length===0)return;const mn=we.players||{},Kn=a&&mn[a.uid],dt=Kn&&Kn.guesses||[];if(Rt.every(gn=>dt.includes(gn))||!et&&dt.length>=x){i("You have already finished!",2e3);return}const Cs=F;D(""),r(""),o();const Es=(gn,ny)=>Xu((gn||"").toLowerCase(),(ny||"").toLowerCase()).map(Oo=>Oo==="green"?2:Oo==="yellow"?1:0),Cd=Rt.length===1?[Es(Cs,Rt[0])]:Rt.map(gn=>Es(Cs,gn));try{qe(gn=>gn+1),st(!0),setTimeout(()=>{st(!1)},la),await C.submitGuess(N,Cs,Cd)}catch(gn){st(!1),i(gn.message||"Failed to submit guess",5e3),D(Cs)}return}};YE({disabled:Rr(),onEnter:zl,onBackspace:Ul,onLetter:No});const Nr=p.useCallback(()=>{N&&C.leaveGame(N),e("/")},[e,N,C]),dd=F=>{Rr()||(F==="ENTER"?zl():F==="BACK"?Ul():No(F))},bn=p.useCallback(async()=>{if(!N){e("/");return}try{await C.leaveGame(N),await d(N)}catch(F){i(F.message||"Failed to cancel challenge",5e3)}e("/")},[N,e,C,d,i]);p.useEffect(()=>()=>{N&&!y&&C.leaveGame(N)},[N,y,C.leaveGame]),p.useMemo(()=>$.map(F=>F.solution).filter(Boolean).map(F=>F.toUpperCase()).join("  "),[$]);const fd=p.useMemo(()=>aa($),[$]),pd=T?"":$.length>0&&!se&&!ae?`Guesses used: ${fd}/${x}${E?" (unlimited)":""}`:"",md=!1,gd=0,yd=0,vd=!1,wd=xi,Po=bi,Cn=p.useMemo(()=>!$||$.length===0?"Play Wuzzle Games!":"Play Wuzzle Games Multiplayer Mode!",[$]),{handleShare:_d,handleShareCode:Sd}=KE(Cn,i),Vl=p.useCallback(async F=>{if(N)try{await C.updateConfig(N,F),i("Room settings updated.",3e3)}catch(we){i(we.message||"Failed to update room settings",5e3)}},[N,C,i]),Wl=p.useCallback(async F=>{if(N)try{await C.setRoomName(N,F),i("Room name updated.",3e3)}catch(we){i(we.message||"Failed to update room name",5e3)}},[N,C,i]);return u.jsxs(u.Fragment,{children:[u.jsxs(Qc,{children:[u.jsx("title",{children:"Multiplayer Wordle-Style Battles  Game | Wuzzle Games"}),u.jsx("meta",{name:"description",content:"Play Wuzzle Games Multiplayer Mode, challenge friends with custom board counts and speedrun mode, and see who solves multi-board puzzles faster."})]}),u.jsx(JE,{message:s}),u.jsx(rB,{isOpen:Si,onRequestClose:()=>xn(!1),boardOptions:D_,boardsDraft:bs,onChangeBoardsDraft:F=>Ro(F),variantDraft:kr,onChangeVariantDraft:F=>ad(F),onSave:cd,isHost:at&&a&&at.players?((X=at.players[a.uid])==null?void 0:X.isHost)===!0:!1}),u.jsx(oB,{mode:"multiplayer",gameCode:N,authUser:a,authLoading:m,isVerifiedUser:c,multiplayerGame:C,isLoading:U,initialNumBoards:Ao,maxTurns:x,currentGuess:B,invalidCurrentGuess:is,revealId:fe,boardRefs:Me,boards:$,selectedBoardIndex:W,setSelectedBoardIndex:le,friendRequestSent:_i,onAddFriendRequest:Fl,onShareCode:Sd,onReady:ld,onStartGame:jl,onBack:Nr,onHomeClick:Nr,onOpenFeedback:()=>he(!0),onCancelChallenge:bn,onRematch:$l,setShowFeedbackModal:he,setTimedMessage:i,multiplayerNowMs:ze,waitingNowMs:We,onChangeMode:Ll,friends:h,onUpdateConfig:Vl,onUpdateRoomName:Wl,countdownRemaining:Ze,onInviteFriend:async F=>{if(!(!F||!F.id||!N))try{if(!await f(F.id,F.name,N,Ao,S)){i("A challenge with this friend is already pending. Accept or dismiss it before sending another.",5e3);return}i("Invite sent to friend.",3e3)}catch(we){i(we.message||"Failed to invite friend",5e3)}}}),se&&u.jsx(tT,{allSolved:Ci,boards:$,speedrunEnabled:T,stageElapsedMs:gd,popupTotalMs:yd,formatElapsed:Xs,solvedCount:Bl,mode:"multiplayer",marathonHasNext:md,onShare:_d,onClose:()=>{de(!1),Ne.current=!0},onNextStage:()=>{},freezeStageTimer:()=>0,isMarathonSpeedrun:vd,commitStageIfNeeded:()=>{},isMultiplayer:!0,multiplayerGameState:C.gameState,winner:C.gameState?C.gameState.winner:null,isPlayerHost:C.gameState&&a&&C.gameState.players?((xe=C.gameState.players[a.uid])==null?void 0:xe.isHost)===!0:!1,currentUserId:a?a.uid:null,onAddFriend:Fl,friendRequestSent:_i,friendIds:(h==null?void 0:h.map(F=>F.id))??[],onRematch:$l,onChangeMode:()=>{de(!1),Ne.current=!0,Ll()}}),u.jsx(p.Suspense,{fallback:null,children:u.jsx(aB,{isOpen:ie,onRequestClose:()=>he(!1)})}),at&&at.status==="playing"&&u.jsx(eT,{numBoards:Sn,showBoardSelector:ce,setShowBoardSelector:Ee,boards:$,selectedBoardIndex:W,setSelectedBoardIndex:le,boardRefs:Me,isUnlimited:!1,speedrunEnabled:T,statusText:pd}),at&&at.status==="playing"&&!Wt&&u.jsx("footer",{className:"keyboardFooter",children:u.jsx(nT,{numBoards:Sn,selectedBoardIndex:W,perBoardLetterMaps:ud,focusedLetterMap:hd,gridCols:wd,gridRows:Po,onVirtualKey:dd})})]})}const LB=Object.freeze(Object.defineProperty({__proto__:null,default:rT},Symbol.toStringTag,{value:"Module"})),iT={daily:{id:"daily",name:"Daily",route:"/game/daily",component:$c,supportsSpeedrun:!0,supportsBoards:!0,minBoards:1,maxBoards:32,persistence:"daily",isMultiplayer:!1,features:{speedrun:!0,multiBoard:!0,streaks:{minBoards:1,maxBoards:32},leaderboard:!0,sharing:!0,comments:!0,timer:!0,persistence:!0},seo:{title:"Daily Multi-Board Wordle-Style Game  Wuzzle Games",description:"Play Wuzzle Games daily multi-board Wordle-style puzzles with standard and speedrun options, tracking your guesses and scores across boards."}},marathon:{id:"marathon",name:"Marathon",route:"/game/marathon",component:$c,supportsSpeedrun:!0,supportsBoards:!1,minBoards:1,maxBoards:32,persistence:"marathon",isMultiplayer:!1,features:{speedrun:!0,multiBoard:!0,streaks:{minBoards:1,maxBoards:32},leaderboard:!0,sharing:!0,comments:!0,timer:!0,persistence:!0,stages:!0},seo:{title:"Marathon & Speedrun  Multi-Board Game | Wuzzle Games",description:"Play Wuzzle Games marathon and speedrun modes with multi-board Wordle-style puzzles, cumulative times and increasing difficulty across stages."}},multiplayer:{id:"multiplayer",name:"Multiplayer",route:"/game/multiplayer",component:rT,supportsSpeedrun:!0,supportsBoards:!0,minBoards:1,maxBoards:32,persistence:null,isMultiplayer:!0,features:{speedrun:!0,multiBoard:!0,streaks:!1,leaderboard:!1,sharing:!0,comments:!1,timer:!0,persistence:!1,chat:!0,friends:!0,rematch:!0},seo:{title:"Multiplayer Wordle-Style Battles  Game | Wuzzle Games",description:"Play Wuzzle Games Multiplayer Mode: host or join multiplayer rooms, challenge friends with custom board counts and speedrun mode, and see who solves multi-board puzzles faster."}},solutionhunt:{id:"solutionhunt",name:"Solution Hunt",route:"/game/solutionhunt",component:$c,supportsSpeedrun:!1,supportsBoards:!1,minBoards:1,maxBoards:1,persistence:"solutionhunt",isMultiplayer:!1,features:{speedrun:!1,multiBoard:!1,streaks:{minBoards:1,maxBoards:1},leaderboard:!1,sharing:!0,comments:!0,timer:!1,persistence:!0,solutionHint:!0},seo:{title:"Daily Solution Hunt  Word Puzzle Helper | Wuzzle Games",description:"Play Wuzzle Games Solution Hunt: a daily word puzzle that shows all possible remaining words based on your guesses. Perfect for learning and improving your strategy."}}};function Zg(t){return iT[t]||null}function lB(){return iT}function $B(t,e={}){const n=Zg(t),s=[];if(!n)return{isValid:!1,errors:["Invalid mode ID"]};if(e.boards!==void 0&&n.supportsBoards){const r=parseInt(e.boards,10);(!Number.isFinite(r)||r<n.minBoards||r>n.maxBoards)&&s.push(`Boards must be between ${n.minBoards} and ${n.maxBoards}`)}return e.speedrun!==void 0&&!n.supportsSpeedrun&&e.speedrun&&s.push("Speedrun mode is not supported for this game mode"),{isValid:s.length===0,errors:s}}function BB(t,e){const n=Zg(t);if(!n||!n.features)return!1;const s=n.features[e];return s===void 0?!1:s}function UB(t){const e=Zg(t);return(e==null?void 0:e.features)||{}}class cB extends rt.Component{constructor(n){super(n);os(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){this.setState({error:n,errorInfo:s})}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error,this.handleReset):u.jsx("div",{className:"error-boundary",children:u.jsxs("div",{className:"error-boundary-content",children:[u.jsx("h2",{children:"Something went wrong"}),u.jsx("p",{children:"We're sorry, but something unexpected happened."}),!1,u.jsxs("div",{className:"error-boundary-actions",children:[u.jsx("button",{type:"button",onClick:this.handleReset,className:"error-boundary-button",children:"Try again"}),u.jsx("button",{type:"button",onClick:()=>{const n="/better-wordle/".replace(/\/$/,"")||"";window.location.href=n?`${n}/`:"/"},className:"error-boundary-button error-boundary-button-secondary",children:"Go to home"})]})]})}):this.props.children}}function uB({children:t,fallback:e,onReset:n}){return u.jsx(cB,{fallback:e,onReset:n,children:t})}function hB(){const[t,e]=p.useState(()=>typeof navigator<"u"?navigator.onLine:!0),[n,s]=p.useState(0),r=p.useRef(t),i=p.useRef(0);return p.useEffect(()=>{r.current=t},[t]),p.useEffect(()=>{const o=()=>{e(!0),ys.processQueue()},a=()=>{e(!1)};window.addEventListener("online",o),window.addEventListener("offline",a);const l=setInterval(()=>{const c=ys.getQueueSize();r.current&&c===0&&i.current===0||(i.current=c,s(c))},1e3);return()=>{window.removeEventListener("online",o),window.removeEventListener("offline",a),clearInterval(l)}},[]),{isOnline:t,queueSize:n,hasQueuedUpdates:n>0}}const Ni=p.lazy(()=>Je(()=>import("./Game-DEMzHZeP.js"),__vite__mapDeps([8,1]))),dB=p.lazy(()=>Je(()=>import("./Profile-DSjTNZfS.js"),__vite__mapDeps([9,1,7,10]))),fB=p.lazy(()=>Je(()=>import("./AdvancedStats-D3mXytR_.js"),__vite__mapDeps([11,1,7,12]))),pB=p.lazy(()=>Je(()=>import("./Leaderboard-Dv7wMxhS.js"),__vite__mapDeps([13,1,14]))),mB=p.lazy(()=>Je(()=>import("./Faq-Dt1kWDNi.js"),__vite__mapDeps([15,1,16]))),gB=p.lazy(()=>Je(()=>import("./HowToPlay-DnaiNBXS.js"),__vite__mapDeps([17,1,18]))),yB=p.lazy(()=>Je(()=>import("./MultiplayerWordleLanding-CiHRZnAa.js"),__vite__mapDeps([19,1,20,21]))),vB=p.lazy(()=>Je(()=>import("./MultiBoardWordleLanding-Bqz_eYpP.js"),__vite__mapDeps([22,1,20,21]))),wB=p.lazy(()=>Je(()=>import("./WordleSpeedrunLanding-UsHpQYly.js"),__vite__mapDeps([23,1,20,21]))),_B=p.lazy(()=>Je(()=>import("./WordleMarathonLanding-B_gwpM5Y.js"),__vite__mapDeps([24,1,20,21]))),SB=[1,2,3,4];function xB(){const t=O_(),[e,n]=j_(),[s,r]=p.useState(1),{isOnline:i,queueSize:o,hasQueuedUpdates:a}=hB(),{user:l}=On();p.useEffect(()=>{const h=e.get("subscription");h==="success"?(n(d=>{const f=new URLSearchParams(d);return f.delete("subscription"),f}),console.log("Subscription successful! Premium features are now active."),l&&l.getIdTokenResult(!0).then(()=>{console.log("Auth token refreshed with latest custom claims")}).catch(d=>{console.error("Failed to refresh token:",d)})):h==="cancelled"&&(n(d=>{const f=new URLSearchParams(d);return f.delete("subscription"),f}),console.log("Subscription cancelled."))},[e,n,l]),p.useEffect(()=>{t.pathname==="/"&&r(1)},[t.pathname]),p.useEffect(()=>{typeof window<"u"&&window.matchMedia&&window.matchMedia("(max-width: 768px)").matches&&window.scrollTo({top:0,left:0,behavior:"auto"})},[t.pathname]);const c=p.useMemo(()=>SB,[]);return p.useMemo(()=>lB(),[]),u.jsxs(uB,{children:[!i&&u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,backgroundColor:"#f59e0b",color:"#ffffff",padding:"8px 16px",textAlign:"center",fontSize:"14px",fontWeight:"500",zIndex:1e4},children:["Offline - Changes will be saved when connection is restored",a&&` (${o} update${o!==1?"s":""} queued)`]}),i&&a&&u.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,backgroundColor:"#10b981",color:"#ffffff",padding:"8px 16px",textAlign:"center",fontSize:"14px",fontWeight:"500",zIndex:1e4},children:["Syncing ",o," update",o!==1?"s":"","..."]}),u.jsx(p.Suspense,{fallback:u.jsx("div",{className:"loadingContainer",children:"Loading"}),children:u.jsxs(yT,{children:[u.jsx(Ht,{path:"/",element:u.jsx(x3,{dailyBoards:s,setDailyBoards:r,marathonLevels:c})}),u.jsx(Ht,{path:"/game",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/game/:mode",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/game/:mode/:boards",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/game/:mode/:boards/:variant",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/game/multiplayer/:code",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/game/multiplayer/:code/:variant",element:u.jsx(Ni,{marathonLevels:c})}),u.jsx(Ht,{path:"/profile",element:u.jsx(dB,{})}),u.jsx(Ht,{path:"/stats",element:u.jsx(fB,{})}),u.jsx(Ht,{path:"/leaderboard",element:u.jsx(pB,{})}),u.jsx(Ht,{path:"/faq",element:u.jsx(mB,{})}),u.jsx(Ht,{path:"/how-to-play",element:u.jsx(gB,{})}),u.jsx(Ht,{path:"/multiplayer-wuzzle",element:u.jsx(yB,{})}),u.jsx(Ht,{path:"/multi-board-wuzzle",element:u.jsx(vB,{})}),u.jsx(Ht,{path:"/wuzzle-speedrun",element:u.jsx(wB,{})}),u.jsx(Ht,{path:"/wuzzle-marathon",element:u.jsx(_B,{})}),u.jsx(Ht,{path:"*",element:u.jsx(vT,{to:"/",replace:!0})})]})})]})}const bB=["/","/game","/leaderboard","/faq","/profile","/how-to-play","/stats","/multiplayer-wuzzle","/multi-board-wuzzle","/wuzzle-speedrun","/wuzzle-marathon"];function CB(t){var n,s,r,i,o,a;const e=[...((s=(n=t==null?void 0:t.meta)==null?void 0:n.toComponent)==null?void 0:s.call(n))||[],...((i=(r=t==null?void 0:t.link)==null?void 0:r.toComponent)==null?void 0:i.call(r))||[],...((a=(o=t==null?void 0:t.script)==null?void 0:o.toComponent)==null?void 0:a.call(o))||[]].flat().filter(Boolean);return new Set(e.map(l=>({type:l.type,props:l.props})))}async function zB(t){var i,o;const e=(t==null?void 0:t.url)||"/",n={},s=Dk(u.jsx(U0,{context:n,children:u.jsx(Mk,{location:e,basename:"/wuzzle-games",children:u.jsx(xB,{})})})),r=n.helmet;return{html:s,links:new Set(bB),head:{lang:"en",title:((o=(i=r==null?void 0:r.title)==null?void 0:i.toString)==null?void 0:o.call(i).replace(/<\/?title>/g,""))||"Wuzzle Games",elements:CB(r)}}}export{MB as A,DB as B,PB as C,x_ as D,UB as E,BB as F,JE as G,Qc as H,Jg as I,Bu as J,G2 as K,X2 as L,vs as M,xa as N,Q2 as O,OE as P,BE as Q,AB as R,Z2 as S,RB as T,xr as U,NB as V,U0 as W,xB as X,FB as Y,LB as Z,Je as _,Ia as a,id as b,Br as c,K as d,od as e,jB as f,Ye as g,Xs as h,qE as i,u as j,nB as k,kB as l,IB as m,Ym as n,Un as o,Ch as p,zB as prerender,ue as q,Z as r,Pt as s,jt as t,On as u,ff as v,zu as w,$B as x,OB as y,Zg as z};