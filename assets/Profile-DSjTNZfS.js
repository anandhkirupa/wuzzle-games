const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeedbackModal-DtP9FLlv.js","assets/prerender-BIIx8aII.js","assets/vendor-BsMbSbDn.js","prerender.css"])))=>i.map(i=>d[i]);
import{u as ne,b as se,I as Le,j as e,M as O,J as We,e as je,K as Ie,L as Oe,H as $e,c as Ye,N as ye,O as Ue,P as X,r as _e,d as be,g as He,Q as qe,R as Je,T as Ke,V as Qe,_ as Ze}from"./prerender-BIIx8aII.js";import{u as Se,r as n,c as Xe}from"./vendor-BsMbSbDn.js";import{loadGameRecords as et,calculateAdvancedStats as tt,formatTime as I}from"./statsService-CnGeUBvE.js";function at({isOpen:p,onRequestClose:j,mode:r,speedrunEnabled:N}){const R=Se(),{user:M}=ne(),{isSubscribed:S,loading:L,showSubscriptionGate:F}=se(M),[A,C]=n.useState(!1),[k,w]=n.useState([]);n.useEffect(()=>{if(!p)return;const s=Le();w(s)},[p,r,N]);const V=()=>{const s=r==="daily"?"Daily":"Marathon",u=N?"Speedrun":"Standard",i=r==="daily"?"1 board":"";return`${s} ${u}${i?" "+i:""}`},m=s=>{if(F){C(!0);return}const u=r,i=r==="daily"?1:null,d=N?"true":void 0;let o=`/game?mode=${u}`;i&&(o+=`&boards=${i}`),d&&(o+=`&speedrun=${d}`),o+=`&archiveDate=${s}`,j(),R(o)},t=()=>{C(!1),j()},l=F;return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .modalPanel--archive {
          max-height: 85vh;
          overflow-y: auto;
          overflow-x: hidden;
        }
        .modalPanel--archive::-webkit-scrollbar {
          width: 8px;
        }
        .modalPanel--archive::-webkit-scrollbar-track {
          background: #372F41;
          border-radius: 4px;
        }
        .modalPanel--archive::-webkit-scrollbar-thumb {
          background: #3A3A3C;
          border-radius: 4px;
        }
        .modalPanel--archive::-webkit-scrollbar-thumb:hover {
          background: #565758;
        }
      `}),e.jsx(O,{isOpen:p,onRequestClose:t,titleId:"archive-modal-title",zIndex:3e3,panelClassName:"modalPanel--wide modalPanel--archive",children:e.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:20,padding:"28px 24px 24px",maxWidth:640,width:"100%",boxSizing:"border-box",boxShadow:"0 25px 70px rgba(0,0,0,0.9)",border:"1px solid #3A3A3C"},children:[e.jsxs("div",{style:{marginBottom:24,textAlign:"center",flexShrink:0},children:[e.jsxs("h2",{id:"archive-modal-title",style:{margin:0,marginBottom:6,fontSize:22,fontWeight:"bold",color:"#ffffff",letterSpacing:.5},children:[V()," Archive"]}),e.jsx("p",{style:{margin:0,fontSize:13,color:"#9ca3af",lineHeight:1.4},children:L?"Loading...":S?"Select a date to play that day's game":"Subscribe to unlock archive access"}),l&&e.jsx("button",{type:"button",onClick:()=>C(!0),style:{marginTop:16,padding:"12px 24px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #e56b6f 0%, #d55a5e 100%)",color:"#ffffff",fontSize:14,fontWeight:"600",cursor:"pointer",letterSpacing:.5,textTransform:"uppercase",transition:"all 0.2s ease"},onMouseEnter:s=>{s.currentTarget.style.opacity="0.95",s.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:s=>{s.currentTarget.style.opacity="1",s.currentTarget.style.transform="translateY(0)"},children:"Subscribe to unlock"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(120px, 1fr))",gap:12,marginBottom:24},children:k.map(s=>e.jsxs("button",{onClick:()=>m(s),style:{padding:"16px 12px",borderRadius:14,border:l?"2px solid #3A3A3C":"2px solid #50a339",background:l?"linear-gradient(135deg, #372F41 0%, #372F41 100%)":"linear-gradient(135deg, rgba(80, 163, 57, 0.15) 0%, rgba(80, 163, 57, 0.05) 100%)",color:l?"#9ca3af":"#ffffff",fontSize:13,fontWeight:"600",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:8,transition:"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)",opacity:l?.7:1,position:"relative",overflow:"hidden"},onMouseEnter:u=>{l||(u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 8px 20px rgba(80, 163, 57, 0.3)",u.currentTarget.style.borderColor="#50a339",u.currentTarget.style.background="linear-gradient(135deg, rgba(80, 163, 57, 0.25) 0%, rgba(80, 163, 57, 0.1) 100%)")},onMouseLeave:u=>{l||(u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="none",u.currentTarget.style.borderColor="#50a339",u.currentTarget.style.background="linear-gradient(135deg, rgba(80, 163, 57, 0.15) 0%, rgba(80, 163, 57, 0.05) 100%)")},children:[l&&e.jsx("div",{style:{fontSize:24,marginBottom:4,lineHeight:1},children:"ðŸ”’"}),!l&&e.jsx("div",{style:{width:32,height:32,borderRadius:"50%",backgroundColor:"rgba(80, 163, 57, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:4},children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"#50a339",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("div",{style:{fontSize:13,fontWeight:"600",lineHeight:1.4,textAlign:"center"},children:We(s)})]},s))}),e.jsx("div",{style:{display:"flex",justifyContent:"center",paddingTop:16,borderTop:"1px solid #3A3A3C"},children:e.jsx("button",{type:"button",onClick:t,style:{padding:"14px 32px",borderRadius:12,border:"2px solid #3A3A3C",background:"transparent",color:"#d7dadc",fontSize:14,fontWeight:"600",cursor:"pointer",letterSpacing:.5,textTransform:"uppercase",transition:"all 0.2s ease"},onMouseEnter:s=>{s.currentTarget.style.borderColor="#565758",s.currentTarget.style.color="#ffffff",s.currentTarget.style.background="rgba(58, 58, 60, 0.3)"},onMouseLeave:s=>{s.currentTarget.style.borderColor="#3a3a3c",s.currentTarget.style.color="#d7dadc",s.currentTarget.style.background="transparent"},children:"Close"})})]})}),e.jsx(je,{isOpen:A,onRequestClose:()=>C(!1),onSubscriptionComplete:()=>{C(!1)}})]})}function rt({isOpen:p,onRequestClose:j}){const{user:r}=ne(),{showSubscriptionGate:N}=se(r),[R,M]=n.useState(!1),[S,L]=n.useState(null),[F,A]=n.useState(!0),[C,k]=n.useState(null),w=[{mode:"daily",speedrunEnabled:!1,label:"Daily Standard"},{mode:"daily",speedrunEnabled:!0,label:"Daily Speedrun"},{mode:"marathon",speedrunEnabled:!1,label:"Marathon Standard"},{mode:"marathon",speedrunEnabled:!0,label:"Marathon Speedrun"}];n.useEffect(()=>{p&&r?V():p&&!r&&(k("You must be signed in to view cross-mode comparisons."),A(!1))},[p,r]);const V=async()=>{try{A(!0),k(null);const t={};for(const{mode:l,speedrunEnabled:s,label:u}of w){const i=await et({uid:r.uid,mode:l,speedrunEnabled:s});if(i!==null){const d=tt(i);t[u]={...d,mode:l,speedrunEnabled:s,gameRecords:i}}else t[u]={mode:l,speedrunEnabled:s,solvedGames:0,totalGames:0}}L(t),A(!1)}catch(t){console.error("Failed to load comparison data:",t),k("Failed to load comparison data."),A(!1)}},m=({label:t,getValue:l,formatValue:s=d=>d,showBest:u=!1,showWorst:i=!1})=>{if(!S)return null;const d={};let o=null,z=null,T=null,G=null;return w.forEach(({label:x})=>{const b=S[x];if(b&&b.solvedGames>0)try{const h=l(b);if(d[x]=h,h!=null){const y=typeof h=="object"&&h!==null?h.count:h;if(typeof y=="number"&&!isNaN(y)){const $=typeof o=="object"&&o!==null?o.count:o,D=typeof T=="object"&&T!==null?T.count:T;u?(o===null||y<$)&&(o=h,z=x):i?(T===null||y>D)&&(T=h,G=x):(o===null||y>$)&&(o=h,z=x)}}}catch{d[x]=null}else d[x]=null}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px repeat(4, 1fr)",gap:12,padding:"12px 16px",borderBottom:"1px solid #3A3A3C",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:13,fontWeight:"600",color:"#d7dadc"},children:t}),w.map(({label:x})=>{const b=d[x],h=u&&z===x&&b!==null,y=i&&G===x&&b!==null;return e.jsx("div",{style:{fontSize:14,color:b===null?"#818384":h?"#50a339":y?"#B1A04C":"#d7dadc",fontWeight:h||y?"bold":"normal",textAlign:"center",padding:"4px 8px",borderRadius:6,background:h?"rgba(80, 163, 57, 0.15)":y?"rgba(177, 160, 76, 0.15)":"transparent"},children:b===null?"N/A":s(b)},x)})]})};return p?N?e.jsxs(e.Fragment,{children:[e.jsx(O,{isOpen:p,onRequestClose:j,titleId:"cross-mode-modal-title",zIndex:3e3,children:e.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:20,padding:"40px 32px",maxWidth:600,width:"92vw",boxShadow:"0 25px 70px rgba(0,0,0,0.9)",border:"1px solid #3A3A3C",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:48,marginBottom:16},children:"ðŸ”’"}),e.jsx("h2",{id:"cross-mode-modal-title",style:{margin:0,marginBottom:16,fontSize:24,fontWeight:"bold",color:"#ffffff"},children:"Premium Feature"}),e.jsx("p",{style:{fontSize:14,color:"#9ca3af",marginBottom:24,lineHeight:1.6},children:"Cross-mode comparisons are available for premium members only. Subscribe to unlock this feature and compare your performance across all game modes."}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>M(!0),style:{padding:"14px 32px",borderRadius:12,border:"none",background:"linear-gradient(135deg, #e56b6f 0%, #d55a5e 100%)",color:"#ffffff",fontSize:14,fontWeight:"600",cursor:"pointer",letterSpacing:.5,textTransform:"uppercase",transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.opacity=.9,t.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:t=>{t.currentTarget.style.opacity=1,t.currentTarget.style.transform="translateY(0)"},children:"Subscribe"}),e.jsx("button",{onClick:j,style:{padding:"14px 32px",borderRadius:12,border:"2px solid #3A3A3C",background:"transparent",color:"#d7dadc",fontSize:14,fontWeight:"600",cursor:"pointer",letterSpacing:.5,textTransform:"uppercase",transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.borderColor="#565758",t.currentTarget.style.color="#ffffff"},onMouseLeave:t=>{t.currentTarget.style.borderColor="#3A3A3C",t.currentTarget.style.color="#d7dadc"},children:"Close"})]})]})}),e.jsx(je,{isOpen:R,onRequestClose:()=>M(!1),onSubscriptionComplete:()=>{M(!1)}})]}):e.jsx(e.Fragment,{children:e.jsx(O,{isOpen:p,onRequestClose:j,titleId:"cross-mode-comparison-title",zIndex:3e3,children:e.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:20,padding:"40px 32px",maxWidth:1e3,width:"95vw",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 25px 70px rgba(0,0,0,0.9)",border:"1px solid #3A3A3C"},children:[e.jsxs("div",{style:{marginBottom:32,textAlign:"center"},children:[e.jsx("h2",{id:"cross-mode-comparison-title",style:{margin:0,marginBottom:8,fontSize:28,fontWeight:"bold",color:"#ffffff",letterSpacing:.5},children:"Cross-Mode Comparison"}),e.jsx("div",{style:{fontSize:14,color:"#9ca3af",marginTop:8},children:"Compare your performance across all game modes"})]}),F&&e.jsx("div",{style:{textAlign:"center",padding:"40px 20px",color:"#9ca3af"},children:"Loading comparison data..."}),C&&e.jsx("div",{style:{padding:"16px 20px",borderRadius:12,backgroundColor:"rgba(220, 38, 38, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",color:"#f87171",marginBottom:24,textAlign:"center"},children:C}),!F&&!C&&S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"200px repeat(4, 1fr)",gap:12,padding:"16px",backgroundColor:"#372F41",borderRadius:12,marginBottom:16,border:"1px solid #3A3A3C"},children:[e.jsx("div",{style:{fontSize:14,fontWeight:"bold",color:"#ffffff",textTransform:"uppercase",letterSpacing:.5},children:"Metric"}),w.map(({label:t})=>e.jsx("div",{style:{fontSize:13,fontWeight:"600",color:"#d7dadc",textAlign:"center"},children:t},t))]}),e.jsxs("div",{style:{backgroundColor:"#372F41",borderRadius:12,border:"1px solid #3A3A3C",overflow:"hidden",marginBottom:32},children:[e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("div",{style:{fontSize:16,fontWeight:"bold",color:"#ffffff",marginBottom:12,padding:"0 16px"},children:"Basic Statistics"}),e.jsx(m,{label:"Total Games",getValue:t=>t.totalGames}),e.jsx(m,{label:"Games Solved",getValue:t=>t.solvedGames}),e.jsx(m,{label:"Win Rate",getValue:t=>t.winRate,formatValue:t=>`${t.toFixed(1)}%`,showBest:!1})]}),e.jsxs("div",{style:{padding:"16px 0",borderTop:"1px solid #3A3A3C"},children:[e.jsx("div",{style:{fontSize:16,fontWeight:"bold",color:"#ffffff",marginBottom:12,padding:"0 16px"},children:"Performance Metrics"}),e.jsx(m,{label:"Average Guesses",getValue:t=>t.averageGuesses,formatValue:t=>t.toFixed(2),showBest:!0}),e.jsx(m,{label:"Median Guesses",getValue:t=>t.medianGuesses,showBest:!0}),e.jsx(m,{label:"Best Performance",getValue:t=>t.bestPerformance,formatValue:t=>t!==null?`${t} guess${t===1?"":"es"}`:"N/A",showBest:!0}),e.jsx(m,{label:"Worst Performance",getValue:t=>t.worstPerformance,formatValue:t=>t!==null?`${t} guesses`:"N/A",showWorst:!0}),e.jsx(m,{label:"Perfect Games",getValue:t=>{if(t.solvedGames>0){const l=t.perfectGamesPercentage||0;return{count:t.perfectGames,percentage:l}}return null},formatValue:t=>t===null?"N/A":`${t.count} (${t.percentage.toFixed(1)}%)`,showBest:!1}),e.jsx(m,{label:"Solved in â‰¤3 Guesses",getValue:t=>{if(t.solvedGames>0){const l=t.gamesSolvedIn3OrFewerPercentage||0;return{count:t.gamesSolvedIn3OrFewer,percentage:l}}return null},formatValue:t=>t===null?"N/A":`${t.count} (${t.percentage.toFixed(1)}%)`,showBest:!1}),e.jsx(m,{label:"Solved in â‰¤4 Guesses",getValue:t=>{if(t.solvedGames>0){const l=t.gamesSolvedIn4OrFewerPercentage||0;return{count:t.gamesSolvedIn4OrFewer,percentage:l}}return null},formatValue:t=>t===null?"N/A":`${t.count} (${t.percentage.toFixed(1)}%)`,showBest:!1})]}),e.jsxs("div",{style:{padding:"16px 0",borderTop:"1px solid #3A3A3C"},children:[e.jsx("div",{style:{fontSize:16,fontWeight:"bold",color:"#ffffff",marginBottom:12,padding:"0 16px"},children:"Time-Based Statistics (Speedrun Modes)"}),e.jsx(m,{label:"Average Solve Time",getValue:t=>t.speedrunEnabled&&t.averageTimeMs!==null?t.averageTimeMs:null,formatValue:t=>t!==null?I(t):"N/A",showBest:!0}),e.jsx(m,{label:"Median Solve Time",getValue:t=>t.speedrunEnabled&&t.medianTimeMs!==null?t.medianTimeMs:null,formatValue:t=>t!==null?I(t):"N/A",showBest:!0}),e.jsx(m,{label:"Fastest Solve",getValue:t=>t.speedrunEnabled&&t.fastestTimeMs!==null?t.fastestTimeMs:null,formatValue:t=>t!==null?I(t):"N/A",showBest:!0}),e.jsx(m,{label:"Slowest Solve",getValue:t=>t.speedrunEnabled&&t.slowestTimeMs!==null?t.slowestTimeMs:null,formatValue:t=>t!==null?I(t):"N/A",showWorst:!0}),e.jsx(m,{label:"Avg Time per Guess",getValue:t=>t.speedrunEnabled&&t.averageTimePerGuess!==null?t.averageTimePerGuess:null,formatValue:t=>t!==null?I(t):"N/A",showBest:!0})]})]}),S&&Object.values(S).some(t=>t&&t.solvedGames>0)&&e.jsxs("div",{style:{padding:"20px",backgroundColor:"#372F41",borderRadius:12,border:"1px solid #3A3A3C",marginBottom:24},children:[e.jsx("h3",{style:{fontSize:16,fontWeight:"bold",color:"#ffffff",marginBottom:12},children:"Performance Insights"}),e.jsx("div",{style:{fontSize:13,color:"#d7dadc",lineHeight:1.8},children:(()=>{const t=Object.entries(S).filter(([i,d])=>d&&d.solvedGames>0).map(([i,d])=>({label:i,...d}));if(t.length===0)return null;const l=t.reduce((i,d)=>!i||d.averageGuesses<i.averageGuesses?d:i,null),s=t.reduce((i,d)=>!i||d.totalGames>i.totalGames?d:i,null),u=t.reduce((i,d)=>!i||d.winRate>i.winRate?d:i,null);return e.jsxs(e.Fragment,{children:[l&&e.jsxs("div",{children:["ðŸ† ",e.jsx("strong",{children:"Best Performance:"})," ",l.label," with ",l.averageGuesses.toFixed(2)," average guesses"]}),s&&e.jsxs("div",{children:["ðŸ“Š ",e.jsx("strong",{children:"Most Active:"})," ",s.label," with ",s.totalGames," total games"]}),u&&e.jsxs("div",{children:["âœ… ",e.jsx("strong",{children:"Highest Win Rate:"})," ",u.label," with ",u.winRate.toFixed(1),"%"]})]})})()})]}),Object.values(S).every(t=>!t||t.solvedGames===0)&&e.jsx("div",{style:{padding:"24px",textAlign:"center",color:"#9ca3af",fontSize:14},children:"No comparison data available yet. Complete games in multiple modes to see comparisons!"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:12,paddingTop:24,borderTop:"1px solid #3A3A3C",marginTop:32},children:e.jsx("button",{onClick:j,style:{padding:"14px 32px",borderRadius:12,border:"2px solid #3A3A3C",background:"transparent",color:"#d7dadc",fontSize:14,fontWeight:"600",cursor:"pointer",letterSpacing:.5,textTransform:"uppercase",transition:"all 0.2s ease"},onMouseEnter:t=>{t.currentTarget.style.borderColor="#565758",t.currentTarget.style.color="#ffffff",t.currentTarget.style.background="rgba(58, 58, 60, 0.3)"},onMouseLeave:t=>{t.currentTarget.style.borderColor="#3A3A3C",t.currentTarget.style.color="#d7dadc",t.currentTarget.style.background="transparent"},children:"Close"})})]})})}):null}const nt=n.lazy(()=>Ze(()=>import("./FeedbackModal-DtP9FLlv.js"),__vite__mapDeps([0,1,2,3])));function it(){var pe,me,ge,he;const p=Se(),j=Xe(),{user:r,loading:N,updateUsername:R,deleteAccount:M,isVerifiedUser:S,resendVerificationEmail:L,linkGoogleAccount:F,linkGoogleJustCompleted:A,clearLinkGoogleJustCompleted:C,formatAuthErrorForDisplay:k}=ne(),[w,V]=n.useState(""),[m,t]=n.useState(""),[l,s]=n.useState(!1),[u,i]=n.useState(!1),[d,o]=n.useState(""),[z,T]=n.useState(!1),[G,x]=n.useState(!1),[b,h]=n.useState(0),[y,$]=n.useState(0),[D,le]=n.useState(!1),[v,Y]=n.useState(null),[ee,oe]=n.useState(null),[ve,Ce]=n.useState(0),[te,W]=n.useState({isOpen:!1,mode:null,speedrunEnabled:!1}),[we,ie]=n.useState(!1),{userBadges:ke,loading:Be}=Ie(r),ae=Oe(ke),{isSubscribed:Ne}=se(r),[f,re]=n.useState(null),[U,de]=n.useState(!1),[ce,P]=n.useState(null),[_,ue]=n.useState(!1),[H,fe]=n.useState(!1),[E,q]=n.useState(null),[Ae,J]=n.useState(!1);n.useEffect(()=>{if(!N&&!r){p("/");return}if(r){const a=r.displayName||"";V(a),t(a)}},[r,N,p]),n.useEffect(()=>{var c;if(!((c=j.state)!=null&&c.openYourBadges))return;const a=document.getElementById("profile-your-badges");a&&a instanceof HTMLDetailsElement&&(a.setAttribute("open",""),a.scrollIntoView({behavior:"smooth",block:"start"})),p(j.pathname,{replace:!0,state:{}})},[(pe=j.state)==null?void 0:pe.openYourBadges,j.pathname,p]),n.useEffect(()=>{A&&(o("Google account linked successfully!"),C())},[A,C]),n.useEffect(()=>{if(b<=0)return;const a=()=>{const g=Math.ceil((b-Date.now())/1e3);$(Math.max(0,g))};a();const c=setInterval(a,1e3);return()=>clearInterval(c)},[b]),n.useEffect(()=>{let a=!0;oe(null);async function c(){try{const g={dailyStandard:X("daily",!1),dailySpeedrun:X("daily",!0),marathonStandard:X("marathon",!1),marathonSpeedrun:X("marathon",!0)};if(!r){Y(g);return}const Pe=_e(be,`users/${r.uid}/streaks`),xe=await He(Pe);if(!xe.exists()){try{await qe(r,be)}catch{}Y(g);return}const K=xe.val()||{},Q={dailyStandard:K.daily_standard||g.dailyStandard,dailySpeedrun:K.daily_speedrun||g.dailySpeedrun,marathonStandard:K.marathon_standard||g.marathonStandard,marathonSpeedrun:K.marathon_speedrun||g.marathonSpeedrun},Z=B=>({current:Math.max(0,Number(B==null?void 0:B.current))||0,best:Math.max(0,Number(B==null?void 0:B.best))||0,lastDate:(B==null?void 0:B.lastDate)??null}),Re={dailyStandard:Z(Q.dailyStandard),dailySpeedrun:Z(Q.dailySpeedrun),marathonStandard:Z(Q.marathonStandard),marathonSpeedrun:Z(Q.marathonSpeedrun)};Y(Re)}catch(g){console.error("Failed to load streaks in profile",g),a&&(Y(null),oe((g==null?void 0:g.message)||"Failed to load streaks."))}}return c(),()=>{a=!1}},[r,ve]);const Te=async()=>{if(!w.trim()){o("Username cannot be empty");return}s(!0),o("");try{await R(w),t(w),o("Username updated successfully!")}catch(a){o(`Error: ${k(a)}`)}finally{s(!1)}},Ee=()=>{V(m),o("")},ze=async()=>{if(!r||S)return;const a=Date.now();if(!(a<b)){x(!0),o("");try{await L(),o("Verification email sent. Please check your inbox (and spam folder)."),h(a+3e4)}catch(c){o(`Error: ${k(c)}`)}finally{x(!1)}}},Me=async()=>{if(r){T(!0),o("");try{await F(j.pathname||"/profile")}catch(a){T(!1),a.code==="auth/credential-already-in-use"||a.code==="auth/provider-already-linked"?o("Google account is already linked."):o(`Error: ${k(a)}`)}}},Fe=async()=>{if(!(!r||!window.confirm("Are you sure you want to delete your account? This will remove your friends and challenges and you will lose access to your synced progress."))){le(!0),o("");try{await M(),o("Your account has been deleted."),p("/")}catch(c){o(`Error: ${k(c)}`)}finally{le(!1)}}},Ve=async()=>{if(!(!(r!=null&&r.uid)||f!==null||U)){de(!0),P(null);try{const c=await Je()({uid:r.uid});re((c==null?void 0:c.data)??null)}catch(a){P((a==null?void 0:a.message)||"Failed to load subscription details.")}finally{de(!1)}}},Ge=async a=>{if(!(!(r!=null&&r.uid)||(f==null?void 0:f.type)!=="stripe")){ue(!0),P(null);try{await Ke()({uid:r.uid,cancelAtPeriodEnd:a}),re(g=>g&&g.type==="stripe"?{...g,cancelAtPeriodEnd:a}:g),o(a?"Auto-renew turned off.":"Auto-renew turned on.")}catch(c){P((c==null?void 0:c.message)||"Failed to update auto-renew.")}finally{ue(!1)}}},De=async()=>{if(!(!(r!=null&&r.uid)||(f==null?void 0:f.type)!=="stripe")){fe(!0),P(null);try{await Qe()({uid:r.uid}),re(c=>c&&c.type==="stripe"?{...c,cancelAtPeriodEnd:!0}:c),o("Subscription will not renew. You keep access until the end of the period.")}catch(a){P((a==null?void 0:a.message)||"Failed to cancel subscription.")}finally{fe(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs($e,{children:[e.jsx("title",{children:"Profile & Friends â€“ Wuzzle Games"}),e.jsx("meta",{name:"description",content:"Manage your Wuzzle Games profile, username, account security and linked Google account so your Wordle-style progress and Multiplayer Mode games stay in sync."})]}),e.jsx("div",{className:"profileRoot",children:e.jsxs("div",{className:"profileContainer",children:[N?e.jsx("div",{className:"profileLoading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{onOpenFeedback:()=>i(!0)}),e.jsxs("div",{className:"profileContent",children:[e.jsx("h1",{className:"profileTitle",children:"Profile"}),e.jsxs("div",{className:"profileCard",children:[e.jsxs("div",{className:"profileSection",children:[e.jsx("h2",{children:"User Information"}),e.jsxs("div",{className:"profileField",children:[e.jsxs("label",{children:["Email",e.jsxs("span",{className:"profileEmailStatus",children:["(",S?"verified":"unverified",")"]})]}),e.jsx("div",{className:"profileValue",children:(r==null?void 0:r.email)||"N/A"})]}),e.jsxs("div",{className:"profileField",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",type:"text",value:w,onChange:a=>V(a.target.value),className:"profileInput",placeholder:"Enter your username"})]}),d&&e.jsx("div",{className:`profileMessage ${d.startsWith("Error")?"error":"success"}`,children:d}),w!==m&&e.jsxs("div",{className:"profileActions",children:[e.jsx("button",{onClick:Te,disabled:l,className:"profileBtn homeBtn homeBtnGreen homeBtnLg",style:{opacity:l?.8:1,cursor:l?"not-allowed":"pointer"},children:l?"Saving...":"Save Changes"}),e.jsx("button",{onClick:Ee,disabled:l,className:"profileBtn homeBtn homeBtnOutline homeBtnLg",style:{opacity:l?.8:1,cursor:l?"not-allowed":"pointer"},children:"Cancel"})]})]}),!Be&&e.jsxs("div",{className:"profileSection profileSectionSpacing",children:[e.jsxs("details",{id:"profile-your-badges",className:"profileDetails",children:[e.jsx("summary",{className:"profileDetailsSummary",children:"Your badges"}),e.jsx("div",{className:"profileBadgesList",children:ae.length===0?e.jsx("p",{className:"profileBadgesEmpty",children:"You haven't earned any badges yet."}):ae.map(a=>e.jsxs("div",{className:"profileBadgeCard profileBadgeCardEarned",children:[e.jsx(ye,{badge:a,profileCard:!0}),e.jsxs("div",{className:"profileBadgeCardContent",children:[e.jsx("div",{className:"profileBadgeName",children:a.name}),e.jsx("div",{className:"profileBadgeDesc",children:a.description})]})]},a.id))})]}),e.jsxs("details",{className:"profileDetails",children:[e.jsx("summary",{className:"profileDetailsSummary",children:"All badges"}),e.jsx("div",{className:"profileBadgesList",children:Ue.map(a=>{const c=ae.some(g=>g.id===a.id);return e.jsxs("div",{className:`profileBadgeCard ${c?"profileBadgeCardEarned":"profileBadgeCardLocked"}`,children:[e.jsx(ye,{badge:a,profileCard:!0}),e.jsxs("div",{className:"profileBadgeCardContent",children:[e.jsxs("div",{className:"profileBadgeName",children:[a.name,c&&e.jsx("span",{className:"profileBadgeEarnedLabel",children:" Â· Earned"})]}),e.jsx("div",{className:"profileBadgeDesc",children:a.description})]})]},a.id)})})]})]}),(v||ee)&&e.jsxs("div",{className:"profileSection profileSectionSpacing",children:[e.jsx("h2",{children:"Game streaks"}),ee?e.jsxs("div",{className:"profileField",children:[e.jsx("div",{style:{color:"#f87171",fontSize:14,marginBottom:8},children:ee}),e.jsx("button",{type:"button",onClick:()=>Ce(a=>a+1),className:"homeBtn homeBtnOutline homeBtnLg",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"profileField",children:e.jsx("label",{style:{fontSize:12,color:"#9ca3af"},children:"Streaks are tied to your account and sync across devices once you're signed in."})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxs("div",{className:"streakCard",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"streakLabel",children:"Daily Standard"}),e.jsxs("div",{className:"streakCurrent",children:[v.dailyStandard.current," day",v.dailyStandard.current===1?"":"s"]}),e.jsxs("div",{className:"streakBest",children:["Best: ",v.dailyStandard.best]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"button",onClick:()=>W({isOpen:!0,mode:"daily",speedrunEnabled:!1}),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Archive"}),e.jsx("button",{type:"button",onClick:()=>p("/stats?mode=daily&speedrun=false"),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Advanced Stats"})]})]}),e.jsxs("div",{className:"streakCard",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"streakLabel",children:"Daily Speedrun"}),e.jsxs("div",{className:"streakCurrent",children:[v.dailySpeedrun.current," day",v.dailySpeedrun.current===1?"":"s"]}),e.jsxs("div",{className:"streakBest",children:["Best: ",v.dailySpeedrun.best]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"button",onClick:()=>W({isOpen:!0,mode:"daily",speedrunEnabled:!0}),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Archive"}),e.jsx("button",{type:"button",onClick:()=>p("/stats?mode=daily&speedrun=true"),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Advanced Stats"})]})]}),e.jsxs("div",{className:"streakCard",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"streakLabel",children:"Marathon Standard"}),e.jsxs("div",{className:"streakCurrent",children:[v.marathonStandard.current," day",v.marathonStandard.current===1?"":"s"]}),e.jsxs("div",{className:"streakBest",children:["Best: ",v.marathonStandard.best]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"button",onClick:()=>W({isOpen:!0,mode:"marathon",speedrunEnabled:!1}),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Archive"}),e.jsx("button",{type:"button",onClick:()=>p("/stats?mode=marathon&speedrun=false"),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Advanced Stats"})]})]}),e.jsxs("div",{className:"streakCard",style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8},children:e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{className:"streakLabel",children:"Marathon Speedrun"}),e.jsxs("div",{className:"streakCurrent",children:[v.marathonSpeedrun.current," day",v.marathonSpeedrun.current===1?"":"s"]}),e.jsxs("div",{className:"streakBest",children:["Best: ",v.marathonSpeedrun.best]})]})}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"button",onClick:()=>W({isOpen:!0,mode:"marathon",speedrunEnabled:!0}),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Archive"}),e.jsx("button",{type:"button",onClick:()=>p("/stats?mode=marathon&speedrun=true"),className:"homeBtn homeBtnOutline",style:{flex:1,padding:"8px 12px",fontSize:12},children:"View Advanced Stats"})]})]})]}),e.jsxs("div",{style:{marginTop:24,paddingTop:24,borderTop:"1px solid #3A3A3C"},children:[e.jsx("button",{type:"button",onClick:()=>ie(!0),className:"homeBtn homeBtnGreen",style:{width:"100%",padding:"12px 16px",fontSize:14,fontWeight:"600"},children:"View Cross-Mode Comparison"}),e.jsx("div",{style:{fontSize:12,color:"#9ca3af",marginTop:8,textAlign:"center"},children:"Compare your performance across all game modes (Premium)"})]})]})]}),Ne&&e.jsx("div",{className:"profileSection profileSectionSpacing",children:e.jsxs("details",{className:"profileDetails",onToggle:a=>{a.target.open&&Ve()},children:[e.jsx("summary",{className:"profileDetailsSummary",children:"Manage premium"}),e.jsxs("div",{className:"profileBadgesList",style:{paddingTop:12},children:[U&&e.jsx("p",{className:"profileBadgesEmpty",children:"Loading subscription details..."}),ce&&e.jsx("div",{style:{color:"#f87171",fontSize:14,marginBottom:12},children:ce}),!U&&(f==null?void 0:f.type)==="stripe"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"profileField",style:{marginBottom:12},children:[e.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Plan"}),e.jsx("div",{className:"profileValue",style:{marginTop:4},children:f.intervalLabel||"Recurring"})]}),e.jsxs("div",{className:"profileField",style:{marginBottom:12},children:[e.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Days remaining until renewal"}),e.jsxs("div",{className:"profileValue",style:{marginTop:4},children:[f.daysRemaining??0," days"]})]}),e.jsxs("div",{className:"profileField",style:{marginBottom:12},children:[e.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Auto-renew"}),e.jsxs("div",{className:"profileValue profileInlineField",style:{marginTop:4},children:[e.jsx("span",{style:{marginRight:12},children:f.cancelAtPeriodEnd?"Off":"On"}),e.jsx("button",{type:"button",onClick:()=>q({newCancelAtPeriodEnd:!f.cancelAtPeriodEnd}),disabled:_,className:"homeBtn homeBtnOutline profileInlineButton",style:{padding:"6px 12px",fontSize:13,cursor:_?"not-allowed":"pointer",opacity:_?.8:1},children:_?"...":f.cancelAtPeriodEnd?"Turn on auto-renew":"Turn off auto-renew"})]})]}),!f.cancelAtPeriodEnd&&e.jsx("div",{className:"profileField",style:{marginBottom:12},children:e.jsx("button",{type:"button",onClick:()=>J(!0),disabled:H,className:"homeBtn homeBtnOutline",style:{padding:"10px 16px",fontSize:14,color:"#f87171",borderColor:"#f87171",cursor:H?"not-allowed":"pointer",opacity:H?.8:1},children:H?"...":"Cancel subscription"})})]}),!U&&(f==null?void 0:f.type)==="gift"&&e.jsxs(e.Fragment,{children:[f.currentPeriodEnd&&e.jsxs("div",{className:"profileField",style:{marginBottom:12},children:[e.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Premium until"}),e.jsx("div",{className:"profileValue",style:{marginTop:4},children:new Date(f.currentPeriodEnd*1e3).toLocaleDateString()})]}),e.jsxs("div",{className:"profileField",style:{marginBottom:12},children:[e.jsx("label",{style:{color:"#9ca3af",fontSize:12},children:"Days remaining"}),e.jsxs("div",{className:"profileValue",style:{marginTop:4},children:[f.daysRemaining??0," days"]})]}),e.jsx("div",{style:{fontSize:13,color:"#9ca3af"},children:"This is a gift subscription; it will not renew."})]})]})]})}),e.jsxs("div",{className:"profileSection profileSectionSpacing",children:[e.jsx("h2",{children:"Account Security"}),!S&&r&&((me=r.providerData)==null?void 0:me.some(a=>a.providerId==="password"))&&e.jsxs("div",{className:"profileField",children:[e.jsx("label",{children:"Email verification"}),e.jsxs("div",{className:"profileValue profileInlineField",children:[e.jsx("span",{children:"Your email is not verified."}),e.jsx("button",{onClick:ze,disabled:G||y>0,className:"homeBtn homeBtnGreen profileInlineButton",style:{opacity:G||y>0?.8:1,cursor:G||y>0?"not-allowed":"pointer"},children:G?"Sending...":y>0?`Wait ${y}s`:"Resend link"})]})]}),r&&!((ge=r.providerData)!=null&&ge.some(a=>a.providerId==="google.com"))&&e.jsxs("div",{className:"profileField",children:[e.jsx("label",{children:"Google account"}),e.jsxs("div",{className:"profileValue profileInlineField",children:[e.jsx("span",{children:"Not linked"}),e.jsx("button",{onClick:Me,disabled:z,className:"homeBtn homeBtnGreen profileInlineButton",style:{opacity:z?.8:1,cursor:z?"not-allowed":"pointer"},children:z?"Linking...":"Connect Google account"})]})]}),r&&((he=r.providerData)==null?void 0:he.some(a=>a.providerId==="google.com"))&&e.jsxs("div",{className:"profileField",children:[e.jsx("label",{children:"Google account"}),e.jsx("div",{className:"profileValue",children:"Linked"})]})]}),e.jsxs("div",{className:"profileSection profileSectionSpacing",children:[e.jsx("h2",{children:"Danger zone"}),e.jsxs("div",{className:"profileField",children:[e.jsx("label",{children:"Delete account"}),e.jsx("div",{className:"profileValue profileDangerText",children:"This will permanently delete your Wuzzle Games account and associated friends/challenge data from Wuzzle Games. You'll need to create a new account to sign in again."}),e.jsx("button",{onClick:Fe,disabled:D,className:"profileDangerButton",style:{cursor:D?"not-allowed":"pointer",opacity:D?.8:1},children:D?"Deleting account...":"Delete account"})]})]})]})]})]}),e.jsx(n.Suspense,{fallback:null,children:e.jsx(nt,{isOpen:u,onRequestClose:()=>i(!1)})}),e.jsx(at,{isOpen:te.isOpen,onRequestClose:()=>W({isOpen:!1,mode:null,speedrunEnabled:!1}),mode:te.mode,speedrunEnabled:te.speedrunEnabled}),e.jsx(rt,{isOpen:we,onRequestClose:()=>ie(!1)}),e.jsx(O,{isOpen:E!==null,onRequestClose:()=>q(null),children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("h2",{style:{margin:0,marginBottom:"24px",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:E!=null&&E.newCancelAtPeriodEnd?"Turn off auto-renew?":"Turn on auto-renew?"}),e.jsx("p",{style:{margin:0,marginBottom:"12px",color:"#d7dadc",fontSize:14},children:E!=null&&E.newCancelAtPeriodEnd?"You will keep access until the end of the current period.":"Your subscription will renew at the end of the current period."}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>q(null),style:{flex:1,padding:"12px",borderRadius:8,border:"1px solid #3A3A3C",background:"transparent",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(E===null)return;const a=E.newCancelAtPeriodEnd;q(null),await Ge(a)},style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Confirm"})]})]})}),e.jsx(O,{isOpen:Ae,onRequestClose:()=>J(!1),children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsx("h2",{style:{margin:0,marginBottom:"24px",fontSize:20,fontWeight:"bold",color:"#ffffff"},children:"Cancel subscription?"}),e.jsx("p",{style:{margin:0,marginBottom:"12px",color:"#d7dadc",fontSize:14},children:"You will keep premium until the end of the current period."}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"12px"},children:[e.jsx("button",{onClick:()=>J(!1),style:{flex:1,padding:"12px",borderRadius:8,border:"1px solid #3A3A3C",background:"transparent",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Cancel"}),e.jsx("button",{onClick:async()=>{J(!1),await De()},style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:"#e56b6f",color:"#ffffff",fontSize:14,fontWeight:"bold",cursor:"pointer"},children:"Confirm"})]})]})})]})})]})}export{it as default};