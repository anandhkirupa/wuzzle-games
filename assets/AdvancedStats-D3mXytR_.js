import{u as L,b as B,j as s,c as F,H,e as q}from"./prerender-BIIx8aII.js";import{u as Y,a as J,r as x}from"./vendor-BsMbSbDn.js";import{loadGameRecords as E,loadMarathonStageRecords as K,calculateMarathonSummaryFromGames as Q,calculateMarathonStageStats as U,calculateAdvancedStats as V,formatTime as o}from"./statsService-CnGeUBvE.js";const y=[{mode:"daily",speedrunEnabled:!1,label:"Daily Standard"},{mode:"daily",speedrunEnabled:!0,label:"Daily Speedrun"},{mode:"marathon",speedrunEnabled:!1,label:"Marathon Standard"},{mode:"marathon",speedrunEnabled:!0,label:"Marathon Speedrun"}];function es(){const C=Y(),[w,A]=J(),P=w.get("mode")||"daily",O=w.get("speedrun")==="true",{user:m,loading:T}=L(),{showSubscriptionGate:e}=B(m),[R,r]=x.useState(!1),[t,b]=x.useState(null),[c,g]=x.useState(null),[N,p]=x.useState(null),[G,$]=x.useState(!0),[k,f]=x.useState(null),u=y.some(a=>a.mode===P)?P:"daily",n=O;x.useEffect(()=>{m&&W()},[m,u,n]);async function W(){if(m)try{if($(!0),f(null),u==="marathon"){const[a,l]=await Promise.all([E({uid:m.uid,mode:u,speedrunEnabled:n}),K({uid:m.uid,speedrunEnabled:n})]);a===null?(f("Failed to load statistics."),b(null),g(null),p(null)):(b(null),g(Q(a,n)),p(U(l||[],n)))}else{const a=await E({uid:m.uid,mode:u,speedrunEnabled:n});a===null?(f("Failed to load statistics."),b(null)):(b(V(a)),g(null),p(null))}}catch(a){console.error("Failed to load stats:",a),f("Failed to load statistics."),b(null),g(null),p(null)}finally{$(!1)}}const _=(a,l)=>{A({mode:a,speedrun:l?"true":"false"})},S=()=>{const a=y.find(l=>l.mode===u&&l.speedrunEnabled===n);return a?a.label:`${u==="daily"?"Daily":"Marathon"} ${n?"Speedrun":"Standard"}`};if(!T&&!m)return C("/",{replace:!0}),null;if(T)return s.jsxs("div",{className:"stats-page",children:[s.jsx(F,{}),s.jsx("main",{className:"stats-main",children:s.jsx("div",{className:"stats-container",children:s.jsx("div",{className:"stats-loading",children:"Loadingâ€¦"})})})]});const D=`${S()} Statistics | Wuzzle Games`;function i({title:a,value:l,subtitle:h=null,locked:d=!1,onClick:v=null}){return s.jsxs("div",{className:`stats-card ${d?"stats-card--locked":""} ${d&&v?"stats-card--clickable":""}`,onClick:d&&v?v:void 0,role:d&&v?"button":void 0,children:[s.jsx("div",{className:"stats-card__label",children:a}),s.jsx("div",{className:"stats-card__value",children:d?"ðŸ”’":l}),h&&s.jsx("div",{className:"stats-card__subtitle",children:h}),d&&s.jsx("div",{className:"stats-card__premium",children:"Premium only"})]})}return s.jsxs(s.Fragment,{children:[s.jsxs(H,{children:[s.jsx("title",{children:D}),s.jsx("meta",{name:"description",content:`Your ${S()} statistics and performance on Wuzzle Games.`})]}),s.jsxs("div",{className:"stats-page",children:[s.jsx(F,{}),s.jsx("main",{className:"stats-main",children:s.jsxs("div",{className:"stats-container",children:[s.jsx("nav",{className:"stats-nav",children:s.jsx("button",{type:"button",className:"stats-back",onClick:()=>C("/profile"),children:"â† Back to Profile"})}),s.jsxs("header",{className:"stats-header",children:[s.jsx("h1",{className:"stats-title",children:"Statistics"}),s.jsx("p",{className:"stats-subtitle",children:S()}),s.jsx("div",{className:"stats-mode-tabs",children:y.map(a=>s.jsx("button",{type:"button",className:`stats-mode-tab ${a.mode===u&&a.speedrunEnabled===n?"stats-mode-tab--active":""}`,onClick:()=>_(a.mode,a.speedrunEnabled),children:a.label},`${a.mode}-${a.speedrunEnabled}`))}),e&&s.jsxs("p",{className:"stats-premium-cta",children:["Subscribe to unlock all statistics.",s.jsx("button",{type:"button",className:"stats-subscribe-btn",onClick:()=>r(!0),children:"Subscribe"})]})]}),G&&s.jsx("div",{className:"stats-loading",children:"Loading statisticsâ€¦"}),k&&s.jsx("div",{className:"stats-error",children:k}),!G&&!k&&(t||u==="marathon"&&c&&N)&&s.jsx(s.Fragment,{children:u==="marathon"&&c&&N?s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Overall marathon summary"}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(i,{title:"Total marathons completed",value:c.totalMarathons,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Average total guesses",value:c.averageTotalGuesses.toFixed(2),locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Best marathon",value:c.bestMarathonGuesses!=null?`${c.bestMarathonGuesses} guesses`:"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Worst marathon",value:c.worstMarathonGuesses!=null?`${c.worstMarathonGuesses} guesses`:"â€”",locked:e,onClick:()=>e&&r(!0)}),n&&s.jsxs(s.Fragment,{children:[s.jsx(i,{title:"Average marathon time",value:c.averageTimeMs!=null?o(c.averageTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Fastest marathon",value:c.fastestTimeMs!=null?o(c.fastestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Slowest marathon",value:c.slowestTimeMs!=null?o(c.slowestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)})]})]})]}),[1,2,3,4].map(a=>{const l=N.byStage[a],h=l&&l.solvedGames>0,d=(l==null?void 0:l.guessDistribution)??{1:0,2:0,3:0,4:0,5:0,6:0},v=Math.max(...Object.values(d),1);return s.jsxs("section",{className:"stats-section stats-section-stage",children:[s.jsxs("h2",{className:"stats-section-title",children:[a,"-board stage"]}),h?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"stats-chart-horizontal",children:[s.jsx("div",{className:"stats-chart-x-label",children:"Number of stage completions"}),s.jsx("div",{className:"stats-chart-body",children:[1,2,3,4,5,6].map(j=>{const M=d[j]||0,z=l.solvedGames>0?Math.round(M/l.solvedGames*100*100)/100:0,I=M/v*100;return s.jsxs("div",{className:"stats-chart-row",children:[s.jsxs("div",{className:"stats-chart-y-label",children:[j," ",j===1?"guess":"guesses"]}),s.jsx("div",{className:"stats-chart-bar-track",children:s.jsx("div",{className:"stats-chart-bar-fill",style:{width:`${I}%`}})}),s.jsxs("div",{className:"stats-chart-bar-meta",children:[s.jsx("span",{className:"stats-chart-bar-count",children:M}),s.jsxs("span",{className:"stats-chart-bar-pct",children:[z,"%"]})]})]},j)})})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(i,{title:"Stages completed",value:l.solvedGames,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Average guesses",value:l.averageGuesses.toFixed(2),locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Best",value:l.bestPerformance!=null?`${l.bestPerformance} guess${l.bestPerformance===1?"":"es"}`:"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Worst",value:l.worstPerformance!=null?`${l.worstPerformance} guesses`:"â€”",locked:e,onClick:()=>e&&r(!0)}),n&&l.averageTimeMs!=null&&s.jsxs(s.Fragment,{children:[s.jsx(i,{title:"Average stage time",value:o(l.averageTimeMs),locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Fastest stage",value:l.fastestTimeMs!=null?o(l.fastestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Slowest stage",value:l.slowestTimeMs!=null?o(l.slowestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)})]})]})]}):s.jsxs("p",{className:"stats-empty stats-empty-stage",children:["No ",a,"-board stage completions yet."]})]},a)}),c.totalMarathons===0&&N.totals.totalStages===0&&s.jsx("p",{className:"stats-empty",children:"No marathon statistics yet. Complete stages to see your stats."})]}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Guess distribution"}),s.jsxs("div",{className:"stats-chart-horizontal",children:[s.jsx("div",{className:"stats-chart-x-label",children:"Number of games"}),s.jsx("div",{className:"stats-chart-body",children:[1,2,3,4,5,6].map(a=>{const l=t.guessDistribution||{},h=l[a]||0,d=t.solvedGames>0?Math.round(h/t.solvedGames*100*100)/100:0,v=Math.max(1,...Object.values(l)),j=h/v*100;return s.jsxs("div",{className:"stats-chart-row",children:[s.jsxs("div",{className:"stats-chart-y-label",children:[a," ",a===1?"guess":"guesses"]}),s.jsx("div",{className:"stats-chart-bar-track",children:s.jsx("div",{className:"stats-chart-bar-fill",style:{width:`${j}%`}})}),s.jsxs("div",{className:"stats-chart-bar-meta",children:[s.jsx("span",{className:"stats-chart-bar-count",children:h}),s.jsxs("span",{className:"stats-chart-bar-pct",children:[d,"%"]})]})]},a)})})]})]}),s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Performance"}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(i,{title:"Total games solved",value:t.solvedGames,subtitle:`of ${t.totalGames} games`}),s.jsx(i,{title:"Win rate",value:`${t.winRate}%`,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Average guesses",value:t.averageGuesses.toFixed(2),locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Median guesses",value:t.medianGuesses,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Best",value:t.bestPerformance!==null?`${t.bestPerformance} guess${t.bestPerformance===1?"":"es"}`:"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Worst",value:t.worstPerformance!==null?`${t.worstPerformance} guesses`:"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Perfect games",value:t.perfectGames,subtitle:`${t.perfectGamesPercentage}% of solved`,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Solved in 3 or fewer",value:t.gamesSolvedIn3OrFewer,subtitle:`${t.gamesSolvedIn3OrFewerPercentage}% of solved`,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Solved in 4 or fewer",value:t.gamesSolvedIn4OrFewer,subtitle:`${t.gamesSolvedIn4OrFewerPercentage}% of solved`,locked:e,onClick:()=>e&&r(!0)})]})]}),n&&s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Time-based"}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(i,{title:"Average solve time",value:t.averageTimeMs!=null?o(t.averageTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Median solve time",value:t.medianTimeMs!=null?o(t.medianTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Fastest solve",value:t.fastestTimeMs!=null?o(t.fastestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Slowest solve",value:t.slowestTimeMs!=null?o(t.slowestTimeMs):"â€”",locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Avg time per guess",value:t.averageTimePerGuess!=null?o(t.averageTimePerGuess):"â€”",locked:e,onClick:()=>e&&r(!0)})]})]}),t.sub30Count!==void 0&&s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Speed categories"}),s.jsxs("div",{className:"stats-grid",children:[s.jsx(i,{title:"Sub-30s",value:t.sub30Count,subtitle:`${t.sub30Percentage}% of solved`,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Sub-1 min",value:t.sub60Count,subtitle:`${t.sub60Percentage}% of solved`,locked:e,onClick:()=>e&&r(!0)}),s.jsx(i,{title:"Sub-2 min",value:t.sub120Count,subtitle:`${t.sub120Percentage}% of solved`,locked:e,onClick:()=>e&&r(!0)})]})]}),t.avgTimeMsByGuesses&&s.jsxs("section",{className:"stats-section",children:[s.jsx("h2",{className:"stats-section-title",children:"Average time by guess count"}),s.jsx("div",{className:"stats-time-by-guess",children:[1,2,3,4,5,6].map(a=>{const l=t.avgTimeMsByGuesses[a];return s.jsxs("div",{className:"stats-time-by-guess-row",children:[s.jsxs("span",{className:"stats-time-by-guess-label",children:[a," ",a===1?"guess":"guesses"]}),s.jsx("span",{className:"stats-time-by-guess-value",children:l!=null?o(l):"â€”"})]},a)})})]})]}),t.solvedGames===0&&s.jsx("p",{className:"stats-empty",children:"No statistics yet. Complete some games to see your stats."})]})})]})})]}),s.jsx(q,{isOpen:R,onRequestClose:()=>r(!1),onSubscriptionComplete:()=>r(!1)})]})}export{es as default};